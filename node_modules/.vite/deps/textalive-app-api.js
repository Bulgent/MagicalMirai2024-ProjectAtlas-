import {
  __commonJS,
  __toESM
} from "./chunk-ZS7NZCD4.js";

// node_modules/axios/lib/helpers/bind.js
var require_bind = __commonJS({
  "node_modules/axios/lib/helpers/bind.js"(exports, module) {
    "use strict";
    module.exports = function bind(fn2, thisArg) {
      return function wrap() {
        var args = new Array(arguments.length);
        for (var i2 = 0; i2 < args.length; i2++) {
          args[i2] = arguments[i2];
        }
        return fn2.apply(thisArg, args);
      };
    };
  }
});

// node_modules/axios/lib/utils.js
var require_utils = __commonJS({
  "node_modules/axios/lib/utils.js"(exports, module) {
    "use strict";
    var bind = require_bind();
    var toString = Object.prototype.toString;
    function isArray(val) {
      return toString.call(val) === "[object Array]";
    }
    function isUndefined(val) {
      return typeof val === "undefined";
    }
    function isBuffer(val) {
      return val !== null && !isUndefined(val) && val.constructor !== null && !isUndefined(val.constructor) && typeof val.constructor.isBuffer === "function" && val.constructor.isBuffer(val);
    }
    function isArrayBuffer(val) {
      return toString.call(val) === "[object ArrayBuffer]";
    }
    function isFormData(val) {
      return typeof FormData !== "undefined" && val instanceof FormData;
    }
    function isArrayBufferView(val) {
      var result;
      if (typeof ArrayBuffer !== "undefined" && ArrayBuffer.isView) {
        result = ArrayBuffer.isView(val);
      } else {
        result = val && val.buffer && val.buffer instanceof ArrayBuffer;
      }
      return result;
    }
    function isString(val) {
      return typeof val === "string";
    }
    function isNumber(val) {
      return typeof val === "number";
    }
    function isObject(val) {
      return val !== null && typeof val === "object";
    }
    function isPlainObject(val) {
      if (toString.call(val) !== "[object Object]") {
        return false;
      }
      var prototype = Object.getPrototypeOf(val);
      return prototype === null || prototype === Object.prototype;
    }
    function isDate(val) {
      return toString.call(val) === "[object Date]";
    }
    function isFile(val) {
      return toString.call(val) === "[object File]";
    }
    function isBlob(val) {
      return toString.call(val) === "[object Blob]";
    }
    function isFunction(val) {
      return toString.call(val) === "[object Function]";
    }
    function isStream(val) {
      return isObject(val) && isFunction(val.pipe);
    }
    function isURLSearchParams(val) {
      return typeof URLSearchParams !== "undefined" && val instanceof URLSearchParams;
    }
    function trim(str) {
      return str.trim ? str.trim() : str.replace(/^\s+|\s+$/g, "");
    }
    function isStandardBrowserEnv() {
      if (typeof navigator !== "undefined" && (navigator.product === "ReactNative" || navigator.product === "NativeScript" || navigator.product === "NS")) {
        return false;
      }
      return typeof window !== "undefined" && typeof document !== "undefined";
    }
    function forEach(obj, fn2) {
      if (obj === null || typeof obj === "undefined") {
        return;
      }
      if (typeof obj !== "object") {
        obj = [obj];
      }
      if (isArray(obj)) {
        for (var i2 = 0, l2 = obj.length; i2 < l2; i2++) {
          fn2.call(null, obj[i2], i2, obj);
        }
      } else {
        for (var key in obj) {
          if (Object.prototype.hasOwnProperty.call(obj, key)) {
            fn2.call(null, obj[key], key, obj);
          }
        }
      }
    }
    function merge() {
      var result = {};
      function assignValue(val, key) {
        if (isPlainObject(result[key]) && isPlainObject(val)) {
          result[key] = merge(result[key], val);
        } else if (isPlainObject(val)) {
          result[key] = merge({}, val);
        } else if (isArray(val)) {
          result[key] = val.slice();
        } else {
          result[key] = val;
        }
      }
      for (var i2 = 0, l2 = arguments.length; i2 < l2; i2++) {
        forEach(arguments[i2], assignValue);
      }
      return result;
    }
    function extend(a2, b2, thisArg) {
      forEach(b2, function assignValue(val, key) {
        if (thisArg && typeof val === "function") {
          a2[key] = bind(val, thisArg);
        } else {
          a2[key] = val;
        }
      });
      return a2;
    }
    function stripBOM(content) {
      if (content.charCodeAt(0) === 65279) {
        content = content.slice(1);
      }
      return content;
    }
    module.exports = {
      isArray,
      isArrayBuffer,
      isBuffer,
      isFormData,
      isArrayBufferView,
      isString,
      isNumber,
      isObject,
      isPlainObject,
      isUndefined,
      isDate,
      isFile,
      isBlob,
      isFunction,
      isStream,
      isURLSearchParams,
      isStandardBrowserEnv,
      forEach,
      merge,
      extend,
      trim,
      stripBOM
    };
  }
});

// node_modules/axios/lib/helpers/buildURL.js
var require_buildURL = __commonJS({
  "node_modules/axios/lib/helpers/buildURL.js"(exports, module) {
    "use strict";
    var utils = require_utils();
    function encode(val) {
      return encodeURIComponent(val).replace(/%3A/gi, ":").replace(/%24/g, "$").replace(/%2C/gi, ",").replace(/%20/g, "+").replace(/%5B/gi, "[").replace(/%5D/gi, "]");
    }
    module.exports = function buildURL(url, params, paramsSerializer) {
      if (!params) {
        return url;
      }
      var serializedParams;
      if (paramsSerializer) {
        serializedParams = paramsSerializer(params);
      } else if (utils.isURLSearchParams(params)) {
        serializedParams = params.toString();
      } else {
        var parts = [];
        utils.forEach(params, function serialize(val, key) {
          if (val === null || typeof val === "undefined") {
            return;
          }
          if (utils.isArray(val)) {
            key = key + "[]";
          } else {
            val = [val];
          }
          utils.forEach(val, function parseValue(v2) {
            if (utils.isDate(v2)) {
              v2 = v2.toISOString();
            } else if (utils.isObject(v2)) {
              v2 = JSON.stringify(v2);
            }
            parts.push(encode(key) + "=" + encode(v2));
          });
        });
        serializedParams = parts.join("&");
      }
      if (serializedParams) {
        var hashmarkIndex = url.indexOf("#");
        if (hashmarkIndex !== -1) {
          url = url.slice(0, hashmarkIndex);
        }
        url += (url.indexOf("?") === -1 ? "?" : "&") + serializedParams;
      }
      return url;
    };
  }
});

// node_modules/axios/lib/core/InterceptorManager.js
var require_InterceptorManager = __commonJS({
  "node_modules/axios/lib/core/InterceptorManager.js"(exports, module) {
    "use strict";
    var utils = require_utils();
    function InterceptorManager() {
      this.handlers = [];
    }
    InterceptorManager.prototype.use = function use(fulfilled, rejected, options) {
      this.handlers.push({
        fulfilled,
        rejected,
        synchronous: options ? options.synchronous : false,
        runWhen: options ? options.runWhen : null
      });
      return this.handlers.length - 1;
    };
    InterceptorManager.prototype.eject = function eject(id) {
      if (this.handlers[id]) {
        this.handlers[id] = null;
      }
    };
    InterceptorManager.prototype.forEach = function forEach(fn2) {
      utils.forEach(this.handlers, function forEachHandler(h2) {
        if (h2 !== null) {
          fn2(h2);
        }
      });
    };
    module.exports = InterceptorManager;
  }
});

// node_modules/axios/lib/helpers/normalizeHeaderName.js
var require_normalizeHeaderName = __commonJS({
  "node_modules/axios/lib/helpers/normalizeHeaderName.js"(exports, module) {
    "use strict";
    var utils = require_utils();
    module.exports = function normalizeHeaderName(headers, normalizedName) {
      utils.forEach(headers, function processHeader(value, name2) {
        if (name2 !== normalizedName && name2.toUpperCase() === normalizedName.toUpperCase()) {
          headers[normalizedName] = value;
          delete headers[name2];
        }
      });
    };
  }
});

// node_modules/axios/lib/core/enhanceError.js
var require_enhanceError = __commonJS({
  "node_modules/axios/lib/core/enhanceError.js"(exports, module) {
    "use strict";
    module.exports = function enhanceError(error, config, code, request, response) {
      error.config = config;
      if (code) {
        error.code = code;
      }
      error.request = request;
      error.response = response;
      error.isAxiosError = true;
      error.toJSON = function toJSON() {
        return {
          // Standard
          message: this.message,
          name: this.name,
          // Microsoft
          description: this.description,
          number: this.number,
          // Mozilla
          fileName: this.fileName,
          lineNumber: this.lineNumber,
          columnNumber: this.columnNumber,
          stack: this.stack,
          // Axios
          config: this.config,
          code: this.code,
          status: this.response && this.response.status ? this.response.status : null
        };
      };
      return error;
    };
  }
});

// node_modules/axios/lib/core/createError.js
var require_createError = __commonJS({
  "node_modules/axios/lib/core/createError.js"(exports, module) {
    "use strict";
    var enhanceError = require_enhanceError();
    module.exports = function createError(message, config, code, request, response) {
      var error = new Error(message);
      return enhanceError(error, config, code, request, response);
    };
  }
});

// node_modules/axios/lib/core/settle.js
var require_settle = __commonJS({
  "node_modules/axios/lib/core/settle.js"(exports, module) {
    "use strict";
    var createError = require_createError();
    module.exports = function settle(resolve, reject, response) {
      var validateStatus = response.config.validateStatus;
      if (!response.status || !validateStatus || validateStatus(response.status)) {
        resolve(response);
      } else {
        reject(createError(
          "Request failed with status code " + response.status,
          response.config,
          null,
          response.request,
          response
        ));
      }
    };
  }
});

// node_modules/axios/lib/helpers/cookies.js
var require_cookies = __commonJS({
  "node_modules/axios/lib/helpers/cookies.js"(exports, module) {
    "use strict";
    var utils = require_utils();
    module.exports = utils.isStandardBrowserEnv() ? (
      // Standard browser envs support document.cookie
      /* @__PURE__ */ function standardBrowserEnv() {
        return {
          write: function write(name2, value, expires, path, domain, secure) {
            var cookie = [];
            cookie.push(name2 + "=" + encodeURIComponent(value));
            if (utils.isNumber(expires)) {
              cookie.push("expires=" + new Date(expires).toGMTString());
            }
            if (utils.isString(path)) {
              cookie.push("path=" + path);
            }
            if (utils.isString(domain)) {
              cookie.push("domain=" + domain);
            }
            if (secure === true) {
              cookie.push("secure");
            }
            document.cookie = cookie.join("; ");
          },
          read: function read(name2) {
            var match = document.cookie.match(new RegExp("(^|;\\s*)(" + name2 + ")=([^;]*)"));
            return match ? decodeURIComponent(match[3]) : null;
          },
          remove: function remove(name2) {
            this.write(name2, "", Date.now() - 864e5);
          }
        };
      }()
    ) : (
      // Non standard browser env (web workers, react-native) lack needed support.
      /* @__PURE__ */ function nonStandardBrowserEnv() {
        return {
          write: function write() {
          },
          read: function read() {
            return null;
          },
          remove: function remove() {
          }
        };
      }()
    );
  }
});

// node_modules/axios/lib/helpers/isAbsoluteURL.js
var require_isAbsoluteURL = __commonJS({
  "node_modules/axios/lib/helpers/isAbsoluteURL.js"(exports, module) {
    "use strict";
    module.exports = function isAbsoluteURL(url) {
      return /^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(url);
    };
  }
});

// node_modules/axios/lib/helpers/combineURLs.js
var require_combineURLs = __commonJS({
  "node_modules/axios/lib/helpers/combineURLs.js"(exports, module) {
    "use strict";
    module.exports = function combineURLs(baseURL, relativeURL) {
      return relativeURL ? baseURL.replace(/\/+$/, "") + "/" + relativeURL.replace(/^\/+/, "") : baseURL;
    };
  }
});

// node_modules/axios/lib/core/buildFullPath.js
var require_buildFullPath = __commonJS({
  "node_modules/axios/lib/core/buildFullPath.js"(exports, module) {
    "use strict";
    var isAbsoluteURL = require_isAbsoluteURL();
    var combineURLs = require_combineURLs();
    module.exports = function buildFullPath(baseURL, requestedURL) {
      if (baseURL && !isAbsoluteURL(requestedURL)) {
        return combineURLs(baseURL, requestedURL);
      }
      return requestedURL;
    };
  }
});

// node_modules/axios/lib/helpers/parseHeaders.js
var require_parseHeaders = __commonJS({
  "node_modules/axios/lib/helpers/parseHeaders.js"(exports, module) {
    "use strict";
    var utils = require_utils();
    var ignoreDuplicateOf = [
      "age",
      "authorization",
      "content-length",
      "content-type",
      "etag",
      "expires",
      "from",
      "host",
      "if-modified-since",
      "if-unmodified-since",
      "last-modified",
      "location",
      "max-forwards",
      "proxy-authorization",
      "referer",
      "retry-after",
      "user-agent"
    ];
    module.exports = function parseHeaders(headers) {
      var parsed = {};
      var key;
      var val;
      var i2;
      if (!headers) {
        return parsed;
      }
      utils.forEach(headers.split("\n"), function parser(line) {
        i2 = line.indexOf(":");
        key = utils.trim(line.substr(0, i2)).toLowerCase();
        val = utils.trim(line.substr(i2 + 1));
        if (key) {
          if (parsed[key] && ignoreDuplicateOf.indexOf(key) >= 0) {
            return;
          }
          if (key === "set-cookie") {
            parsed[key] = (parsed[key] ? parsed[key] : []).concat([val]);
          } else {
            parsed[key] = parsed[key] ? parsed[key] + ", " + val : val;
          }
        }
      });
      return parsed;
    };
  }
});

// node_modules/axios/lib/helpers/isURLSameOrigin.js
var require_isURLSameOrigin = __commonJS({
  "node_modules/axios/lib/helpers/isURLSameOrigin.js"(exports, module) {
    "use strict";
    var utils = require_utils();
    module.exports = utils.isStandardBrowserEnv() ? (
      // Standard browser envs have full support of the APIs needed to test
      // whether the request URL is of the same origin as current location.
      function standardBrowserEnv() {
        var msie = /(msie|trident)/i.test(navigator.userAgent);
        var urlParsingNode = document.createElement("a");
        var originURL;
        function resolveURL(url) {
          var href = url;
          if (msie) {
            urlParsingNode.setAttribute("href", href);
            href = urlParsingNode.href;
          }
          urlParsingNode.setAttribute("href", href);
          return {
            href: urlParsingNode.href,
            protocol: urlParsingNode.protocol ? urlParsingNode.protocol.replace(/:$/, "") : "",
            host: urlParsingNode.host,
            search: urlParsingNode.search ? urlParsingNode.search.replace(/^\?/, "") : "",
            hash: urlParsingNode.hash ? urlParsingNode.hash.replace(/^#/, "") : "",
            hostname: urlParsingNode.hostname,
            port: urlParsingNode.port,
            pathname: urlParsingNode.pathname.charAt(0) === "/" ? urlParsingNode.pathname : "/" + urlParsingNode.pathname
          };
        }
        originURL = resolveURL(window.location.href);
        return function isURLSameOrigin(requestURL) {
          var parsed = utils.isString(requestURL) ? resolveURL(requestURL) : requestURL;
          return parsed.protocol === originURL.protocol && parsed.host === originURL.host;
        };
      }()
    ) : (
      // Non standard browser envs (web workers, react-native) lack needed support.
      /* @__PURE__ */ function nonStandardBrowserEnv() {
        return function isURLSameOrigin() {
          return true;
        };
      }()
    );
  }
});

// node_modules/axios/lib/cancel/Cancel.js
var require_Cancel = __commonJS({
  "node_modules/axios/lib/cancel/Cancel.js"(exports, module) {
    "use strict";
    function Cancel(message) {
      this.message = message;
    }
    Cancel.prototype.toString = function toString() {
      return "Cancel" + (this.message ? ": " + this.message : "");
    };
    Cancel.prototype.__CANCEL__ = true;
    module.exports = Cancel;
  }
});

// node_modules/axios/lib/adapters/xhr.js
var require_xhr = __commonJS({
  "node_modules/axios/lib/adapters/xhr.js"(exports, module) {
    "use strict";
    var utils = require_utils();
    var settle = require_settle();
    var cookies = require_cookies();
    var buildURL = require_buildURL();
    var buildFullPath = require_buildFullPath();
    var parseHeaders = require_parseHeaders();
    var isURLSameOrigin = require_isURLSameOrigin();
    var createError = require_createError();
    var defaults = require_defaults();
    var Cancel = require_Cancel();
    module.exports = function xhrAdapter(config) {
      return new Promise(function dispatchXhrRequest(resolve, reject) {
        var requestData = config.data;
        var requestHeaders = config.headers;
        var responseType = config.responseType;
        var onCanceled;
        function done() {
          if (config.cancelToken) {
            config.cancelToken.unsubscribe(onCanceled);
          }
          if (config.signal) {
            config.signal.removeEventListener("abort", onCanceled);
          }
        }
        if (utils.isFormData(requestData)) {
          delete requestHeaders["Content-Type"];
        }
        var request = new XMLHttpRequest();
        if (config.auth) {
          var username = config.auth.username || "";
          var password = config.auth.password ? unescape(encodeURIComponent(config.auth.password)) : "";
          requestHeaders.Authorization = "Basic " + btoa(username + ":" + password);
        }
        var fullPath = buildFullPath(config.baseURL, config.url);
        request.open(config.method.toUpperCase(), buildURL(fullPath, config.params, config.paramsSerializer), true);
        request.timeout = config.timeout;
        function onloadend() {
          if (!request) {
            return;
          }
          var responseHeaders = "getAllResponseHeaders" in request ? parseHeaders(request.getAllResponseHeaders()) : null;
          var responseData = !responseType || responseType === "text" || responseType === "json" ? request.responseText : request.response;
          var response = {
            data: responseData,
            status: request.status,
            statusText: request.statusText,
            headers: responseHeaders,
            config,
            request
          };
          settle(function _resolve(value) {
            resolve(value);
            done();
          }, function _reject(err) {
            reject(err);
            done();
          }, response);
          request = null;
        }
        if ("onloadend" in request) {
          request.onloadend = onloadend;
        } else {
          request.onreadystatechange = function handleLoad() {
            if (!request || request.readyState !== 4) {
              return;
            }
            if (request.status === 0 && !(request.responseURL && request.responseURL.indexOf("file:") === 0)) {
              return;
            }
            setTimeout(onloadend);
          };
        }
        request.onabort = function handleAbort() {
          if (!request) {
            return;
          }
          reject(createError("Request aborted", config, "ECONNABORTED", request));
          request = null;
        };
        request.onerror = function handleError() {
          reject(createError("Network Error", config, null, request));
          request = null;
        };
        request.ontimeout = function handleTimeout() {
          var timeoutErrorMessage = config.timeout ? "timeout of " + config.timeout + "ms exceeded" : "timeout exceeded";
          var transitional = config.transitional || defaults.transitional;
          if (config.timeoutErrorMessage) {
            timeoutErrorMessage = config.timeoutErrorMessage;
          }
          reject(createError(
            timeoutErrorMessage,
            config,
            transitional.clarifyTimeoutError ? "ETIMEDOUT" : "ECONNABORTED",
            request
          ));
          request = null;
        };
        if (utils.isStandardBrowserEnv()) {
          var xsrfValue = (config.withCredentials || isURLSameOrigin(fullPath)) && config.xsrfCookieName ? cookies.read(config.xsrfCookieName) : void 0;
          if (xsrfValue) {
            requestHeaders[config.xsrfHeaderName] = xsrfValue;
          }
        }
        if ("setRequestHeader" in request) {
          utils.forEach(requestHeaders, function setRequestHeader(val, key) {
            if (typeof requestData === "undefined" && key.toLowerCase() === "content-type") {
              delete requestHeaders[key];
            } else {
              request.setRequestHeader(key, val);
            }
          });
        }
        if (!utils.isUndefined(config.withCredentials)) {
          request.withCredentials = !!config.withCredentials;
        }
        if (responseType && responseType !== "json") {
          request.responseType = config.responseType;
        }
        if (typeof config.onDownloadProgress === "function") {
          request.addEventListener("progress", config.onDownloadProgress);
        }
        if (typeof config.onUploadProgress === "function" && request.upload) {
          request.upload.addEventListener("progress", config.onUploadProgress);
        }
        if (config.cancelToken || config.signal) {
          onCanceled = function(cancel) {
            if (!request) {
              return;
            }
            reject(!cancel || cancel && cancel.type ? new Cancel("canceled") : cancel);
            request.abort();
            request = null;
          };
          config.cancelToken && config.cancelToken.subscribe(onCanceled);
          if (config.signal) {
            config.signal.aborted ? onCanceled() : config.signal.addEventListener("abort", onCanceled);
          }
        }
        if (!requestData) {
          requestData = null;
        }
        request.send(requestData);
      });
    };
  }
});

// node_modules/axios/lib/defaults.js
var require_defaults = __commonJS({
  "node_modules/axios/lib/defaults.js"(exports, module) {
    "use strict";
    var utils = require_utils();
    var normalizeHeaderName = require_normalizeHeaderName();
    var enhanceError = require_enhanceError();
    var DEFAULT_CONTENT_TYPE = {
      "Content-Type": "application/x-www-form-urlencoded"
    };
    function setContentTypeIfUnset(headers, value) {
      if (!utils.isUndefined(headers) && utils.isUndefined(headers["Content-Type"])) {
        headers["Content-Type"] = value;
      }
    }
    function getDefaultAdapter() {
      var adapter;
      if (typeof XMLHttpRequest !== "undefined") {
        adapter = require_xhr();
      } else if (typeof process !== "undefined" && Object.prototype.toString.call(process) === "[object process]") {
        adapter = require_xhr();
      }
      return adapter;
    }
    function stringifySafely(rawValue, parser, encoder) {
      if (utils.isString(rawValue)) {
        try {
          (parser || JSON.parse)(rawValue);
          return utils.trim(rawValue);
        } catch (e2) {
          if (e2.name !== "SyntaxError") {
            throw e2;
          }
        }
      }
      return (encoder || JSON.stringify)(rawValue);
    }
    var defaults = {
      transitional: {
        silentJSONParsing: true,
        forcedJSONParsing: true,
        clarifyTimeoutError: false
      },
      adapter: getDefaultAdapter(),
      transformRequest: [function transformRequest(data, headers) {
        normalizeHeaderName(headers, "Accept");
        normalizeHeaderName(headers, "Content-Type");
        if (utils.isFormData(data) || utils.isArrayBuffer(data) || utils.isBuffer(data) || utils.isStream(data) || utils.isFile(data) || utils.isBlob(data)) {
          return data;
        }
        if (utils.isArrayBufferView(data)) {
          return data.buffer;
        }
        if (utils.isURLSearchParams(data)) {
          setContentTypeIfUnset(headers, "application/x-www-form-urlencoded;charset=utf-8");
          return data.toString();
        }
        if (utils.isObject(data) || headers && headers["Content-Type"] === "application/json") {
          setContentTypeIfUnset(headers, "application/json");
          return stringifySafely(data);
        }
        return data;
      }],
      transformResponse: [function transformResponse(data) {
        var transitional = this.transitional || defaults.transitional;
        var silentJSONParsing = transitional && transitional.silentJSONParsing;
        var forcedJSONParsing = transitional && transitional.forcedJSONParsing;
        var strictJSONParsing = !silentJSONParsing && this.responseType === "json";
        if (strictJSONParsing || forcedJSONParsing && utils.isString(data) && data.length) {
          try {
            return JSON.parse(data);
          } catch (e2) {
            if (strictJSONParsing) {
              if (e2.name === "SyntaxError") {
                throw enhanceError(e2, this, "E_JSON_PARSE");
              }
              throw e2;
            }
          }
        }
        return data;
      }],
      /**
       * A timeout in milliseconds to abort a request. If set to 0 (default) a
       * timeout is not created.
       */
      timeout: 0,
      xsrfCookieName: "XSRF-TOKEN",
      xsrfHeaderName: "X-XSRF-TOKEN",
      maxContentLength: -1,
      maxBodyLength: -1,
      validateStatus: function validateStatus(status) {
        return status >= 200 && status < 300;
      },
      headers: {
        common: {
          "Accept": "application/json, text/plain, */*"
        }
      }
    };
    utils.forEach(["delete", "get", "head"], function forEachMethodNoData(method) {
      defaults.headers[method] = {};
    });
    utils.forEach(["post", "put", "patch"], function forEachMethodWithData(method) {
      defaults.headers[method] = utils.merge(DEFAULT_CONTENT_TYPE);
    });
    module.exports = defaults;
  }
});

// node_modules/axios/lib/core/transformData.js
var require_transformData = __commonJS({
  "node_modules/axios/lib/core/transformData.js"(exports, module) {
    "use strict";
    var utils = require_utils();
    var defaults = require_defaults();
    module.exports = function transformData(data, headers, fns) {
      var context = this || defaults;
      utils.forEach(fns, function transform(fn2) {
        data = fn2.call(context, data, headers);
      });
      return data;
    };
  }
});

// node_modules/axios/lib/cancel/isCancel.js
var require_isCancel = __commonJS({
  "node_modules/axios/lib/cancel/isCancel.js"(exports, module) {
    "use strict";
    module.exports = function isCancel(value) {
      return !!(value && value.__CANCEL__);
    };
  }
});

// node_modules/axios/lib/core/dispatchRequest.js
var require_dispatchRequest = __commonJS({
  "node_modules/axios/lib/core/dispatchRequest.js"(exports, module) {
    "use strict";
    var utils = require_utils();
    var transformData = require_transformData();
    var isCancel = require_isCancel();
    var defaults = require_defaults();
    var Cancel = require_Cancel();
    function throwIfCancellationRequested(config) {
      if (config.cancelToken) {
        config.cancelToken.throwIfRequested();
      }
      if (config.signal && config.signal.aborted) {
        throw new Cancel("canceled");
      }
    }
    module.exports = function dispatchRequest(config) {
      throwIfCancellationRequested(config);
      config.headers = config.headers || {};
      config.data = transformData.call(
        config,
        config.data,
        config.headers,
        config.transformRequest
      );
      config.headers = utils.merge(
        config.headers.common || {},
        config.headers[config.method] || {},
        config.headers
      );
      utils.forEach(
        ["delete", "get", "head", "post", "put", "patch", "common"],
        function cleanHeaderConfig(method) {
          delete config.headers[method];
        }
      );
      var adapter = config.adapter || defaults.adapter;
      return adapter(config).then(function onAdapterResolution(response) {
        throwIfCancellationRequested(config);
        response.data = transformData.call(
          config,
          response.data,
          response.headers,
          config.transformResponse
        );
        return response;
      }, function onAdapterRejection(reason) {
        if (!isCancel(reason)) {
          throwIfCancellationRequested(config);
          if (reason && reason.response) {
            reason.response.data = transformData.call(
              config,
              reason.response.data,
              reason.response.headers,
              config.transformResponse
            );
          }
        }
        return Promise.reject(reason);
      });
    };
  }
});

// node_modules/axios/lib/core/mergeConfig.js
var require_mergeConfig = __commonJS({
  "node_modules/axios/lib/core/mergeConfig.js"(exports, module) {
    "use strict";
    var utils = require_utils();
    module.exports = function mergeConfig(config1, config2) {
      config2 = config2 || {};
      var config = {};
      function getMergedValue(target, source) {
        if (utils.isPlainObject(target) && utils.isPlainObject(source)) {
          return utils.merge(target, source);
        } else if (utils.isPlainObject(source)) {
          return utils.merge({}, source);
        } else if (utils.isArray(source)) {
          return source.slice();
        }
        return source;
      }
      function mergeDeepProperties(prop) {
        if (!utils.isUndefined(config2[prop])) {
          return getMergedValue(config1[prop], config2[prop]);
        } else if (!utils.isUndefined(config1[prop])) {
          return getMergedValue(void 0, config1[prop]);
        }
      }
      function valueFromConfig2(prop) {
        if (!utils.isUndefined(config2[prop])) {
          return getMergedValue(void 0, config2[prop]);
        }
      }
      function defaultToConfig2(prop) {
        if (!utils.isUndefined(config2[prop])) {
          return getMergedValue(void 0, config2[prop]);
        } else if (!utils.isUndefined(config1[prop])) {
          return getMergedValue(void 0, config1[prop]);
        }
      }
      function mergeDirectKeys(prop) {
        if (prop in config2) {
          return getMergedValue(config1[prop], config2[prop]);
        } else if (prop in config1) {
          return getMergedValue(void 0, config1[prop]);
        }
      }
      var mergeMap = {
        "url": valueFromConfig2,
        "method": valueFromConfig2,
        "data": valueFromConfig2,
        "baseURL": defaultToConfig2,
        "transformRequest": defaultToConfig2,
        "transformResponse": defaultToConfig2,
        "paramsSerializer": defaultToConfig2,
        "timeout": defaultToConfig2,
        "timeoutMessage": defaultToConfig2,
        "withCredentials": defaultToConfig2,
        "adapter": defaultToConfig2,
        "responseType": defaultToConfig2,
        "xsrfCookieName": defaultToConfig2,
        "xsrfHeaderName": defaultToConfig2,
        "onUploadProgress": defaultToConfig2,
        "onDownloadProgress": defaultToConfig2,
        "decompress": defaultToConfig2,
        "maxContentLength": defaultToConfig2,
        "maxBodyLength": defaultToConfig2,
        "transport": defaultToConfig2,
        "httpAgent": defaultToConfig2,
        "httpsAgent": defaultToConfig2,
        "cancelToken": defaultToConfig2,
        "socketPath": defaultToConfig2,
        "responseEncoding": defaultToConfig2,
        "validateStatus": mergeDirectKeys
      };
      utils.forEach(Object.keys(config1).concat(Object.keys(config2)), function computeConfigValue(prop) {
        var merge = mergeMap[prop] || mergeDeepProperties;
        var configValue = merge(prop);
        utils.isUndefined(configValue) && merge !== mergeDirectKeys || (config[prop] = configValue);
      });
      return config;
    };
  }
});

// node_modules/axios/lib/env/data.js
var require_data = __commonJS({
  "node_modules/axios/lib/env/data.js"(exports, module) {
    module.exports = {
      "version": "0.23.0"
    };
  }
});

// node_modules/axios/lib/helpers/validator.js
var require_validator = __commonJS({
  "node_modules/axios/lib/helpers/validator.js"(exports, module) {
    "use strict";
    var VERSION = require_data().version;
    var validators = {};
    ["object", "boolean", "number", "function", "string", "symbol"].forEach(function(type, i2) {
      validators[type] = function validator(thing) {
        return typeof thing === type || "a" + (i2 < 1 ? "n " : " ") + type;
      };
    });
    var deprecatedWarnings = {};
    validators.transitional = function transitional(validator, version, message) {
      function formatMessage(opt, desc) {
        return "[Axios v" + VERSION + "] Transitional option '" + opt + "'" + desc + (message ? ". " + message : "");
      }
      return function(value, opt, opts) {
        if (validator === false) {
          throw new Error(formatMessage(opt, " has been removed" + (version ? " in " + version : "")));
        }
        if (version && !deprecatedWarnings[opt]) {
          deprecatedWarnings[opt] = true;
          console.warn(
            formatMessage(
              opt,
              " has been deprecated since v" + version + " and will be removed in the near future"
            )
          );
        }
        return validator ? validator(value, opt, opts) : true;
      };
    };
    function assertOptions(options, schema, allowUnknown) {
      if (typeof options !== "object") {
        throw new TypeError("options must be an object");
      }
      var keys = Object.keys(options);
      var i2 = keys.length;
      while (i2-- > 0) {
        var opt = keys[i2];
        var validator = schema[opt];
        if (validator) {
          var value = options[opt];
          var result = value === void 0 || validator(value, opt, options);
          if (result !== true) {
            throw new TypeError("option " + opt + " must be " + result);
          }
          continue;
        }
        if (allowUnknown !== true) {
          throw Error("Unknown option " + opt);
        }
      }
    }
    module.exports = {
      assertOptions,
      validators
    };
  }
});

// node_modules/axios/lib/core/Axios.js
var require_Axios = __commonJS({
  "node_modules/axios/lib/core/Axios.js"(exports, module) {
    "use strict";
    var utils = require_utils();
    var buildURL = require_buildURL();
    var InterceptorManager = require_InterceptorManager();
    var dispatchRequest = require_dispatchRequest();
    var mergeConfig = require_mergeConfig();
    var validator = require_validator();
    var validators = validator.validators;
    function Axios(instanceConfig) {
      this.defaults = instanceConfig;
      this.interceptors = {
        request: new InterceptorManager(),
        response: new InterceptorManager()
      };
    }
    Axios.prototype.request = function request(config) {
      if (typeof config === "string") {
        config = arguments[1] || {};
        config.url = arguments[0];
      } else {
        config = config || {};
      }
      config = mergeConfig(this.defaults, config);
      if (config.method) {
        config.method = config.method.toLowerCase();
      } else if (this.defaults.method) {
        config.method = this.defaults.method.toLowerCase();
      } else {
        config.method = "get";
      }
      var transitional = config.transitional;
      if (transitional !== void 0) {
        validator.assertOptions(transitional, {
          silentJSONParsing: validators.transitional(validators.boolean),
          forcedJSONParsing: validators.transitional(validators.boolean),
          clarifyTimeoutError: validators.transitional(validators.boolean)
        }, false);
      }
      var requestInterceptorChain = [];
      var synchronousRequestInterceptors = true;
      this.interceptors.request.forEach(function unshiftRequestInterceptors(interceptor) {
        if (typeof interceptor.runWhen === "function" && interceptor.runWhen(config) === false) {
          return;
        }
        synchronousRequestInterceptors = synchronousRequestInterceptors && interceptor.synchronous;
        requestInterceptorChain.unshift(interceptor.fulfilled, interceptor.rejected);
      });
      var responseInterceptorChain = [];
      this.interceptors.response.forEach(function pushResponseInterceptors(interceptor) {
        responseInterceptorChain.push(interceptor.fulfilled, interceptor.rejected);
      });
      var promise;
      if (!synchronousRequestInterceptors) {
        var chain = [dispatchRequest, void 0];
        Array.prototype.unshift.apply(chain, requestInterceptorChain);
        chain = chain.concat(responseInterceptorChain);
        promise = Promise.resolve(config);
        while (chain.length) {
          promise = promise.then(chain.shift(), chain.shift());
        }
        return promise;
      }
      var newConfig = config;
      while (requestInterceptorChain.length) {
        var onFulfilled = requestInterceptorChain.shift();
        var onRejected = requestInterceptorChain.shift();
        try {
          newConfig = onFulfilled(newConfig);
        } catch (error) {
          onRejected(error);
          break;
        }
      }
      try {
        promise = dispatchRequest(newConfig);
      } catch (error) {
        return Promise.reject(error);
      }
      while (responseInterceptorChain.length) {
        promise = promise.then(responseInterceptorChain.shift(), responseInterceptorChain.shift());
      }
      return promise;
    };
    Axios.prototype.getUri = function getUri(config) {
      config = mergeConfig(this.defaults, config);
      return buildURL(config.url, config.params, config.paramsSerializer).replace(/^\?/, "");
    };
    utils.forEach(["delete", "get", "head", "options"], function forEachMethodNoData(method) {
      Axios.prototype[method] = function(url, config) {
        return this.request(mergeConfig(config || {}, {
          method,
          url,
          data: (config || {}).data
        }));
      };
    });
    utils.forEach(["post", "put", "patch"], function forEachMethodWithData(method) {
      Axios.prototype[method] = function(url, data, config) {
        return this.request(mergeConfig(config || {}, {
          method,
          url,
          data
        }));
      };
    });
    module.exports = Axios;
  }
});

// node_modules/axios/lib/cancel/CancelToken.js
var require_CancelToken = __commonJS({
  "node_modules/axios/lib/cancel/CancelToken.js"(exports, module) {
    "use strict";
    var Cancel = require_Cancel();
    function CancelToken(executor) {
      if (typeof executor !== "function") {
        throw new TypeError("executor must be a function.");
      }
      var resolvePromise;
      this.promise = new Promise(function promiseExecutor(resolve) {
        resolvePromise = resolve;
      });
      var token = this;
      this.promise.then(function(cancel) {
        if (!token._listeners)
          return;
        var i2;
        var l2 = token._listeners.length;
        for (i2 = 0; i2 < l2; i2++) {
          token._listeners[i2](cancel);
        }
        token._listeners = null;
      });
      this.promise.then = function(onfulfilled) {
        var _resolve;
        var promise = new Promise(function(resolve) {
          token.subscribe(resolve);
          _resolve = resolve;
        }).then(onfulfilled);
        promise.cancel = function reject() {
          token.unsubscribe(_resolve);
        };
        return promise;
      };
      executor(function cancel(message) {
        if (token.reason) {
          return;
        }
        token.reason = new Cancel(message);
        resolvePromise(token.reason);
      });
    }
    CancelToken.prototype.throwIfRequested = function throwIfRequested() {
      if (this.reason) {
        throw this.reason;
      }
    };
    CancelToken.prototype.subscribe = function subscribe(listener) {
      if (this.reason) {
        listener(this.reason);
        return;
      }
      if (this._listeners) {
        this._listeners.push(listener);
      } else {
        this._listeners = [listener];
      }
    };
    CancelToken.prototype.unsubscribe = function unsubscribe(listener) {
      if (!this._listeners) {
        return;
      }
      var index = this._listeners.indexOf(listener);
      if (index !== -1) {
        this._listeners.splice(index, 1);
      }
    };
    CancelToken.source = function source() {
      var cancel;
      var token = new CancelToken(function executor(c2) {
        cancel = c2;
      });
      return {
        token,
        cancel
      };
    };
    module.exports = CancelToken;
  }
});

// node_modules/axios/lib/helpers/spread.js
var require_spread = __commonJS({
  "node_modules/axios/lib/helpers/spread.js"(exports, module) {
    "use strict";
    module.exports = function spread(callback) {
      return function wrap(arr) {
        return callback.apply(null, arr);
      };
    };
  }
});

// node_modules/axios/lib/helpers/isAxiosError.js
var require_isAxiosError = __commonJS({
  "node_modules/axios/lib/helpers/isAxiosError.js"(exports, module) {
    "use strict";
    module.exports = function isAxiosError(payload) {
      return typeof payload === "object" && payload.isAxiosError === true;
    };
  }
});

// node_modules/axios/lib/axios.js
var require_axios = __commonJS({
  "node_modules/axios/lib/axios.js"(exports, module) {
    "use strict";
    var utils = require_utils();
    var bind = require_bind();
    var Axios = require_Axios();
    var mergeConfig = require_mergeConfig();
    var defaults = require_defaults();
    function createInstance(defaultConfig) {
      var context = new Axios(defaultConfig);
      var instance = bind(Axios.prototype.request, context);
      utils.extend(instance, Axios.prototype, context);
      utils.extend(instance, context);
      instance.create = function create(instanceConfig) {
        return createInstance(mergeConfig(defaultConfig, instanceConfig));
      };
      return instance;
    }
    var axios = createInstance(defaults);
    axios.Axios = Axios;
    axios.Cancel = require_Cancel();
    axios.CancelToken = require_CancelToken();
    axios.isCancel = require_isCancel();
    axios.VERSION = require_data().version;
    axios.all = function all(promises) {
      return Promise.all(promises);
    };
    axios.spread = require_spread();
    axios.isAxiosError = require_isAxiosError();
    module.exports = axios;
    module.exports.default = axios;
  }
});

// node_modules/axios/index.js
var require_axios2 = __commonJS({
  "node_modules/axios/index.js"(exports, module) {
    module.exports = require_axios();
  }
});

// node_modules/textalive-app-api/dist/index.es.js
var import_axios = __toESM(require_axios2());
var e = { exports: {} };
!function(t2) {
  function e2(t3, e3, r2) {
    for (var n2 = r2 && "number" != typeof e3 ? r2(e3) : e3, i2 = 0, o2 = t3.length; i2 < o2; ) {
      var s2 = i2 + o2 >>> 1;
      (r2 ? r2(t3[s2]) : t3[s2]) < n2 ? i2 = s2 + 1 : o2 = s2;
    }
    return i2;
  }
  t2.sortedIndex = e2, Object.defineProperty(t2, "__esModule", { value: true });
}(e.exports);
var r = { NONE: 0, PHRASE: 1, WORD: 2, CHAR: 4, GRAPHIC: 8, ALL: 63, PUBLIC: 64 };
var n = /^https?:\/\/uploader\.ongaaccel\.jp\/files\?guid=([a-zA-Z0-9]+)/i;
var i = /^https?:\/\/songle\.jp\/uploads\/([a-zA-Z0-9]+)\.mp3$/i;
var o = /^uploaded:([a-zA-Z0-9]+)$/i;
var s = /^songle\.jp\/uploads\/([a-zA-Z0-9]+)\.mp3$/i;
var a = /^https?:\/\/piapro\.jp\/t\/([^/]+)(\/[0-9]+)?$/i;
var u = { getSongPathFromUrl: function(t2) {
  if (u.isUploaderUrl(t2)) {
    var e2 = i.exec(t2);
    if (e2)
      return "songle.jp/uploads/" + e2[1] + ".mp3";
    var r2 = n.exec(t2);
    if (r2)
      return "songle.jp/uploads/" + r2[1] + ".mp3";
  }
  return /https?:\/\/(.+)/.exec(t2)[1];
}, isUploaderUrl: function(t2) {
  return i.test(t2) || n.test(t2);
}, isUploaderPath: function(t2) {
  return s.test(t2) || o.test(t2);
}, getUploaderGuid: function(t2) {
  var e2 = s.exec(t2);
  if (e2)
    return e2[1];
  var r2 = o.exec(t2);
  return r2 ? r2[1] : null;
}, getSongUrlFromUploaderGuid: function(t2) {
  return t2 ? "https://songle.jp/uploads/" + t2 + ".mp3" : null;
}, getAltSongUrlFromUploaderGuid: function(t2) {
  return t2 ? "https://api.textalive.jp/songle/me/uploads/" + t2 : null;
}, getSongUrlFromPath: function(t2) {
  var e2 = u.getUploaderGuid(t2);
  return e2 ? u.getSongUrlFromUploaderGuid(e2) : "https://" + t2;
}, isYouTubeUrl: function(t2) {
  return /^https?:\/\/((www|m)\.)?youtube\.com/i.test(t2);
}, isNicovideoUrl: function(t2) {
  return /^https?:\/\/(www\.)?nicovideo.jp/i.test(t2);
}, isVideoSiteUrl: function(t2) {
  return u.isYouTubeUrl(t2) || u.isNicovideoUrl(t2);
}, isPiaproUrl: function(t2) {
  return a.test(t2);
} };
var l = /^https:\/\/songle\.jp\/api\/v[0-9]+\/users\/(.+)\/uploads\/(.+)$/;
var c = function(t2) {
  return l.test(t2);
};
var p = function(t2) {
  var e2 = l.exec(t2);
  return e2 ? { user: e2[1], identifier: e2[2] } : { user: null, identifier: null };
};
var h = function() {
  function t2() {
  }
  return t2.prototype.isLicenseLoading = function(t3) {
    return !t3 || !t3.song || void 0 === t3.lyrics || void 0 === t3.backgroundImage;
  }, t2.prototype.checkLicenses = function(t3) {
    return !this.isLicenseLoading(t3) && this.checkLicense(t3.song) && this.checkLicense(t3.lyrics) && this.checkLicense(t3.backgroundImage);
  }, t2.prototype.checkLicense = function(t3) {
    return null === t3 || (1 === t3.contentType ? this.checkMusicLicense(t3.license) : 2 === t3.contentType ? this.checkTextLicense(t3.license) : 0 === t3.contentType && (!!this.isBackgroundColorAsset(t3) || this.checkBackgroundImageLicense(t3.license)));
  }, t2.prototype.checkMusicLicense = function(t3) {
    return t3.condition && t3.condition.uploader || !(!t3.condition || t3.condition.ns || t3.condition.nc || t3.condition.org || t3.condition.clb);
  }, t2.prototype.checkTextLicense = function(t3) {
    return t3.condition && t3.condition.uploader || !(!t3.condition || t3.condition.ns || t3.condition.org || t3.condition.clb);
  }, t2.prototype.checkBackgroundImageLicense = function(t3) {
    return !(!t3.condition || t3.condition.ns || t3.condition.nc || t3.condition.org || t3.condition.clb);
  }, t2.prototype.isUploaderAsset = function(t3) {
    return t3 && t3.url && (u.isUploaderUrl(t3.url) || c(t3.url));
  }, t2.prototype.isPiaproAsset = function(t3) {
    return t3 && t3.url && u.isPiaproUrl(t3.url);
  }, t2.prototype.isBlankBackgroundAsset = function(t3) {
    return !t3 || !t3.originalUrl;
  }, t2.prototype.isBackgroundColorAsset = function(t3) {
    var e2 = t3 && t3.originalUrl ? t3.originalUrl : "";
    return /^#[0-9a-fA-F]{3,6}$/.test(e2);
  }, t2.prototype.isBackgroundPiaproImageAsset = function(t3) {
    var e2 = t3 && t3.originalUrl ? t3.originalUrl : "";
    return u.isPiaproUrl(e2);
  }, t2.prototype.isBackgroundSpecialImageAsset = function(t3) {
    var e2 = t3 && t3.originalUrl ? t3.originalUrl : "";
    return /^snowmiku2016-([0-9]{2})$/.test(e2);
  }, t2.prototype.getQueryParameter = function(t3) {
    return !t3 || t3.license && !this.checkBackgroundImageLicense(t3.license) ? null : t3.originalUrl;
  }, t2;
}();
var d = function(t2, e2) {
  return d = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(t3, e3) {
    t3.__proto__ = e3;
  } || function(t3, e3) {
    for (var r2 in e3)
      Object.prototype.hasOwnProperty.call(e3, r2) && (t3[r2] = e3[r2]);
  }, d(t2, e2);
};
var f = function() {
  return f = Object.assign || function(t2) {
    for (var e2, r2 = 1, n2 = arguments.length; r2 < n2; r2++)
      for (var i2 in e2 = arguments[r2])
        Object.prototype.hasOwnProperty.call(e2, i2) && (t2[i2] = e2[i2]);
    return t2;
  }, f.apply(this, arguments);
};
function y(t2, e2, r2, n2) {
  return new (r2 || (r2 = Promise))(function(i2, o2) {
    function s2(t3) {
      try {
        u2(n2.next(t3));
      } catch (t4) {
        o2(t4);
      }
    }
    function a2(t3) {
      try {
        u2(n2.throw(t3));
      } catch (t4) {
        o2(t4);
      }
    }
    function u2(t3) {
      var e3;
      t3.done ? i2(t3.value) : (e3 = t3.value, e3 instanceof r2 ? e3 : new r2(function(t4) {
        t4(e3);
      })).then(s2, a2);
    }
    u2((n2 = n2.apply(t2, e2 || [])).next());
  });
}
function v(t2, e2) {
  var r2, n2, i2, o2, s2 = { label: 0, sent: function() {
    if (1 & i2[0])
      throw i2[1];
    return i2[1];
  }, trys: [], ops: [] };
  return o2 = { next: a2(0), throw: a2(1), return: a2(2) }, "function" == typeof Symbol && (o2[Symbol.iterator] = function() {
    return this;
  }), o2;
  function a2(o3) {
    return function(a3) {
      return function(o4) {
        if (r2)
          throw new TypeError("Generator is already executing.");
        for (; s2; )
          try {
            if (r2 = 1, n2 && (i2 = 2 & o4[0] ? n2.return : o4[0] ? n2.throw || ((i2 = n2.return) && i2.call(n2), 0) : n2.next) && !(i2 = i2.call(n2, o4[1])).done)
              return i2;
            switch (n2 = 0, i2 && (o4 = [2 & o4[0], i2.value]), o4[0]) {
              case 0:
              case 1:
                i2 = o4;
                break;
              case 4:
                return s2.label++, { value: o4[1], done: false };
              case 5:
                s2.label++, n2 = o4[1], o4 = [0];
                continue;
              case 7:
                o4 = s2.ops.pop(), s2.trys.pop();
                continue;
              default:
                if (!((i2 = (i2 = s2.trys).length > 0 && i2[i2.length - 1]) || 6 !== o4[0] && 2 !== o4[0])) {
                  s2 = 0;
                  continue;
                }
                if (3 === o4[0] && (!i2 || o4[1] > i2[0] && o4[1] < i2[3])) {
                  s2.label = o4[1];
                  break;
                }
                if (6 === o4[0] && s2.label < i2[1]) {
                  s2.label = i2[1], i2 = o4;
                  break;
                }
                if (i2 && s2.label < i2[2]) {
                  s2.label = i2[2], s2.ops.push(o4);
                  break;
                }
                i2[2] && s2.ops.pop(), s2.trys.pop();
                continue;
            }
            o4 = e2.call(t2, s2);
          } catch (t3) {
            o4 = [6, t3], n2 = 0;
          } finally {
            r2 = i2 = 0;
          }
        if (5 & o4[0])
          throw o4[1];
        return { value: o4[0] ? o4[1] : void 0, done: true };
      }([o3, a3]);
    };
  }
}
var g = { fallback: { protocol: "https" }, songle: { domain: "songle.jp" }, textalive: { domain: "api.textalive.jp" }, content: { domain: "content.textalive.jp" }, client: { version: "0.10.0", axios: null } };
function m(e2, r2, n2) {
  var i2, o2, s2;
  return y(this, void 0, void 0, function() {
    var a2;
    return v(this, function(u2) {
      switch (u2.label) {
        case 0:
          a2 = { responseType: (null == n2 ? void 0 : n2.responseType) || "json" }, r2 && (a2.params = r2), (null == n2 ? void 0 : n2.auth) && (a2.auth = { username: null === (i2 = n2.auth) || void 0 === i2 ? void 0 : i2.username, password: null === (o2 = n2.auth) || void 0 === o2 ? void 0 : o2.password }), (null == n2 ? void 0 : n2.withCredentials) && (a2.withCredentials = true), a2.headers = {}, 0 === e2.indexOf(g.textalive.server) && (g.textalive.appToken && (a2.headers["x-ta-app-token"] = g.textalive.appToken), g.textalive.authUser && g.textalive.authToken && (a2.headers["x-ta-auth-user"] = g.textalive.authUser, a2.headers["x-ta-auth-token"] = g.textalive.authToken)), (null == n2 ? void 0 : n2.headers) && (a2.headers = f(f({}, a2.headers), n2.headers)), u2.label = 1;
        case 1:
          return u2.trys.push([1, 3, , 4]), [4, ((null == n2 ? void 0 : n2.client) || (null === (s2 = g.client) || void 0 === s2 ? void 0 : s2.axios) || import_axios.default).get(e2, a2)];
        case 2:
          return [2, u2.sent()];
        case 3:
          return u2.sent(), [2, null];
        case 4:
          return [2];
      }
    });
  });
}
function b(t2) {
  var e2, r2, n2 = 0;
  if (0 === t2.length)
    return n2;
  for (e2 = 0, r2 = t2.length; e2 < r2; e2++)
    n2 = (n2 << 5) - n2 + t2.charCodeAt(e2), n2 |= 0;
  return n2;
}
g.songle.protocol = g.songle.protocol || g.fallback.protocol, g.songle.server = g.songle.protocol + "://" + g.songle.domain, g.textalive.protocol = g.textalive.protocol || g.fallback.protocol, g.textalive.server = g.textalive.protocol + "://" + g.textalive.domain, g.textalive.appToken = null, g.content.protocol = g.content.protocol || g.fallback.protocol, g.content.server = g.content.protocol + "://" + g.content.domain;
var _ = new (function(t2) {
  function e2() {
    return null !== t2 && t2.apply(this, arguments) || this;
  }
  return function(t3, e3) {
    if ("function" != typeof e3 && null !== e3)
      throw new TypeError("Class extends value " + String(e3) + " is not a constructor or null");
    function r2() {
      this.constructor = t3;
    }
    d(t3, e3), t3.prototype = null === e3 ? Object.create(e3) : (r2.prototype = e3.prototype, new r2());
  }(e2, t2), Object.defineProperty(e2.prototype, "endpoint", { get: function() {
    return g.textalive.server + "/etc/license";
  }, enumerable: false, configurable: true }), e2.prototype.read = function(t3, e3) {
    var r2;
    return void 0 === e3 && (e3 = true), y(this, void 0, void 0, function() {
      var n2, i2;
      return v(this, function(o2) {
        switch (o2.label) {
          case 0:
            return [4, m(this.endpoint, { url: t3, token: b("ta" + t3), skipOptoutCheck: !!e3 || void 0 })];
          case 1:
            return !(n2 = o2.sent()) || 200 !== n2.status || (null === (r2 = n2.data) || void 0 === r2 ? void 0 : r2.error) ? [2, { originalUrl: null, license: { code: n2 ? n2.status : 404 } }] : ((i2 = n2.data).license.code = n2.status, 0 === i2.contentType && (i2.css = 'url("' + i2.contentUrl + '")'), [2, i2]);
        }
      });
    });
  }, e2;
}(h))();
function w(e2, r2, n2) {
  var i2;
  return y(this, void 0, void 0, function() {
    var o2;
    return v(this, function(s2) {
      switch (s2.label) {
        case 0:
          r2 || (r2 = {}), o2 = { responseType: (null == n2 ? void 0 : n2.responseType) || "json" }, (null == n2 ? void 0 : n2.withCredentials) && (o2.withCredentials = true), o2.headers = {}, 0 === e2.indexOf(g.textalive.server) && (g.textalive.appToken && (o2.headers["x-ta-app-token"] = g.textalive.appToken), g.textalive.authUser && g.textalive.authToken && (o2.headers["x-ta-auth-user"] = g.textalive.authUser, o2.headers["x-ta-auth-token"] = g.textalive.authToken)), (null == n2 ? void 0 : n2.postToken) && (o2.headers["x-ta-post-token"] = n2.postToken), (null == n2 ? void 0 : n2.headers) && (o2.headers || (o2.headers = {}), o2.headers = f(f({}, o2.headers), n2.headers)), s2.label = 1;
        case 1:
          return s2.trys.push([1, 3, , 4]), [4, ((null == n2 ? void 0 : n2.client) || (null === (i2 = g.client) || void 0 === i2 ? void 0 : i2.axios) || import_axios.default).post(e2, r2, o2)];
        case 2:
          return [2, s2.sent()];
        case 3:
          return s2.sent(), [2, null];
        case 4:
          return [2];
      }
    });
  });
}
function P(t2) {
  return "string" == typeof t2 && 0 === t2.indexOf("data:text/plain;base64,");
}
function E(t2) {
  if (!P(t2))
    return null;
  var e2 = t2.split(",")[1];
  return decodeURIComponent(atob(e2).split("").map(function(t3) {
    return "%" + ("00" + t3.charCodeAt(0).toString(16)).slice(-2);
  }).join(""));
}
function O(t2) {
  return "string" != typeof t2 ? null : "data:text/plain;base64," + btoa(encodeURIComponent(t2).replace(/%([0-9A-F]{2})/g, function(t3, e2) {
    return String.fromCharCode(parseInt("0x" + e2));
  }));
}
function S(t2, e2, r2, n2, i2) {
  var o2 = void 0 === window.screenLeft ? screen.left : window.screenLeft, s2 = void 0 === window.screenTop ? screen.top : window.screenTop, a2 = (window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width) / 2 - r2 / 2 + o2, u2 = (window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height) / 2 - n2 / 2 + s2, l2 = window.open(t2, e2, "width=" + r2 + ",height=" + n2 + ",top=" + u2 + ",left=" + a2 + (i2 ? "," + i2 : ""));
  return window.focus && l2.focus(), l2;
}
var T = new (function() {
  function t2() {
    this.listeners = [], this.pollingTimeout = null;
  }
  return Object.defineProperty(t2.prototype, "endpoint", { get: function() {
    return g.textalive.server + "/";
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "songleEndpoint", { get: function() {
    return g.songle.server + "/";
  }, enumerable: false, configurable: true }), t2.prototype.isLoading = function() {
    return !!this.userProfile;
  }, t2.prototype.spoof = function(t3) {
    this.userProfile = t3;
  }, t2.prototype.getServerStatus = function() {
    return y(this, void 0, void 0, function() {
      return v(this, function(t3) {
        return [2, this.serverStatus || this.doGetServerStatus()];
      });
    });
  }, t2.prototype.doGetServerStatus = function() {
    return y(this, void 0, void 0, function() {
      var t3;
      return v(this, function(e2) {
        switch (e2.label) {
          case 0:
            return this.serverStatusRequest || (this.serverStatusRequest = m(this.endpoint, null, { withCredentials: true })), [4, this.serverStatusRequest];
          case 1:
            return t3 = e2.sent(), this.serverStatusRequest = null, t3 && 200 === t3.status ? (this.serverStatus = t3.data, [2, this.serverStatus]) : [2, null];
        }
      });
    });
  }, t2.prototype.getProfile = function() {
    return y(this, void 0, void 0, function() {
      return v(this, function(t3) {
        return [2, this.userProfile || this.doGetProfile()];
      });
    });
  }, t2.prototype.doGetProfile = function() {
    return y(this, void 0, void 0, function() {
      var t3;
      return v(this, function(e2) {
        switch (e2.label) {
          case 0:
            return this.userProfileRequest || (this.userProfileRequest = m(this.endpoint + "profile", null, { withCredentials: true })), [4, this.userProfileRequest];
          case 1:
            return t3 = e2.sent(), this.userProfileRequest = null, t3 && 200 === t3.status ? (this.emitUserProfile(t3.data), this.userProfile = t3.data, [2, this.userProfile]) : [2, null];
        }
      });
    });
  }, t2.prototype.getMergingUsers = function() {
    return y(this, void 0, void 0, function() {
      var t3;
      return v(this, function(e2) {
        switch (e2.label) {
          case 0:
            return [4, m(this.endpoint + "profile/merge", null, { withCredentials: true })];
          case 1:
            return (t3 = e2.sent()) && 200 === t3.status && t3.data ? [2, [t3.data.user, t3.data.mergeWith]] : [2, [null, null]];
        }
      });
    });
  }, t2.prototype.mergeUsers = function() {
    var t3;
    return y(this, void 0, void 0, function() {
      var e2, r2, n2, i2, o2, s2;
      return v(this, function(a2) {
        switch (a2.label) {
          case 0:
            return [4, this.getToken()];
          case 1:
            return e2 = a2.sent(), [4, w(this.endpoint + "profile/merge", null, { postToken: e2, withCredentials: true })];
          case 2:
            if (!(r2 = a2.sent()) || 200 !== r2.status || !(null === (t3 = r2.data) || void 0 === t3 ? void 0 : t3.success))
              return [2, null];
            for (n2 = r2.data.user, i2 = 0, o2 = this.listeners; i2 < o2.length; i2++)
              (s2 = o2[i2]).onUserMerged && s2.onUserMerged(n2);
            return [2, n2];
        }
      });
    });
  }, t2.prototype.updateUser = function(t3) {
    var e2;
    return y(this, void 0, void 0, function() {
      var r2, n2, i2, o2;
      return v(this, function(s2) {
        switch (s2.label) {
          case 0:
            return [4, this.getToken()];
          case 1:
            return r2 = s2.sent(), [4, w(this.endpoint + "profile", t3, { postToken: r2, withCredentials: true })];
          case 2:
            return (n2 = s2.sent()) && 200 === n2.status && (null === (e2 = n2.data) || void 0 === e2 ? void 0 : e2.success) ? (i2 = n2.data.user, [4, this.getProfile()]) : [2, null];
          case 3:
            return (o2 = s2.sent()).user = i2, this.emitUserProfile(o2), [2, i2];
        }
      });
    });
  }, t2.prototype.isYouTubeUser = function(t3) {
    return t3 && t3.user && "string" == typeof t3.user.youtubeIdString;
  }, t2.prototype.isPiaproUser = function(t3) {
    return t3 && t3.user && "string" == typeof t3.user.piaproIdString;
  }, t2.prototype.isSongleUser = function(t3) {
    return t3 && t3.user && ("number" == typeof t3.user.songleUserId && t3.user.songleUserId >= 0 || "string" == typeof t3.user.songleAccessToken);
  }, t2.prototype.isSpoofingSongleUser = function(t3) {
    return this.isSongleUser(t3) && ("number" != typeof t3.user.id || t3.user.id < 0);
  }, t2.prototype.addListener = function(t3) {
    t3 && this.listeners.push(t3);
  }, t2.prototype.removeListener = function(t3) {
    this.listeners = this.listeners.filter(function(e2) {
      return e2 !== t3;
    });
  }, t2.prototype.emitUserProfile = function(t3) {
    this.userProfile = t3;
    for (var e2 = 0, r2 = this.listeners; e2 < r2.length; e2++) {
      var n2 = r2[e2];
      n2.onUserProfileUpdated && n2.onUserProfileUpdated(t3), this.userProfile.user ? n2.onUserLoggedIn && n2.onUserLoggedIn(t3.user) : n2.onUserLoggedOut && n2.onUserLoggedOut();
    }
  }, t2.prototype.authenticate = function(t3, e2) {
    return y(this, void 0, void 0, function() {
      var r2;
      return v(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, m(this.endpoint + "profile/logins/basic", null, { auth: { username: String(t3), password: e2 }, withCredentials: true })];
          case 1:
            return (r2 = n2.sent()) && 200 === r2.status && r2.data ? [2, r2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.loginTwitter = function(t3) {
    return this.login(t3, "twitter");
  }, t2.prototype.loginGitHub = function(t3) {
    return this.login(t3, "github");
  }, t2.prototype.loginYouTube = function(t3) {
    return this.login(t3, "youtube");
  }, t2.prototype.loginPiapro = function(t3) {
    return this.login(t3, "piapro");
  }, t2.prototype.loginSongle = function(t3) {
    return this.login(t3, "songle");
  }, t2.prototype.login = function(t3, e2) {
    return t3 && t3.preventDefault(), !!e2 && (S(this.endpoint + "profile/logins/" + e2, "TextAliveAuth", 600, 480, "status=no,toolbar=no,menubar=no"), this.startMonitoringAuthState(), false);
  }, t2.prototype.logoutTwitter = function(t3) {
    return this.logout(t3, "twitter");
  }, t2.prototype.logoutGitHub = function(t3) {
    return this.logout(t3, "github");
  }, t2.prototype.logoutYouTube = function(t3) {
    return this.logout(t3, "youtube");
  }, t2.prototype.logoutPiapro = function(t3) {
    return this.logout(t3, "piapro");
  }, t2.prototype.logoutSongle = function(t3) {
    return this.logout(t3, "songle");
  }, t2.prototype.logout = function(t3, e2) {
    return void 0 === e2 && (e2 = null), t3 && t3.preventDefault(), S(this.endpoint + "profile/logouts/" + (e2 || "all"), "TextAliveAuth", 600, 480, "status=no,toolbar=no,menubar=no"), this.startMonitoringAuthState(), false;
  }, t2.prototype.startMonitoringAuthState = function() {
    var t3 = this;
    this.pollingTimeout && (clearTimeout(this.pollingTimeout), this.pollingTimeout = null);
    var e2 = function(r2) {
      if (r2.data && r2.data.textalive) {
        if (r2.source.postMessage("close", r2.origin), r2.data.merge)
          return t3.getMergingUsers().then(function(e3) {
            for (var r3 = e3[0], n2 = e3[1], i2 = 0, o2 = t3.listeners; i2 < o2.length; i2++) {
              var s2 = o2[i2];
              s2.onUserMergeRequired && s2.onUserMergeRequired(r3, n2);
            }
          }).catch(function() {
          }), void window.removeEventListener("message", e2);
        t3.doGetProfile(), window.removeEventListener("message", e2);
      }
    };
    window.addEventListener("message", e2);
  }, t2.prototype.getToken = function() {
    return y(this, void 0, void 0, function() {
      return v(this, function(t3) {
        return this.userProfile ? [2, this.userProfile.status.token] : this.token ? [2, this.token] : [2, this.doGetToken()];
      });
    });
  }, t2.prototype.doGetToken = function() {
    var t3;
    return y(this, void 0, void 0, function() {
      var e2;
      return v(this, function(r2) {
        switch (r2.label) {
          case 0:
            return [4, m(this.endpoint + "profile/token", null, { withCredentials: true })];
          case 1:
            return e2 = r2.sent(), (null === (t3 = null == e2 ? void 0 : e2.data) || void 0 === t3 ? void 0 : t3.token) && (this.token = e2.data.token), [2, this.token];
        }
      });
    });
  }, t2;
}())();
var x = new (function() {
  function t2() {
  }
  return Object.defineProperty(t2.prototype, "endpoint", { get: function() {
    return g.textalive.server + "/text-parser/";
  }, enumerable: false, configurable: true }), t2.prototype.parse = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2, r2;
      return v(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, T.getToken()];
          case 1:
            return e2 = n2.sent(), [4, w(this.endpoint, { text: t3 }, { postToken: e2, withCredentials: true })];
          case 2:
            return (r2 = n2.sent()) && 200 === r2.status ? [2, r2.data] : [2, null];
        }
      });
    });
  }, t2;
}())();
var A = new (function() {
  function t2() {
  }
  return Object.defineProperty(t2.prototype, "endpoint", { get: function() {
    return g.content.server + "/fonts";
  }, enumerable: false, configurable: true }), t2.prototype.listAvailableFonts = function() {
    return y(this, void 0, void 0, function() {
      var t3 = this;
      return v(this, function(e2) {
        switch (e2.label) {
          case 0:
            return this.data ? [3, 2] : [4, this.fetchInfo()];
          case 1:
            e2.sent(), e2.label = 2;
          case 2:
            return this.data && this.data.fontFamilies ? [2, Object.keys(this.data.fontFamilies).map(function(e3) {
              return f({ key: e3 }, t3.data.fontFamilies[e3]);
            })] : [2, []];
        }
      });
    });
  }, t2.prototype.getFrequentChars = function() {
    return y(this, void 0, void 0, function() {
      return v(this, function(t3) {
        switch (t3.label) {
          case 0:
            return this.data ? [3, 2] : [4, this.fetchInfo()];
          case 1:
            t3.sent(), t3.label = 2;
          case 2:
            return [2, this.data && this.data.frequentChars || ""];
        }
      });
    });
  }, t2.prototype.fetchInfo = function() {
    return y(this, void 0, void 0, function() {
      var t3, e2, r2, n2;
      return v(this, function(i2) {
        switch (i2.label) {
          case 0:
            return [4, m(this.endpoint + "/index.json")];
          case 1:
            if (!(t3 = i2.sent()) || 200 !== t3.status || !t3.data)
              return this.data = null, [2, null];
            for (r2 in this.data = t3.data, e2 = this.data.fontUrlPrefix, this.data.fontFamilies)
              (n2 = this.data.fontFamilies[r2]).typesquare || n2.typekit || n2.google || n2.url || (n2.url = e2 + "/" + r2 + "-all.css", n2.compactUrl = e2 + "/" + r2 + ".css");
            return [2];
        }
      });
    });
  }, t2;
}())();
var R = new RegExp("\\b([CDEFGAB](?:b|bb)*(?:#|##|sus|maj|min|aug|m|M)*[\\d/]*(?:[CDEFGAB](?:b|bb)*(?:#|##|sus|maj|min|aug|m|M)*[\\d/]*)*\\-){2}");
function C(t2, e2, r2) {
  return !R.test(t2) && !t2.match(/[(].+(?:|).*[)]/) && (!t2.match(/(|).+(|)/) || 0 !== e2 && e2 !== r2.length - 2);
}
function N(t2) {
  return !t2.match(new RegExp("[(]?"));
}
var k = {};
var j = {};
var I = function() {
  function t2() {
  }
  return Object.defineProperty(t2.prototype, "endpoint", { get: function() {
    return g.songle.server + "/lyrics/";
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "localLyricsEndpoint", { get: function() {
    return g.textalive.server + "/etc/lyrics";
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "timingEndpoint", { get: function() {
    return g.songle.server + "/songs/";
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "lyricsParserEndpoint", { get: function() {
    return g.songle.server;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "lyricsPostEndpoint", { get: function() {
    return g.songle.server;
  }, enumerable: false, configurable: true }), t2.prototype.isUploaderUrl = function(t3) {
    return c(t3);
  }, t2.prototype.parseUploaderUrl = function(t3) {
    return p(t3);
  }, t2.prototype.getRecentlySynchronizedCount = function() {
    return y(this, void 0, void 0, function() {
      var t3;
      return v(this, function(e2) {
        switch (e2.label) {
          case 0:
            return [4, m(this.endpoint + "recently_synchronized_count.json")];
          case 1:
            return (t3 = e2.sent()) && 200 === t3.status && t3.data ? [2, t3.data.count] : [2, -1];
        }
      });
    });
  }, t2.prototype.getRecentlySynchronizedList = function(t3, e2) {
    return void 0 === t3 && (t3 = 1), y(this, void 0, void 0, function() {
      var r2;
      return v(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, m(this.endpoint + "recently_synchronized.json", f({ page: t3 }, e2))];
          case 1:
            return (r2 = n2.sent()) && 200 === r2.status ? [2, r2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.load = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2;
      return v(this, function(r2) {
        switch (r2.label) {
          case 0:
            return [4, m(this.timingEndpoint + t3 + "/lyrics.json")];
          case 1:
            return (e2 = r2.sent()) && 200 === e2.status ? [2, e2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.loadDetail = function(t3, e2) {
    return y(this, void 0, void 0, function() {
      var r2, n2;
      return v(this, function(i2) {
        switch (i2.label) {
          case 0:
            return k[t3] && k[t3][e2] ? [2, k[t3][e2]] : [4, m(this.timingEndpoint + t3 + "/lyrics/" + (e2 < 0 ? "latest" : e2) + ".json")];
          case 1:
            return (r2 = i2.sent()) && 200 === r2.status ? (n2 = r2.data, k[t3] || (k[t3] = {}), k[t3][n2.id] = n2, e2 < 0 && (k[t3][-1] = n2), [2, n2]) : [2, null];
        }
      });
    });
  }, t2.prototype.loadDiffs = function(t3, e2) {
    return y(this, void 0, void 0, function() {
      var r2;
      return v(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, m(this.timingEndpoint + t3 + "/lyrics/" + e2 + "/diffs.json")];
          case 1:
            return (r2 = n2.sent()) && 200 === r2.status ? [2, r2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.loadDiff = function(t3, e2, r2) {
    return y(this, void 0, void 0, function() {
      return v(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, m(this.timingEndpoint + t3 + "/lyrics/" + e2 + (r2 < 0 ? "" : 0 === r2 ? "/original" : "/diffs/" + r2 + "/lyrics") + ".json")];
          case 1:
            return [2, n2.sent().data];
        }
      });
    });
  }, t2.prototype.loadAllRevisionsForSong = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2, r2, n2, i2, o2, s2, a2, u2, l2, c2;
      return v(this, function(p2) {
        switch (p2.label) {
          case 0:
            return [4, this.load(t3)];
          case 1:
            if (!(e2 = p2.sent()))
              return [2, null];
            r2 = [], n2 = 0, i2 = e2.lyrics, p2.label = 2;
          case 2:
            return n2 < i2.length ? (o2 = i2[n2], [4, this.loadDetail(t3, o2.id)]) : [3, 6];
          case 3:
            return s2 = p2.sent(), [4, this.loadDiffs(t3, s2.id)];
          case 4:
            if (a2 = p2.sent(), r2.push({ lyrics: s2, updated_at: new Date(s2.created_at) }), Array.isArray(a2))
              for (u2 = 0, l2 = a2; u2 < l2.length; u2++)
                c2 = l2[u2], r2.push({ diff_id: c2.id, source_id: c2.source_id, lyrics: s2, updated_at: new Date(c2.updated_at) });
            p2.label = 5;
          case 5:
            return n2++, [3, 2];
          case 6:
            return [2, r2.sort(function(t4, e3) {
              var r3 = e3.updated_at.getTime() - t4.updated_at.getTime();
              return 0 === r3 ? e3.diff_id - t4.diff_id : r3;
            })];
        }
      });
    });
  }, t2.prototype.getLatestRevision = function(t3) {
    return t3.filter(function(t4) {
      return !(t4.lyrics.processing || t4.lyrics.failed);
    })[0];
  }, t2.prototype.fetchLocalLyricBody = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2, r2, n2, i2;
      return v(this, function(o2) {
        switch (o2.label) {
          case 0:
            return this.verbose && ("string" == typeof t3 ? console.log("load locally-stored lyrics for song code", t3) : console.log("load locally-stored lyrics for lyric id", t3)), e2 = {}, "string" == typeof t3 ? e2.code = t3 : e2.lyricId = t3, [4, m(this.localLyricsEndpoint + "/token", e2)];
          case 1:
            return !(r2 = o2.sent()) || 200 !== r2.status || r2.data.error ? [2, null] : (n2 = r2.data.token, e2.token = n2, [4, m(this.localLyricsEndpoint, e2)]);
          case 2:
            return (i2 = o2.sent()) && 200 === i2.status ? (this.verbose && console.log("loaded locally-stored lyrics with params", e2), [2, i2.data]) : [2, null];
        }
      });
    });
  }, t2.prototype.fetchSongleLyricBody = function(t3, e2) {
    return y(this, void 0, void 0, function() {
      var r2, n2, i2, o2, s2, a2, u2, l2, c2, p2, h2;
      return v(this, function(d2) {
        switch (d2.label) {
          case 0:
            if (!(r2 = this.parseUploaderUrl(t3)).identifier)
              throw new Error("unsupported lyrics url " + t3);
            return [4, T.getProfile()];
          case 1:
            if (n2 = d2.sent(), !T.isSongleUser(n2))
              throw new Error("Songle authentication is required");
            return j[i2 = t3 + "//" + e2] ? [2, j[i2]] : (T.isSpoofingSongleUser(n2) && (s2 = n2.user, a2 = s2.songleUserId, u2 = s2.songleAccessToken, l2 = s2.songleRefreshToken, o2 = { songleUserId: a2, songleAccessToken: u2, songleRefreshToken: l2 }), [4, m(g.textalive.server + "/songle/users/" + r2.user + "/uploads/" + r2.identifier, o2, { withCredentials: true, responseType: "text" })]);
          case 2:
            return c2 = d2.sent(), p2 = null == c2 ? void 0 : c2.data, h2 = p2 ? { text: p2, url: t3 } : null, p2 && (j[i2] = h2), [2, h2];
        }
      });
    });
  }, t2.prototype.fetchPiaproLyricBody = function(t3, e2) {
    return y(this, void 0, void 0, function() {
      var r2, n2, i2, o2, s2;
      return v(this, function(a2) {
        switch (a2.label) {
          case 0:
            if (!u.isPiaproUrl(t3))
              throw new Error("unsupported lyrics url " + t3);
            return j[r2 = t3 + "//" + e2] ? [2, j[r2]] : [4, _.read(t3, true)];
          case 1:
            if (n2 = a2.sent(), !_.isPiaproAsset(n2))
              throw new Error("unsupported piapro lyrics url " + t3);
            return i2 = E(n2.contentUrl), [4, this.parseLyricBody(i2, e2)];
          case 2:
            return o2 = a2.sent(), (s2 = o2 ? { text: o2, artist: { name: n2.authorName, url: n2.authorPath ? "https://piapro.jp" + n2.authorPath : null }, name: n2.name, url: t3 } : null) && (j[r2] = s2), [2, s2];
        }
      });
    });
  }, t2.prototype.fetchInternalLyricBody = function(t3, e2) {
    return y(this, void 0, void 0, function() {
      var r2;
      return v(this, function(n2) {
        if (r2 = new URL(t3), "undefined" == typeof location || location.protocol !== r2.protocol || location.hostname !== r2.hostname)
          throw new Error("direct access not supported for lyrics url " + t3);
        return [2, this.fetchCrossOriginLyricBody(t3, e2)];
      });
    });
  }, t2.prototype.fetchCrossOriginLyricBody = function(t3, e2) {
    return y(this, void 0, void 0, function() {
      var r2, n2, i2, o2, s2;
      return v(this, function(a2) {
        switch (a2.label) {
          case 0:
            return j[r2 = t3 + "//" + e2] ? [2, j[r2]] : [4, m(t3, null, { responseType: "text" })];
          case 1:
            return n2 = a2.sent(), i2 = null == n2 ? void 0 : n2.data, n2 && 200 === n2.status && i2 ? [4, this.parseLyricBody(i2, e2)] : (this.verbose && console.error("direct access not supported for lyrics url " + t3), [2, this.fetchProxiedLyricBody(t3, e2)]);
          case 2:
            return o2 = a2.sent(), (s2 = o2 ? { text: o2, url: t3 } : null) && (j[r2] = s2), [2, s2];
        }
      });
    });
  }, t2.prototype.fetchProxiedLyricBody = function(t3, e2) {
    return y(this, void 0, void 0, function() {
      var r2, n2, i2;
      return v(this, function(o2) {
        switch (o2.label) {
          case 0:
            return j[r2 = t3 + "//" + e2] ? [2, j[r2]] : (this.verbose && console.log("load lyrics from the external server", t3), [4, U(this.lyricsParserEndpoint + e2, function(e3) {
              return new Promise(function(r3, n3) {
                e3.Songle.Utils.url2Lyric(t3, function(t4) {
                  return r3(t4);
                }, function(t4) {
                  return n3(t4);
                });
              });
            }, this.verbose)]);
          case 1:
            return n2 = o2.sent(), (i2 = n2 ? { text: n2, url: t3 } : null) && (j[r2] = i2), [2, i2];
        }
      });
    });
  }, t2.prototype.parseLyricBody = function(t3, e2) {
    return y(this, void 0, void 0, function() {
      var r2;
      return v(this, function(n2) {
        switch (n2.label) {
          case 0:
            return n2.trys.push([0, 2, , 3]), [4, U(this.lyricsParserEndpoint + e2, function(e3) {
              return e3.Songle.Utils.parseLyric(t3);
            }, this.verbose)];
          case 1:
            return r2 = n2.sent(), [3, 3];
          case 2:
            return n2.sent(), r2 = function(t4) {
              return function(t5) {
                return t5 = function(t6) {
                  var e3, r3 = t6.split(/\n/);
                  return r3.forEach(function(t7, r4) {
                    t7.match(/^\S+\S+$/m) && (e3 = r4);
                  }), void 0 !== e3 && e3 < 5 ? r3.slice(e3 + 1).join("\n") : t6;
                }(t5), (t5 = function(t6) {
                  var e3 = new RegExp("[\\u4E00-\\u9FAF|\\uFF66-\\uFF9D|\\u31F0-\\u31FF]+[\\(]([\\u3041-\\u3096\\u309D-\\u309F]+)[\\)]", "g");
                  return t6.replace(e3, function(t7, e4) {
                    return e4;
                  });
                }(t5 = function(t6) {
                  for (var e3, r3, n3, i2, o2, s2 = new RegExp("[(]?(.)[)]?", "g"); null !== (r3 = s2.exec(t6)); )
                    n3 = r3[1], i2 = new RegExp("^(" + n3 + "[\\s\\S]+?)(?=\\n\\n[^\\u3000|\\s])", "m"), null !== (o2 = t6.match(i2)) && (e3 = o2[1].replace(new RegExp("^" + n3, "m"), "").replace(new RegExp("^\\n"), "").replace(new RegExp("^\\u3000", "mg"), ""), t6 = (t6 = t6.replace(i2, function() {
                      return e3;
                    })).replace(new RegExp("[\\(]?" + n3 + "[\\)]?", "g"), e3).replace(new RegExp("^" + n3, "m"), ""));
                  return t6;
                }(t5 = t5.split(/\n/).filter(C).join("\n")))).split(/\n/).filter(N).join("\n").replace(/\n\n+/g, "\n\n").replace(/\n+$/g, "\n");
              }(t4.replace(/^\ufeff/, "").replace(/\r/, "").split(/\n/).filter(C).filter(function(t5) {
                return !t5.match(/^#/);
              }).join("\n").replace(/^\s+/, ""));
            }(t3), [3, 3];
          case 3:
            return [2, r2];
        }
      });
    });
  }, t2.prototype.fetchLyricBody = function(t3, e2) {
    var r2, n2, i2 = e2.parserPath, o2 = e2.directAccess;
    return y(this, void 0, void 0, function() {
      var e3, s2;
      return v(this, function(a2) {
        switch (a2.label) {
          case 0:
            if (P(t3))
              return this.verbose && console.log("load lyrics from the data url", t3), [2, { text: E(t3) }];
            if (this.isUploaderUrl(t3))
              return [2, this.fetchSongleLyricBody(t3, i2)];
            if (u.isPiaproUrl(t3))
              return [2, this.fetchPiaproLyricBody(t3, i2)];
            a2.label = 1;
          case 1:
            return a2.trys.push([1, 5, , 6]), e3 = new URL(t3), o2 || "undefined" != typeof location && location.protocol !== e3.protocol && "https:" !== e3.protocol ? [3, 4] : "undefined" != typeof location && location.hostname !== e3.hostname ? [3, 2] : (o2 = true, [3, 4]);
          case 2:
            return [4, m(this.localLyricsEndpoint + "/cors", { url: t3 })];
          case 3:
            s2 = a2.sent(), o2 = s2 && 200 === s2.status && (null === (n2 = null === (r2 = s2.data) || void 0 === r2 ? void 0 : r2.data) || void 0 === n2 ? void 0 : n2.enabled), a2.label = 4;
          case 4:
            return o2 ? (this.verbose && console.log("load lyrics directly", t3), [2, this.fetchCrossOriginLyricBody(t3, i2)]) : [3, 6];
          case 5:
            return a2.sent(), [3, 6];
          case 6:
            return [2, this.fetchProxiedLyricBody(t3, i2)];
        }
      });
    });
  }, t2.prototype.post = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2, r2;
      return v(this, function(n2) {
        switch (n2.label) {
          case 0:
            return e2 = t3.forceUpdate ? { url: t3.lyricsUrl, force_create: "true" } : { url: t3.lyricsUrl }, [4, w(this.lyricsPostEndpoint + "/songs/" + t3.songId + "/lyrics.json", e2)];
          case 1:
            return (r2 = n2.sent()) && 200 === r2.status && r2.data ? [2, { success: true, lyricsId: r2.data.id }] : [2, { success: false, error: "failed to update lyrics url" }];
        }
      });
    });
  }, t2.prototype.postPrivate = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2, r2, n2, i2, o2, s2, a2, u2, l2, c2, p2;
      return v(this, function(h2) {
        switch (h2.label) {
          case 0:
            return [4, T.getProfile()];
          case 1:
            if (e2 = h2.sent(), !T.isSongleUser(e2))
              throw new Error("Songle authentication is required");
            return T.isSpoofingSongleUser(e2) ? (n2 = e2.user, i2 = n2.songleUserId, o2 = n2.songleAccessToken, s2 = n2.songleRefreshToken, a2 = { songleUserId: i2, songleAccessToken: o2, songleRefreshToken: s2 }, r2 = "?" + Object.keys(a2).map(function(t4) {
              return t4 + "=" + encodeURIComponent(a2[t4]);
            }).join("&")) : r2 = "", u2 = t3.songId, l2 = t3.lyricsText, (c2 = new FormData()).append("text", l2), [4, w(g.textalive.server + "/songle/me/songs/" + u2 + "/lyrics.json" + r2, c2, { withCredentials: true })];
          case 2:
            return (p2 = h2.sent()) && 200 === p2.status && p2.data ? [2, { success: true, lyrics: p2.data.data.lyric }] : [2, { success: false, error: "failed to post lyrics text" }];
        }
      });
    });
  }, t2.prototype.update = function(t3) {
    var e2;
    return y(this, void 0, void 0, function() {
      var r2;
      return v(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, w(this.lyricsPostEndpoint + "/songs/" + t3.songCode + "/lyrics/" + t3.lyricsId + "/diffs.json", t3.lyricsData ? { lyric: JSON.stringify(t3.lyricsData) } : { source_diff_id: t3.lyricsDiffId })];
          case 1:
            return r2 = n2.sent(), [2, (null === (e2 = null == r2 ? void 0 : r2.data) || void 0 === e2 ? void 0 : e2.lyric_diff) ? { success: 200 === r2.status, lyricsId: r2.data.lyric_diff.lyric_id, lyricsDiffId: r2.data.lyric_diff.id } : { success: 200 === r2.status }];
        }
      });
    });
  }, t2;
}();
function U(t2, e2, r2) {
  var n2, i2 = this;
  return "undefined" == typeof window || !(null === (n2 = null === window || void 0 === window ? void 0 : window.navigator) || void 0 === n2 ? void 0 : n2.userAgent) || window.navigator.userAgent.includes("Node.js") || window.navigator.userAgent.includes("jsdom") ? function(t3, e3, r3) {
    return r3 && console.log("parse lyrics: loading on Node.js", t3), new Promise(function(r4, n3) {
      m(t3, { responseType: "text" }).then(function(t4) {
        var i3 = t4.data, o2 = new Function("let g=global;global={};" + i3 + ";let res=global;global=g"), s2 = {};
        try {
          o2.bind(s2)(), r4(e3(s2));
        } catch (t5) {
          n3(t5);
        }
      }).catch(n3);
    });
  }(t2, e2, r2) : (r2 && console.log("parse lyrics: loading", t2), new Promise(function(n3, o2) {
    try {
      var s2 = document.createElement("script"), a2 = null;
      window.module && (a2 = window.module, delete window.module), s2.src = t2, s2.onload = function() {
        return y(i2, void 0, void 0, function() {
          var i3, u2;
          return v(this, function(l2) {
            switch (l2.label) {
              case 0:
                document.body.removeChild(s2), r2 && console.log("parse lyrics: load", t2), window.Songle && window.Songle.Utils && window.Songle.Utils.url2Lyric || (a2 && (window.module = a2), o2("url2Lyric not found")), l2.label = 1;
              case 1:
                return l2.trys.push([1, 3, 4, 5]), i3 = n3, [4, e2(window)];
              case 2:
                return i3.apply(void 0, [l2.sent()]), [3, 5];
              case 3:
                return u2 = l2.sent(), o2(u2), [3, 5];
              case 4:
                return a2 && (window.module = a2), [7];
              case 5:
                return [2];
            }
          });
        });
      }, s2.onerror = function(t3) {
        return o2(t3.message);
      }, document.body.appendChild(s2);
    } catch (e3) {
      console.error("failed to call lyrics parser", t2, e3);
    }
  }));
}
var F = new I();
var L = {};
var D = {};
var M = new (function() {
  function t2() {
  }
  return Object.defineProperty(t2.prototype, "endpoint", { get: function() {
    return g.textalive.server;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "songleEndpoint", { get: function() {
    return g.songle.server;
  }, enumerable: false, configurable: true }), t2.prototype.getSongPathFromUrl = function(t3) {
    return u.getSongPathFromUrl(t3);
  }, t2.prototype.isUploaderUrl = function(t3) {
    return u.isUploaderUrl(t3);
  }, t2.prototype.isUploaderPath = function(t3) {
    return u.isUploaderPath(t3);
  }, t2.prototype.getUploaderGuid = function(t3) {
    return u.getUploaderGuid(t3);
  }, t2.prototype.getAltSongUrlFromUploaderGuid = function(t3) {
    return u.getAltSongUrlFromUploaderGuid(t3);
  }, t2.prototype.getSongUrlFromUploaderGuid = function(t3) {
    return u.getSongUrlFromUploaderGuid(t3);
  }, t2.prototype.getSongUrlFromPath = function(t3) {
    return u.getSongUrlFromPath(t3);
  }, t2.prototype.isYouTubeUrl = function(t3) {
    return u.isYouTubeUrl(t3);
  }, t2.prototype.isNicovideoUrl = function(t3) {
    return u.isNicovideoUrl(t3);
  }, t2.prototype.isVideoSiteUrl = function(t3) {
    return u.isVideoSiteUrl(t3);
  }, t2.prototype.isPiaproUrl = function(t3) {
    return u.isPiaproUrl(t3);
  }, t2.prototype.load = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2, r2;
      return v(this, function(n2) {
        switch (n2.label) {
          case 0:
            return e2 = t3.code || "number" == typeof t3.id && String(t3.id) || encodeURIComponent(t3.songPath), L[e2] ? [2, L[e2]] : (L[e2] = this.doLoad(e2), [4, L[e2]]);
          case 1:
            return r2 = n2.sent(), this.use(r2), [2, r2];
        }
      });
    });
  }, t2.prototype.use = function(t3) {
    if (t3) {
      var e2 = String(t3.song.id), r2 = t3.song.code, n2 = this.getSongPathFromUrl(t3.song.permalink);
      L[e2] = L[r2] = L[n2] = Promise.resolve(t3);
    }
  }, t2.prototype.clearCache = function() {
    L = {}, D = {};
  }, t2.prototype.doLoad = function(t3) {
    var e2;
    return y(this, void 0, void 0, function() {
      var r2, n2, i2;
      return v(this, function(o2) {
        switch (o2.label) {
          case 0:
            return [4, m(this.songleEndpoint + "/songs/" + t3 + "?format=json")];
          case 1:
            return (r2 = o2.sent()) && 200 === r2.status ? (n2 = r2.data, this.isUploaderUrl(null === (e2 = null == n2 ? void 0 : n2.song) || void 0 === e2 ? void 0 : e2.permalink) ? [4, this.doLoadPrivateSong(n2.song.id)] : [3, 3]) : [2, null];
          case 2:
            if (i2 = o2.sent())
              return n2.status = n2.status || {}, n2.status.owner = true, [2, f(f({}, n2), { song: i2 })];
            n2.status = n2.status || {}, n2.status.owner = false, o2.label = 3;
          case 3:
            return [2, n2];
        }
      });
    });
  }, t2.prototype.doLoadPrivateSong = function(t3) {
    var e2, r2;
    return y(this, void 0, void 0, function() {
      var n2, i2, o2, s2, a2, u2, l2;
      return v(this, function(c2) {
        switch (c2.label) {
          case 0:
            return [4, T.getProfile()];
          case 1:
            return n2 = c2.sent(), T.isSongleUser(n2) ? (T.isSpoofingSongleUser(n2) && (o2 = n2.user, s2 = o2.songleUserId, a2 = o2.songleAccessToken, u2 = o2.songleRefreshToken, i2 = { songleUserId: s2, songleAccessToken: a2, songleRefreshToken: u2 }), [4, m(this.endpoint + "/songle/me/songs/" + t3 + ".json", i2, { withCredentials: true })]) : [2, null];
          case 2:
            return (l2 = c2.sent()) && 200 === l2.status && (null === (r2 = null === (e2 = l2.data) || void 0 === e2 ? void 0 : e2.data) || void 0 === r2 ? void 0 : r2.song) ? [2, l2.data.data.song] : [2, null];
        }
      });
    });
  }, t2.prototype.loadInfo = function(t3, e2) {
    return y(this, void 0, void 0, function() {
      var r2;
      return v(this, function(n2) {
        return r2 = this.cacheKey(t3, e2), D[r2] || (D[r2] = this.doLoadInfo(t3, { min: true, revisions: null == e2 ? void 0 : e2.revisions })), [2, D[r2]];
      });
    });
  }, t2.prototype.loadDetailInfo = function(t3, e2) {
    return y(this, void 0, void 0, function() {
      var r2;
      return v(this, function(n2) {
        return r2 = this.cacheKey(t3, e2) + "/dt", D[r2] || (D[r2] = this.doLoadInfo(t3, { min: false, revisions: null == e2 ? void 0 : e2.revisions })), [2, D[r2]];
      });
    });
  }, t2.prototype.cacheKey = function(t3, e2) {
    var r2 = String(t3);
    return (null == e2 ? void 0 : e2.revisions) && ("number" == typeof e2.revisions.chord && (r2 += "/cd" + e2.revisions.chord), "number" == typeof e2.revisions.beat && (r2 += "/bt" + e2.revisions.beat), "number" == typeof e2.revisions.chorus && (r2 += "/cr" + e2.revisions.chorus)), r2;
  }, t2.prototype.doLoadInfo = function(t3, e2) {
    var r2 = void 0 === e2 ? { min: true } : e2, n2 = r2.min, i2 = r2.revisions;
    return y(this, void 0, void 0, function() {
      var e3, r3;
      return v(this, function(o2) {
        switch (o2.label) {
          case 0:
            return e3 = { min: n2 ? 1 : 0 }, "number" == typeof (null == i2 ? void 0 : i2.chord) && (e3.chord_revision_id = i2.chord), "number" == typeof (null == i2 ? void 0 : i2.beat) && (e3.beat_revision_id = i2.beat), "number" == typeof (null == i2 ? void 0 : i2.chorus) && (e3.chorus_revision_id = i2.chorus), [4, m(this.songleEndpoint + "/songs/" + t3 + "/info.json", e3)];
          case 1:
            return (r3 = o2.sent()) && 200 === r3.status ? [2, r3.data] : [2, null];
        }
      });
    });
  }, t2.prototype.loadVocalAmplitude = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2;
      return v(this, function(r2) {
        switch (r2.label) {
          case 0:
            return [4, m(this.songleEndpoint + "/songs/" + t3 + "/vamplitude.json")];
          case 1:
            return (e2 = r2.sent()) && 200 === e2.status && e2.data ? [2, e2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.loadValenceArousal = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2;
      return v(this, function(r2) {
        switch (r2.label) {
          case 0:
            return [4, m(this.songleEndpoint + "/songs/" + t3 + "/av.json")];
          case 1:
            return (e2 = r2.sent()) && 200 === e2.status && e2.data ? [2, e2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.list = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2;
      return v(this, function(r2) {
        switch (r2.label) {
          case 0:
            return void 0 === t3 && (t3 = {}), [4, m(this.endpoint + "/songs", t3)];
          case 1:
            return (e2 = r2.sent()) && 200 === e2.status ? [2, e2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.listPrivate = function() {
    return y(this, void 0, void 0, function() {
      var t3, e2, r2, n2, i2, o2, s2;
      return v(this, function(a2) {
        switch (a2.label) {
          case 0:
            return [4, T.getProfile()];
          case 1:
            return t3 = a2.sent(), T.isSongleUser(t3) ? (T.isSpoofingSongleUser(t3) && (r2 = t3.user, n2 = r2.songleUserId, i2 = r2.songleAccessToken, o2 = r2.songleRefreshToken, e2 = { songleUserId: n2, songleAccessToken: i2, songleRefreshToken: o2 }), [4, m(this.endpoint + "/songle/me/songs.json", f(f({}, e2), { private: true }), { withCredentials: true })]) : [2, { data: null, error: "Songle authentication is required" }];
          case 2:
            return (s2 = a2.sent()) && 200 === s2.status ? [2, s2.data] : [2, { data: null, error: "private songs not found" }];
        }
      });
    });
  }, t2.prototype.create = function(t3) {
    return y(this, void 0, void 0, function() {
      return v(this, function(e2) {
        return [2, this.doCreate(t3, false)];
      });
    });
  }, t2.prototype.createPrivate = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2;
      return v(this, function(r2) {
        switch (r2.label) {
          case 0:
            return [4, T.getProfile()];
          case 1:
            return e2 = r2.sent(), T.isSongleUser(e2) ? [2, this.doCreate(t3, true)] : [2, { success: false, song: null, error: "Songle authentication is required" }];
        }
      });
    });
  }, t2.prototype.doCreate = function(t3, e2) {
    var r2, n2;
    return y(this, void 0, void 0, function() {
      var i2, o2, s2, a2, u2;
      return v(this, function(l2) {
        switch (l2.label) {
          case 0:
            return i2 = t3.url, o2 = t3.name, s2 = t3.artistName, [4, T.getToken()];
          case 1:
            return a2 = l2.sent(), [4, w(e2 ? this.endpoint + "/etc/songs/private" : this.endpoint + "/etc/songs", { url: i2, name: o2, artist: s2 }, { postToken: a2, withCredentials: true })];
          case 2:
            return (u2 = l2.sent()) && 200 === u2.status ? e2 ? [2, { success: true, song: u2.data.data.song }] : [2, { success: true, song: u2.data.song }] : [2, { success: false, error: ((null === (r2 = null == u2 ? void 0 : u2.data) || void 0 === r2 ? void 0 : r2.data) ? u2.data.data.message : null === (n2 = null == u2 ? void 0 : u2.data) || void 0 === n2 ? void 0 : n2.message) || "failed to register a song" }];
        }
      });
    });
  }, t2.prototype.uploadPrivate = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2, r2, n2, i2, o2, s2, a2, u2, l2;
      return v(this, function(c2) {
        switch (c2.label) {
          case 0:
            return [4, T.getProfile()];
          case 1:
            if (e2 = c2.sent(), !T.isSongleUser(e2))
              throw new Error("Songle authentication is required");
            return T.isSpoofingSongleUser(e2) ? (n2 = e2.user, i2 = n2.songleUserId, o2 = n2.songleAccessToken, s2 = n2.songleRefreshToken, a2 = { songleUserId: i2, songleAccessToken: o2, songleRefreshToken: s2 }, r2 = "?" + Object.keys(a2).map(function(t4) {
              return t4 + "=" + encodeURIComponent(a2[t4]);
            }).join("&")) : r2 = "", (u2 = new FormData()).append("file", t3), [4, w(this.endpoint + "/songle/me/uploads.json" + r2, u2, { withCredentials: true })];
          case 2:
            return (l2 = c2.sent()) && 200 === l2.status && l2.data ? [2, l2.data.data] : [2, null];
        }
      });
    });
  }, t2.prototype.search = function(t3, e2) {
    return void 0 === e2 && (e2 = true), y(this, void 0, void 0, function() {
      var r2;
      return v(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, m(this.songleEndpoint + "/songs/search.json", { q: t3, lyrics: e2 ? 1 : 0 })];
          case 1:
            return (r2 = n2.sent()) && 200 === r2.status && r2.data ? [2, { success: true, data: r2.data }] : [2, { success: false }];
        }
      });
    });
  }, t2.prototype.copySongMap = function(t3) {
    var e2;
    return y(this, void 0, void 0, function() {
      var r2, n2, i2, o2;
      return v(this, function(s2) {
        switch (s2.label) {
          case 0:
            return r2 = t3.sourceId, n2 = t3.destinationId, i2 = t3.types || ["beat", "chord", "chorus", "melody"], [4, w(this.endpoint + "/songle/me/songs/" + n2 + "/actions/copy_music_map.json", { source_id: r2, types: i2 }, { withCredentials: true })];
          case 1:
            return (o2 = s2.sent()) && (null === (e2 = o2.data) || void 0 === e2 ? void 0 : e2.success) ? [2, { success: true }] : [2, { success: false, error: null == o2 ? void 0 : o2.data }];
        }
      });
    });
  }, t2.prototype.createStage = function() {
    var t3;
    return y(this, void 0, void 0, function() {
      var e2, r2;
      return v(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, T.getProfile()];
          case 1:
            return e2 = n2.sent(), [4, w(this.endpoint + "/etc/songs/stage", null, { postToken: null === (t3 = null == e2 ? void 0 : e2.status) || void 0 === t3 ? void 0 : t3.token, withCredentials: true })];
          case 2:
            return [2, (null == (r2 = n2.sent()) ? void 0 : r2.data) || null];
        }
      });
    });
  }, t2;
}())();
var B = function() {
  function t2() {
  }
  return Object.defineProperty(t2.prototype, "endpoint", { get: function() {
    return g.textalive.server + "/templates/";
  }, enumerable: false, configurable: true }), t2.prototype.list = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2;
      return v(this, function(r2) {
        switch (r2.label) {
          case 0:
            return [4, m("" + this.endpoint, t3)];
          case 1:
            return (e2 = r2.sent()) && 200 === e2.status ? [2, e2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.load = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2;
      return v(this, function(r2) {
        switch (r2.label) {
          case 0:
            return [4, m("" + (this.endpoint + t3))];
          case 1:
            return (e2 = r2.sent()) && 200 === e2.status ? [2, e2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.loadByName = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2, r2, n2;
      return v(this, function(i2) {
        switch (i2.label) {
          case 0:
            return r2 = "latest", t3 && (e2 = t3.match(/(.+)@([0-9]+)/)) && (t3 = e2[1], r2 = e2[2]), [4, m(this.endpoint + t3 + "/" + r2)];
          case 1:
            return (n2 = i2.sent()) && 200 === n2.status ? [2, n2.data] : "latest" !== r2 ? [2, this.loadByName(t3)] : [2, null];
        }
      });
    });
  }, t2.prototype.loadForVideo = function(t3, e2) {
    return void 0 === e2 && (e2 = { script: true, withoutAuthors: true }), y(this, void 0, void 0, function() {
      var r2;
      return v(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, m(this.endpoint + "for/" + t3, e2)];
          case 1:
            return (r2 = n2.sent()) && 200 === r2.status ? [2, r2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.create = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2, r2, n2;
      return v(this, function(i2) {
        switch (i2.label) {
          case 0:
            return [4, T.getToken()];
          case 1:
            return e2 = i2.sent(), [4, w(this.endpoint, t3, { postToken: e2, withCredentials: true })];
          case 2:
            return (r2 = i2.sent()) ? 200 !== r2.status || Array.isArray(r2.data) || r2.data.error ? (n2 = Array.isArray(r2.data) ? { parseErrors: r2.data } : r2.data, [2, f(f({}, n2), { success: false })]) : [2, f(f({}, r2.data), { success: true })] : [2, { success: false }];
        }
      });
    });
  }, t2.prototype.listContributors = function(t3, e2) {
    return y(this, void 0, void 0, function() {
      var r2;
      return v(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, m("" + this.endpoint + t3 + "/" + e2 + "/contributors")];
          case 1:
            return (r2 = n2.sent()) && 200 === r2.status ? [2, r2.data] : [2, null];
        }
      });
    });
  }, t2;
}();
var V = new B();
var G = new (function() {
  function t2() {
  }
  return Object.defineProperty(t2.prototype, "endpoint", { get: function() {
    return g.textalive.server + "/videos/";
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "rendererEndpoint", { get: function() {
    return g.textalive.server + "/renderer/";
  }, enumerable: false, configurable: true }), t2.prototype.list = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2;
      return v(this, function(r2) {
        switch (r2.label) {
          case 0:
            return [4, m("" + this.endpoint, t3)];
          case 1:
            return (e2 = r2.sent()) && 200 === e2.status ? [2, e2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.load = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2, r2, n2, i2, o2, s2, a2;
      return v(this, function(u2) {
        switch (u2.label) {
          case 0:
            return e2 = {}, [4, T.getProfile()];
          case 1:
            return r2 = u2.sent(), T.isSpoofingSongleUser(r2) && (n2 = r2.user, i2 = n2.songleUserId, o2 = n2.songleAccessToken, s2 = n2.songleRefreshToken, e2 = { songleUserId: i2, songleAccessToken: o2, songleRefreshToken: s2 }), [4, m("" + (this.endpoint + t3), e2, { withCredentials: true })];
          case 2:
            return (a2 = u2.sent()) && 200 === a2.status ? [2, a2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.create = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2, r2;
      return v(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, T.getToken()];
          case 1:
            return e2 = n2.sent(), [4, w(this.endpoint, t3, { postToken: e2, withCredentials: true })];
          case 2:
            return (r2 = n2.sent()) ? 200 !== r2.status || r2.data.error ? [2, f(f({}, r2.data), { success: false })] : [2, f(f({}, r2.data), { success: true })] : [2, { success: false }];
        }
      });
    });
  }, t2.prototype.delete = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2, r2;
      return v(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, T.getToken()];
          case 1:
            return e2 = n2.sent(), [4, w(this.endpoint + "delete", { id: t3 }, { postToken: e2, withCredentials: true })];
          case 2:
            return (r2 = n2.sent()) && 200 === r2.status ? [2, { success: true, video: r2.data }] : [2, { success: false, video: null }];
        }
      });
    });
  }, t2.prototype.listContributors = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2;
      return v(this, function(r2) {
        switch (r2.label) {
          case 0:
            return [4, m("" + this.endpoint + t3 + "/contributors", null, { withCredentials: true })];
          case 1:
            return (e2 = r2.sent()) && 200 === e2.status ? [2, e2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.listRenderings = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2;
      return v(this, function(r2) {
        switch (r2.label) {
          case 0:
            return [4, m(this.rendererEndpoint + "list", { videoId: t3 }, { withCredentials: true })];
          case 1:
            return (e2 = r2.sent()) && 200 === e2.status ? [2, e2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.getRenderingStatus = function(t3) {
    return y(this, void 0, void 0, function() {
      var e2;
      return v(this, function(r2) {
        switch (r2.label) {
          case 0:
            return [4, m(this.rendererEndpoint + "status", { id: t3 }, { withCredentials: true })];
          case 1:
            return (e2 = r2.sent()) && 200 === e2.status ? [2, e2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.render = function(t3, e2, r2) {
    return y(this, void 0, void 0, function() {
      var n2, i2, o2;
      return v(this, function(s2) {
        switch (s2.label) {
          case 0:
            return [4, T.getToken()];
          case 1:
            return n2 = s2.sent(), i2 = { token: n2, videoId: t3, quality: e2 }, r2 && (i2.authentication = true), [4, w(this.rendererEndpoint + "render", i2, { withCredentials: true })];
          case 2:
            return (o2 = s2.sent()) && 200 === o2.status ? [2, o2.data] : [2, null];
        }
      });
    });
  }, t2.prototype.getDownloadInfo = function() {
    return y(this, void 0, void 0, function() {
      var t3;
      return v(this, function(e2) {
        switch (e2.label) {
          case 0:
            return t3 = { endpoint: this.rendererEndpoint + "download" }, [4, T.getToken()];
          case 1:
            return [2, (t3.token = e2.sent(), t3)];
        }
      });
    });
  }, t2;
}())();
var q = { asset: _, endpoint: g, lyrics: F, song: M, template: V, text: x, font: A, user: T, video: G };
var W = function(t2, e2) {
  return W = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(t3, e3) {
    t3.__proto__ = e3;
  } || function(t3, e3) {
    for (var r2 in e3)
      Object.prototype.hasOwnProperty.call(e3, r2) && (t3[r2] = e3[r2]);
  }, W(t2, e2);
};
function Y(t2, e2) {
  if ("function" != typeof e2 && null !== e2)
    throw new TypeError("Class extends value " + String(e2) + " is not a constructor or null");
  function r2() {
    this.constructor = t2;
  }
  W(t2, e2), t2.prototype = null === e2 ? Object.create(e2) : (r2.prototype = e2.prototype, new r2());
}
var z = function() {
  function t2() {
    this._parent = null, this._children = [], this._previous = null, this._next = null, this._runtime = null, this._templates = [];
  }
  return Object.defineProperty(t2.prototype, "video", { get: function() {
    return this.parent && this.parent.video;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "parent", { get: function() {
    return this._parent;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "children", { get: function() {
    return this._children;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "previous", { get: function() {
    return this._previous;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "next", { get: function() {
    return this._next;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "startTime", { get: function() {
    return this._data ? this._data.startTime : 0;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "endTime", { get: function() {
    return this._data ? this._data.endTime : 0;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "duration", { get: function() {
    return this.endTime - this.startTime;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "rendering", { get: function() {
    return this._runtime ? this._runtime.rendering : null;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "graphics", { get: function() {
    return this._runtime ? this._runtime.graphics : null;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "templates", { get: function() {
    return this._templates.slice();
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "templateCount", { get: function() {
    return this._templates.length;
  }, enumerable: false, configurable: true }), t2.prototype.contains = function(t3) {
    return t3 >= this.startTime && t3 <= this.endTime;
  }, t2.prototype.overlaps = function(t3, e2) {
    return this.contains(t3) || this.contains(e2) || this.startTime <= t3 && this.endTime >= e2;
  }, t2.prototype.progress = function(t3) {
    return this.contains(t3) ? (t3 - this.startTime) / this.duration : -1;
  }, t2.prototype.maximize = function() {
    var t3 = false, e2 = this.endTime, r2 = Math.max(null === this._parent ? 0 : this._parent.startTime, null === this._previous ? 0 : this._previous.endTime);
    r2 !== this.startTime && (this.moveWithChildren(r2 - this.startTime), t3 = true);
    var n2 = Math.min(null === this._parent ? this.video.duration : this._parent.endTime, null === this._next ? this.video.duration : this._next.startTime);
    return n2 !== this.endTime && (this._data.endTime = n2, t3 = e2 !== n2), t3;
  }, t2.prototype.moveWithChildren = function(t3) {
    var e2 = [];
    for (e2.push(this); e2.length > 0; ) {
      var r2 = e2.pop();
      null != r2._children && r2._children.forEach(function(t4) {
        return e2.push(t4);
      }), r2._data.startTime += t3, r2._data.endTime += t3;
    }
  }, t2.prototype.getTemplate = function(t3) {
    return void 0 === t3 && (t3 = 0), t3 < 0 || t3 >= this._templates.length ? null : this._templates[t3];
  }, t2.prototype.addTemplateAt = function(t3, e2) {
    this._templates.splice(e2, 0, t3), t3.assignedUnit = this;
  }, t2.prototype.addTemplate = function(t3) {
    this._templates.push(t3), t3.assignedUnit = this;
  }, t2.prototype.removeTemplates = function() {
    for (var t3 = this._templates.slice(); this._templates.length > 0; )
      this._templates.pop();
    return t3;
  }, t2.prototype.removeTemplateAt = function(t3) {
    if (t3 < 0 || t3 >= this._templates.length)
      return null;
    var e2 = this._templates.splice(t3, 1)[0];
    return e2.assignedUnit = null, e2;
  }, t2.prototype.removeTemplate = function(t3) {
    for (var e2 = 0; e2 < this._templates.length; e2++) {
      var r2 = this._templates[e2];
      if (r2 === t3)
        return this._templates.splice(e2, 1), t3.assignedUnit = null, r2;
    }
    return null;
  }, t2.prototype.getType = function() {
    return r.NONE;
  }, t2.prototype.toString = function() {
    return "RenderingUnit";
  }, t2;
}();
function J(t2, e2) {
  return "number" == typeof e2 && !isNaN(e2) && e2 > t2 ? e2 : t2;
}
function H(t2, e2) {
  return "number" == typeof e2 && !isNaN(e2) && e2 < t2 ? e2 : t2;
}
var X = function(t2) {
  function e2() {
    return null !== t2 && t2.apply(this, arguments) || this;
  }
  return Y(e2, t2), Object.defineProperty(e2.prototype, "text", { get: function() {
    var t3 = "";
    return this.children.forEach(function(e3) {
      t3 += e3.text;
    }), t3;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "color", { get: function() {
    return this.children.reduce(function(t3, e3) {
      return null === t3 ? e3.color : void 0 === t3 || t3.eq(e3.color) ? t3 : void 0;
    }, null);
  }, set: function(t3) {
    null !== t3 && this.children.forEach(function(e3) {
      e3.color = t3;
    });
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "font", { set: function(t3) {
    null !== t3 && this.children.forEach(function(e3) {
      e3.font = t3;
    });
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "fontFamily", { get: function() {
    return this.children.reduce(function(t3, e3) {
      var r2 = e3.fontFamily;
      return void 0 === t3 || null !== t3 && t3 !== r2 ? void 0 : r2;
    }, null);
  }, set: function(t3) {
    this.children.forEach(function(e3) {
      e3.fontFamily = t3;
    });
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "fontStyle", { get: function() {
    return this.children.reduce(function(t3, e3) {
      var r2 = e3.fontStyle;
      return void 0 === t3 || null !== t3 && t3 !== r2 ? void 0 : r2;
    }, null);
  }, set: function(t3) {
    this.children.forEach(function(e3) {
      e3.fontStyle = t3;
    });
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "fontSize", { get: function() {
    return this.children.length <= 0 ? 0 : this.children.reduce(function(t3, e3) {
      return t3 + e3.fontSize;
    }, 0) / this.children.length;
  }, set: function(t3) {
    this.children.forEach(function(e3) {
      e3.fontSize = t3;
    });
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "advance", { get: function() {
    return this.children.reduce(function(t3, e3) {
      return t3 + e3.advance;
    }, 0);
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "ascent", { get: function() {
    return this.children.reduce(function(t3, e3) {
      return Math.max(t3, e3.ascent);
    }, 0);
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "descent", { get: function() {
    return this.children.reduce(function(t3, e3) {
      return Math.max(t3, e3.descent);
    }, 0);
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "height", { get: function() {
    return this.ascent + this.descent;
  }, enumerable: false, configurable: true }), e2.prototype.expandTime = function(t3) {
    return { startTime: H(this.startTime, t3.startTime), endTime: J(this.endTime, t3.endTime) };
  }, e2.prototype.toString = function() {
    return this.text;
  }, e2;
}(z);
var Z = function() {
  function t2(t3) {
    this.a = 0, this.r = 0, this.g = 0, this.b = 0, this.from(t3);
  }
  return Object.defineProperty(t2.prototype, "value", { get: function() {
    return (((this.a << 8) + this.r << 8) + this.g << 8) + this.b;
  }, set: function(t3) {
    this.fromNumber(t3, true);
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "rgb", { get: function() {
    return "rgb(" + this.r + "," + this.g + "," + this.b + ")";
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "rgba", { get: function() {
    return "rgba(" + this.r + "," + this.g + "," + this.b + "," + this.a / 255 + ")";
  }, enumerable: false, configurable: true }), t2.prototype.eq = function(e2) {
    return typeof this == typeof e2 && e2 instanceof t2 && this.value === e2.value;
  }, t2.prototype.toString = function(t3) {
    return void 0 === t3 && (t3 = true), t3 ? this.rgba : this.rgb;
  }, t2.prototype.from = function(t3) {
    if (void 0 === t3 && (t3 = "#000"), "object" == typeof t3) {
      if (!t3)
        return;
      return "number" == typeof t3.value ? void (this.value = t3.value) : "number" == typeof t3.r && "number" == typeof t3.g && "number" == typeof t3.b ? (this.a = "number" == typeof t3.a ? t3.a : 255, this.r = t3.r, this.g = t3.g, void (this.b = t3.b)) : void 0;
    }
    "string" == typeof t3 ? this.fromString(t3) : "number" == typeof t3 && this.fromNumber(t3);
  }, t2.prototype.fromString = function(t3) {
    if (t3) {
      if ("#" === t3.charAt(0) && (t3 = t3.substr(1)), 4 === t3.length) {
        var e2 = t3.charAt(0), r2 = t3.charAt(1), n2 = t3.charAt(2), i2 = t3.charAt(3);
        t3 = "" + e2 + e2 + r2 + r2 + n2 + n2 + i2 + i2;
      }
      3 === t3.length && (r2 = t3.charAt(0), n2 = t3.charAt(1), i2 = t3.charAt(2), t3 = "" + r2 + r2 + n2 + n2 + i2 + i2);
      var o2 = parseInt(t3, 16);
      this.fromNumber(o2, 8 === t3.length);
    }
  }, t2.prototype.fromNumber = function(t3, e2) {
    void 0 === e2 && (e2 = true), isNaN(t3) || (this.a = e2 ? t3 >> 24 & 255 : 255, this.r = t3 >> 16 & 255, this.g = t3 >> 8 & 255, this.b = 255 & t3);
  }, t2;
}();
var $ = function() {
  function t2(t3, e2, r2) {
    void 0 === t3 && (t3 = "Noto Sans Japanese"), void 0 === e2 && (e2 = 40), void 0 === r2 && (r2 = ""), this._family = t3, this._size = e2, this._style = r2;
  }
  return Object.defineProperty(t2.prototype, "family", { get: function() {
    return this._family;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "size", { get: function() {
    return this._size;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "style", { get: function() {
    return this._style;
  }, enumerable: false, configurable: true }), t2.prototype.deriveFamily = function(e2) {
    return new t2(e2, this._size, this._style);
  }, t2.prototype.deriveStyle = function(e2) {
    return new t2(this._family, this._size, e2);
  }, t2.prototype.deriveSize = function(e2) {
    return new t2(this._family, e2, this._style);
  }, t2.prototype.clone = function() {
    return new t2(this._family, this._size, this._style);
  }, t2.prototype.eq = function(t3) {
    return this._family === t3._family && this._size === t3._size && this._style === t3._style;
  }, t2.prototype.toString = function(t3) {
    void 0 === t3 && (t3 = 1);
    var e2, r2 = function(t4) {
      if (!t4 || t4.length <= 0)
        return [];
      for (var e3 = [], r3 = "", n2 = false, i2 = false, o2 = false, s2 = 0, a2 = t4; s2 < a2.length; s2++) {
        var u2 = a2[s2];
        if (i2 ? o2 ? o2 = false : "\\" === u2 ? o2 = true : u2 === i2 && (i2 = false) : '"' === u2 || "'" === u2 ? i2 = u2 : "," === u2 && (n2 = true), n2) {
          var l2 = r3.trim();
          "" !== l2 && e3.push(l2), r3 = "", n2 = false;
        } else
          r3 += u2;
      }
      var c2 = r3.trim();
      return "" !== c2 && e3.push(c2), e3;
    }(this._family);
    return e2 = r2.length < 1 ? "" : r2.length > 1 ? " " + r2.join(", ") : (e2 = r2[0]).length > 1 && e2[0] !== e2[e2.length - 1] || "'" !== e2[0] && '"' !== e2[0] ? " '" + e2 + "'" : " " + e2, this._style + (this._style.length > 0 ? " " : "") + this._size * t3 + "px" + e2;
  }, t2;
}();
var Q = function(t2) {
  function e2(e3) {
    var r2 = t2.call(this) || this;
    return r2._data = e3, r2._font = new $(e3 && e3.fontFamily, e3 && e3.fontSize, e3 && e3.fontStyle), r2._color = new Z(), r2;
  }
  return Y(e2, t2), Object.defineProperty(e2.prototype, "parent", { get: function() {
    return this._parent;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "previous", { get: function() {
    return this._previous;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "next", { get: function() {
    return this._next;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "text", { get: function() {
    return this._data && this._data.char || "?";
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "advance", { get: function() {
    return this._runtime ? this._runtime.advance : 0;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "ascent", { get: function() {
    return this._runtime ? this._runtime.ascent : 0;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "descent", { get: function() {
    return this._runtime ? this._runtime.descent : 0;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "font", { get: function() {
    return this._font;
  }, set: function(t3) {
    null === t3 || this.font.eq(t3) || (this._font = t3.clone(), this._data.fontFamily = t3.family, this._data.fontSize = t3.size, this._data.fontStyle = t3.style, this._runtime && this._runtime.onFontUpdate(this.font));
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "fontFamily", { get: function() {
    return this.font.family;
  }, set: function(t3) {
    this.font.family !== t3 && (this._font = this.font.deriveFamily(t3), this._data.fontFamily = t3, this._runtime && this._runtime.onFontUpdate(this.font));
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "fontStyle", { get: function() {
    return this.font.style;
  }, set: function(t3) {
    this.font.style !== t3 && (this._font = this.font.deriveStyle(t3), this._data.fontStyle = t3, this._runtime && this._runtime.onFontUpdate(this.font));
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "fontSize", { get: function() {
    return this.font.size;
  }, set: function(t3) {
    isNaN(t3) || this.font.size === t3 || (this._font = this.font.deriveSize(t3), this._data.fontSize = t3, this._runtime && this._runtime.onFontUpdate(this.font));
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "color", { get: function() {
    return this._color;
  }, set: function(t3) {
    t3 && !t3.eq(this.color) && (this._color = t3, this._runtime && this._runtime.onColorUpdate(t3));
  }, enumerable: false, configurable: true }), e2.prototype.getType = function() {
    return r.CHAR;
  }, e2;
}(X);
var K = function(t2) {
  function e2(e3) {
    var r2 = t2.call(this) || this;
    return r2._data = e3, r2;
  }
  return Y(e2, t2), e2.prototype.getType = function() {
    return r.GRAPHIC;
  }, e2.prototype.toString = function() {
    return "Graphic";
  }, e2;
}(z);
var tt = function(t2) {
  function e2(e3) {
    var r2 = t2.call(this) || this;
    return r2._data = e3, r2;
  }
  return Y(e2, t2), Object.defineProperty(e2.prototype, "parent", { get: function() {
    return this._parent;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "children", { get: function() {
    return this._children.slice();
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "previous", { get: function() {
    return this._previous;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "next", { get: function() {
    return this._next;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "startTime", { get: function() {
    return this.firstChar ? this.firstChar.startTime : 0;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "endTime", { get: function() {
    return this.lastChar ? this.lastChar.endTime : 0;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "pos", { get: function() {
    return this._data && this._data.pos || "";
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "rawPos", { get: function() {
    return this._data && this._data.rawPoS || "";
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "language", { get: function() {
    return this._data && this._data.language || "";
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "countDown", { get: function() {
    return this._data ? this._data.countDown : -1;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "countUp", { get: function() {
    return this._data ? this._data.countUp : -1;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "initialCount", { get: function() {
    return this._data ? this._data.initialCount : -1;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "charCount", { get: function() {
    return this._children.length;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "firstChar", { get: function() {
    return this._children.length <= 0 ? null : this._children[0];
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "lastChar", { get: function() {
    return this._children.length <= 0 ? null : this._children[this._children.length - 1];
  }, enumerable: false, configurable: true }), e2.prototype.addChar = function(t3) {
    if (t3) {
      this._children.length > 0 && (t3._previous = this.lastChar, this.lastChar._next = t3), this._children.push(t3), t3._parent = this;
      var e3 = this.expandTime(t3), r2 = e3.startTime, n2 = e3.endTime;
      this._data.startTime = r2, this._data.endTime = n2;
    }
  }, e2.prototype.findIndex = function(t3) {
    return t3 instanceof Q ? this._children.indexOf(t3) : -1;
  }, e2.prototype.getType = function() {
    return r.WORD;
  }, e2;
}(X);
var et = function(t2) {
  function e2(e3, r2) {
    var n2 = t2.call(this) || this;
    return n2._video = e3, n2._data = r2, n2.createUnits(), n2;
  }
  return Y(e2, t2), e2.prototype.createUnits = function() {
    var t3 = this, e3 = this._data;
    e3 && Array.isArray(e3.words) && e3.words.forEach(function(e4) {
      if (e4) {
        var r2 = new tt(e4);
        Array.isArray(e4.characters) && e4.characters.forEach(function(t4) {
          return r2.addChar(new Q(t4));
        }), t3.addWord(r2);
      }
    });
  }, Object.defineProperty(e2.prototype, "children", { get: function() {
    return this._children.slice();
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "previous", { get: function() {
    return this._previous;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "next", { get: function() {
    return this._next;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "video", { get: function() {
    return this._video;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "startTime", { get: function() {
    return this.firstChar ? this.firstChar.startTime : 0;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "endTime", { get: function() {
    return this.lastChar ? this.lastChar.endTime : 0;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "wordCount", { get: function() {
    return this._children.length;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "charCount", { get: function() {
    return this._children.reduce(function(t3, e3) {
      return t3 + e3.charCount;
    }, 0);
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "firstWord", { get: function() {
    return this._children.length <= 0 ? null : this._children[0];
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "lastWord", { get: function() {
    return this._children.length <= 0 ? null : this._children[this._children.length - 1];
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "firstChar", { get: function() {
    var t3 = this.firstWord;
    return null === t3 ? null : t3.firstChar;
  }, enumerable: false, configurable: true }), Object.defineProperty(e2.prototype, "lastChar", { get: function() {
    var t3 = this.lastWord;
    return null === t3 ? null : t3.lastChar;
  }, enumerable: false, configurable: true }), e2.prototype.getWord = function(t3) {
    return t3 < 0 || t3 >= this._children.length ? null : this._children[t3];
  }, e2.prototype.getChar = function(t3) {
    if (t3 < 0)
      return null;
    for (var e3 = 0, r2 = this.firstWord; ; ) {
      if (!r2)
        return null;
      if (e3 + r2.children.length > t3)
        break;
      e3 += r2.children.length, r2 = r2.next;
    }
    return r2.children[t3 - e3];
  }, e2.prototype.addWord = function(t3) {
    if (t3) {
      this._children.length > 0 && (t3._previous = this.lastWord, t3._previous._next = t3, t3.firstChar._previous = t3._previous.lastChar, t3._previous.lastChar._next = t3.firstChar), this._children.push(t3), t3._parent = this;
      var e3 = this.expandTime(t3), r2 = e3.startTime, n2 = e3.endTime;
      this._data.startTime = r2, this._data.endTime = n2;
    }
  }, e2.prototype.findIndex = function(t3) {
    if (t3 instanceof tt)
      return this._children.indexOf(t3);
    if (t3 instanceof Q) {
      for (var e3 = 0, r2 = false, n2 = 0, i2 = this._children; n2 < i2.length; n2++) {
        var o2 = i2[n2], s2 = o2.findIndex(t3);
        if (!(s2 < 0)) {
          e3 += s2, r2 = true;
          break;
        }
        e3 += o2.charCount;
      }
      return r2 ? e3 : -1;
    }
    return -1;
  }, e2.prototype.getType = function() {
    return r.PHRASE;
  }, e2;
}(X);
function rt(t2, r2, n2) {
  if (!t2 || t2.length <= 0)
    return null;
  var i2 = e.exports.sortedIndex(t2, r2, function(t3) {
    return t3.endTime;
  });
  if (i2 < 0)
    return null;
  if ("number" == typeof (null == n2 ? void 0 : n2.endTime)) {
    i2 >= t2.length && (i2 = t2.length - 1);
    var o2 = r2, s2 = n2.endTime;
    return t2[i2].overlaps(o2, s2) ? t2[i2] : i2 < 1 ? null : t2[i2 - 1].overlaps(o2, s2) ? t2[i2 - 1] : null;
  }
  return i2 >= t2.length ? null : (null == n2 ? void 0 : n2.loose) || t2[i2].contains(r2) ? t2[i2] : null;
}
var nt = function() {
  function t2(t3) {
    this._credits = [], this._phrases = [], this._graphics = [], this.data = t3 || {}, this.createUnits();
  }
  return Object.defineProperty(t2.prototype, "credits", { get: function() {
    return this._credits.slice();
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "phrases", { get: function() {
    return this._phrases.slice();
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "graphics", { get: function() {
    return this._graphics.slice();
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "rendering", { get: function() {
    return this._runtime.rendering;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "duration", { get: function() {
    return this.data.duration || 0;
  }, set: function(t3) {
    this.data.duration = t3;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "startTime", { get: function() {
    return this.data.startTime || 0;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "endTime", { get: function() {
    return this.data.endTime || 0;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "creditCount", { get: function() {
    return this._credits.length;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "phraseCount", { get: function() {
    return this._phrases.length;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "graphicCount", { get: function() {
    return this._graphics.length;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "wordCount", { get: function() {
    return this._phrases.reduce(function(t3, e2) {
      return t3 + e2.wordCount;
    }, 0);
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "charCount", { get: function() {
    return this._phrases.reduce(function(t3, e2) {
      return t3 + e2.charCount;
    }, 0);
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "firstCredit", { get: function() {
    return this._credits.length <= 0 ? null : this._credits[0];
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "lastCredit", { get: function() {
    return this._credits.length <= 0 ? null : this._credits[this._credits.length - 1];
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "firstPhrase", { get: function() {
    return this._phrases.length <= 0 ? null : this._phrases[0];
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "lastPhrase", { get: function() {
    return this._phrases.length <= 0 ? null : this._phrases[this._phrases.length - 1];
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "firstWord", { get: function() {
    var t3;
    return (null === (t3 = this.firstPhrase) || void 0 === t3 ? void 0 : t3.firstWord) || null;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "lastWord", { get: function() {
    var t3;
    return (null === (t3 = this.lastPhrase) || void 0 === t3 ? void 0 : t3.lastWord) || null;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "firstChar", { get: function() {
    var t3;
    return (null === (t3 = this.firstWord) || void 0 === t3 ? void 0 : t3.firstChar) || null;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "lastChar", { get: function() {
    var t3;
    return (null === (t3 = this.lastWord) || void 0 === t3 ? void 0 : t3.lastChar) || null;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "firstGraphic", { get: function() {
    return this._graphics.length <= 0 ? null : this._graphics[0];
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "lastGraphic", { get: function() {
    return this._graphics.length <= 0 ? null : this._graphics[this._graphics.length - 1];
  }, enumerable: false, configurable: true }), t2.prototype.createUnits = function() {
    var t3, e2, r2 = this;
    Array.isArray(this.data.credits) ? (this.data.credits.sort(it), this.data.credits.forEach(function(t4) {
      return r2.doAddCredit(new et(r2, t4), false);
    }), this.organizeTimings(null === (t3 = this.firstCredit) || void 0 === t3 ? void 0 : t3.firstChar)) : this.data.credits = [], Array.isArray(this.data.phrases) ? (this.data.phrases.sort(it), this.data.phrases.forEach(function(t4) {
      return r2.doAddPhrase(new et(r2, t4), false);
    }), this.organizeTimings(null === (e2 = this.firstPhrase) || void 0 === e2 ? void 0 : e2.firstChar)) : this.data.phrases = [], Array.isArray(this.data.graphics) ? (this.data.graphics.sort(it), this.data.graphics.forEach(function(t4) {
      return r2.doAddGraphic(new K(t4), false);
    })) : this.data.graphics = [];
  }, t2.prototype.organizeTimings = function(t3) {
    for (; t3; )
      t3.startTime === t3.endTime && t3.maximize(), t3 = t3.next;
  }, t2.prototype.exportData = function(e2) {
    this.updateTemplateData(e2);
    for (var r2 = t2.exportUnitData(this.data.credits, true), n2 = r2.units, i2 = r2.templateClasses, o2 = t2.exportUnitData(this.data.phrases, false), s2 = o2.units, a2 = o2.templateClasses, u2 = t2.exportUnitData(this.data.graphics, true), l2 = u2.units, c2 = u2.templateClasses, p2 = i2.concat(a2, c2).filter(function(t3, e3, r3) {
      return r3.indexOf(t3) === e3;
    }), h2 = {}; p2.length > 0; ) {
      var d2 = p2.shift(), f2 = e2.getByName(d2);
      if (f2) {
        h2[d2] = f2.id;
        for (var y2 = 0, v2 = e2.getRequiredTemplates(f2.script); y2 < v2.length; y2++) {
          var g2 = v2[y2];
          h2[g2] || p2.push(g2);
        }
      } else
        console.log("template class not found", d2);
    }
    return { credits: n2, phrases: s2, graphics: l2, templateClasses: h2 };
  }, t2.exportUnitData = function(e2, r2) {
    if (void 0 === r2 && (r2 = false), !e2)
      return { units: [], templateClasses: [] };
    for (var n2 = [], i2 = [], o2 = 0, s2 = e2; o2 < s2.length; o2++) {
      var a2 = s2[o2], u2 = { templates: a2.templates ? a2.templates.map(function(t3) {
        var e3 = t3.type;
        i2.push(e3);
        var r3 = {};
        return Object.keys(t3.value).forEach(function(e4) {
          var n3 = t3.value[e4];
          r3[e4] = "object" == typeof n3 ? Object.assign({}, n3) : n3;
        }), { type: e3, value: r3 };
      }) : [] }, l2 = void 0;
      if (a2.words) {
        var c2 = a2, p2 = t2.exportUnitData(c2.words);
        u2.words = p2.units, l2 = p2.templateClasses;
      } else if (a2.characters) {
        var h2 = a2, d2 = t2.exportUnitData(h2.characters);
        u2.characters = d2.units, l2 = d2.templateClasses;
      } else {
        for (var f2 = 0, y2 = ["fontFamily", "fontSize", "fontStyle"]; f2 < y2.length; f2++) {
          var v2 = y2[f2];
          a2[v2] && (u2[v2] = a2[v2]);
        }
        l2 = [];
      }
      r2 && (u2.startTime = a2.startTime, u2.endTime = a2.endTime), n2.push(u2), i2 = i2.concat(l2);
    }
    return { units: n2, templateClasses: i2 = i2.filter(function(t3, e3, r3) {
      return r3.indexOf(t3) === e3;
    }) };
  }, t2.prototype.updateTemplateData = function(e2) {
    t2.updateTemplateDataForUnits(e2, this.firstCredit, this.data.credits), t2.updateTemplateDataForUnits(e2, this.firstPhrase, this.data.phrases), t2.updateTemplateDataForUnits(e2, this.firstGraphic, this.data.graphics);
  }, t2.updateTemplateDataForUnits = function(e2, r2, n2) {
    if (r2 && n2)
      for (var i2 = 0, o2 = n2; i2 < o2.length; i2++) {
        var s2 = o2[i2];
        s2.templates = [];
        for (var a2 = 0; a2 < r2.templateCount; a2++) {
          var u2 = r2.getTemplate(a2), l2 = e2.exportInstance(u2);
          s2.templates.push(l2);
        }
        if (s2.words) {
          var c2 = s2;
          t2.updateTemplateDataForUnits(e2, r2.children[0], c2.words);
        } else if (s2.characters) {
          var p2 = s2;
          t2.updateTemplateDataForUnits(e2, r2.children[0], p2.characters);
        }
        r2 = r2.next;
      }
  }, t2.prototype.addCredit = function(t3) {
    this.doAddCredit(t3, true);
  }, t2.prototype.doAddCredit = function(t3, e2) {
    var r2 = this.addRenderingUnit(this._credits, t3);
    e2 && this.data.credits.splice(r2, 0, t3._data), this._runtime && this._runtime.addCredit(t3);
  }, t2.prototype.addPhrase = function(t3) {
    this.doAddPhrase(t3, true);
  }, t2.prototype.doAddPhrase = function(t3, e2) {
    var r2 = this.addRenderingUnit(this._phrases, t3);
    e2 && this.data.phrases.splice(r2, 0, t3._data), this._runtime && this._runtime.addPhrase(t3);
  }, t2.prototype.addGraphic = function(t3) {
    this.doAddGraphic(t3, true);
  }, t2.prototype.doAddGraphic = function(t3, e2) {
    if (t3) {
      var r2 = this.addRenderingUnit(this._graphics, t3);
      e2 && this.data.graphics.splice(r2, 0, t3._data), this._runtime && this._runtime.addGraphic(t3);
    }
  }, t2.prototype.addRenderingUnit = function(t3, r2) {
    if (r2) {
      var n2 = e.exports.sortedIndex(t3, r2, ot), i2 = n2 > 0 ? t3[n2 - 1] : null, o2 = n2 < t3.length ? t3[n2] : null;
      if (t3.splice(n2, 0, r2), i2 && (r2._previous = i2, r2._previous._next = r2), o2 && (o2._previous = r2, r2._next = o2), r2 instanceof et && r2.wordCount > 0) {
        for (var s2 = i2; s2 && !s2.lastWord; )
          s2 = s2.previous;
        for (var a2 = o2; a2 && !a2.firstWord; )
          a2 = a2.next;
        if (s2 && (r2.firstWord._previous = s2.lastWord, s2.lastWord._next = r2.firstWord), a2 && (r2.lastWord._next = a2.firstWord, a2.firstWord._previous = r2.lastWord), r2.charCount > 0) {
          for (var u2 = null == s2 ? void 0 : s2.lastWord; u2 && null === u2.lastChar; )
            u2 = u2.previous;
          for (var l2 = null == a2 ? void 0 : a2.firstWord; l2 && null === l2.firstChar; )
            l2 = l2.next;
          u2 && (r2.firstChar._previous = u2.lastChar, u2.lastChar._next = r2.firstChar), l2 && (r2.lastChar._next = l2.firstChar, l2.firstChar._previous = r2.lastChar);
        }
      }
      return this.updateStartAndEndTime(), n2;
    }
  }, t2.prototype.removeCredit = function(t3) {
    var e2 = this.removeRenderingUnit(this._credits, t3);
    return !(e2 < 0 || (this.data.credits.splice(e2, 1), this._runtime && this._runtime.removeCredit(t3), 0));
  }, t2.prototype.removeCredits = function() {
    var t3 = this;
    this._runtime && this._credits.forEach(function(e2) {
      return t3._runtime.removeCredit(e2);
    }), this._credits = [], this.data.credits.splice(0, this.data.credits.length);
  }, t2.prototype.removePhrase = function(t3) {
    var e2 = this.removeRenderingUnit(this._phrases, t3);
    return !(e2 < 0 || (this.data.phrases.splice(e2, 1), this._runtime && this._runtime.removePhrase(t3), 0));
  }, t2.prototype.removePhrases = function() {
    var t3 = this;
    this._runtime && this._phrases.forEach(function(e2) {
      return t3._runtime.removePhrase(e2);
    }), this._phrases = [], this.data.phrases.splice(0, this.data.phrases.length);
  }, t2.prototype.removeGraphic = function(t3) {
    var e2 = this.removeRenderingUnit(this._graphics, t3);
    return !(e2 < 0 || (this.data.graphics.splice(e2, 1), this._runtime && this._runtime.removeGraphic(t3), 0));
  }, t2.prototype.removeGraphics = function() {
    var t3 = this;
    this._runtime && this._graphics.forEach(function(e2) {
      return t3._runtime.removeGraphic(e2);
    }), this._graphics = [], this.data.graphics.splice(0, this.data.graphics.length), this.rendering.reset();
  }, t2.prototype.removeRenderingUnit = function(t3, r2) {
    var n2 = e.exports.sortedIndex(t3, r2, ot);
    if (n2 < 0 || t3[n2] !== r2)
      return -1;
    if (t3.splice(n2, 1), r2 instanceof et) {
      if (r2.charCount > 0) {
        for (var i2 = r2._previous; i2 && null === i2.lastChar; )
          i2 = i2.previous;
        for (var o2 = r2._next; o2 && null === o2.firstChar; )
          o2 = o2.next;
        i2 && o2 ? (i2.lastChar._next = o2.firstChar, o2.firstChar._previous = i2.lastChar) : i2 ? i2.lastChar._next = null : o2 && (o2.firstChar._previous = null);
      }
      if (r2.wordCount > 0) {
        for (i2 = r2._previous; i2 && null === i2.lastWord; )
          i2 = i2.previous;
        for (o2 = r2._next; o2 && null === o2.firstWord; )
          o2 = o2.next;
        i2 && o2 ? (i2.lastWord._next = o2.firstWord, o2.firstWord._previous = i2.lastWord) : i2 ? i2.lastWord._next = null : o2 && (o2.firstWord._previous = null);
      }
    }
    r2._previous && (r2._previous._next = r2._next), r2._next && (r2._next._previous = r2._previous), this.updateStartAndEndTime();
  }, t2.prototype.updateStartAndEndTime = function() {
    var t3, e2, r2, n2, i2, o2, s2, a2;
    this.data.endTime = Math.max((null === (e2 = null === (t3 = this.lastCredit) || void 0 === t3 ? void 0 : t3.lastChar) || void 0 === e2 ? void 0 : e2.endTime) || 0, (null === (r2 = this.lastChar) || void 0 === r2 ? void 0 : r2.endTime) || 0, (null === (n2 = this.lastGraphic) || void 0 === n2 ? void 0 : n2.endTime) || 0);
    var u2 = null === (o2 = null === (i2 = this.firstCredit) || void 0 === i2 ? void 0 : i2.firstChar) || void 0 === o2 ? void 0 : o2.startTime, l2 = null === (s2 = this.firstChar) || void 0 === s2 ? void 0 : s2.startTime, c2 = null === (a2 = this.firstGraphic) || void 0 === a2 ? void 0 : a2.startTime;
    this.data.startTime = Math.min("number" == typeof u2 ? u2 : Number.MAX_VALUE, "number" == typeof l2 ? l2 : Number.MAX_VALUE, "number" == typeof c2 ? c2 : Number.MAX_VALUE, this.data.endTime);
  }, t2.prototype.findIndex = function(t3) {
    if (t3 instanceof et)
      return (e2 = this._phrases.indexOf(t3)) >= 0 ? e2 : this._credits.indexOf(t3);
    if (t3 instanceof tt) {
      for (var e2 = 0, r2 = false, n2 = 0, i2 = this._phrases; n2 < i2.length; n2++) {
        if (!((u2 = (a2 = i2[n2]).findIndex(t3)) < 0)) {
          e2 += u2, r2 = true;
          break;
        }
        e2 += a2.wordCount;
      }
      return r2 ? e2 : -1;
    }
    if (t3 instanceof Q) {
      e2 = 0, r2 = false;
      for (var o2 = 0, s2 = this._phrases; o2 < s2.length; o2++) {
        var a2, u2;
        if (!((u2 = (a2 = s2[o2]).findIndex(t3)) < 0)) {
          e2 += u2, r2 = true;
          break;
        }
        e2 += a2.charCount;
      }
      return r2 ? e2 : -1;
    }
    return t3 instanceof K ? this._graphics.indexOf(t3) : -1;
  }, t2.prototype.getCredit = function(t3) {
    return t3 < 0 || t3 >= this._credits.length ? null : this._credits[t3];
  }, t2.prototype.getPhrase = function(t3) {
    return t3 < 0 || t3 >= this._phrases.length ? null : this._phrases[t3];
  }, t2.prototype.getWord = function(t3) {
    if (t3 < 0)
      return null;
    for (var e2 = 0, r2 = this.firstPhrase; ; ) {
      if (!r2)
        return null;
      if (e2 + r2.children.length > t3)
        break;
      e2 += r2.children.length, r2 = r2.next;
    }
    return r2.children[t3 - e2];
  }, t2.prototype.getChar = function(t3) {
    if (t3 < 0)
      return null;
    for (var e2 = 0, r2 = this.firstWord; ; ) {
      if (!r2)
        return null;
      if (e2 + r2.children.length > t3)
        break;
      e2 += r2.children.length, r2 = r2.next;
    }
    return r2.children[t3 - e2];
  }, t2.prototype.getGraphic = function(t3) {
    return t3 < 0 || t3 >= this._graphics.length ? null : this._graphics[t3];
  }, t2.prototype.findCredit = function(t3, e2) {
    return rt(this._credits, t3, e2);
  }, t2.prototype.findPhrase = function(t3, e2) {
    return rt(this._phrases, t3, e2);
  }, t2.prototype.findWord = function(t3, e2) {
    var r2 = this.findPhrase(t3, e2);
    return r2 ? rt(r2._children, t3, e2) : null;
  }, t2.prototype.findChar = function(t3, e2) {
    var r2 = this.findWord(t3, e2);
    return r2 ? rt(r2._children, t3, e2) : null;
  }, t2.prototype.findGraphic = function(t3, e2) {
    return rt(this._graphics, t3, e2);
  }, t2.prototype.contains = function(t3) {
    return t3 >= this.startTime && t3 <= this.endTime;
  }, t2.prototype.overlaps = function(t3, e2) {
    return this.contains(t3) || this.contains(e2) || this.startTime <= t3 && this.endTime >= e2;
  }, t2.prototype.progress = function(t3) {
    return this.contains(t3) ? (t3 - this.startTime) / this.duration : -1;
  }, t2;
}();
function it(t2, e2) {
  return t2.startTime - e2.startTime;
}
function ot(t2) {
  return t2.startTime;
}
var st = function() {
  function t2(t3, e2, r2, n2, i2, o2) {
    void 0 === t3 && (t3 = 1), void 0 === e2 && (e2 = 0), void 0 === r2 && (r2 = 0), void 0 === n2 && (n2 = 1), void 0 === i2 && (i2 = 0), void 0 === o2 && (o2 = 0), this.setValues(t3, e2, r2, n2, i2, o2);
  }
  return t2.prototype.setValues = function(t3, e2, r2, n2, i2, o2) {
    return void 0 === t3 && (t3 = 1), void 0 === e2 && (e2 = 0), void 0 === r2 && (r2 = 0), void 0 === n2 && (n2 = 1), void 0 === i2 && (i2 = 0), void 0 === o2 && (o2 = 0), this.a = t3, this.b = e2, this.c = r2, this.d = n2, this.tx = i2, this.ty = o2, this;
  }, t2.prototype.append = function(t3, e2, r2, n2, i2, o2) {
    var s2 = this.a, a2 = this.b, u2 = this.c, l2 = this.d;
    return 1 == t3 && 0 == e2 && 0 == r2 && 1 == n2 || (this.a = s2 * t3 + u2 * e2, this.b = a2 * t3 + l2 * e2, this.c = s2 * r2 + u2 * n2, this.d = a2 * r2 + l2 * n2), this.tx = s2 * i2 + u2 * o2 + this.tx, this.ty = a2 * i2 + l2 * o2 + this.ty, this;
  }, t2.prototype.prepend = function(t3, e2, r2, n2, i2, o2) {
    var s2 = this.a, a2 = this.c, u2 = this.tx;
    return this.a = t3 * s2 + r2 * this.b, this.b = e2 * s2 + n2 * this.b, this.c = t3 * a2 + r2 * this.d, this.d = e2 * a2 + n2 * this.d, this.tx = t3 * u2 + r2 * this.ty + i2, this.ty = e2 * u2 + n2 * this.ty + o2, this;
  }, t2.prototype.appendMatrix = function(t3) {
    return this.append(t3.a, t3.b, t3.c, t3.d, t3.tx, t3.ty);
  }, t2.prototype.prependMatrix = function(t3) {
    return this.prepend(t3.a, t3.b, t3.c, t3.d, t3.tx, t3.ty);
  }, t2.prototype.appendTransform = function(e2, r2, n2, i2, o2, s2, a2, u2, l2) {
    var c2, p2, h2;
    return o2 % 360 ? (c2 = o2 * t2.DEG_TO_RAD, p2 = Math.cos(c2), h2 = Math.sin(c2)) : (p2 = 1, h2 = 0), s2 || a2 ? (s2 *= t2.DEG_TO_RAD, a2 *= t2.DEG_TO_RAD, this.append(Math.cos(a2), Math.sin(a2), -Math.sin(s2), Math.cos(s2), e2, r2), this.append(p2 * n2, h2 * n2, -h2 * i2, p2 * i2, 0, 0)) : this.append(p2 * n2, h2 * n2, -h2 * i2, p2 * i2, e2, r2), (u2 || l2) && (this.tx -= u2 * this.a + l2 * this.c, this.ty -= u2 * this.b + l2 * this.d), this;
  }, t2.prototype.prependTransform = function(e2, r2, n2, i2, o2, s2, a2, u2, l2) {
    var c2, p2, h2;
    return o2 % 360 ? (c2 = o2 * t2.DEG_TO_RAD, p2 = Math.cos(c2), h2 = Math.sin(c2)) : (p2 = 1, h2 = 0), (u2 || l2) && (this.tx -= u2, this.ty -= l2), s2 || a2 ? (s2 *= t2.DEG_TO_RAD, a2 *= t2.DEG_TO_RAD, this.prepend(p2 * n2, h2 * n2, -h2 * i2, p2 * i2, 0, 0), this.prepend(Math.cos(a2), Math.sin(a2), -Math.sin(s2), Math.cos(s2), e2, r2)) : this.prepend(p2 * n2, h2 * n2, -h2 * i2, p2 * i2, e2, r2), this;
  }, t2.prototype.rotate = function(e2) {
    e2 *= t2.DEG_TO_RAD;
    var r2 = Math.cos(e2), n2 = Math.sin(e2), i2 = this.a, o2 = this.b;
    return this.a = i2 * r2 + this.c * n2, this.b = o2 * r2 + this.d * n2, this.c = -i2 * n2 + this.c * r2, this.d = -o2 * n2 + this.d * r2, this;
  }, t2.prototype.skew = function(e2, r2) {
    return e2 *= t2.DEG_TO_RAD, r2 *= t2.DEG_TO_RAD, this.append(Math.cos(r2), Math.sin(r2), -Math.sin(e2), Math.cos(e2), 0, 0), this;
  }, t2.prototype.scale = function(t3, e2) {
    return this.a *= t3, this.b *= t3, this.c *= e2, this.d *= e2, this;
  }, t2.prototype.translate = function(t3, e2) {
    return this.tx += this.a * t3 + this.c * e2, this.ty += this.b * t3 + this.d * e2, this;
  }, t2.prototype.identity = function() {
    return this.a = this.d = 1, this.b = this.c = this.tx = this.ty = 0, this;
  }, t2.prototype.invert = function() {
    var t3 = this.a, e2 = this.b, r2 = this.c, n2 = this.d, i2 = this.tx, o2 = t3 * n2 - e2 * r2;
    return this.a = n2 / o2, this.b = -e2 / o2, this.c = -r2 / o2, this.d = t3 / o2, this.tx = (r2 * this.ty - n2 * i2) / o2, this.ty = -(t3 * this.ty - e2 * i2) / o2, this;
  }, t2.prototype.isIdentity = function() {
    return 0 === this.tx && 0 === this.ty && 1 === this.a && 0 === this.b && 0 === this.c && 1 === this.d;
  }, t2.prototype.equals = function(t3) {
    return this.tx === t3.tx && this.ty === t3.ty && this.a === t3.a && this.b === t3.b && this.c === t3.c && this.d === t3.d;
  }, t2.prototype.transformPoint = function(t3, e2, r2) {
    return r2.x = t3 * this.a + e2 * this.c + this.tx, r2.y = t3 * this.b + e2 * this.d + this.ty, r2;
  }, t2.prototype.decompose = function(e2) {
    void 0 === e2 && (e2 = {}), e2.x = this.tx, e2.y = this.ty, e2.scaleX = Math.sqrt(this.a * this.a + this.b * this.b), e2.scaleY = Math.sqrt(this.c * this.c + this.d * this.d);
    var r2 = Math.atan2(-this.c, this.d), n2 = Math.atan2(this.b, this.a);
    return Math.abs(1 - r2 / n2) < 1e-5 ? (e2.rotation = n2 / t2.DEG_TO_RAD, this.a < 0 && this.d >= 0 && (e2.rotation += e2.rotation <= 0 ? 180 : -180), e2.skewX = e2.skewY = 0) : (e2.skewX = r2 / t2.DEG_TO_RAD, e2.skewY = n2 / t2.DEG_TO_RAD), e2;
  }, t2.prototype.copy = function(t3) {
    return this.setValues(t3.a, t3.b, t3.c, t3.d, t3.tx, t3.ty);
  }, t2.prototype.clone = function() {
    return new t2(this.a, this.b, this.c, this.d, this.tx, this.ty);
  }, t2.prototype.toString = function() {
    return "[" + this.constructor.name + " (a=" + this.a + " b=" + this.b + " c=" + this.c + " d=" + this.d + " tx=" + this.tx + " ty=" + this.ty + ")]";
  }, t2.DEG_TO_RAD = Math.PI / 180, t2.identity = new t2(), t2;
}();
var at = function() {
  function t2(t3, e2) {
    void 0 === t3 && (t3 = 0), void 0 === e2 && (e2 = 0), this.setValues(t3, e2);
  }
  return t2.prototype.setValues = function(t3, e2) {
    return void 0 === t3 && (t3 = 0), void 0 === e2 && (e2 = 0), this.x = t3, this.y = e2, this;
  }, t2.prototype.copy = function(t3) {
    return this.x = t3.x, this.y = t3.y, this;
  }, t2.prototype.clone = function() {
    return new t2(this.x, this.y);
  }, t2.prototype.toString = function() {
    return "[" + this.constructor.name + " (x=" + this.x + " y=" + this.y + ")]";
  }, t2;
}();
var ut = function() {
  function t2() {
    this.tx = new st(), this.alpha = 0, this.composite = "", this.visible = true;
  }
  return t2.prototype.reset = function() {
  }, t2;
}();
var lt = function() {
  function t2() {
    this.rendering = new ut();
  }
  return t2.prototype.addCredit = function(t3) {
    this.doAddPhrase(t3);
  }, t2.prototype.removeCredit = function(t3) {
    t3._runtime = null;
  }, t2.prototype.addPhrase = function(t3) {
    this.doAddPhrase(t3);
  }, t2.prototype.removePhrase = function(t3) {
    t3._runtime = null;
  }, t2.prototype.doAddPhrase = function(t3) {
    t3._runtime = { graphics: { clear: function() {
    } }, rendering: new ut(), update: function() {
    } };
    for (var e2 = t3.firstWord; e2; ) {
      e2._runtime = { graphics: { clear: function() {
      } }, rendering: new ut(), update: function() {
      } };
      for (var r2 = e2.firstChar; r2 && (r2._runtime = { graphics: { clear: function() {
      } }, rendering: new ut(), update: function() {
      }, advance: 0, ascent: 0, descent: 0, onFontUpdate: function() {
      }, onColorUpdate: function() {
      } }, r2 !== e2.lastChar); )
        r2 = r2.next;
      if (e2 === t3.lastWord)
        break;
      e2 = e2.next;
    }
  }, t2.prototype.addGraphic = function(t3) {
    t3._runtime = { graphics: { clear: function() {
    } }, rendering: new ut(), update: function() {
    } };
  }, t2.prototype.removeGraphic = function(t3) {
    t3._runtime = null;
  }, t2;
}();
var ct = function() {
  function t2() {
    this.wrapperTable = {};
  }
  return t2.prototype.isGraphics = function() {
    return false;
  }, t2.prototype.setCanvas = function() {
    return Promise.resolve();
  }, t2.prototype.createRuntime = function(t3) {
    return function(t4, e2, r2, n2) {
      return new (r2 || (r2 = Promise))(function(i2, o2) {
        function s2(t5) {
          try {
            u2(n2.next(t5));
          } catch (t6) {
            o2(t6);
          }
        }
        function a2(t5) {
          try {
            u2(n2.throw(t5));
          } catch (t6) {
            o2(t6);
          }
        }
        function u2(t5) {
          var e3;
          t5.done ? i2(t5.value) : (e3 = t5.value, e3 instanceof r2 ? e3 : new r2(function(t6) {
            t6(e3);
          })).then(s2, a2);
        }
        u2((n2 = n2.apply(t4, e2 || [])).next());
      });
    }(this, void 0, void 0, function() {
      var e2, r2, n2;
      return function(t4, e3) {
        var r3, n3, i2, o2, s2 = { label: 0, sent: function() {
          if (1 & i2[0])
            throw i2[1];
          return i2[1];
        }, trys: [], ops: [] };
        return o2 = { next: a2(0), throw: a2(1), return: a2(2) }, "function" == typeof Symbol && (o2[Symbol.iterator] = function() {
          return this;
        }), o2;
        function a2(o3) {
          return function(a3) {
            return function(o4) {
              if (r3)
                throw new TypeError("Generator is already executing.");
              for (; s2; )
                try {
                  if (r3 = 1, n3 && (i2 = 2 & o4[0] ? n3.return : o4[0] ? n3.throw || ((i2 = n3.return) && i2.call(n3), 0) : n3.next) && !(i2 = i2.call(n3, o4[1])).done)
                    return i2;
                  switch (n3 = 0, i2 && (o4 = [2 & o4[0], i2.value]), o4[0]) {
                    case 0:
                    case 1:
                      i2 = o4;
                      break;
                    case 4:
                      return s2.label++, { value: o4[1], done: false };
                    case 5:
                      s2.label++, n3 = o4[1], o4 = [0];
                      continue;
                    case 7:
                      o4 = s2.ops.pop(), s2.trys.pop();
                      continue;
                    default:
                      if (!((i2 = (i2 = s2.trys).length > 0 && i2[i2.length - 1]) || 6 !== o4[0] && 2 !== o4[0])) {
                        s2 = 0;
                        continue;
                      }
                      if (3 === o4[0] && (!i2 || o4[1] > i2[0] && o4[1] < i2[3])) {
                        s2.label = o4[1];
                        break;
                      }
                      if (6 === o4[0] && s2.label < i2[1]) {
                        s2.label = i2[1], i2 = o4;
                        break;
                      }
                      if (i2 && s2.label < i2[2]) {
                        s2.label = i2[2], s2.ops.push(o4);
                        break;
                      }
                      i2[2] && s2.ops.pop(), s2.trys.pop();
                      continue;
                  }
                  o4 = e3.call(t4, s2);
                } catch (t5) {
                  o4 = [6, t5], n3 = 0;
                } finally {
                  r3 = i2 = 0;
                }
              if (5 & o4[0])
                throw o4[1];
              return { value: o4[0] ? o4[1] : void 0, done: true };
            }([o3, a3]);
          };
        }
      }(this, function(i2) {
        for (this.video = t3, t3._runtime = new lt(), e2 = t3.firstCredit; e2; )
          t3._runtime.addCredit(e2), e2 = e2.next;
        for (r2 = t3.firstPhrase; r2; )
          t3._runtime.addPhrase(r2), r2 = r2.next;
        for (n2 = t3.firstGraphic; n2; )
          t3._runtime.addGraphic(n2), n2 = n2.next;
        return [2, t3._runtime];
      });
    });
  }, t2.prototype.reset = function() {
    var t3, e2;
    this.resetTextUnitsFrom(this.video.firstCredit), this.resetTextUnitsFrom(null === (t3 = this.video.firstCredit) || void 0 === t3 ? void 0 : t3.firstWord), this.resetTextUnitsFrom(null === (e2 = this.video.firstCredit) || void 0 === e2 ? void 0 : e2.firstChar), this.resetTextUnitsFrom(this.video.firstPhrase), this.resetTextUnitsFrom(this.video.firstWord), this.resetTextUnitsFrom(this.video.firstChar), this.video._runtime.rendering.reset();
  }, t2.prototype.resetTextUnitsFrom = function(t3) {
    for (; t3; )
      t3.rendering.reset(), t3.graphics.clear(), t3 = t3.next;
  }, t2.prototype.update = function() {
    var t3, e2;
    this.updateCharsFrom(null === (t3 = this.video.firstCredit) || void 0 === t3 ? void 0 : t3.firstChar), this.updateCharsFrom(null === (e2 = this.video.firstPhrase) || void 0 === e2 ? void 0 : e2.firstChar);
  }, t2.prototype.updateCharsFrom = function(t3) {
    for (; t3; )
      t3._runtime.update(), t3 = t3.next;
  }, t2.prototype.updateStageTx = function() {
  }, t2;
}();
function pt(t2) {
  if (void 0 !== t2 && "function" != typeof t2) {
    if ("object" != typeof t2)
      return t2;
    if (null === t2)
      return null;
    if (t2 instanceof Z)
      return { type: "Color", value: { r: t2.r, g: t2.g, b: t2.b, a: t2.a } };
    throw new Error();
  }
}
function ht(t2, e2) {
  if ("object" != typeof t2 || null === t2)
    return t2;
  if (t2.type && e2[t2.type]) {
    var r2;
    if ("Color" === t2.type) {
      var n2 = new Z();
      n2.r = Number(t2.value.r), n2.g = Number(t2.value.g), n2.b = Number(t2.value.b), n2.a = Number(t2.value.a), r2 = n2;
    } else {
      for (var i2 = new e2[t2.type](), o2 = 0, s2 = Object.keys(t2.value); o2 < s2.length; o2++) {
        var a2 = s2[o2];
        i2[a2] = t2.value[a2];
      }
      r2 = i2;
    }
    return r2;
  }
}
var dt;
var ft;
var yt;
var vt;
var gt;
var mt;
var bt;
var _t;
var wt;
var Pt;
var Et;
var Ot;
var St;
var Tt;
var xt;
var At;
var Rt;
var Ct;
var Nt;
var kt;
var jt = function(t2, e2) {
  return ft = String(t2), yt = ft.length, function(t3) {
    for (var e3 in dt = t3 || {}, It)
      Object.prototype.hasOwnProperty.call(dt, e3) || (dt[e3] = It[e3]);
    vt = dt.sourceFile || null;
  }(e2), St = 1, gt = Tt = 0, Ot = true, ar(), function(t3) {
    xt = At = gt, dt.locations && (Rt = new nr()), Ct = kt = null, Nt = [], ur();
    var e3 = t3 || _r(), r2 = true;
    for (t3 || (e3.body = []); Pt !== Vt; ) {
      var n2 = kr();
      e3.body.push(n2), r2 && Er(n2) && gr(true), r2 = false;
    }
    return Pr(e3, "Program");
  }(dt.program);
};
var It = { ecmaVersion: 5, strictSemicolons: false, allowTrailingCommas: true, forbidReserved: false, locations: false, onComment: null, ranges: false, program: null, sourceFile: null, directSourceFile: null };
function Ut(t2, e2) {
  var r2 = function(t3, e3) {
    for (var r3 = 1, n3 = 0; ; ) {
      tr.lastIndex = n3;
      var i2 = tr.exec(t3);
      if (!(i2 && i2.index < e3))
        break;
      ++r3, n3 = i2.index + i2[0].length;
    }
    return { line: r3, column: e3 - n3 };
  }(ft, t2);
  e2 += " (" + r2.line + ":" + r2.column + ")";
  var n2 = new SyntaxError(e2);
  throw n2.pos = t2, n2.loc = r2, n2.raisedAt = gt, n2;
}
var Ft = [];
var Lt = { type: "num" };
var Dt = { type: "regexp" };
var Mt = { type: "string" };
var Bt = { type: "name" };
var Vt = { type: "eof" };
var Gt = { keyword: "break" };
var qt = { keyword: "case", beforeExpr: true };
var Wt = { keyword: "catch" };
var Yt = { keyword: "continue" };
var zt = { keyword: "debugger" };
var Jt = { keyword: "default" };
var Ht = { keyword: "do", isLoop: true };
var Xt = { keyword: "else", beforeExpr: true };
var Zt = { keyword: "finally" };
var $t = { keyword: "for", isLoop: true };
var Qt = { keyword: "function" };
var Kt = { keyword: "if" };
var te = { keyword: "return", beforeExpr: true };
var ee = { keyword: "switch" };
var re = { keyword: "throw", beforeExpr: true };
var ne = { keyword: "try" };
var ie = { keyword: "var" };
var oe = { keyword: "while", isLoop: true };
var se = { keyword: "with" };
var ae = { keyword: "new", beforeExpr: true };
var ue = { keyword: "this" };
var le = { keyword: "null", atomValue: null };
var ce = { keyword: "true", atomValue: true };
var pe = { keyword: "false", atomValue: false };
var he = { keyword: "in", binop: 7, beforeExpr: true };
var de = { break: Gt, case: qt, catch: Wt, continue: Yt, debugger: zt, default: Jt, do: Ht, else: Xt, finally: Zt, for: $t, function: Qt, if: Kt, return: te, switch: ee, throw: re, try: ne, var: ie, while: oe, with: se, null: le, true: ce, false: pe, new: ae, in: he, instanceof: { keyword: "instanceof", binop: 7, beforeExpr: true }, this: ue, typeof: { keyword: "typeof", prefix: true, beforeExpr: true }, void: { keyword: "void", prefix: true, beforeExpr: true }, delete: { keyword: "delete", prefix: true, beforeExpr: true } };
var fe = { type: "[", beforeExpr: true };
var ye = { type: "]" };
var ve = { type: "{", beforeExpr: true };
var ge = { type: "}" };
var me = { type: "(", beforeExpr: true };
var be = { type: ")" };
var _e = { type: ",", beforeExpr: true };
var we = { type: ";", beforeExpr: true };
var Pe = { type: ":", beforeExpr: true };
var Ee = { type: "." };
var Oe = { type: "?", beforeExpr: true };
var Se = { binop: 10, beforeExpr: true };
var Te = { isAssign: true, beforeExpr: true };
var xe = { isAssign: true, beforeExpr: true };
var Ae = { postfix: true, prefix: true, isUpdate: true };
var Re = { prefix: true, beforeExpr: true };
var Ce = { binop: 1, beforeExpr: true };
var Ne = { binop: 2, beforeExpr: true };
var ke = { binop: 3, beforeExpr: true };
var je = { binop: 4, beforeExpr: true };
var Ie = { binop: 5, beforeExpr: true };
var Ue = { binop: 6, beforeExpr: true };
var Fe = { binop: 7, beforeExpr: true };
var Le = { binop: 8, beforeExpr: true };
var De = { binop: 9, prefix: true, beforeExpr: true };
var Me = { binop: 10, beforeExpr: true };
var Be = { bracketL: fe, bracketR: ye, braceL: ve, braceR: ge, parenL: me, parenR: be, comma: _e, semi: we, colon: Pe, dot: Ee, question: Oe, slash: Se, eq: Te, name: Bt, eof: Vt, num: Lt, regexp: Dt, string: Mt };
for (Ve in de)
  Be["_" + Ve] = de[Ve];
var Ve;
function Ge(t2) {
  t2 = t2.split(" ");
  var e2 = "", r2 = [];
  t:
    for (var n2 = 0; n2 < t2.length; ++n2) {
      for (var i2 = 0; i2 < r2.length; ++i2)
        if (r2[i2][0].length == t2[n2].length) {
          r2[i2].push(t2[n2]);
          continue t;
        }
      r2.push([t2[n2]]);
    }
  function o2(t3) {
    if (1 == t3.length)
      return e2 += "return str === " + JSON.stringify(t3[0]) + ";";
    e2 += "switch(str){";
    for (var r3 = 0; r3 < t3.length; ++r3)
      e2 += "case " + JSON.stringify(t3[r3]) + ":";
    e2 += "return true}return false;";
  }
  if (r2.length > 3) {
    for (r2.sort(function(t3, e3) {
      return e3.length - t3.length;
    }), e2 += "switch(str.length){", n2 = 0; n2 < r2.length; ++n2) {
      var s2 = r2[n2];
      e2 += "case " + s2[0].length + ":", o2(s2);
    }
    e2 += "}";
  } else
    o2(t2);
  return new Function("str", e2);
}
var qe;
var We = Ge("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile");
var Ye = Ge("class enum extends super const export import");
var ze = Ge("implements interface let package private protected public static yield");
var Je = Ge("eval arguments");
var He = Ge("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this");
var Xe = /[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/;
var Ze = "------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------";
var $e = new RegExp("[" + Ze + "]");
var Qe = new RegExp("[" + Ze + "------------------------------------------------------------------------------------------------------------------------------------------]");
var Ke = /[\n\r\u2028\u2029]/;
var tr = /\r\n|[\n\r\u2028\u2029]/g;
var er = function(t2) {
  return t2 < 65 ? 36 === t2 : t2 < 91 || (t2 < 97 ? 95 === t2 : t2 < 123 || t2 >= 170 && $e.test(String.fromCharCode(t2)));
};
var rr = function(t2) {
  return t2 < 48 ? 36 === t2 : t2 < 58 || !(t2 < 65) && (t2 < 91 || (t2 < 97 ? 95 === t2 : t2 < 123 || t2 >= 170 && Qe.test(String.fromCharCode(t2))));
};
function nr() {
  this.line = St, this.column = gt - Tt;
}
function ir(t2, e2) {
  bt = gt, dt.locations && (wt = new nr()), Pt = t2, ar(), Et = e2, Ot = t2.beforeExpr;
}
function or() {
  var t2, e2 = dt.onComment && dt.locations && new nr(), r2 = gt, n2 = ft.indexOf("*/", gt += 2);
  if (-1 === n2 && Ut(gt - 2, "Unterminated comment"), gt = n2 + 2, dt.locations)
    for (tr.lastIndex = r2; (t2 = tr.exec(ft)) && t2.index < gt; )
      ++St, Tt = t2.index + t2[0].length;
  dt.onComment && dt.onComment(true, ft.slice(r2 + 2, n2), r2, gt, e2, dt.locations && new nr());
}
function sr() {
  for (var t2 = gt, e2 = dt.onComment && dt.locations && new nr(), r2 = ft.charCodeAt(gt += 2); gt < yt && 10 !== r2 && 13 !== r2 && 8232 !== r2 && 8233 !== r2; )
    ++gt, r2 = ft.charCodeAt(gt);
  dt.onComment && dt.onComment(false, ft.slice(t2 + 2, gt), t2, gt, e2, dt.locations && new nr());
}
function ar() {
  for (; gt < yt; ) {
    var t2 = ft.charCodeAt(gt);
    if (32 === t2)
      ++gt;
    else if (13 === t2)
      ++gt, 10 === (e2 = ft.charCodeAt(gt)) && ++gt, dt.locations && (++St, Tt = gt);
    else if (10 === t2 || 8232 === t2 || 8233 === t2)
      ++gt, dt.locations && (++St, Tt = gt);
    else if (t2 > 8 && t2 < 14)
      ++gt;
    else if (47 === t2) {
      var e2;
      if (42 === (e2 = ft.charCodeAt(gt + 1)))
        or();
      else {
        if (47 !== e2)
          break;
        sr();
      }
    } else if (160 === t2)
      ++gt;
    else {
      if (!(t2 >= 5760 && Xe.test(String.fromCharCode(t2))))
        break;
      ++gt;
    }
  }
}
function ur(t2) {
  if (t2 ? gt = mt + 1 : mt = gt, dt.locations && (_t = new nr()), t2)
    return cr();
  if (gt >= yt)
    return ir(Vt);
  var e2 = ft.charCodeAt(gt);
  if (er(e2) || 92 === e2)
    return yr();
  var r2 = function(t3) {
    switch (t3) {
      case 46:
        return function() {
          var t4 = ft.charCodeAt(gt + 1);
          return t4 >= 48 && t4 <= 57 ? hr(true) : (++gt, ir(Ee));
        }();
      case 40:
        return ++gt, ir(me);
      case 41:
        return ++gt, ir(be);
      case 59:
        return ++gt, ir(we);
      case 44:
        return ++gt, ir(_e);
      case 91:
        return ++gt, ir(fe);
      case 93:
        return ++gt, ir(ye);
      case 123:
        return ++gt, ir(ve);
      case 125:
        return ++gt, ir(ge);
      case 58:
        return ++gt, ir(Pe);
      case 63:
        return ++gt, ir(Oe);
      case 48:
        var e3 = ft.charCodeAt(gt + 1);
        if (120 === e3 || 88 === e3)
          return function() {
            gt += 2;
            var t4 = pr(16);
            return null == t4 && Ut(mt + 2, "Expected hexadecimal number"), er(ft.charCodeAt(gt)) && Ut(gt, "Identifier directly after number"), ir(Lt, t4);
          }();
      case 49:
      case 50:
      case 51:
      case 52:
      case 53:
      case 54:
      case 55:
      case 56:
      case 57:
        return hr(false);
      case 34:
      case 39:
        return function(t4) {
          gt++;
          for (var e4 = ""; ; ) {
            gt >= yt && Ut(mt, "Unterminated string constant");
            var r3 = ft.charCodeAt(gt);
            if (r3 === t4)
              return ++gt, ir(Mt, e4);
            if (92 === r3) {
              r3 = ft.charCodeAt(++gt);
              var n3 = /^[0-7]+/.exec(ft.slice(gt, gt + 3));
              for (n3 && (n3 = n3[0]); n3 && parseInt(n3, 8) > 255; )
                n3 = n3.slice(0, -1);
              if ("0" === n3 && (n3 = null), ++gt, n3)
                kt && Ut(gt - 2, "Octal literal in strict mode"), e4 += String.fromCharCode(parseInt(n3, 8)), gt += n3.length - 1;
              else
                switch (r3) {
                  case 110:
                    e4 += "\n";
                    break;
                  case 114:
                    e4 += "\r";
                    break;
                  case 120:
                    e4 += String.fromCharCode(dr(2));
                    break;
                  case 117:
                    e4 += String.fromCharCode(dr(4));
                    break;
                  case 85:
                    e4 += String.fromCharCode(dr(8));
                    break;
                  case 116:
                    e4 += "	";
                    break;
                  case 98:
                    e4 += "\b";
                    break;
                  case 118:
                    e4 += "\v";
                    break;
                  case 102:
                    e4 += "\f";
                    break;
                  case 48:
                    e4 += "\0";
                    break;
                  case 13:
                    10 === ft.charCodeAt(gt) && ++gt;
                  case 10:
                    dt.locations && (Tt = gt, ++St);
                    break;
                  default:
                    e4 += String.fromCharCode(r3);
                }
            } else
              13 !== r3 && 10 !== r3 && 8232 !== r3 && 8233 !== r3 || Ut(mt, "Unterminated string constant"), e4 += String.fromCharCode(r3), ++gt;
          }
        }(t3);
      case 47:
        return function(t4) {
          var e4 = ft.charCodeAt(gt + 1);
          return Ot ? (++gt, cr()) : 61 === e4 ? lr(xe, 2) : lr(Se, 1);
        }();
      case 37:
      case 42:
        return 61 === ft.charCodeAt(gt + 1) ? lr(xe, 2) : lr(Me, 1);
      case 124:
      case 38:
        return function(t4) {
          var e4 = ft.charCodeAt(gt + 1);
          return e4 === t4 ? lr(124 === t4 ? Ce : Ne, 2) : 61 === e4 ? lr(xe, 2) : lr(124 === t4 ? ke : Ie, 1);
        }(t3);
      case 94:
        return 61 === ft.charCodeAt(gt + 1) ? lr(xe, 2) : lr(je, 1);
      case 43:
      case 45:
        return function(t4) {
          var e4 = ft.charCodeAt(gt + 1);
          return e4 === t4 ? 45 == e4 && 62 == ft.charCodeAt(gt + 2) && Ke.test(ft.slice(At, gt)) ? (gt += 3, sr(), ar(), ur()) : lr(Ae, 2) : 61 === e4 ? lr(xe, 2) : lr(De, 1);
        }(t3);
      case 60:
      case 62:
        return function(t4) {
          var e4 = ft.charCodeAt(gt + 1), r3 = 1;
          return e4 === t4 ? (r3 = 62 === t4 && 62 === ft.charCodeAt(gt + 2) ? 3 : 2, 61 === ft.charCodeAt(gt + r3) ? lr(xe, r3 + 1) : lr(Le, r3)) : 33 == e4 && 60 == t4 && 45 == ft.charCodeAt(gt + 2) && 45 == ft.charCodeAt(gt + 3) ? (gt += 4, sr(), ar(), ur()) : (61 === e4 && (r3 = 61 === ft.charCodeAt(gt + 2) ? 3 : 2), lr(Fe, r3));
        }(t3);
      case 61:
      case 33:
        return function(t4) {
          return 61 === ft.charCodeAt(gt + 1) ? lr(Ue, 61 === ft.charCodeAt(gt + 2) ? 3 : 2) : lr(61 === t4 ? Te : Re, 1);
        }(t3);
      case 126:
        return lr(Re, 1);
    }
    return false;
  }(e2);
  if (false === r2) {
    var n2 = String.fromCharCode(e2);
    if ("\\" === n2 || $e.test(n2))
      return yr();
    Ut(gt, "Unexpected character '" + n2 + "'");
  }
  return r2;
}
function lr(t2, e2) {
  var r2 = ft.slice(gt, gt + e2);
  gt += e2, ir(t2, r2);
}
function cr() {
  for (var t2, e2, r2 = gt; ; ) {
    gt >= yt && Ut(r2, "Unterminated regular expression");
    var n2 = ft.charAt(gt);
    if (Ke.test(n2) && Ut(r2, "Unterminated regular expression"), t2)
      t2 = false;
    else {
      if ("[" === n2)
        e2 = true;
      else if ("]" === n2 && e2)
        e2 = false;
      else if ("/" === n2 && !e2)
        break;
      t2 = "\\" === n2;
    }
    ++gt;
  }
  var i2 = ft.slice(r2, gt);
  ++gt;
  var o2 = fr();
  return o2 && !/^[gmsiy]*$/.test(o2) && Ut(r2, "Invalid regexp flag"), ir(Dt, new RegExp(i2, o2));
}
function pr(t2, e2) {
  for (var r2 = gt, n2 = 0, i2 = 0, o2 = null == e2 ? 1 / 0 : e2; i2 < o2; ++i2) {
    var s2, a2 = ft.charCodeAt(gt);
    if ((s2 = a2 >= 97 ? a2 - 97 + 10 : a2 >= 65 ? a2 - 65 + 10 : a2 >= 48 && a2 <= 57 ? a2 - 48 : 1 / 0) >= t2)
      break;
    ++gt, n2 = n2 * t2 + s2;
  }
  return gt === r2 || null != e2 && gt - r2 !== e2 ? null : n2;
}
function hr(t2) {
  var e2 = gt, r2 = false, n2 = 48 === ft.charCodeAt(gt);
  t2 || null !== pr(10) || Ut(e2, "Invalid number"), 46 === ft.charCodeAt(gt) && (++gt, pr(10), r2 = true);
  var i2 = ft.charCodeAt(gt);
  69 !== i2 && 101 !== i2 || (43 !== (i2 = ft.charCodeAt(++gt)) && 45 !== i2 || ++gt, null === pr(10) && Ut(e2, "Invalid number"), r2 = true), er(ft.charCodeAt(gt)) && Ut(gt, "Identifier directly after number");
  var o2, s2 = ft.slice(e2, gt);
  return r2 ? o2 = parseFloat(s2) : n2 && 1 !== s2.length ? /[89]/.test(s2) || kt ? Ut(e2, "Invalid number") : o2 = parseInt(s2, 8) : o2 = parseInt(s2, 10), ir(Lt, o2);
}
function dr(t2) {
  var e2 = pr(16, t2);
  return null === e2 && Ut(mt, "Bad character escape sequence"), e2;
}
function fr() {
  qe = false;
  for (var t2, e2 = true, r2 = gt; ; ) {
    var n2 = ft.charCodeAt(gt);
    if (rr(n2))
      qe && (t2 += ft.charAt(gt)), ++gt;
    else {
      if (92 !== n2)
        break;
      qe || (t2 = ft.slice(r2, gt)), qe = true, 117 != ft.charCodeAt(++gt) && Ut(gt, "Expecting Unicode escape sequence \\uXXXX"), ++gt;
      var i2 = dr(4), o2 = String.fromCharCode(i2);
      o2 || Ut(gt - 1, "Invalid Unicode escape"), (e2 ? er(i2) : rr(i2)) || Ut(gt - 4, "Invalid Unicode escape"), t2 += o2;
    }
    e2 = false;
  }
  return qe ? t2 : ft.slice(r2, gt);
}
function yr() {
  var t2 = fr(), e2 = Bt;
  return qe || (He(t2) ? e2 = de[t2] : (dt.forbidReserved && (3 === dt.ecmaVersion ? We : Ye)(t2) || kt && ze(t2)) && Ut(mt, "The keyword '" + t2 + "' is reserved")), ir(e2, t2);
}
function vr() {
  xt = mt, At = bt, Rt = wt, ur();
}
function gr(t2) {
  if (kt = t2, gt = At, dt.locations)
    for (; gt < Tt; )
      Tt = ft.lastIndexOf("\n", Tt - 2) + 1, --St;
  ar(), ur();
}
function mr() {
  this.type = null, this.start = mt, this.end = null;
}
function br() {
  this.start = _t, this.end = null, null !== vt && (this.source = vt);
}
function _r() {
  var t2 = new mr();
  return dt.locations && (t2.loc = new br()), dt.directSourceFile && (t2.sourceFile = dt.directSourceFile), dt.ranges && (t2.range = [mt, 0]), t2;
}
function wr(t2) {
  var e2 = new mr();
  return e2.start = t2.start, dt.locations && (e2.loc = new br(), e2.loc.start = t2.loc.start), dt.ranges && (e2.range = [t2.range[0], 0]), e2;
}
function Pr(t2, e2) {
  return t2.type = e2, t2.end = At, dt.locations && (t2.loc.end = Rt), dt.ranges && (t2.range[1] = At), t2;
}
function Er(t2) {
  return dt.ecmaVersion >= 5 && "ExpressionStatement" === t2.type && "Literal" === t2.expression.type && "use strict" === t2.expression.value;
}
function Or(t2) {
  if (Pt === t2)
    return vr(), true;
}
function Sr() {
  return !dt.strictSemicolons && (Pt === Vt || Pt === ge || Ke.test(ft.slice(At, mt)));
}
function Tr() {
  Or(we) || Sr() || Ar();
}
function xr(t2) {
  Pt === t2 ? vr() : Ar();
}
function Ar() {
  Ut(mt, "Unexpected token");
}
function Rr(t2) {
  "Identifier" !== t2.type && "MemberExpression" !== t2.type && Ut(t2.start, "Assigning to rvalue"), kt && "Identifier" === t2.type && Je(t2.name) && Ut(t2.start, "Assigning to " + t2.name + " in strict mode");
}
var Cr = { kind: "loop" };
var Nr = { kind: "switch" };
function kr() {
  (Pt === Se || Pt === xe && "/=" == Et) && ur(true);
  var t2 = Pt, e2 = _r();
  switch (t2) {
    case Gt:
    case Yt:
      vr();
      var r2 = t2 === Gt;
      Or(we) || Sr() ? e2.label = null : Pt !== Bt ? Ar() : (e2.label = Jr(), Tr());
      for (var n2 = 0; n2 < Nt.length; ++n2) {
        var i2 = Nt[n2];
        if (null == e2.label || i2.name === e2.label.name) {
          if (null != i2.kind && (r2 || "loop" === i2.kind))
            break;
          if (e2.label && r2)
            break;
        }
      }
      return n2 === Nt.length && Ut(e2.start, "Unsyntactic " + t2.keyword), Pr(e2, r2 ? "BreakStatement" : "ContinueStatement");
    case zt:
      return vr(), Tr(), Pr(e2, "DebuggerStatement");
    case Ht:
      return vr(), Nt.push(Cr), e2.body = kr(), Nt.pop(), xr(oe), e2.test = jr(), Tr(), Pr(e2, "DoWhileStatement");
    case $t:
      if (vr(), Nt.push(Cr), xr(me), Pt === we)
        return Ur(e2, null);
      if (Pt === ie) {
        var o2 = _r();
        return vr(), Lr(o2, true), Pr(o2, "VariableDeclaration"), 1 === o2.declarations.length && Or(he) ? Fr(e2, o2) : Ur(e2, o2);
      }
      return o2 = Dr(false, true), Or(he) ? (Rr(o2), Fr(e2, o2)) : Ur(e2, o2);
    case Qt:
      return vr(), Yr(e2, true);
    case Kt:
      return vr(), e2.test = jr(), e2.consequent = kr(), e2.alternate = Or(Xt) ? kr() : null, Pr(e2, "IfStatement");
    case te:
      return Ct || Ut(mt, "'return' outside of function"), vr(), Or(we) || Sr() ? e2.argument = null : (e2.argument = Dr(), Tr()), Pr(e2, "ReturnStatement");
    case ee:
      vr(), e2.discriminant = jr(), e2.cases = [], xr(ve), Nt.push(Nr);
      for (var s2, a2; Pt != ge; )
        if (Pt === qt || Pt === Jt) {
          var u2 = Pt === qt;
          s2 && Pr(s2, "SwitchCase"), e2.cases.push(s2 = _r()), s2.consequent = [], vr(), u2 ? s2.test = Dr() : (a2 && Ut(xt, "Multiple default clauses"), a2 = true, s2.test = null), xr(Pe);
        } else
          s2 || Ar(), s2.consequent.push(kr());
      return s2 && Pr(s2, "SwitchCase"), vr(), Nt.pop(), Pr(e2, "SwitchStatement");
    case re:
      return vr(), Ke.test(ft.slice(At, mt)) && Ut(At, "Illegal newline after throw"), e2.argument = Dr(), Tr(), Pr(e2, "ThrowStatement");
    case ne:
      if (vr(), e2.block = Ir(), e2.handler = null, Pt === Wt) {
        var l2 = _r();
        vr(), xr(me), l2.param = Jr(), kt && Je(l2.param.name) && Ut(l2.param.start, "Binding " + l2.param.name + " in strict mode"), xr(be), l2.guard = null, l2.body = Ir(), e2.handler = Pr(l2, "CatchClause");
      }
      return e2.guardedHandlers = Ft, e2.finalizer = Or(Zt) ? Ir() : null, e2.handler || e2.finalizer || Ut(e2.start, "Missing catch or finally clause"), Pr(e2, "TryStatement");
    case ie:
      return vr(), Lr(e2), Tr(), Pr(e2, "VariableDeclaration");
    case oe:
      return vr(), e2.test = jr(), Nt.push(Cr), e2.body = kr(), Nt.pop(), Pr(e2, "WhileStatement");
    case se:
      return kt && Ut(mt, "'with' in strict mode"), vr(), e2.object = jr(), e2.body = kr(), Pr(e2, "WithStatement");
    case ve:
      return Ir();
    case we:
      return vr(), Pr(e2, "EmptyStatement");
    default:
      var c2 = Et, p2 = Dr();
      if (t2 === Bt && "Identifier" === p2.type && Or(Pe)) {
        for (n2 = 0; n2 < Nt.length; ++n2)
          Nt[n2].name === c2 && Ut(p2.start, "Label '" + c2 + "' is already declared");
        var h2 = Pt.isLoop ? "loop" : Pt === ee ? "switch" : null;
        return Nt.push({ name: c2, kind: h2 }), e2.body = kr(), Nt.pop(), e2.label = p2, Pr(e2, "LabeledStatement");
      }
      return e2.expression = p2, Tr(), Pr(e2, "ExpressionStatement");
  }
}
function jr() {
  xr(me);
  var t2 = Dr();
  return xr(be), t2;
}
function Ir(t2) {
  var e2, r2 = _r(), n2 = true, i2 = false;
  for (r2.body = [], xr(ve); !Or(ge); ) {
    var o2 = kr();
    r2.body.push(o2), n2 && t2 && Er(o2) && (e2 = i2, gr(i2 = true)), n2 = false;
  }
  return i2 && !e2 && gr(false), Pr(r2, "BlockStatement");
}
function Ur(t2, e2) {
  return t2.init = e2, xr(we), t2.test = Pt === we ? null : Dr(), xr(we), t2.update = Pt === be ? null : Dr(), xr(be), t2.body = kr(), Nt.pop(), Pr(t2, "ForStatement");
}
function Fr(t2, e2) {
  return t2.left = e2, t2.right = Dr(), xr(be), t2.body = kr(), Nt.pop(), Pr(t2, "ForInStatement");
}
function Lr(t2, e2) {
  for (t2.declarations = [], t2.kind = "var"; ; ) {
    var r2 = _r();
    if (r2.id = Jr(), kt && Je(r2.id.name) && Ut(r2.id.start, "Binding " + r2.id.name + " in strict mode"), r2.init = Or(Te) ? Dr(true, e2) : null, t2.declarations.push(Pr(r2, "VariableDeclarator")), !Or(_e))
      break;
  }
  return t2;
}
function Dr(t2, e2) {
  var r2 = Mr(e2);
  if (!t2 && Pt === _e) {
    var n2 = wr(r2);
    for (n2.expressions = [r2]; Or(_e); )
      n2.expressions.push(Mr(e2));
    return Pr(n2, "SequenceExpression");
  }
  return r2;
}
function Mr(t2) {
  var e2 = function(t3) {
    var e3 = function(t4) {
      return Br(Vr(), -1, t4);
    }(t3);
    if (Or(Oe)) {
      var r3 = wr(e3);
      return r3.test = e3, r3.consequent = Dr(true), xr(Pe), r3.alternate = Dr(true, t3), Pr(r3, "ConditionalExpression");
    }
    return e3;
  }(t2);
  if (Pt.isAssign) {
    var r2 = wr(e2);
    return r2.operator = Et, r2.left = e2, vr(), r2.right = Mr(t2), Rr(e2), Pr(r2, "AssignmentExpression");
  }
  return e2;
}
function Br(t2, e2, r2) {
  var n2 = Pt.binop;
  if (null != n2 && (!r2 || Pt !== he) && n2 > e2) {
    var i2 = wr(t2);
    i2.left = t2, i2.operator = Et;
    var o2 = Pt;
    return vr(), i2.right = Br(Vr(), n2, r2), Br(Pr(i2, o2 === Ce || o2 === Ne ? "LogicalExpression" : "BinaryExpression"), e2, r2);
  }
  return t2;
}
function Vr() {
  if (Pt.prefix) {
    var t2 = _r(), e2 = Pt.isUpdate;
    return t2.operator = Et, t2.prefix = true, Ot = true, vr(), t2.argument = Vr(), e2 ? Rr(t2.argument) : kt && "delete" === t2.operator && "Identifier" === t2.argument.type && Ut(t2.start, "Deleting local variable in strict mode"), Pr(t2, e2 ? "UpdateExpression" : "UnaryExpression");
  }
  for (var r2 = Gr(qr()); Pt.postfix && !Sr(); )
    (t2 = wr(r2)).operator = Et, t2.prefix = false, t2.argument = r2, Rr(r2), vr(), r2 = Pr(t2, "UpdateExpression");
  return r2;
}
function Gr(t2, e2) {
  var r2;
  return Or(Ee) ? ((r2 = wr(t2)).object = t2, r2.property = Jr(true), r2.computed = false, Gr(Pr(r2, "MemberExpression"), e2)) : Or(fe) ? ((r2 = wr(t2)).object = t2, r2.property = Dr(), r2.computed = true, xr(ye), Gr(Pr(r2, "MemberExpression"), e2)) : !e2 && Or(me) ? ((r2 = wr(t2)).callee = t2, r2.arguments = zr(be, false), Gr(Pr(r2, "CallExpression"), e2)) : t2;
}
function qr() {
  switch (Pt) {
    case ue:
      var t2 = _r();
      return vr(), Pr(t2, "ThisExpression");
    case Bt:
      return Jr();
    case Lt:
    case Mt:
    case Dt:
      return (t2 = _r()).value = Et, t2.raw = ft.slice(mt, bt), vr(), Pr(t2, "Literal");
    case le:
    case ce:
    case pe:
      return (t2 = _r()).value = Pt.atomValue, t2.raw = Pt.keyword, vr(), Pr(t2, "Literal");
    case me:
      var e2 = _t, r2 = mt;
      vr();
      var n2 = Dr();
      return n2.start = r2, n2.end = bt, dt.locations && (n2.loc.start = e2, n2.loc.end = wt), dt.ranges && (n2.range = [r2, bt]), xr(be), n2;
    case fe:
      return t2 = _r(), vr(), t2.elements = zr(ye, true, true), Pr(t2, "ArrayExpression");
    case ve:
      return function() {
        var t3 = _r(), e3 = true, r3 = false;
        for (t3.properties = [], vr(); !Or(ge); ) {
          if (e3)
            e3 = false;
          else if (xr(_e), dt.allowTrailingCommas && Or(ge))
            break;
          var n3, i2 = { key: Wr() }, o2 = false;
          if (Or(Pe) ? (i2.value = Dr(true), n3 = i2.kind = "init") : dt.ecmaVersion >= 5 && "Identifier" === i2.key.type && ("get" === i2.key.name || "set" === i2.key.name) ? (o2 = r3 = true, n3 = i2.kind = i2.key.name, i2.key = Wr(), Pt !== me && Ar(), i2.value = Yr(_r(), false)) : Ar(), "Identifier" === i2.key.type && (kt || r3))
            for (var s2 = 0; s2 < t3.properties.length; ++s2) {
              var a2 = t3.properties[s2];
              if (a2.key.name === i2.key.name) {
                var u2 = n3 == a2.kind || o2 && "init" === a2.kind || "init" === n3 && ("get" === a2.kind || "set" === a2.kind);
                u2 && !kt && "init" === n3 && "init" === a2.kind && (u2 = false), u2 && Ut(i2.key.start, "Redefinition of property");
              }
            }
          t3.properties.push(i2);
        }
        return Pr(t3, "ObjectExpression");
      }();
    case Qt:
      return t2 = _r(), vr(), Yr(t2, false);
    case ae:
      return function() {
        var t3 = _r();
        return vr(), t3.callee = Gr(qr(), true), Or(me) ? t3.arguments = zr(be, false) : t3.arguments = Ft, Pr(t3, "NewExpression");
      }();
    default:
      Ar();
  }
}
function Wr() {
  return Pt === Lt || Pt === Mt ? qr() : Jr(true);
}
function Yr(t2, e2) {
  Pt === Bt ? t2.id = Jr() : e2 ? Ar() : t2.id = null, t2.params = [];
  var r2 = true;
  for (xr(me); !Or(be); )
    r2 ? r2 = false : xr(_e), t2.params.push(Jr());
  var n2 = Ct, i2 = Nt;
  if (Ct = true, Nt = [], t2.body = Ir(true), Ct = n2, Nt = i2, kt || t2.body.body.length && Er(t2.body.body[0]))
    for (var o2 = t2.id ? -1 : 0; o2 < t2.params.length; ++o2) {
      var s2 = o2 < 0 ? t2.id : t2.params[o2];
      if ((ze(s2.name) || Je(s2.name)) && Ut(s2.start, "Defining '" + s2.name + "' in strict mode"), o2 >= 0)
        for (var a2 = 0; a2 < o2; ++a2)
          s2.name === t2.params[a2].name && Ut(s2.start, "Argument name clash in strict mode");
    }
  return Pr(t2, e2 ? "FunctionDeclaration" : "FunctionExpression");
}
function zr(t2, e2, r2) {
  for (var n2 = [], i2 = true; !Or(t2); ) {
    if (i2)
      i2 = false;
    else if (xr(_e), e2 && dt.allowTrailingCommas && Or(t2))
      break;
    r2 && Pt === _e ? n2.push(null) : n2.push(Dr(true));
  }
  return n2;
}
function Jr(t2) {
  var e2 = _r();
  return e2.name = Pt === Bt ? Et : t2 && !dt.forbidReserved && Pt.keyword || Ar(), Ot = false, vr(), Pr(e2, "Identifier");
}
var Hr = function() {
  function t2(e2, r2) {
    var n2, i2 = "string" == typeof e2 ? jt(e2, t2.PARSE_OPTIONS) : e2;
    this.ast = i2, this.initFunc_ = r2, this.paused_ = false, this.polyfills_ = [], this.functionCounter_ = 0, this.stepFunctions_ = /* @__PURE__ */ Object.create(null);
    for (var o2, s2 = /^step([A-Z]\w*)$/, a2 = Object.getOwnPropertyNames(t2.prototype), u2 = 0; u2 < a2.length; u2++) {
      var l2 = a2[u2];
      "function" == typeof t2.prototype[l2] && (o2 = l2.match(s2)) && (this.stepFunctions_[o2[1]] = t2.prototype[l2].bind(this));
    }
    this.global = this.createScope(this.ast, null), this.ast = jt(this.polyfills_.join("\n"), t2.PARSE_OPTIONS), this.polyfills_ = void 0, this.stripLocations_(this.ast, void 0, void 0), (n2 = new Zr(this.ast, this.global)).done = false, this.stateStack = [n2], this.run(), this.value = void 0, this.ast = i2, (n2 = new Zr(this.ast, this.global)).done = false, this.stateStack.length = 0, this.stateStack[0] = n2, this.nodeConstructor = n2.node.constructor, this.stateStack = this.stateStack, this.OBJECT = this.OBJECT, this.OBJECT_PROTO = this.OBJECT_PROTO, this.FUNCTION = this.FUNCTION, this.FUNCTION_PROTO = this.FUNCTION_PROTO, this.ARRAY = this.ARRAY, this.ARRAY_PROTO = this.ARRAY_PROTO, this.REGEXP = this.REGEXP, this.REGEXP_PROTO = this.REGEXP_PROTO, this.UNDEFINED = void 0, this.NULL = null, this.NAN = NaN, this.TRUE = true, this.FALSE = false, this.STRING_EMPTY = "", this.NUMBER_ZERO = 0, this.NUMBER_ONE = 1;
  }
  return t2.prototype.wrap = function(t3) {
    return t3;
  }, t2.prototype.unwrap = function(t3, e2) {
    return t3;
  }, t2.prototype.appendCode = function(e2) {
    var r2 = this.stateStack[0];
    if (!r2 || "Program" !== r2.node.type)
      throw Error("Expecting original AST to start with a Program node.");
    var n2 = "string" == typeof e2 ? jt(e2, t2.PARSE_OPTIONS) : e2;
    if (!n2 || "Program" !== n2.type)
      throw Error("Expecting new AST to start with a Program node.");
    this.populateScope_(n2, r2.scope);
    for (var i2, o2 = 0; i2 = n2.body[o2]; o2++)
      r2.node.body.push(i2);
    r2.done = false;
  }, t2.prototype.step = function() {
    var e2 = this.stateStack, r2 = e2[e2.length - 1];
    if (!r2)
      return false;
    var n2 = r2.node, i2 = n2.type;
    if ("Program" === i2 && r2.done)
      return false;
    if (this.paused_)
      return true;
    try {
      var o2 = this.stepFunctions_[i2](e2, r2, n2);
    } catch (e3) {
      if (e3 !== t2.STEP_ERROR)
        throw e3;
    }
    return o2 && e2.push(o2), !!n2.end || this.step();
  }, t2.prototype.run = function() {
    for (; !this.paused_ && this.step(); )
      ;
    return this.paused_;
  }, t2.prototype.initGlobalScope = function(e2) {
    this.setProperty(e2, "NaN", NaN, t2.READONLY_DESCRIPTOR), this.setProperty(e2, "Infinity", 1 / 0, t2.READONLY_DESCRIPTOR), this.setProperty(e2, "undefined", void 0, t2.READONLY_DESCRIPTOR), this.setProperty(e2, "window", e2, t2.READONLY_DESCRIPTOR), this.setProperty(e2, "this", e2, t2.READONLY_DESCRIPTOR), this.setProperty(e2, "self", e2), this.OBJECT_PROTO = new Xr(null), this.FUNCTION_PROTO = new Xr(this.OBJECT_PROTO), this.initFunction(e2), this.initObject(e2), e2.proto = this.OBJECT_PROTO, this.setProperty(e2, "constructor", this.OBJECT), this.initArray(e2), this.initString(e2), this.initBoolean(e2), this.initNumber(e2), this.initDate(e2), this.initRegExp(e2), this.initError(e2), this.initMath(e2), this.initJSON(e2);
    var r2 = this, n2 = this.createNativeFunction(function(t3) {
      throw EvalError("Can't happen");
    }, false);
    n2.eval = true, this.setProperty(e2, "eval", n2), this.setProperty(e2, "parseInt", this.createNativeFunction(parseInt, false)), this.setProperty(e2, "parseFloat", this.createNativeFunction(parseFloat, false)), this.setProperty(e2, "isNaN", this.createNativeFunction(isNaN, false)), this.setProperty(e2, "isFinite", this.createNativeFunction(isFinite, false));
    for (var i2 = [[escape, "escape"], [unescape, "unescape"], [decodeURI, "decodeURI"], [decodeURIComponent, "decodeURIComponent"], [encodeURI, "encodeURI"], [encodeURIComponent, "encodeURIComponent"]], o2 = 0; o2 < i2.length; o2++) {
      var s2 = /* @__PURE__ */ function(t3) {
        return function(e3) {
          try {
            return t3(e3);
          } catch (t4) {
            r2.throwException(r2.URI_ERROR, t4.message);
          }
        };
      }(i2[o2][0]);
      this.setProperty(e2, i2[o2][1], this.createNativeFunction(s2, false), t2.NONENUMERABLE_DESCRIPTOR);
    }
    this.initFunc_ && this.initFunc_(this, e2);
  }, t2.prototype.initFunction = function(e2) {
    var r2, n2 = this, i2 = /^[A-Za-z_$][\w$]*$/;
    r2 = function(e3) {
      if (n2.calledWithNew())
        var r3 = this;
      else
        r3 = n2.createObjectProto(n2.FUNCTION_PROTO);
      if (arguments.length)
        var o3 = String(arguments[arguments.length - 1]);
      else
        o3 = "";
      for (var s2 = [], a2 = 0; a2 < arguments.length - 1; a2++) {
        var u2 = String(arguments[a2]);
        u2.match(i2) || n2.throwException(n2.SYNTAX_ERROR, "Invalid function argument: " + u2), s2.push(u2);
      }
      s2 = s2.join(", "), r3.parentScope = n2.global;
      try {
        var l2 = jt("$ = function(" + s2 + ") {" + o3 + "};", t2.PARSE_OPTIONS);
      } catch (t3) {
        n2.throwException(n2.SYNTAX_ERROR, "Invalid code: " + t3.message);
      }
      return 1 !== l2.body.length && n2.throwException(n2.SYNTAX_ERROR, "Invalid code in function body."), r3.node = l2.body[0].expression.right, n2.setProperty(r3, "length", r3.node.length, t2.READONLY_DESCRIPTOR), r3;
    }, r2.id = this.functionCounter_++, this.FUNCTION = this.createObjectProto(this.FUNCTION_PROTO), this.setProperty(e2, "Function", this.FUNCTION), this.setProperty(this.FUNCTION, "prototype", this.FUNCTION_PROTO), this.FUNCTION.nativeFunc = r2, this.setProperty(this.FUNCTION_PROTO, "constructor", this.FUNCTION, t2.NONENUMERABLE_DESCRIPTOR), this.FUNCTION_PROTO.nativeFunc = function() {
    }, this.FUNCTION_PROTO.nativeFunc.id = this.functionCounter_++, this.setProperty(this.FUNCTION_PROTO, "length", 0, t2.READONLY_DESCRIPTOR);
    var o2 = function(t3) {
      if (!(t3 && t3.isObject || n2.getScope().strict))
        if (null == t3)
          t3 = n2.global;
        else {
          var e3 = n2.createObjectProto(n2.getPrototype(t3));
          e3.data = t3, t3 = e3;
        }
      return t3;
    };
    r2 = function(t3, e3) {
      var r3 = n2.stateStack[n2.stateStack.length - 1];
      r3.func_ = this, r3.funcThis_ = o2(t3), r3.arguments_ = [], null != e3 && (e3.isObject ? r3.arguments_ = n2.pseudoToNative(e3) : n2.throwException(n2.TYPE_ERROR, "CreateListFromArrayLike called on non-object")), r3.doneExec_ = false;
    }, this.setNativeFunctionPrototype(this.FUNCTION, "apply", r2), r2 = function(t3, e3) {
      var r3 = n2.stateStack[n2.stateStack.length - 1];
      r3.func_ = this, r3.funcThis_ = o2(t3), r3.arguments_ = [];
      for (var i3 = 1; i3 < arguments.length; i3++)
        r3.arguments_.push(arguments[i3]);
      r3.doneExec_ = false;
    }, this.setNativeFunctionPrototype(this.FUNCTION, "call", r2), this.polyfills_.push("Object.defineProperty(Function.prototype, 'bind',", "{configurable: true, writable: true, value:", "function(oThis) {", "if (typeof this !== 'function') {", "throw TypeError('What is trying to be bound is not callable');", "}", "var aArgs   = Array.prototype.slice.call(arguments, 1),", "fToBind = this,", "fNOP    = function() {},", "fBound  = function() {", "return fToBind.apply(this instanceof fNOP", "? this", ": oThis,", "aArgs.concat(Array.prototype.slice.call(arguments)));", "};", "if (this.prototype) {", "fNOP.prototype = this.prototype;", "}", "fBound.prototype = new fNOP();", "return fBound;", "}", "});", ""), r2 = function() {
      return this.toString();
    }, this.setNativeFunctionPrototype(this.FUNCTION, "toString", r2), this.setProperty(this.FUNCTION, "toString", this.createNativeFunction(r2, false), t2.NONENUMERABLE_DESCRIPTOR), r2 = function() {
      return this.valueOf();
    }, this.setNativeFunctionPrototype(this.FUNCTION, "valueOf", r2), this.setProperty(this.FUNCTION, "valueOf", this.createNativeFunction(r2, false), t2.NONENUMERABLE_DESCRIPTOR);
  }, t2.prototype.initObject = function(e2) {
    var r2, n2 = this;
    r2 = function(t3) {
      if (null == t3)
        return n2.calledWithNew() ? this : n2.createObjectProto(n2.OBJECT_PROTO);
      if (!t3.isObject) {
        var e3 = n2.createObjectProto(n2.getPrototype(t3));
        return e3.data = t3, e3;
      }
      return t3;
    }, this.OBJECT = this.createNativeFunction(r2, true), this.setProperty(this.OBJECT, "prototype", this.OBJECT_PROTO), this.setProperty(this.OBJECT_PROTO, "constructor", this.OBJECT), this.setProperty(e2, "Object", this.OBJECT);
    var i2 = function(t3) {
      null == t3 && n2.throwException(n2.TYPE_ERROR, "Cannot convert '" + t3 + "' to object");
    };
    r2 = function(t3) {
      i2(t3);
      var e3 = t3.isObject ? t3.properties : t3;
      return n2.nativeToPseudo(Object.getOwnPropertyNames(e3));
    }, this.setProperty(this.OBJECT, "getOwnPropertyNames", this.createNativeFunction(r2, false), t2.NONENUMERABLE_DESCRIPTOR), r2 = function(t3) {
      return i2(t3), t3.isObject ? n2.nativeToPseudo(Object.keys(t3.properties)) : n2.nativeToPseudo(Object.keys(t3));
    }, this.setProperty(this.OBJECT, "keys", this.createNativeFunction(r2, false), t2.NONENUMERABLE_DESCRIPTOR), r2 = function(t3) {
      return null === t3 ? n2.createObjectProto(null) : (void 0 !== t3 && t3.isObject || n2.throwException(n2.TYPE_ERROR, "Object prototype may only be an Object or null"), n2.createObjectProto(t3));
    }, this.setProperty(this.OBJECT, "create", this.createNativeFunction(r2, false), t2.NONENUMERABLE_DESCRIPTOR), this.polyfills_.push("(function() {", "var create_ = Object.create;", "Object.create = function(proto, props) {", "var obj = create_(proto);", "props && Object.defineProperties(obj, props);", "return obj;", "};", "})();", ""), r2 = function(t3, e3, r3) {
      return e3 = String(e3), t3 && t3.isObject || n2.throwException(n2.TYPE_ERROR, "Object.defineProperty called on non-object"), r3 && r3.isObject || n2.throwException(n2.TYPE_ERROR, "Property description must be an object"), !t3.properties[e3] && t3.preventExtensions && n2.throwException(n2.TYPE_ERROR, "Can't define property '" + e3 + "', object is not extensible"), n2.setProperty(t3, e3, ReferenceError, r3.properties), t3;
    }, this.setProperty(this.OBJECT, "defineProperty", this.createNativeFunction(r2, false), t2.NONENUMERABLE_DESCRIPTOR), this.polyfills_.push("(function() {", "var defineProperty_ = Object.defineProperty;", "Object.defineProperty = function(obj, prop, d1) {", "var d2 = {};", "if ('configurable' in d1) d2.configurable = d1.configurable;", "if ('enumerable' in d1) d2.enumerable = d1.enumerable;", "if ('writable' in d1) d2.writable = d1.writable;", "if ('value' in d1) d2.value = d1.value;", "if ('get' in d1) d2.get = d1.get;", "if ('set' in d1) d2.set = d1.set;", "return defineProperty_(obj, prop, d2);", "};", "})();", "Object.defineProperty(Object, 'defineProperties',", "{configurable: true, writable: true, value:", "function(obj, props) {", "var keys = Object.keys(props);", "for (var i = 0; i < keys.length; i++) {", "Object.defineProperty(obj, keys[i], props[keys[i]]);", "}", "return obj;", "}", "});", ""), r2 = function(t3, e3) {
      if (t3 && t3.isObject || n2.throwException(n2.TYPE_ERROR, "Object.getOwnPropertyDescriptor called on non-object"), (e3 = String(e3)) in t3.properties) {
        var r3 = Object.getOwnPropertyDescriptor(t3.properties, e3), i3 = t3.getter[e3], o2 = t3.setter[e3];
        (i3 || o2) && (r3.get = i3, r3.set = o2, delete r3.value, delete r3.writable);
        var s2 = n2.nativeToPseudo(r3);
        return "value" in r3 && n2.setProperty(s2, "value", r3.value), s2;
      }
    }, this.setProperty(this.OBJECT, "getOwnPropertyDescriptor", this.createNativeFunction(r2, false), t2.NONENUMERABLE_DESCRIPTOR), r2 = function(t3) {
      return i2(t3), n2.getPrototype(t3);
    }, this.setProperty(this.OBJECT, "getPrototypeOf", this.createNativeFunction(r2, false), t2.NONENUMERABLE_DESCRIPTOR), r2 = function(t3) {
      return Boolean(t3) && !t3.preventExtensions;
    }, this.setProperty(this.OBJECT, "isExtensible", this.createNativeFunction(r2, false), t2.NONENUMERABLE_DESCRIPTOR), r2 = function(t3) {
      return t3 && t3.isObject && (t3.preventExtensions = true), t3;
    }, this.setProperty(this.OBJECT, "preventExtensions", this.createNativeFunction(r2, false), t2.NONENUMERABLE_DESCRIPTOR), this.setNativeFunctionPrototype(this.OBJECT, "toString", Xr.prototype.toString), this.setNativeFunctionPrototype(this.OBJECT, "toLocaleString", Xr.prototype.toString), this.setNativeFunctionPrototype(this.OBJECT, "valueOf", Xr.prototype.valueOf), r2 = function(t3) {
      return i2(this), this.isObject ? String(t3) in this.properties : this.hasOwnProperty(t3);
    }, this.setNativeFunctionPrototype(this.OBJECT, "hasOwnProperty", r2), r2 = function(t3) {
      return i2(this), Object.prototype.propertyIsEnumerable.call(this.properties, t3);
    }, this.setNativeFunctionPrototype(this.OBJECT, "propertyIsEnumerable", r2), r2 = function(t3) {
      for (; ; ) {
        if (!(t3 = n2.getPrototype(t3)))
          return false;
        if (t3 === this)
          return true;
      }
    }, this.setNativeFunctionPrototype(this.OBJECT, "isPrototypeOf", r2);
  }, t2.prototype.initArray = function(e2) {
    var r2, n2 = this;
    r2 = function(e3) {
      if (n2.calledWithNew())
        var r3 = this;
      else
        r3 = n2.createObjectProto(n2.ARRAY_PROTO);
      var i2 = arguments[0];
      if (1 === arguments.length && "number" == typeof i2)
        isNaN(t2.legalArrayLength(i2)) && n2.throwException(n2.RANGE_ERROR, "Invalid array length"), r3.properties.length = i2;
      else {
        for (var o2 = 0; o2 < arguments.length; o2++)
          r3.properties[o2] = arguments[o2];
        r3.properties.length = o2;
      }
      return r3;
    }, this.ARRAY = this.createNativeFunction(r2, true), this.ARRAY_PROTO = this.ARRAY.properties.prototype, this.setProperty(e2, "Array", this.ARRAY), r2 = function(t3) {
      return t3 && "Array" === t3.class;
    }, this.setProperty(this.ARRAY, "isArray", this.createNativeFunction(r2, false), t2.NONENUMERABLE_DESCRIPTOR), r2 = function() {
      return Array.prototype.pop.call(this.properties);
    }, this.setNativeFunctionPrototype(this.ARRAY, "pop", r2), r2 = function(t3) {
      return Array.prototype.push.apply(this.properties, arguments);
    }, this.setNativeFunctionPrototype(this.ARRAY, "push", r2), r2 = function() {
      return Array.prototype.shift.call(this.properties);
    }, this.setNativeFunctionPrototype(this.ARRAY, "shift", r2), r2 = function(t3) {
      return Array.prototype.unshift.apply(this.properties, arguments);
    }, this.setNativeFunctionPrototype(this.ARRAY, "unshift", r2), r2 = function() {
      return Array.prototype.reverse.call(this.properties), this;
    }, this.setNativeFunctionPrototype(this.ARRAY, "reverse", r2), r2 = function(t3, e3) {
      var r3 = Array.prototype.splice.apply(this.properties, arguments);
      return n2.unwrap && (r3 = r3.map(n2.unwrap)), n2.nativeToPseudo(r3);
    }, this.setNativeFunctionPrototype(this.ARRAY, "splice", r2), r2 = function(t3, e3) {
      var r3 = Array.prototype.slice.call(this.properties, t3, e3);
      return n2.unwrap && (r3 = r3.map(n2.unwrap)), n2.nativeToPseudo(r3);
    }, this.setNativeFunctionPrototype(this.ARRAY, "slice", r2), r2 = function(t3) {
      return Array.prototype.join.call(this.properties, t3);
    }, this.setNativeFunctionPrototype(this.ARRAY, "join", r2), r2 = function(t3) {
      for (var e3 = [], r3 = 0, i2 = n2.getProperty(this, "length"), o2 = 0; o2 < i2; o2++) {
        if (n2.hasProperty(this, o2)) {
          var s2 = n2.getProperty(this, o2);
          e3[r3] = s2;
        }
        r3++;
      }
      for (o2 = 0; o2 < arguments.length; o2++) {
        var a2 = arguments[o2];
        if (n2.isa(a2, n2.ARRAY))
          for (var u2 = n2.getProperty(a2, "length"), l2 = 0; l2 < u2; l2++)
            n2.hasProperty(a2, l2) && (e3[r3] = n2.getProperty(a2, l2)), r3++;
        else
          e3[r3] = a2;
      }
      return n2.unwrap && (e3 = e3.map(n2.unwrap)), n2.nativeToPseudo(e3);
    }, this.setNativeFunctionPrototype(this.ARRAY, "concat", r2), r2 = function(t3, e3) {
      return Array.prototype.indexOf.apply(this.properties, arguments);
    }, this.setNativeFunctionPrototype(this.ARRAY, "indexOf", r2), r2 = function(t3, e3) {
      return Array.prototype.lastIndexOf.apply(this.properties, arguments);
    }, this.setNativeFunctionPrototype(this.ARRAY, "lastIndexOf", r2), r2 = function() {
      return Array.prototype.sort.call(this.properties), this;
    }, this.setNativeFunctionPrototype(this.ARRAY, "sort", r2), this.polyfills_.push("Object.defineProperty(Array.prototype, 'every',", "{configurable: true, writable: true, value:", "function(callbackfn, thisArg) {", "if (!this || typeof callbackfn !== 'function') throw TypeError();", "var T, k;", "var O = Object(this);", "var len = O.length >>> 0;", "if (arguments.length > 1) T = thisArg;", "k = 0;", "while (k < len) {", "if (k in O && !callbackfn.call(T, O[k], k, O)) return false;", "k++;", "}", "return true;", "}", "});", "Object.defineProperty(Array.prototype, 'filter',", "{configurable: true, writable: true, value:", "function(fun/*, thisArg*/) {", "if (this === void 0 || this === null || typeof fun !== 'function') throw TypeError();", "var t = Object(this);", "var len = t.length >>> 0;", "var res = [];", "var thisArg = arguments.length >= 2 ? arguments[1] : void 0;", "for (var i = 0; i < len; i++) {", "if (i in t) {", "var val = t[i];", "if (fun.call(thisArg, val, i, t)) res.push(val);", "}", "}", "return res;", "}", "});", "Object.defineProperty(Array.prototype, 'forEach',", "{configurable: true, writable: true, value:", "function(callback, thisArg) {", "if (!this || typeof callback !== 'function') throw TypeError();", "var T, k;", "var O = Object(this);", "var len = O.length >>> 0;", "if (arguments.length > 1) T = thisArg;", "k = 0;", "while (k < len) {", "if (k in O) callback.call(T, O[k], k, O);", "k++;", "}", "}", "});", "Object.defineProperty(Array.prototype, 'map',", "{configurable: true, writable: true, value:", "function(callback, thisArg) {", "if (!this || typeof callback !== 'function') new TypeError;", "var T, A, k;", "var O = Object(this);", "var len = O.length >>> 0;", "if (arguments.length > 1) T = thisArg;", "A = new Array(len);", "k = 0;", "while (k < len) {", "if (k in O) A[k] = callback.call(T, O[k], k, O);", "k++;", "}", "return A;", "}", "});", "Object.defineProperty(Array.prototype, 'reduce',", "{configurable: true, writable: true, value:", "function(callback /*, initialValue*/) {", "if (!this || typeof callback !== 'function') throw TypeError();", "var t = Object(this), len = t.length >>> 0, k = 0, value;", "if (arguments.length === 2) {", "value = arguments[1];", "} else {", "while (k < len && !(k in t)) k++;", "if (k >= len) {", "throw TypeError('Reduce of empty array with no initial value');", "}", "value = t[k++];", "}", "for (; k < len; k++) {", "if (k in t) value = callback(value, t[k], k, t);", "}", "return value;", "}", "});", "Object.defineProperty(Array.prototype, 'reduceRight',", "{configurable: true, writable: true, value:", "function(callback /*, initialValue*/) {", "if (null === this || 'undefined' === typeof this || 'function' !== typeof callback) throw TypeError();", "var t = Object(this), len = t.length >>> 0, k = len - 1, value;", "if (arguments.length >= 2) {", "value = arguments[1];", "} else {", "while (k >= 0 && !(k in t)) k--;", "if (k < 0) {", "throw TypeError('Reduce of empty array with no initial value');", "}", "value = t[k--];", "}", "for (; k >= 0; k--) {", "if (k in t) value = callback(value, t[k], k, t);", "}", "return value;", "}", "});", "Object.defineProperty(Array.prototype, 'some',", "{configurable: true, writable: true, value:", "function(fun/*, thisArg*/) {", "if (!this || typeof fun !== 'function') throw TypeError();", "var t = Object(this);", "var len = t.length >>> 0;", "var thisArg = arguments.length >= 2 ? arguments[1] : void 0;", "for (var i = 0; i < len; i++) {", "if (i in t && fun.call(thisArg, t[i], i, t)) {", "return true;", "}", "}", "return false;", "}", "});", "(function() {", "var sort_ = Array.prototype.sort;", "Array.prototype.sort = function(opt_comp) {", "if (typeof opt_comp !== 'function') {", "return sort_.call(this);", "}", "for (var i = 0; i < this.length; i++) {", "var changes = 0;", "for (var j = 0; j < this.length - i - 1; j++) {", "if (opt_comp(this[j], this[j + 1]) > 0) {", "var swap = this[j];", "this[j] = this[j + 1];", "this[j + 1] = swap;", "changes++;", "}", "}", "if (!changes) break;", "}", "return this;", "};", "})();", "Object.defineProperty(Array.prototype, 'toLocaleString',", "{configurable: true, writable: true, value:", "function() {", "var out = [];", "for (var i = 0; i < this.length; i++) {", "out[i] = (this[i] === null || this[i] === undefined) ? '' : this[i].toLocaleString();", "}", "return out.join(',');", "}", "});", "");
  }, t2.prototype.initString = function(e2) {
    var r2, n2 = this;
    r2 = function(t3) {
      return t3 = String(t3), n2.calledWithNew() ? (this.data = t3, this) : t3;
    }, this.STRING = this.createNativeFunction(r2, true), this.setProperty(e2, "String", this.STRING), this.setProperty(this.STRING, "fromCharCode", this.createNativeFunction(String.fromCharCode, false), t2.NONENUMERABLE_DESCRIPTOR);
    for (var i2 = ["trim", "toLowerCase", "toUpperCase", "toLocaleLowerCase", "toLocaleUpperCase", "charAt", "charCodeAt", "substring", "slice", "substr", "indexOf", "lastIndexOf", "concat"], o2 = 0; o2 < i2.length; o2++)
      this.setNativeFunctionPrototype(this.STRING, i2[o2], String.prototype[i2[o2]]);
    r2 = function(t3, e3, r3) {
      return e3 = e3 ? n2.pseudoToNative(e3) : void 0, r3 = r3 ? n2.pseudoToNative(r3) : void 0, String(this).localeCompare(t3, e3, r3);
    }, this.setNativeFunctionPrototype(this.STRING, "localeCompare", r2), r2 = function(t3, e3) {
      n2.isa(t3, n2.REGEXP) && (t3 = t3.data);
      var r3 = String(this).split(t3, e3);
      return n2.nativeToPseudo(r3);
    }, this.setNativeFunctionPrototype(this.STRING, "split", r2), r2 = function(t3) {
      t3 = t3 ? t3.data : void 0;
      var e3 = String(this).match(t3);
      return e3 ? n2.nativeToPseudo(e3) : null;
    }, this.setNativeFunctionPrototype(this.STRING, "match", r2), r2 = function(t3) {
      return n2.isa(t3, n2.REGEXP) && (t3 = t3.data), String(this).search(t3);
    }, this.setNativeFunctionPrototype(this.STRING, "search", r2), r2 = function(t3, e3) {
      return String(this).replace(t3.data || t3, e3);
    }, this.setNativeFunctionPrototype(this.STRING, "replace", r2), this.polyfills_.push("(function() {", "var replace_ = String.prototype.replace;", "String.prototype.replace = function(substr, newSubstr) {", "if (typeof newSubstr !== 'function') {", "return replace_.call(this, substr, newSubstr);", "}", "var str = this;", "if (substr instanceof RegExp) {", "var subs = [];", "var m = substr.exec(str);", "while (m) {", "m.push(m.index, str);", "var inject = newSubstr.apply(null, m);", "subs.push([m.index, m[0].length, inject]);", "m = substr.global ? substr.exec(str) : null;", "}", "for (var i = subs.length - 1; i >= 0; i--) {", "str = str.substring(0, subs[i][0]) + subs[i][2] + str.substring(subs[i][0] + subs[i][1]);", "}", "} else {", "var i = str.indexOf(substr);", "if (i !== -1) {", "var inject = newSubstr(str.substr(i, substr.length), i, str);", "str = str.substring(0, i) + inject + str.substring(i + substr.length);", "}", "}", "return str;", "};", "})();", "");
  }, t2.prototype.initBoolean = function(t3) {
    var e2, r2 = this;
    e2 = function(t4) {
      return t4 = Boolean(t4), r2.calledWithNew() ? (this.data = t4, this) : t4;
    }, this.BOOLEAN = this.createNativeFunction(e2, true), this.setProperty(t3, "Boolean", this.BOOLEAN);
  }, t2.prototype.initNumber = function(e2) {
    var r2, n2 = this;
    r2 = function(t3) {
      return t3 = Number(t3), n2.calledWithNew() ? (this.data = t3, this) : t3;
    }, this.NUMBER = this.createNativeFunction(r2, true), this.setProperty(e2, "Number", this.NUMBER);
    for (var i2 = ["MAX_VALUE", "MIN_VALUE", "NaN", "NEGATIVE_INFINITY", "POSITIVE_INFINITY"], o2 = 0; o2 < i2.length; o2++)
      this.setProperty(this.NUMBER, i2[o2], Number[i2[o2]], t2.READONLY_NONENUMERABLE_DESCRIPTOR);
    r2 = function(t3) {
      try {
        return Number(this).toExponential(t3);
      } catch (t4) {
        n2.throwException(n2.ERROR, t4.message);
      }
    }, this.setNativeFunctionPrototype(this.NUMBER, "toExponential", r2), r2 = function(t3) {
      try {
        return Number(this).toFixed(t3);
      } catch (t4) {
        n2.throwException(n2.ERROR, t4.message);
      }
    }, this.setNativeFunctionPrototype(this.NUMBER, "toFixed", r2), r2 = function(t3) {
      try {
        return Number(this).toPrecision(t3);
      } catch (t4) {
        n2.throwException(n2.ERROR, t4.message);
      }
    }, this.setNativeFunctionPrototype(this.NUMBER, "toPrecision", r2), r2 = function(t3) {
      try {
        return Number(this).toString(t3);
      } catch (t4) {
        n2.throwException(n2.ERROR, t4.message);
      }
    }, this.setNativeFunctionPrototype(this.NUMBER, "toString", r2), r2 = function(t3, e3) {
      return t3 = t3 ? n2.pseudoToNative(t3) : void 0, e3 = e3 ? n2.pseudoToNative(e3) : void 0, Number(this).toLocaleString(t3, e3);
    }, this.setNativeFunctionPrototype(this.NUMBER, "toLocaleString", r2);
  }, t2.prototype.initDate = function(e2) {
    var r2, n2 = this;
    r2 = function(t3, e3) {
      if (!n2.calledWithNew())
        return Date();
      var r3 = [null].concat([].slice.call(arguments));
      return this.data = new (Function.prototype.bind.apply(Date, r3))(), this;
    }, this.DATE = this.createNativeFunction(r2, true), this.setProperty(e2, "Date", this.DATE), this.setProperty(this.DATE, "now", this.createNativeFunction(Date.now, false), t2.NONENUMERABLE_DESCRIPTOR), this.setProperty(this.DATE, "parse", this.createNativeFunction(Date.parse, false), t2.NONENUMERABLE_DESCRIPTOR), this.setProperty(this.DATE, "UTC", this.createNativeFunction(Date.UTC, false), t2.NONENUMERABLE_DESCRIPTOR);
    for (var i2 = ["getDate", "getDay", "getFullYear", "getHours", "getMilliseconds", "getMinutes", "getMonth", "getSeconds", "getTime", "getTimezoneOffset", "getUTCDate", "getUTCDay", "getUTCFullYear", "getUTCHours", "getUTCMilliseconds", "getUTCMinutes", "getUTCMonth", "getUTCSeconds", "getYear", "setDate", "setFullYear", "setHours", "setMilliseconds", "setMinutes", "setMonth", "setSeconds", "setTime", "setUTCDate", "setUTCFullYear", "setUTCHours", "setUTCMilliseconds", "setUTCMinutes", "setUTCMonth", "setUTCSeconds", "setYear", "toDateString", "toISOString", "toJSON", "toGMTString", "toLocaleDateString", "toLocaleString", "toLocaleTimeString", "toTimeString", "toUTCString"], o2 = 0; o2 < i2.length; o2++)
      r2 = /* @__PURE__ */ function(t3) {
        return function(e3) {
          for (var r3 = [], i3 = 0; i3 < arguments.length; i3++)
            r3[i3] = n2.pseudoToNative(arguments[i3]);
          return this.data[t3].apply(this.data, r3);
        };
      }(i2[o2]), this.setNativeFunctionPrototype(this.DATE, i2[o2], r2);
  }, t2.prototype.initRegExp = function(e2) {
    var r2, n2 = this;
    r2 = function(t3, e3) {
      if (n2.calledWithNew())
        var r3 = this;
      else
        r3 = n2.createObjectProto(n2.REGEXP_PROTO);
      return t3 = t3 ? t3.toString() : "", e3 = e3 ? e3.toString() : "", n2.populateRegExp(r3, new RegExp(t3, e3)), r3;
    }, this.REGEXP = this.createNativeFunction(r2, true), this.REGEXP_PROTO = this.REGEXP.properties.prototype, this.setProperty(e2, "RegExp", this.REGEXP), this.setProperty(this.REGEXP.properties.prototype, "global", void 0, t2.READONLY_NONENUMERABLE_DESCRIPTOR), this.setProperty(this.REGEXP.properties.prototype, "ignoreCase", void 0, t2.READONLY_NONENUMERABLE_DESCRIPTOR), this.setProperty(this.REGEXP.properties.prototype, "multiline", void 0, t2.READONLY_NONENUMERABLE_DESCRIPTOR), this.setProperty(this.REGEXP.properties.prototype, "source", "(?:)", t2.READONLY_NONENUMERABLE_DESCRIPTOR), r2 = function(t3) {
      return this.data.test(t3);
    }, this.setNativeFunctionPrototype(this.REGEXP, "test", r2), r2 = function(t3) {
      t3 = t3.toString(), this.data.lastIndex = Number(n2.getProperty(this, "lastIndex"));
      var e3 = this.data.exec(t3);
      if (n2.setProperty(this, "lastIndex", this.data.lastIndex), e3) {
        for (var r3 = n2.createObjectProto(n2.ARRAY_PROTO), i2 = 0; i2 < e3.length; i2++)
          n2.setProperty(r3, i2, e3[i2]);
        return n2.setProperty(r3, "index", e3.index), n2.setProperty(r3, "input", e3.input), r3;
      }
      return null;
    }, this.setNativeFunctionPrototype(this.REGEXP, "exec", r2);
  }, t2.prototype.initError = function(e2) {
    var r2 = this;
    this.ERROR = this.createNativeFunction(function(e3) {
      if (r2.calledWithNew())
        var n3 = this;
      else
        n3 = r2.createObject(r2.ERROR);
      return e3 && r2.setProperty(n3, "message", String(e3), t2.NONENUMERABLE_DESCRIPTOR), n3;
    }, true), this.setProperty(e2, "Error", this.ERROR), this.setProperty(this.ERROR.properties.prototype, "message", "", t2.NONENUMERABLE_DESCRIPTOR), this.setProperty(this.ERROR.properties.prototype, "name", "Error", t2.NONENUMERABLE_DESCRIPTOR);
    var n2 = function(n3) {
      var i2 = r2.createNativeFunction(function(e3) {
        if (r2.calledWithNew())
          var n4 = this;
        else
          n4 = r2.createObject(i2);
        return e3 && r2.setProperty(n4, "message", String(e3), t2.NONENUMERABLE_DESCRIPTOR), n4;
      }, true);
      return r2.setProperty(i2, "prototype", r2.createObject(r2.ERROR)), r2.setProperty(i2.properties.prototype, "name", n3, t2.NONENUMERABLE_DESCRIPTOR), r2.setProperty(e2, n3, i2), i2;
    };
    this.EVAL_ERROR = n2("EvalError"), this.RANGE_ERROR = n2("RangeError"), this.REFERENCE_ERROR = n2("ReferenceError"), this.SYNTAX_ERROR = n2("SyntaxError"), this.TYPE_ERROR = n2("TypeError"), this.URI_ERROR = n2("URIError");
  }, t2.prototype.initMath = function(e2) {
    var r2 = this.createObjectProto(this.OBJECT_PROTO);
    this.setProperty(e2, "Math", r2);
    for (var n2 = ["E", "LN2", "LN10", "LOG2E", "LOG10E", "PI", "SQRT1_2", "SQRT2"], i2 = 0; i2 < n2.length; i2++)
      this.setProperty(r2, n2[i2], Math[n2[i2]], t2.READONLY_NONENUMERABLE_DESCRIPTOR);
    var o2 = ["abs", "acos", "asin", "atan", "atan2", "ceil", "cos", "exp", "floor", "log", "max", "min", "pow", "random", "round", "sin", "sqrt", "tan"];
    for (i2 = 0; i2 < o2.length; i2++)
      this.setProperty(r2, o2[i2], this.createNativeFunction(Math[o2[i2]], false), t2.NONENUMERABLE_DESCRIPTOR);
  }, t2.prototype.initJSON = function(t3) {
    var e2 = this, r2 = e2.createObjectProto(this.OBJECT_PROTO);
    this.setProperty(t3, "JSON", r2);
    var n2 = function(t4) {
      try {
        var r3 = JSON.parse(t4.toString());
      } catch (t5) {
        e2.throwException(e2.SYNTAX_ERROR, t5.message);
      }
      return e2.nativeToPseudo(r3);
    };
    this.setProperty(r2, "parse", this.createNativeFunction(n2, false)), n2 = function(t4) {
      var r3 = e2.pseudoToNative(t4);
      try {
        var n3 = JSON.stringify(r3);
      } catch (t5) {
        e2.throwException(e2.TYPE_ERROR, t5.message);
      }
      return n3;
    }, this.setProperty(r2, "stringify", this.createNativeFunction(n2, false));
  }, t2.prototype.isa = function(t3, e2) {
    if (null == t3 || !e2)
      return false;
    var r2 = e2.properties.prototype;
    if (t3 === r2)
      return true;
    for (var n2 = this.getPrototype(t3); n2; ) {
      if (n2 === r2)
        return true;
      n2 = n2.proto;
    }
    return false;
  }, t2.legalArrayLength = function(t3) {
    var e2 = t3 >>> 0;
    return e2 === Number(t3) ? e2 : NaN;
  }, t2.legalArrayIndex = function(t3) {
    var e2 = t3 >>> 0;
    return String(e2) === String(t3) && 4294967295 !== e2 ? e2 : NaN;
  }, t2.prototype.createObject = function(t3) {
    return this.createObjectProto(t3 && t3.properties.prototype);
  }, t2.prototype.createObjectProto = function(t3) {
    var e2 = new Xr(t3);
    return this.isa(e2, this.FUNCTION) && (this.setProperty(e2, "prototype", this.createObjectProto(this.OBJECT_PROTO || null)), e2.class = "Function"), this.isa(e2, this.ARRAY) && (this.setProperty(e2, "length", 0, { configurable: false, enumerable: false, writable: true }), e2.class = "Array"), this.isa(e2, this.ERROR) && (e2.class = "Error"), e2;
  }, t2.prototype.populateRegExp = function(e2, r2) {
    e2.data = r2, this.setProperty(e2, "lastIndex", r2.lastIndex, t2.NONENUMERABLE_DESCRIPTOR), this.setProperty(e2, "source", r2.source, t2.READONLY_NONENUMERABLE_DESCRIPTOR), this.setProperty(e2, "global", r2.global, t2.READONLY_NONENUMERABLE_DESCRIPTOR), this.setProperty(e2, "ignoreCase", r2.ignoreCase, t2.READONLY_NONENUMERABLE_DESCRIPTOR), this.setProperty(e2, "multiline", r2.multiline, t2.READONLY_NONENUMERABLE_DESCRIPTOR);
  }, t2.prototype.createFunction = function(e2, r2) {
    var n2 = this.createObjectProto(this.FUNCTION_PROTO);
    return n2.parentScope = r2, n2.node = e2, this.setProperty(n2, "length", n2.node.params.length, t2.READONLY_DESCRIPTOR), n2;
  }, t2.prototype.createNativeFunction = function(e2, r2) {
    var n2 = this.createObjectProto(this.FUNCTION_PROTO);
    return n2.nativeFunc = e2, e2.id = this.functionCounter_++, this.setProperty(n2, "length", e2.length, t2.READONLY_DESCRIPTOR), r2 ? this.setProperty(n2.properties.prototype, "constructor", n2, t2.NONENUMERABLE_DESCRIPTOR) : false === r2 && (n2.illegalConstructor = true, this.setProperty(n2, "prototype", void 0)), n2;
  }, t2.prototype.createAsyncFunction = function(e2) {
    var r2 = this.createObjectProto(this.FUNCTION_PROTO);
    return r2.asyncFunc = e2, e2.id = this.functionCounter_++, this.setProperty(r2, "length", e2.length, t2.READONLY_DESCRIPTOR), r2;
  }, t2.prototype.nativeToPseudo = function(t3) {
    if ("boolean" == typeof t3 || "number" == typeof t3 || "string" == typeof t3 || null == t3)
      return t3;
    if (t3 instanceof RegExp) {
      var e2 = this.createObjectProto(this.REGEXP_PROTO);
      return this.populateRegExp(e2, t3), e2;
    }
    if (t3 instanceof Function) {
      var r2 = this;
      return this.createNativeFunction(function() {
        return r2.nativeToPseudo(t3.apply(r2, Array.prototype.slice.call(arguments).map(function(t4) {
          return r2.pseudoToNative(t4);
        })));
      }, void 0);
    }
    var n2;
    if (Array.isArray(t3)) {
      n2 = this.createObjectProto(this.ARRAY_PROTO);
      for (var i2 = 0; i2 < t3.length; i2++)
        i2 in t3 && this.setProperty(n2, i2, this.wrap ? this.wrap(t3[i2]) : this.nativeToPseudo(t3[i2]));
    } else
      for (var o2 in n2 = this.createObjectProto(this.OBJECT_PROTO), t3)
        this.setProperty(n2, o2, this.wrap ? this.wrap(t3[i2]) : this.nativeToPseudo(t3[i2]));
    return n2;
  }, t2.prototype.pseudoToNative = function(t3, e2) {
    if ("boolean" == typeof t3 || "number" == typeof t3 || "string" == typeof t3 || null == t3)
      return t3;
    if (this.isa(t3, this.REGEXP))
      return t3.data;
    var r2, n2 = e2 || { pseudo: [], native: [] };
    if (-1 !== (o2 = n2.pseudo.indexOf(t3)))
      return n2.native[o2];
    if (n2.pseudo.push(t3), this.isa(t3, this.ARRAY)) {
      r2 = [], n2.native.push(r2);
      for (var i2 = this.getProperty(t3, "length"), o2 = 0; o2 < i2; o2++)
        this.hasProperty(t3, o2) && (r2[o2] = this.unwrap ? this.unwrap(this.getProperty(t3, o2), n2) : this.pseudoToNative(this.getProperty(t3, o2), n2));
    } else {
      if (t3._native)
        return t3._native;
      r2 = {}, n2.native.push(r2);
      var s2 = void 0;
      for (var a2 in t3.properties)
        s2 = t3.properties[a2], r2[a2] = this.unwrap ? this.unwrap(s2, n2) : this.pseudoToNative(s2, n2);
    }
    return n2.pseudo.pop(), n2.native.pop(), r2;
  }, t2.prototype.getPrototype = function(t3) {
    switch (typeof t3) {
      case "number":
        return this.NUMBER.properties.prototype;
      case "boolean":
        return this.BOOLEAN.properties.prototype;
      case "string":
        return this.STRING.properties.prototype;
    }
    return t3 ? t3.proto : null;
  }, t2.prototype.getProperty = function(e2, r2) {
    if (r2 = String(r2), null == e2 && this.throwException(this.TYPE_ERROR, "Cannot read property '" + r2 + "' of " + e2), "length" === r2) {
      if (this.isa(e2, this.STRING))
        return String(e2).length;
    } else if (r2.charCodeAt(0) < 64 && this.isa(e2, this.STRING)) {
      var n2 = t2.legalArrayIndex(r2);
      if (!isNaN(n2) && n2 < String(e2).length)
        return String(e2)[n2];
    }
    do {
      var i2 = e2;
      if (i2.properties && r2 in i2.properties) {
        var o2 = i2.getter[r2];
        return o2 ? (o2.isGetter = true, o2) : i2.properties[r2];
      }
      if (void 0 !== i2._native && "_" !== r2.charAt(0) && "function" != typeof i2._native[r2])
        return this.wrap ? this.wrap(i2._native[r2]) : i2._native[r2];
    } while (e2 = this.getPrototype(e2));
  }, t2.prototype.hasProperty = function(e2, r2) {
    if (!e2.isObject)
      throw TypeError("Primitive data type has no properties");
    if ("length" === (r2 = String(r2)) && this.isa(e2, this.STRING))
      return true;
    if (this.isa(e2, this.STRING)) {
      var n2 = t2.legalArrayIndex(r2);
      if (!isNaN(n2) && n2 < String(e2).length)
        return true;
    }
    do {
      var i2 = e2;
      if (i2.properties && r2 in i2.properties)
        return true;
      if (void 0 !== i2._native && "_" != r2.charAt(0)) {
        var o2 = typeof i2._native[r2];
        return "function" !== o2 && ("undefined" !== o2 || $r(i2._native.constructor, r2));
      }
    } while (e2 = this.getPrototype(e2));
    return false;
  }, t2.prototype.setProperty = function(e2, r2, n2, i2) {
    r2 = String(r2), null == e2 && this.throwException(this.TYPE_ERROR, "Cannot set property '" + r2 + "' of " + e2), i2 && ("get" in i2 || "set" in i2) && ("value" in i2 || "writable" in i2) && this.throwException(this.TYPE_ERROR, "Invalid property descriptor. Cannot both specify accessors and a value or writable attribute");
    var o2 = !this.stateStack || this.getScope().strict;
    if (e2.isObject) {
      if (this.isa(e2, this.STRING)) {
        var s2 = t2.legalArrayIndex(r2);
        if ("length" === r2 || !isNaN(s2) && s2 < String(e2).length)
          return void (o2 && this.throwException(this.TYPE_ERROR, "Cannot assign to read only property '" + r2 + "' of String '" + e2.data + "'"));
      }
      if ("Array" === e2.class) {
        var a2 = e2.properties.length, u2 = void 0;
        if ("length" === r2) {
          if (n2 = t2.legalArrayLength(n2), isNaN(n2) && this.throwException(this.RANGE_ERROR, "Invalid array length"), n2 < a2)
            for (u2 in e2.properties)
              u2 = t2.legalArrayIndex(u2), !isNaN(u2) && n2 <= u2 && delete e2.properties[u2];
        } else
          isNaN(u2 = t2.legalArrayIndex(r2)) || (e2.properties.length = Math.max(a2, u2 + 1));
      }
      if (!e2.preventExtensions || r2 in e2.properties)
        if (i2) {
          "get" in i2 && (i2.get ? e2.getter[r2] = i2.get : delete e2.getter[r2]), "set" in i2 && (i2.set ? e2.setter[r2] = i2.set : delete e2.setter[r2]);
          var l2 = {};
          "configurable" in i2 && (l2.configurable = i2.configurable), "enumerable" in i2 && (l2.enumerable = i2.enumerable), "writable" in i2 && (l2.writable = i2.writable, delete e2.getter[r2], delete e2.setter[r2]), "value" in i2 ? (l2.value = i2.value, delete e2.getter[r2], delete e2.setter[r2]) : n2 !== ReferenceError && (l2.value = n2, delete e2.getter[r2], delete e2.setter[r2]);
          try {
            Object.defineProperty(e2.properties, r2, l2);
          } catch (t3) {
            this.throwException(this.TYPE_ERROR, "Cannot redefine property: " + r2);
          }
        } else {
          if (n2 === ReferenceError)
            throw ReferenceError("Value not specified.");
          if (void 0 !== e2._native && "_" != r2.charAt(0)) {
            var c2 = typeof e2._native[r2];
            if ("function" !== c2 && ("undefined" !== c2 || $r(e2._native.constructor, r2))) {
              var p2 = this.unwrap ? this.unwrap(n2) : n2;
              return void (e2._native[r2] = p2);
            }
          }
          for (var h2 = e2; !(r2 in h2.properties); )
            if (!(h2 = this.getPrototype(h2))) {
              h2 = e2;
              break;
            }
          if (h2.setter && h2.setter[r2])
            return h2.setter[r2];
          if (h2.getter && h2.getter[r2])
            o2 && this.throwException(this.TYPE_ERROR, "Cannot set property '" + r2 + "' of object '" + e2 + "' which only has a getter");
          else
            try {
              e2.properties[r2] = n2;
            } catch (t3) {
              o2 && this.throwException(this.TYPE_ERROR, "Cannot assign to read only property '" + r2 + "' of object '" + e2 + "'");
            }
        }
      else
        o2 && this.throwException(this.TYPE_ERROR, "Can't add property '" + r2 + "', object is not extensible");
    } else
      o2 && this.throwException(this.TYPE_ERROR, "Can't create property '" + r2 + "' on '" + e2 + "'");
  }, t2.prototype.setNativeFunctionPrototype = function(e2, r2, n2) {
    this.setProperty(e2.properties.prototype, r2, this.createNativeFunction(n2, false), t2.NONENUMERABLE_DESCRIPTOR);
  }, t2.prototype.getScope = function() {
    var t3 = this.stateStack[this.stateStack.length - 1].scope;
    if (!t3)
      throw Error("No scope found.");
    return t3;
  }, t2.prototype.createScope = function(t3, e2) {
    var r2 = this.createObjectProto(null);
    if (r2.parentScope = e2, e2 || this.initGlobalScope(r2), this.populateScope_(t3, r2), r2.strict = false, e2 && e2.strict)
      r2.strict = true;
    else {
      var n2 = t3.body && t3.body[0];
      n2 && n2.expression && "Literal" === n2.expression.type && "use strict" === n2.expression.value && (r2.strict = true);
    }
    return r2;
  }, t2.prototype.createSpecialScope = function(t3, e2) {
    if (!t3)
      throw Error("parentScope required");
    var r2 = e2 || this.createObjectProto(null);
    return r2.parentScope = t3, r2.strict = t3.strict, r2;
  }, t2.prototype.getValueFromScope = function(t3) {
    for (var e2 = this.getScope(); e2 && e2 !== this.global; ) {
      if (t3 in e2.properties)
        return e2.properties[t3];
      e2 = e2.parentScope;
    }
    if (e2 === this.global && this.hasProperty(e2, t3))
      return this.getProperty(e2, t3);
    var r2 = this.stateStack[this.stateStack.length - 1].node;
    "UnaryExpression" === r2.type && "typeof" === r2.operator || this.throwException(this.REFERENCE_ERROR, t3 + " is not defined");
  }, t2.prototype.setValueToScope = function(t3, e2) {
    for (var r2 = this.getScope(), n2 = r2.strict; r2 && r2 !== this.global; ) {
      if (t3 in r2.properties)
        return void (r2.properties[t3] = e2);
      r2 = r2.parentScope;
    }
    if (r2 === this.global && (!n2 || this.hasProperty(r2, t3)))
      return this.setProperty(r2, t3, e2);
    this.throwException(this.REFERENCE_ERROR, t3 + " is not defined");
  }, t2.prototype.populateScope_ = function(e2, r2) {
    if ("VariableDeclaration" === e2.type)
      for (var n2 = 0; n2 < e2.declarations.length; n2++)
        this.setProperty(r2, e2.declarations[n2].id.name, void 0, t2.VARIABLE_DESCRIPTOR);
    else {
      if ("FunctionDeclaration" === e2.type)
        return void this.setProperty(r2, e2.id.name, this.createFunction(e2, r2), t2.VARIABLE_DESCRIPTOR);
      if ("FunctionExpression" === e2.type)
        return;
      if ("ExpressionStatement" === e2.type)
        return;
    }
    var i2 = e2.constructor;
    for (var o2 in e2) {
      var s2 = e2[o2];
      if (s2 && "object" == typeof s2)
        if (Array.isArray(s2))
          for (n2 = 0; n2 < s2.length; n2++)
            s2[n2] && s2[n2].constructor === i2 && this.populateScope_(s2[n2], r2);
        else
          s2.constructor === i2 && this.populateScope_(s2, r2);
    }
  }, t2.prototype.stripLocations_ = function(t3, e2, r2) {
    for (var n2 in e2 ? t3.start = e2 : delete t3.start, r2 ? t3.end = r2 : delete t3.end, t3)
      if (t3.hasOwnProperty(n2)) {
        var i2 = t3[n2];
        i2 && "object" == typeof i2 && this.stripLocations_(i2, e2, r2);
      }
  }, t2.prototype.calledWithNew = function() {
    return this.stateStack[this.stateStack.length - 1].isConstructor;
  }, t2.prototype.getValue = function(e2) {
    return e2[0] === t2.SCOPE_REFERENCE ? this.getValueFromScope(e2[1]) : this.getProperty(e2[0], e2[1]);
  }, t2.prototype.setValue = function(e2, r2) {
    return e2[0] === t2.SCOPE_REFERENCE ? this.setValueToScope(e2[1], r2) : this.setProperty(e2[0], e2[1], r2);
  }, t2.prototype.throwException = function(e2, r2) {
    if (void 0 === r2)
      var n2 = e2;
    else
      n2 = this.createObject(e2), this.setProperty(n2, "message", r2, t2.NONENUMERABLE_DESCRIPTOR);
    throw this.executeException(n2), t2.STEP_ERROR;
  }, t2.prototype.executeException = function(t3) {
    var e2, r2 = this.stateStack.slice();
    do {
      this.stateStack.pop();
      var n2 = this.stateStack[this.stateStack.length - 1];
      if ("TryStatement" === n2.node.type)
        return void (n2.throwValue = t3);
    } while (n2 && "Program" !== n2.node.type);
    if (this.isa(t3, this.ERROR)) {
      var i2 = { EvalError, RangeError, ReferenceError, SyntaxError, TypeError, URIError }, o2 = this.getProperty(t3, "name").toString(), s2 = this.getProperty(t3, "message").valueOf();
      e2 = (i2[o2] || Error)(s2);
    } else
      e2 = t3.toString();
    throw this.stateStack = r2, e2;
  }, t2.prototype.createGetter_ = function(t3, e2) {
    var r2 = Array.isArray(e2) ? e2[0] : e2, n2 = new this.nodeConstructor();
    n2.type = "CallExpression";
    var i2 = new Zr(n2, this.stateStack[this.stateStack.length - 1].scope);
    return i2.doneCallee_ = true, i2.funcThis_ = r2, i2.func_ = t3, i2.doneArgs_ = true, i2.arguments_ = [], i2;
  }, t2.prototype.createSetter_ = function(t3, e2, r2) {
    var n2 = Array.isArray(e2) ? e2[0] : this.global, i2 = new this.nodeConstructor();
    i2.type = "CallExpression";
    var o2 = new Zr(i2, this.stateStack[this.stateStack.length - 1].scope);
    return o2.doneCallee_ = true, o2.funcThis_ = n2, o2.func_ = t3, o2.doneArgs_ = true, o2.arguments_ = [r2], o2;
  }, t2.prototype.stepArrayExpression = function(t3, e2, r2) {
    var n2 = r2.elements, i2 = e2.n_ || 0;
    for (e2.array_ ? (this.setProperty(e2.array_, i2, e2.value), i2++) : (e2.array_ = this.createObjectProto(this.ARRAY_PROTO), e2.array_.properties.length = n2.length); i2 < n2.length; ) {
      if (n2[i2])
        return e2.n_ = i2, new Zr(n2[i2], e2.scope);
      i2++;
    }
    t3.pop(), t3[t3.length - 1].value = e2.array_;
  }, t2.prototype.stepAssignmentExpression = function(t3, e2, r2) {
    if (!e2.doneLeft_) {
      e2.doneLeft_ = true;
      var n2 = new Zr(r2.left, e2.scope);
      return n2.components = true, n2;
    }
    if (!e2.doneRight_) {
      if (e2.leftReference_ || (e2.leftReference_ = e2.value), e2.doneGetter_ && (e2.leftValue_ = e2.value), !e2.doneGetter_ && "=" !== r2.operator) {
        var i2 = this.getValue(e2.leftReference_);
        if (e2.leftValue_ = i2, i2 && "object" == typeof i2 && i2.isGetter) {
          i2.isGetter = false, e2.doneGetter_ = true;
          var o2 = i2;
          return this.createGetter_(o2, e2.leftReference_);
        }
      }
      return e2.doneRight_ = true, new Zr(r2.right, e2.scope);
    }
    if (e2.doneSetter_)
      return t3.pop(), void (t3[t3.length - 1].value = e2.doneSetter_);
    var s2 = e2.leftValue_, a2 = e2.value;
    switch (r2.operator) {
      case "=":
        s2 = a2;
        break;
      case "+=":
        s2 += a2;
        break;
      case "-=":
        s2 -= a2;
        break;
      case "*=":
        s2 *= a2;
        break;
      case "/=":
        s2 /= a2;
        break;
      case "%=":
        s2 %= a2;
        break;
      case "<<=":
        s2 <<= a2;
        break;
      case ">>=":
        s2 >>= a2;
        break;
      case ">>>=":
        s2 >>>= a2;
        break;
      case "&=":
        s2 &= a2;
        break;
      case "^=":
        s2 ^= a2;
        break;
      case "|=":
        s2 |= a2;
        break;
      default:
        throw SyntaxError("Unknown assignment expression: " + r2.operator);
    }
    var u2 = this.setValue(e2.leftReference_, s2);
    if (u2)
      return e2.doneSetter_ = s2, this.createSetter_(u2, e2.leftReference_, s2);
    t3.pop(), t3[t3.length - 1].value = s2;
  }, t2.prototype.stepBinaryExpression = function(t3, e2, r2) {
    if (!e2.doneLeft_)
      return e2.doneLeft_ = true, new Zr(r2.left, e2.scope);
    if (!e2.doneRight_)
      return e2.doneRight_ = true, e2.leftValue_ = e2.value, new Zr(r2.right, e2.scope);
    t3.pop();
    var n2, i2 = e2.leftValue_, o2 = e2.value;
    switch (r2.operator) {
      case "==":
        n2 = i2 == o2;
        break;
      case "!=":
        n2 = i2 != o2;
        break;
      case "===":
        n2 = i2 === o2;
        break;
      case "!==":
        n2 = i2 !== o2;
        break;
      case ">":
        n2 = i2 > o2;
        break;
      case ">=":
        n2 = i2 >= o2;
        break;
      case "<":
        n2 = i2 < o2;
        break;
      case "<=":
        n2 = i2 <= o2;
        break;
      case "+":
        n2 = i2 + o2;
        break;
      case "-":
        n2 = i2 - o2;
        break;
      case "*":
        n2 = i2 * o2;
        break;
      case "/":
        n2 = i2 / o2;
        break;
      case "%":
        n2 = i2 % o2;
        break;
      case "&":
        n2 = i2 & o2;
        break;
      case "|":
        n2 = i2 | o2;
        break;
      case "^":
        n2 = i2 ^ o2;
        break;
      case "<<":
        n2 = i2 << o2;
        break;
      case ">>":
        n2 = i2 >> o2;
        break;
      case ">>>":
        n2 = i2 >>> o2;
        break;
      case "in":
        o2 && o2.isObject || this.throwException(this.TYPE_ERROR, "'in' expects an object, not '" + o2 + "'"), n2 = this.hasProperty(o2, i2);
        break;
      case "instanceof":
        this.isa(o2, this.FUNCTION) || this.throwException(this.TYPE_ERROR, "Right-hand side of instanceof is not an object"), n2 = !!i2.isObject && this.isa(i2, o2);
        break;
      default:
        throw SyntaxError("Unknown binary operator: " + r2.operator);
    }
    t3[t3.length - 1].value = n2;
  }, t2.prototype.stepBlockStatement = function(t3, e2, r2) {
    var n2 = e2.n_ || 0, i2 = r2.body[n2];
    if (i2)
      return e2.n_ = n2 + 1, new Zr(i2, e2.scope);
    t3.pop();
  }, t2.prototype.stepBreakStatement = function(t3, e2, r2) {
    t3.pop();
    var n2 = null;
    for (r2.label && (n2 = r2.label.name); e2 && "CallExpression" !== e2.node.type && "NewExpression" !== e2.node.type; ) {
      if (n2) {
        if (e2.labels && -1 !== e2.labels.indexOf(n2))
          return;
      } else if (e2.isLoop || e2.isSwitch)
        return;
      e2 = t3.pop();
    }
    throw SyntaxError("Illegal break statement");
  }, t2.prototype.stepCallExpression = function(e2, r2, n2) {
    if (!r2.doneCallee_) {
      r2.doneCallee_ = 1;
      var i2 = new Zr(n2.callee, r2.scope);
      return i2.components = true, i2;
    }
    if (1 === r2.doneCallee_) {
      r2.doneCallee_ = 2;
      var o2 = r2.value;
      if (Array.isArray(o2)) {
        if (r2.func_ = this.getValue(o2), o2[0] !== t2.SCOPE_REFERENCE && (r2.funcThis_ = o2[0]), (o2 = r2.func_) && "object" == typeof o2 && o2.isGetter)
          return o2.isGetter = false, r2.doneCallee_ = 1, this.createGetter_(o2, r2.value);
      } else
        r2.func_ = o2;
      r2.arguments_ = [], r2.n_ = 0;
    }
    if (o2 = r2.func_, !r2.doneArgs_) {
      if (0 !== r2.n_ && r2.arguments_.push(r2.value), n2.arguments[r2.n_])
        return new Zr(n2.arguments[r2.n_++], r2.scope);
      "NewExpression" === n2.type ? (o2.illegalConstructor && this.throwException(this.TYPE_ERROR, o2 + " is not a constructor"), r2.funcThis_ = this.createObject(o2), r2.isConstructor = true) : void 0 === r2.funcThis_ && (r2.funcThis_ = r2.scope.strict ? void 0 : this.global), r2.doneArgs_ = true;
    }
    if (r2.doneExec_)
      e2.pop(), r2.isConstructor && "object" != typeof r2.value ? e2[e2.length - 1].value = r2.funcThis_ : e2[e2.length - 1].value = r2.value;
    else {
      r2.doneExec_ = true, o2 && o2.isObject || (console.log("non-function called", o2, r2), this.throwException(this.TYPE_ERROR, o2 + " is not a function"));
      var s2 = o2.node;
      if (s2) {
        for (var a2 = this.createScope(s2.body, o2.parentScope), u2 = 0; u2 < s2.params.length; u2++) {
          var l2 = s2.params[u2].name, c2 = r2.arguments_.length > u2 ? r2.arguments_[u2] : void 0;
          this.setProperty(a2, l2, c2);
        }
        var p2 = this.createObjectProto(this.ARRAY_PROTO);
        for (u2 = 0; u2 < r2.arguments_.length; u2++)
          this.setProperty(p2, u2, r2.arguments_[u2]);
        this.setProperty(a2, "arguments", p2);
        var h2 = s2.id && s2.id.name;
        return h2 && this.setProperty(a2, h2, o2), this.setProperty(a2, "this", r2.funcThis_, t2.READONLY_DESCRIPTOR), r2.value = void 0, new Zr(s2.body, a2);
      }
      if (o2.eval) {
        var d2 = r2.arguments_[0];
        if ("string" == typeof d2) {
          try {
            var f2 = jt(d2.toString(), t2.PARSE_OPTIONS);
          } catch (t3) {
            this.throwException(this.SYNTAX_ERROR, "Invalid code: " + t3.message);
          }
          var y2 = new this.nodeConstructor();
          return y2.type = "EvalProgram_", y2.body = f2.body, this.stripLocations_(y2, n2.start, n2.end), (a2 = r2.scope).strict ? a2 = this.createScope(f2, a2) : this.populateScope_(f2, a2), this.value = void 0, new Zr(y2, a2);
        }
        r2.value = d2;
      } else if (o2.nativeFunc)
        void 0 !== r2.funcThis_ && void 0 !== r2.funcThis_._native ? r2.value = o2.nativeFunc.call(r2.funcThis_, r2.arguments_) : r2.value = o2.nativeFunc.apply(r2.funcThis_, r2.arguments_);
      else {
        if (o2.asyncFunc) {
          var v2 = this, g2 = r2.arguments_.concat(function(t3) {
            r2.value = t3, v2.paused_ = false;
          });
          return this.paused_ = true, void o2.asyncFunc.apply(r2.funcThis_, g2);
        }
        this.throwException(this.TYPE_ERROR, o2.class + " is not a function");
      }
    }
  }, t2.prototype.stepCatchClause = function(t3, e2, r2) {
    if (!e2.done_) {
      e2.done_ = true;
      var n2 = this.createSpecialScope(e2.scope);
      return this.setProperty(n2, r2.param.name, e2.throwValue), new Zr(r2.body, n2);
    }
    t3.pop();
  }, t2.prototype.stepConditionalExpression = function(t3, e2, r2) {
    var n2 = e2.mode_ || 0;
    if (0 === n2)
      return e2.mode_ = 1, new Zr(r2.test, e2.scope);
    if (1 === n2) {
      e2.mode_ = 2;
      var i2 = Boolean(e2.value);
      if (i2 && r2.consequent)
        return new Zr(r2.consequent, e2.scope);
      if (!i2 && r2.alternate)
        return new Zr(r2.alternate, e2.scope);
      this.value = void 0;
    }
    t3.pop(), "ConditionalExpression" === r2.type && (t3[t3.length - 1].value = e2.value);
  }, t2.prototype.stepContinueStatement = function(t3, e2, r2) {
    t3.pop();
    var n2 = null;
    for (r2.label && (n2 = r2.label.name), e2 = t3[t3.length - 1]; e2 && "CallExpression" !== e2.node.type && "NewExpression" !== e2.node.type; ) {
      if (e2.isLoop && (!n2 || e2.labels && -1 !== e2.labels.indexOf(n2)))
        return;
      t3.pop(), e2 = t3[t3.length - 1];
    }
    throw SyntaxError("Illegal continue statement");
  }, t2.prototype.stepDebuggerStatement = function(t3, e2, r2) {
    t3.pop();
  }, t2.prototype.stepDoWhileStatement = function(t3, e2, r2) {
    if ("DoWhileStatement" === r2.type && void 0 === e2.test_ && (e2.value = true, e2.test_ = true), !e2.test_)
      return e2.test_ = true, new Zr(r2.test, e2.scope);
    if (e2.value) {
      if (r2.body)
        return e2.test_ = false, e2.isLoop = true, new Zr(r2.body, e2.scope);
    } else
      t3.pop();
  }, t2.prototype.stepEmptyStatement = function(t3, e2, r2) {
    t3.pop();
  }, t2.prototype.stepEvalProgram_ = function(t3, e2, r2) {
    var n2 = e2.n_ || 0, i2 = r2.body[n2];
    if (i2)
      return e2.n_ = n2 + 1, new Zr(i2, e2.scope);
    t3.pop(), t3[t3.length - 1].value = this.value;
  }, t2.prototype.stepExpressionStatement = function(t3, e2, r2) {
    if (!e2.done_)
      return e2.done_ = true, new Zr(r2.expression, e2.scope);
    t3.pop(), this.value = e2.value;
  }, t2.prototype.stepForInStatement = function(e2, r2, n2) {
    if (!r2.doneInit_ && (r2.doneInit_ = true, n2.left.declarations && n2.left.declarations[0].init))
      return r2.scope.strict && this.throwException(this.SYNTAX_ERROR, "for-in loop variable declaration may not have an initializer."), new Zr(n2.left, r2.scope);
    if (!r2.doneObject_)
      return r2.doneObject_ = true, r2.variable_ || (r2.variable_ = r2.value), new Zr(n2.right, r2.scope);
    if (r2.isLoop || (r2.isLoop = true, r2.object_ = r2.value, r2.visited_ = /* @__PURE__ */ Object.create(null)), void 0 === r2.name_) {
      t:
        do {
          if (r2.object_ && r2.object_.isObject) {
            r2.props_ || (r2.props_ = Object.getOwnPropertyNames(r2.object_.properties));
            do {
              var i2 = r2.props_.shift();
            } while (i2 && (r2.visited_[i2] || !Object.prototype.hasOwnProperty.call(r2.object_.properties, i2)));
            if (i2 && (r2.visited_[i2] = true, Object.prototype.propertyIsEnumerable.call(r2.object_.properties, i2))) {
              r2.name_ = i2;
              break t;
            }
          } else if (null !== r2.object_) {
            r2.props_ || (r2.props_ = Object.getOwnPropertyNames(r2.object_));
            do {
              i2 = r2.props_.shift();
            } while (i2 && r2.visited_[i2]);
            if (i2) {
              r2.visited_[i2] = true, r2.name_ = i2;
              break t;
            }
          }
          r2.object_ = this.getPrototype(r2.object_), r2.props_ = null;
        } while (null !== r2.object_);
      if (null === r2.object_)
        return void e2.pop();
    }
    if (!r2.doneVariable_) {
      r2.doneVariable_ = true;
      var o2 = n2.left;
      if ("VariableDeclaration" !== o2.type) {
        r2.variable_ = null;
        var s2 = new Zr(o2, r2.scope);
        return s2.components = true, s2;
      }
      r2.variable_ = [t2.SCOPE_REFERENCE, o2.declarations[0].id.name];
    }
    if (r2.variable_ || (r2.variable_ = r2.value), !r2.doneSetter_) {
      r2.doneSetter_ = true;
      var a2 = r2.name_, u2 = this.setValue(r2.variable_, a2);
      if (u2)
        return this.createSetter_(u2, r2.variable_, a2);
    }
    return r2.name_ = void 0, r2.doneVariable_ = false, r2.doneSetter_ = false, n2.body ? new Zr(n2.body, r2.scope) : void 0;
  }, t2.prototype.stepForStatement = function(t3, e2, r2) {
    var n2 = e2.mode_ || 0;
    if (0 === n2) {
      if (e2.mode_ = 1, r2.init)
        return new Zr(r2.init, e2.scope);
    } else if (1 === n2) {
      if (e2.mode_ = 2, r2.test)
        return new Zr(r2.test, e2.scope);
    } else if (2 === n2) {
      if (e2.mode_ = 3, !r2.test || e2.value)
        return e2.isLoop = true, new Zr(r2.body, e2.scope);
      t3.pop();
    } else if (3 === n2 && (e2.mode_ = 1, r2.update))
      return new Zr(r2.update, e2.scope);
  }, t2.prototype.stepFunctionDeclaration = function(t3, e2, r2) {
    t3.pop();
  }, t2.prototype.stepFunctionExpression = function(t3, e2, r2) {
    t3.pop(), t3[t3.length - 1].value = this.createFunction(r2, e2.scope);
  }, t2.prototype.stepIdentifier = function(e2, r2, n2) {
    if (e2.pop(), r2.components)
      e2[e2.length - 1].value = [t2.SCOPE_REFERENCE, n2.name];
    else {
      var i2 = this.getValueFromScope(n2.name);
      if (i2 && "object" == typeof i2 && i2.isGetter) {
        i2.isGetter = false;
        for (var o2 = r2.scope; !this.hasProperty(o2, n2.name); )
          o2 = o2.parentScope;
        var s2 = i2;
        return this.createGetter_(s2, this.global);
      }
      e2[e2.length - 1].value = i2;
    }
  }, t2.prototype.stepIfStatement = function(t3, e2, r2) {
    return this.stepConditionalExpression(t3, e2, r2);
  }, t2.prototype.stepLabeledStatement = function(t3, e2, r2) {
    t3.pop();
    var n2 = e2.labels || [];
    n2.push(r2.label.name);
    var i2 = new Zr(r2.body, e2.scope);
    return i2.labels = n2, i2;
  }, t2.prototype.stepLiteral = function(t3, e2, r2) {
    t3.pop();
    var n2 = r2.value;
    if (n2 instanceof RegExp) {
      var i2 = this.createObjectProto(this.REGEXP_PROTO);
      this.populateRegExp(i2, n2), n2 = i2;
    }
    t3[t3.length - 1].value = n2;
  }, t2.prototype.stepLogicalExpression = function(t3, e2, r2) {
    if ("&&" !== r2.operator && "||" !== r2.operator)
      throw SyntaxError("Unknown logical operator: " + r2.operator);
    if (!e2.doneLeft_)
      return e2.doneLeft_ = true, new Zr(r2.left, e2.scope);
    if (e2.doneRight_)
      t3.pop(), t3[t3.length - 1].value = e2.value;
    else {
      if (!("&&" === r2.operator && !e2.value || "||" === r2.operator && e2.value))
        return e2.doneRight_ = true, new Zr(r2.right, e2.scope);
      t3.pop(), t3[t3.length - 1].value = e2.value;
    }
  }, t2.prototype.stepMemberExpression = function(t3, e2, r2) {
    if (!e2.doneObject_)
      return e2.doneObject_ = true, new Zr(r2.object, e2.scope);
    var n2;
    if (r2.computed) {
      if (!e2.doneProperty_)
        return e2.object_ = e2.value, e2.doneProperty_ = true, new Zr(r2.property, e2.scope);
      n2 = e2.value;
    } else
      e2.object_ = e2.value, n2 = r2.property.name;
    if (t3.pop(), e2.components)
      t3[t3.length - 1].value = [e2.object_, n2];
    else {
      var i2 = this.getProperty(e2.object_, n2);
      if (i2 && "object" == typeof i2 && i2.isGetter) {
        i2.isGetter = false;
        var o2 = i2;
        return this.createGetter_(o2, e2.object_);
      }
      t3[t3.length - 1].value = i2;
    }
  }, t2.prototype.stepNewExpression = function(t3, e2, r2) {
    return this.stepCallExpression(t3, e2, r2);
  }, t2.prototype.stepObjectExpression = function(t3, e2, r2) {
    var n2 = e2.n_ || 0, i2 = r2.properties[n2];
    if (e2.object_) {
      var o2 = i2.key;
      if ("Identifier" === o2.type)
        var s2 = o2.name;
      else {
        if ("Literal" !== o2.type)
          throw SyntaxError("Unknown object structure: " + o2.type);
        s2 = o2.value;
      }
      e2.properties_[s2] || (e2.properties_[s2] = {}), e2.properties_[s2][i2.kind] = e2.value, e2.n_ = ++n2, i2 = r2.properties[n2];
    } else
      e2.object_ = this.createObjectProto(this.OBJECT_PROTO), e2.properties_ = /* @__PURE__ */ Object.create(null);
    if (i2)
      return new Zr(i2.value, e2.scope);
    for (var a2 in e2.properties_) {
      var u2 = e2.properties_[a2];
      if ("get" in u2 || "set" in u2) {
        var l2 = { configurable: true, enumerable: true, get: u2.get, set: u2.set };
        this.setProperty(e2.object_, a2, null, l2);
      } else
        this.setProperty(e2.object_, a2, u2.init);
    }
    t3.pop(), t3[t3.length - 1].value = e2.object_;
  }, t2.prototype.stepProgram = function(t3, e2, r2) {
    var n2 = e2.n_ || 0, i2 = r2.body[n2];
    if (i2)
      return e2.done = false, e2.n_ = n2 + 1, new Zr(i2, e2.scope);
    e2.done = true;
  }, t2.prototype.stepReturnStatement = function(t3, e2, r2) {
    if (r2.argument && !e2.done_)
      return e2.done_ = true, new Zr(r2.argument, e2.scope);
    var n2 = e2.value, i2 = t3.length - 1;
    for (e2 = t3[i2]; "CallExpression" !== e2.node.type && "NewExpression" !== e2.node.type; ) {
      if ("TryStatement" !== e2.node.type && t3.splice(i2, 1), --i2 < 0)
        throw SyntaxError("Illegal return statement");
      e2 = t3[i2];
    }
    e2.value = n2;
  }, t2.prototype.stepSequenceExpression = function(t3, e2, r2) {
    var n2 = e2.n_ || 0, i2 = r2.expressions[n2];
    if (i2)
      return e2.n_ = n2 + 1, new Zr(i2, e2.scope);
    t3.pop(), t3[t3.length - 1].value = e2.value;
  }, t2.prototype.stepSwitchStatement = function(t3, e2, r2) {
    if (!e2.test_)
      return e2.test_ = 1, new Zr(r2.discriminant, e2.scope);
    for (1 === e2.test_ && (e2.test_ = 2, e2.switchValue_ = e2.value); ; ) {
      var n2 = e2.index_ || 0, i2 = r2.cases[n2];
      if (e2.matched_ || !i2 || i2.test)
        if (i2 || e2.matched_ || !e2.defaultCase_) {
          if (!i2)
            return void t3.pop();
          if (!e2.matched_ && !e2.tested_ && i2.test)
            return e2.tested_ = true, new Zr(i2.test, e2.scope);
          if (e2.matched_ || e2.value === e2.switchValue_) {
            e2.matched_ = true;
            var o2 = e2.n_ || 0;
            if (i2.consequent[o2])
              return e2.isSwitch = true, e2.n_ = o2 + 1, new Zr(i2.consequent[o2], e2.scope);
          }
          e2.tested_ = false, e2.n_ = 0, e2.index_ = n2 + 1;
        } else
          e2.matched_ = true, e2.index_ = e2.defaultCase_;
      else
        e2.defaultCase_ = n2, e2.index_ = n2 + 1;
    }
  }, t2.prototype.stepThisExpression = function(t3, e2, r2) {
    t3.pop(), t3[t3.length - 1].value = this.getValueFromScope("this");
  }, t2.prototype.stepThrowStatement = function(t3, e2, r2) {
    if (!e2.done_)
      return e2.done_ = true, new Zr(r2.argument, e2.scope);
    this.throwException(e2.value);
  }, t2.prototype.stepTryStatement = function(t3, e2, r2) {
    if (!e2.doneBlock_)
      return e2.doneBlock_ = true, new Zr(r2.block, e2.scope);
    if (e2.throwValue && !e2.doneHandler_ && r2.handler) {
      e2.doneHandler_ = true;
      var n2 = new Zr(r2.handler, e2.scope);
      return n2.throwValue = e2.throwValue, e2.throwValue = null, n2;
    }
    if (!e2.doneFinalizer_ && r2.finalizer)
      return e2.doneFinalizer_ = true, new Zr(r2.finalizer, e2.scope);
    e2.throwValue ? this.executeException(e2.throwValue) : t3.pop();
  }, t2.prototype.stepUnaryExpression = function(e2, r2, n2) {
    if (!r2.done_) {
      r2.done_ = true;
      var i2 = new Zr(n2.argument, r2.scope);
      return i2.components = "delete" === n2.operator, i2;
    }
    e2.pop();
    var o2 = r2.value;
    if ("-" === n2.operator)
      o2 = -o2;
    else if ("+" === n2.operator)
      o2 = +o2;
    else if ("!" === n2.operator)
      o2 = !o2;
    else if ("~" === n2.operator)
      o2 = ~o2;
    else if ("delete" === n2.operator) {
      var s2 = true;
      if (Array.isArray(o2)) {
        var a2 = o2[0];
        a2 === t2.SCOPE_REFERENCE && (a2 = r2.scope);
        var u2 = String(o2[1]);
        try {
          delete a2.properties[u2];
        } catch (t3) {
          r2.scope.strict ? this.throwException(this.TYPE_ERROR, "Cannot delete property '" + u2 + "' of '" + a2 + "'") : s2 = false;
        }
      }
      o2 = s2;
    } else if ("typeof" === n2.operator)
      o2 = o2 && "Function" === o2.class ? "function" : typeof o2;
    else {
      if ("void" !== n2.operator)
        throw SyntaxError("Unknown unary operator: " + n2.operator);
      o2 = void 0;
    }
    e2[e2.length - 1].value = o2;
  }, t2.prototype.stepUpdateExpression = function(t3, e2, r2) {
    if (!e2.doneLeft_) {
      e2.doneLeft_ = true;
      var n2 = new Zr(r2.argument, e2.scope);
      return n2.components = true, n2;
    }
    if (e2.leftSide_ || (e2.leftSide_ = e2.value), e2.doneGetter_ && (e2.leftValue_ = e2.value), !e2.doneGetter_) {
      var i2 = this.getValue(e2.leftSide_);
      if (e2.leftValue_ = i2, i2 && "object" == typeof i2 && i2.isGetter) {
        i2.isGetter = false, e2.doneGetter_ = true;
        var o2 = i2;
        return this.createGetter_(o2, e2.leftSide_);
      }
    }
    if (e2.doneSetter_)
      return t3.pop(), void (t3[t3.length - 1].value = e2.doneSetter_);
    var s2;
    if (i2 = Number(e2.leftValue_), "++" === r2.operator)
      s2 = i2 + 1;
    else {
      if ("--" !== r2.operator)
        throw SyntaxError("Unknown update expression: " + r2.operator);
      s2 = i2 - 1;
    }
    var a2 = r2.prefix ? s2 : i2, u2 = this.setValue(e2.leftSide_, s2);
    if (u2)
      return e2.doneSetter_ = a2, this.createSetter_(u2, e2.leftSide_, s2);
    t3.pop(), t3[t3.length - 1].value = a2;
  }, t2.prototype.stepVariableDeclaration = function(t3, e2, r2) {
    var n2 = r2.declarations, i2 = e2.n_ || 0, o2 = n2[i2];
    for (e2.init_ && o2 && (this.setValueToScope(o2.id.name, e2.value), e2.init_ = false, o2 = n2[++i2]); o2; ) {
      if (o2.init)
        return e2.n_ = i2, e2.init_ = true, new Zr(o2.init, e2.scope);
      o2 = n2[++i2];
    }
    t3.pop();
  }, t2.prototype.stepWithStatement = function(t3, e2, r2) {
    if (!e2.doneObject_)
      return e2.doneObject_ = true, new Zr(r2.object, e2.scope);
    if (!e2.doneBody_) {
      e2.doneBody_ = true;
      var n2 = this.createSpecialScope(e2.scope, e2.value);
      return new Zr(r2.body, n2);
    }
    t3.pop();
  }, t2.prototype.stepWhileStatement = function(t3, e2, r2) {
    return this.stepDoWhileStatement(t3, e2, r2);
  }, t2.PARSE_OPTIONS = { ecmaVersion: 5 }, t2.READONLY_DESCRIPTOR = { configurable: true, enumerable: true, writable: false }, t2.NONENUMERABLE_DESCRIPTOR = { configurable: true, enumerable: false, writable: true }, t2.READONLY_NONENUMERABLE_DESCRIPTOR = { configurable: true, enumerable: false, writable: false }, t2.VARIABLE_DESCRIPTOR = { configurable: false, enumerable: true, writable: true }, t2.STEP_ERROR = {}, t2.SCOPE_REFERENCE = {}, t2.toStringCycles_ = [], t2;
}();
var Xr = function() {
  function t2(t3) {
    this.proto = null, this.isObject = true, this.class = "Object", this.data = null, this._native = void 0, this.getter = /* @__PURE__ */ Object.create(null), this.setter = /* @__PURE__ */ Object.create(null), this.properties = /* @__PURE__ */ Object.create(null), this.proto = t3;
  }
  return t2.prototype.toString = function() {
    if ("Array" === this.class) {
      (n2 = Hr.toStringCycles_).push(this);
      try {
        for (var t3 = [], e2 = 0; e2 < this.properties.length; e2++) {
          var r2 = this.properties[e2];
          t3[e2] = r2 && r2.isObject && -1 !== n2.indexOf(r2) ? "..." : r2;
        }
      } finally {
        n2.pop();
      }
      return t3.join(",");
    }
    if ("Error" === this.class) {
      var n2;
      if (-1 !== (n2 = Hr.toStringCycles_).indexOf(this))
        return "[object Error]";
      var i2, o2 = void 0, s2 = this;
      do {
        if ("name" in s2.properties) {
          i2 = s2.properties.name;
          break;
        }
      } while (s2 = s2.proto);
      s2 = this;
      do {
        if ("message" in s2.properties) {
          o2 = s2.properties.message;
          break;
        }
      } while (s2 = s2.proto);
      n2.push(this);
      try {
        i2 = i2 && i2.toString(), o2 = o2 && o2.toString();
      } finally {
        n2.pop();
      }
      return o2 ? i2 + ": " + o2 : String(i2);
    }
    return null !== this.data ? String(this.data) : "[object " + this.class + "]";
  }, t2.prototype.valueOf = function() {
    return void 0 === this.data || null === this.data || this.data instanceof RegExp ? this : this.data instanceof Date ? this.data.valueOf() : this.data;
  }, t2;
}();
var Zr = function(t2, e2) {
  this.node = t2, this.scope = e2;
};
var $r = function(t2, e2) {
  for (var r2 = t2; r2 && r2.prototype; ) {
    if (Object.getOwnPropertyNames(r2.prototype).indexOf(e2) >= 0)
      return true;
    r2 = Object.getPrototypeOf(r2);
  }
  return false;
};
function Qr(t2, e2) {
  var r2 = {}, n2 = jt(t2, { locations: true, onComment: function(t3, e3, n3, i3, o3, s3) {
    r2[s3.line] = e3;
  } });
  if ("Program" !== n2.type || 1 !== n2.body.length || "FunctionDeclaration" !== n2.body[0].type)
    throw new Error("JavaScript program should only have one function definition");
  var i2 = n2.body[0].body.body, o2 = [], s2 = [];
  return i2.forEach(function(t3) {
    if ("ExpressionStatement" === t3.type) {
      var n3 = t3.expression;
      if ("AssignmentExpression" === n3.type && "=" === n3.operator && "MemberExpression" === n3.left.type && "ThisExpression" === n3.left.object.type && "Identifier" === n3.left.property.type) {
        for (var i3 = [], a2 = n3.loc.start.line - 1; a2 >= 0 && void 0 !== r2[a2]; a2--)
          i3.push(r2[a2]);
        if (!(i3.length <= 0)) {
          var u2 = n3.left.property.name;
          if (!(Array.isArray(e2) && e2.indexOf(u2) >= 0) && "FunctionExpression" !== n3.right.type) {
            var l2 = function(t4, e3, r3) {
              var n4 = { name: t4, title: {}, className: null, proposed: false, initialValue: null };
              if (e3.forEach(function(t5) {
                var e4 = t5.indexOf("@ui ");
                if (e4 >= 0)
                  n4.description = t5.substring(e4 + "@ui ".length).trim();
                else {
                  var r4 = t5.indexOf("@title ");
                  if (r4 >= 0) {
                    var i5 = t5.substring(r4 + "@title ".length).trim();
                    0 === i5.indexOf("@ja ") ? n4.title.ja = i5.substring("@ja ".length).trim() : n4.title.default = i5;
                  } else if (t5.indexOf("@proposed") >= 0)
                    n4.proposed = true;
                  else {
                    var o4 = t5.indexOf("@comment ");
                    if (o4 >= 0) {
                      var s4 = t5.substring(o4 + "@comment ".length).trim();
                      return n4.comment || (n4.comment = {}), void (0 === s4.indexOf("@ja ") ? n4.comment.ja = s4.substring("@ja ".length).trim() : n4.comment.default = s4);
                    }
                  }
                }
              }), !n4.description && !n4.comment)
                return null;
              if (n4.proposed || n4.comment)
                return n4;
              var i4 = n4.description.indexOf("("), o3 = n4.description.indexOf(")", i4);
              if (!(i4 < 0 || o3 < 0)) {
                n4.className = n4.description.substr(0, i4);
                try {
                  var s3 = new Hr("[" + n4.description.substr(i4 + 1, o3 - i4 - 1) + "]"), a3 = Date.now();
                  for (s3.unwrap = null, s3.wrap = null; s3.step() && !(Date.now() - a3 > 100); )
                    ;
                  n4.params = s3.pseudoToNative(s3.value);
                } catch (t5) {
                }
                return n4.params || (n4.params = []), n4;
              }
            }(u2, i3);
            s2.push(n3), l2 && o2.push(l2);
          }
        }
      }
    }
  }), { widgets: o2, fields: s2, ast: n2 };
}
function Kr(t2, e2) {
  if (void 0 === e2 && (e2 = -1), !t2)
    return { dependencyAtCursor: null, dependencies: [] };
  for (var r2 = [], n2 = null, i2 = ("string" == typeof t2 ? jt(t2, Hr.PARSE_OPTIONS) : t2).body[0].body.body.slice(0); i2.length > 0; ) {
    var o2 = i2.shift();
    if (null != o2) {
      if ("CallExpression" !== o2.type)
        o2.expression && i2.push(o2.expression), o2.object && i2.push(o2.object), o2.property && i2.push(o2.property), o2.name && "string" != typeof name && i2.push(o2.name), o2.left && i2.push(o2.left), o2.right && i2.push(o2.right), o2.id && i2.push(o2.id), o2.init && i2.push(o2.init), o2.callee && i2.push(o2.callee), o2.body && Array.isArray(o2.body) && i2.push.apply(i2, o2.body), o2.declarations && Array.isArray(o2.declarations) && i2.push.apply(i2, o2.declarations), o2.arguments && Array.isArray(o2.arguments) && i2.push.apply(i2, o2.arguments), o2.params && Array.isArray(o2.params) && i2.push.apply(i2, o2.params);
      else if (o2.callee.name && "require" === o2.callee.name) {
        var s2 = o2.arguments;
        if (s2 && Array.isArray(s2) && 1 === s2.length) {
          var a2 = s2[0];
          if ("Literal" === a2.type) {
            var u2 = a2.value;
            r2.push(u2), o2.start && o2.end && o2.start <= e2 && o2.end >= e2 && (n2 = u2);
          }
        }
      }
    }
  }
  return { dependencyAtCursor: n2, dependencies: r2 };
}
Hr.Object = Xr, Hr.State = Zr;
var tn = function() {
  return tn = Object.assign || function(t2) {
    for (var e2, r2 = 1, n2 = arguments.length; r2 < n2; r2++)
      for (var i2 in e2 = arguments[r2])
        Object.prototype.hasOwnProperty.call(e2, i2) && (t2[i2] = e2[i2]);
    return t2;
  }, tn.apply(this, arguments);
};
function en(t2, e2, r2) {
  if (r2 || 2 === arguments.length)
    for (var n2, i2 = 0, o2 = e2.length; i2 < o2; i2++)
      !n2 && i2 in e2 || (n2 || (n2 = Array.prototype.slice.call(e2, 0, i2)), n2[i2] = e2[i2]);
  return t2.concat(n2 || Array.prototype.slice.call(e2));
}
function rn(t2) {
  return "boolean" == typeof t2 || "number" == typeof t2 || "string" == typeof t2 || null == t2;
}
var nn = { type: "ExpressionStatement", start: null, end: null, expression: { type: "CallExpression", start: null, end: null, expression: null, arguments: null }, arguments: null };
var on = function() {
  function t2(t3, e2, r2) {
    void 0 === r2 && (r2 = null), this.wrapperTable = t3, this.ignoredPropNames = e2, this.wrapMethodParameter = r2, this.verbose = false, this.initialize();
  }
  return t2.prototype.initialize = function() {
    var t3 = this, e2 = new Hr("", function(e3, r2) {
      t3.globalScope = r2;
    });
    this.interpreter = e2, this.interpreter.wrap = function(e3) {
      return t3.wrap(e3);
    }, this.interpreter.unwrap = function(e3, r2) {
      return t3.unwrap(e3, r2);
    }, this.wrappers = {}, Object.keys(this.wrapperTable).forEach(function(e3) {
      return t3.wrapClass(t3.wrapperTable[e3], e3);
    });
  }, t2.prototype.createGlobalFunction = function(t3, e2) {
    var r2, n2 = this, i2 = e2.func, o2 = e2.raw, s2 = e2.isConstructor, a2 = e2.async, u2 = function() {
      for (var t4 = [], e3 = 0; e3 < arguments.length; e3++)
        t4[e3] = arguments[e3];
      var r3 = i2(o2 ? t4 : t4.map(function(e4, r4) {
        return r4 < t4.length - 1 || !a2 ? n2.unwrap(e4) : e4;
      }));
      return o2 ? r3 : n2.wrap(r3);
    };
    r2 = a2 ? this.interpreter.createAsyncFunction(u2) : this.interpreter.createNativeFunction(u2, s2), this.interpreter.setProperty(this.globalScope, t3, r2);
  }, t2.prototype.createFunction = function(t3, e2) {
    return void 0 === e2 && (e2 = false), this.interpreter.createNativeFunction(t3, e2);
  }, t2.prototype.setProperty = function(t3, e2, r2) {
    this.interpreter.setProperty(t3, e2, this.wrap(r2));
  }, t2.prototype.setRawProperty = function(t3, e2, r2) {
    this.interpreter.setProperty(t3, e2, r2);
  }, t2.prototype.getProperty = function(t3, e2) {
    return this.unwrap(this.interpreter.getProperty(t3, e2));
  }, t2.prototype.getRawProperty = function(t3, e2) {
    return this.interpreter.getProperty(t3, e2);
  }, t2.prototype.prepareRun = function(t3) {
    var e2;
    e2 = "string" == typeof t3 ? jt(t3, Hr.PARSE_OPTIONS) : t3;
    var r2 = this.interpreter.createScope(e2, this.globalScope);
    return this.interpreter.stateStack = [{ node: e2, scope: r2, done: false }], r2;
  }, t2.prototype.newStatementFor = function(t3) {
    return jt("new " + t3 + "();", Hr.PARSE_OPTIONS);
  }, t2.prototype.prepareNewInstance = function(t3, e2) {
    var r2 = this.interpreter.createScope(jt("", Hr.PARSE_OPTIONS), e2);
    return this.interpreter.stateStack = [{ node: t3, scope: r2, thisExpression: r2 }], r2;
  }, t2.prototype.exec = function(t3, e2, r2, n2) {
    var i2 = this, o2 = this.interpreter;
    nn.expression.arguments = [];
    var s2 = [];
    return r2.forEach(function(t4) {
      nn.expression.arguments.push(null), s2.push(i2.wrap(t4));
    }), o2.stateStack = [{ node: { type: "Program", body: [nn] }, scope: this.globalScope, done: true, n_: 1 }, { node: nn, scope: this.globalScope, done_: true }, { node: nn.expression, doneCallee_: 2, doneArgs_: true, arguments_: s2, funcThis_: t3, func_: o2.getProperty(t3, e2), scope: t3, n_: s2.length, value: [t3, e2] }], this.run(700, "call a method (" + t3.className + "." + e2 + (n2 || "") + ")");
  }, t2.prototype.run = function(t3, e2) {
    var r2 = this.interpreter, n2 = Date.now(), i2 = false;
    try {
      for (; r2.step(); )
        if (Date.now() - n2 > t3) {
          i2 = true;
          break;
        }
    } catch (o3) {
      throw this.verbose && console.log(r2.stateStack), "string" == typeof o3 && (o3 = new Error(o3)), r2.stateStack.length > 0 && (o3.node = r2.stateStack[r2.stateStack.length - 1].node), o3;
    }
    if (i2) {
      var o2 = new Error("timeout: spent too long time (> " + t3 + "ms) to " + e2);
      throw r2.stateStack.length > 0 && (o2.node = r2.stateStack[0].node), o2;
    }
    return this.interpreter.value;
  }, t2.prototype.cleanupProperties = function(t3) {
    if (!t3)
      return null;
    for (var e2 in this.ignoredPropNames.forEach(function(e3) {
      void 0 !== t3.properties[e3] && delete t3.properties[e3];
    }), t3.properties)
      this.cleanupProperty(t3.properties[e2]) || delete t3.properties[e2];
    return t3.properties;
  }, t2.prototype.cleanupProperty = function(t3) {
    if (rn(t3))
      return true;
    var e2 = t3;
    if (e2._native)
      return true;
    var r2 = this.globalScope.properties;
    if (e2.parent === r2.Array) {
      for (var n2 = e2.length, i2 = 0; i2 < e2.length; i2++)
        this.cleanupProperty(e2.properties[i2]) || (delete e2.properties[i2], n2--);
      return e2.length = n2, n2 > 0;
    }
    if (e2.parent === r2.Object) {
      var o2 = true;
      for (var s2 in e2.properties)
        this.cleanupProperty(e2.properties[s2]) ? o2 = false : delete e2.properties[s2];
      return !o2;
    }
    return false;
  }, t2.prototype.restoreProperties = function(t3, e2) {
    e2 && (t3.properties = tn(tn({}, t3.properties), e2));
  }, t2.prototype.wrap = function(t3) {
    if ("object" == typeof t3 && null !== t3 && void 0 !== t3.constructor && "string" == typeof t3.constructor.className) {
      var e2 = t3.constructor.className, r2 = this.wrappers[e2];
      if (void 0 === r2)
        return;
      var n2 = this.interpreter.createObject(r2);
      return n2._native = t3, n2;
    }
    return this.verbose && (rn(t3) || Array.isArray(t3) || console.log("wrap complex obj:", String(t3))), this.interpreter.nativeToPseudo(t3);
  }, t2.prototype.unwrap = function(t3, e2) {
    return "object" == typeof t3 && null !== t3 && t3._native ? t3._native : this.interpreter.pseudoToNative(t3, e2);
  }, t2.prototype.wrapClass = function(t3, e2) {
    this.verbose && console.log("--- wrapping " + e2 + " ---"), t3.className = e2;
    var r2 = this, n2 = this.interpreter.createNativeFunction(function(e3) {
      var i2, o2;
      if (i2 = r2.interpreter.calledWithNew() ? this : r2.interpreter.createObjectProto(n2.properties.prototype), void 0 !== e3)
        if (Array.isArray(e3))
          for (var s2 = 0; s2 < e3.length; s2++)
            o2[s2] = r2.unwrap(e3[s2]);
        else
          o2 = r2.unwrap(e3);
      if (t3) {
        var a2 = Object.create(t3.prototype), u2 = t3.apply(a2, [null].concat(o2).splice(1));
        i2._native = null !== u2 && "object" == typeof u2 ? u2 : a2;
      }
      return i2;
    });
    return this.interpreter.setProperty(this.globalScope, e2, n2), this.wrapStaticMembers(n2, t3), this.wrapInstanceMembers(n2, t3), this.wrappers[e2] = n2, n2;
  }, t2.prototype.wrapStaticMembers = function(t3, e2) {
    var r2 = this, n2 = function(n3) {
      var o3 = n3;
      if (i2.interpreter.setProperty(t3, n3, ReferenceError, { get: function() {
        return r2.wrap(e2[o3]);
      }, set: function(t4) {
        return e2[o3] = r2.unwrap(t4);
      } }), i2.verbose) {
        var s2 = void 0;
        try {
          s2 = typeof e2[o3];
        } catch (t4) {
          s2 = "not accessible";
        }
        console.log("static " + o3 + " (" + s2 + ")");
      }
    }, i2 = this;
    for (var o2 in e2)
      n2(o2);
  }, t2.prototype.wrapInstanceMembers = function(t3, e2) {
    for (var r2, n2 = new e2(), i2 = 0, o2 = en(en([], Object.keys(n2), true), function(t4) {
      for (var e3 = t4, r3 = []; e3 && e3.prototype; )
        r3 = en(en([], r3, true), Object.getOwnPropertyNames(e3.prototype), true), e3 = Object.getPrototypeOf(e3);
      return r3;
    }(e2), true).filter(function(t4, e3, r3) {
      return r3.indexOf(t4) === e3;
    }); i2 < o2.length; i2++) {
      var s2 = o2[i2];
      if ("constructor" !== s2 && !this.interpreter.hasProperty(t3, s2) && !this.interpreter.hasProperty(t3.properties.prototype, s2) && "_" !== s2.charAt(0)) {
        if (this.verbose) {
          var a2 = void 0;
          try {
            a2 = typeof n2[s2];
          } catch (t4) {
            a2 = "not accessible";
          }
          r2 = s2 + " (" + a2 + ")";
        }
        try {
          if ("function" == typeof n2[s2]) {
            var u2 = /* @__PURE__ */ function(e3, r3) {
              return function(n3) {
                var i3;
                return r3.wrap((i3 = this._native)[e3].apply(i3, n3.map(function(e4) {
                  var n4 = r3.unwrap(e4);
                  return r3.wrapMethodParameter ? r3.wrapMethodParameter(t3, n4) : n4;
                })));
              };
            }(s2, this);
            this.interpreter.setProperty(t3.properties.prototype, s2, this.interpreter.createNativeFunction(u2)), this.verbose && (r2 += " native method");
          }
        } catch (t4) {
        }
        this.verbose && console.log(r2);
      }
    }
  }, t2;
}();
function sn(t2) {
  var e2 = parseFloat(t2);
  return isNaN(e2) ? 0 : e2;
}
function an(t2) {
  var e2;
  if (!(null === (e2 = null === window || void 0 === window ? void 0 : window.location) || void 0 === e2 ? void 0 : e2.search))
    return null;
  for (var r2 = 0, n2 = window.location.search.substring(1).split("&"); r2 < n2.length; r2++) {
    var i2 = n2[r2].split("=");
    if (decodeURIComponent(i2[0]) === t2)
      return decodeURIComponent(i2[1]);
  }
  return null;
}
Object.freeze({ __proto__: null, cancelIdleCallback: function(t2) {
  return window.cancelIdleCallback ? window.cancelIdleCallback(t2) : clearTimeout(t2);
}, requestIdleCallback: function(t2, e2) {
  if (window.requestIdleCallback)
    return window.requestIdleCallback(t2, e2);
  var r2 = Date.now(), n2 = e2 ? e2.timeout : 50;
  return setTimeout(function() {
    t2({ didTimeout: false, timeRemaining: function() {
      return Math.max(0, n2 - (Date.now() - r2));
    } });
  }, 1);
}, getNumber: sn, getQueryVariable: an });
var un = function(t2, e2) {
  return un = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function(t3, e3) {
    t3.__proto__ = e3;
  } || function(t3, e3) {
    for (var r2 in e3)
      Object.prototype.hasOwnProperty.call(e3, r2) && (t3[r2] = e3[r2]);
  }, un(t2, e2);
};
function ln(t2, e2) {
  if ("function" != typeof e2 && null !== e2)
    throw new TypeError("Class extends value " + String(e2) + " is not a constructor or null");
  function r2() {
    this.constructor = t2;
  }
  un(t2, e2), t2.prototype = null === e2 ? Object.create(e2) : (r2.prototype = e2.prototype, new r2());
}
var cn = function() {
  return cn = Object.assign || function(t2) {
    for (var e2, r2 = 1, n2 = arguments.length; r2 < n2; r2++)
      for (var i2 in e2 = arguments[r2])
        Object.prototype.hasOwnProperty.call(e2, i2) && (t2[i2] = e2[i2]);
    return t2;
  }, cn.apply(this, arguments);
};
function pn(t2, e2, r2, n2) {
  return new (r2 || (r2 = Promise))(function(i2, o2) {
    function s2(t3) {
      try {
        u2(n2.next(t3));
      } catch (t4) {
        o2(t4);
      }
    }
    function a2(t3) {
      try {
        u2(n2.throw(t3));
      } catch (t4) {
        o2(t4);
      }
    }
    function u2(t3) {
      var e3;
      t3.done ? i2(t3.value) : (e3 = t3.value, e3 instanceof r2 ? e3 : new r2(function(t4) {
        t4(e3);
      })).then(s2, a2);
    }
    u2((n2 = n2.apply(t2, e2 || [])).next());
  });
}
function hn(t2, e2) {
  var r2, n2, i2, o2, s2 = { label: 0, sent: function() {
    if (1 & i2[0])
      throw i2[1];
    return i2[1];
  }, trys: [], ops: [] };
  return o2 = { next: a2(0), throw: a2(1), return: a2(2) }, "function" == typeof Symbol && (o2[Symbol.iterator] = function() {
    return this;
  }), o2;
  function a2(o3) {
    return function(a3) {
      return function(o4) {
        if (r2)
          throw new TypeError("Generator is already executing.");
        for (; s2; )
          try {
            if (r2 = 1, n2 && (i2 = 2 & o4[0] ? n2.return : o4[0] ? n2.throw || ((i2 = n2.return) && i2.call(n2), 0) : n2.next) && !(i2 = i2.call(n2, o4[1])).done)
              return i2;
            switch (n2 = 0, i2 && (o4 = [2 & o4[0], i2.value]), o4[0]) {
              case 0:
              case 1:
                i2 = o4;
                break;
              case 4:
                return s2.label++, { value: o4[1], done: false };
              case 5:
                s2.label++, n2 = o4[1], o4 = [0];
                continue;
              case 7:
                o4 = s2.ops.pop(), s2.trys.pop();
                continue;
              default:
                if (!((i2 = (i2 = s2.trys).length > 0 && i2[i2.length - 1]) || 6 !== o4[0] && 2 !== o4[0])) {
                  s2 = 0;
                  continue;
                }
                if (3 === o4[0] && (!i2 || o4[1] > i2[0] && o4[1] < i2[3])) {
                  s2.label = o4[1];
                  break;
                }
                if (6 === o4[0] && s2.label < i2[1]) {
                  s2.label = i2[1], i2 = o4;
                  break;
                }
                if (i2 && s2.label < i2[2]) {
                  s2.label = i2[2], s2.ops.push(o4);
                  break;
                }
                i2[2] && s2.ops.pop(), s2.trys.pop();
                continue;
            }
            o4 = e2.call(t2, s2);
          } catch (t3) {
            o4 = [6, t3], n2 = 0;
          } finally {
            r2 = i2 = 0;
          }
        if (5 & o4[0])
          throw o4[1];
        return { value: o4[0] ? o4[1] : void 0, done: true };
      }([o3, a3]);
    };
  }
}
function dn(t2, e2, r2) {
  if (r2 || 2 === arguments.length)
    for (var n2, i2 = 0, o2 = e2.length; i2 < o2; i2++)
      !n2 && i2 in e2 || (n2 || (n2 = Array.prototype.slice.call(e2, 0, i2)), n2[i2] = e2[i2]);
  return t2.concat(n2 || Array.prototype.slice.call(e2));
}
var fn;
var yn = [0, 0, 0, 0];
var vn = function() {
  function t2() {
    this._position = 0, this._wait = 50, this.update = this.update.bind(this);
  }
  return Object.defineProperty(t2.prototype, "wait", { get: function() {
    return this._wait;
  }, set: function(t3) {
    this._wait = t3, this._isPlaying && this.start();
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "isPlaying", { get: function() {
    return this._isPlaying;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "position", { get: function() {
    if (!this.isPlaying)
      return this._position;
    var t3 = this.basePosition.position + (Date.now() - this.basePosition.time);
    return Math.min(t3, this.player.video.duration);
  }, enumerable: false, configurable: true }), t2.prototype.initialize = function(t3) {
    var e2 = t3.player, r2 = t3.updater, n2 = t3.emitter;
    return pn(this, void 0, void 0, function() {
      return hn(this, function(t4) {
        return this.player = e2, this.updateMediaPosition = r2, this.emitter = n2, [2];
      });
    });
  }, t2.prototype.play = function() {
    this.start(), this.emitter.onPlay();
  }, t2.prototype.stop = function() {
    this.clearInterval(), this._isPlaying = false, this.seek(0), this.pause(), this.emitter.onStop();
  }, t2.prototype.pause = function() {
    this.clearInterval(), this._isPlaying = false, this.emitter.onPause();
  }, t2.prototype.seek = function(t3) {
    var e2 = this;
    this._position = t3, this.updateMediaPosition(t3).then(function() {
      e2.emitter.onSeek(t3), e2.emitter.onSeekComplete(t3);
    }), this.isPlaying && this.start();
  }, t2.prototype.dispose = function() {
    this.clearInterval();
  }, t2.prototype.clearInterval = function() {
    window.clearInterval(this.intervalId);
  }, t2.prototype.start = function() {
    this.clearInterval(), this._isPlaying = true, this.basePosition = { time: Date.now(), position: this._position }, this.intervalId = window.setInterval(this.update, this.wait);
  }, t2.prototype.update = function() {
    this.player.video || this.stop();
    var t3 = this.basePosition.position + (Date.now() - this.basePosition.time);
    this._position = Math.min(t3, this.player.video.duration), this.updateMediaPosition(this.position), this._position >= this.player.video.duration && this.stop();
  }, t2;
}();
function gn() {
  return pn(this, void 0, void 0, function() {
    return hn(this, function(t2) {
      return fn && fn.Player ? [2, fn] : "undefined" == typeof window ? [2, import("./main-KKQPZE3T.js")] : window.Songle && window.Songle.Player ? [2, window.Songle] : [2, new Promise(function(t3) {
        var e2 = false;
        window.onSongleAPIReady = function(r2) {
          e2 = true, t3(fn = r2);
        }, setTimeout(function() {
          if (!e2) {
            var t4 = [];
            document.querySelectorAll("script").forEach(function(e3) {
              var r3 = e3.getAttribute("src");
              r3 && r3.indexOf("songle.jp/v2/api.js") >= 0 && t4.push(e3);
            }), t4.forEach(function(t5) {
              return t5.parentElement.removeChild(t5);
            });
            var r2 = document.createElement("script");
            r2.src = "https://api.songle.jp/v2/api.js", document.head.appendChild(r2);
          }
        }, 1e3);
      })];
    });
  });
}
var mn = function() {
  function t2(t3) {
    void 0 === t3 && (t3 = {}), this.options = t3, this.wait = 50, this.volumeListener = { onVolumeUpdate: this.onVolumeUpdate.bind(this) }, this.resetProps();
  }
  return Object.defineProperty(t2.prototype, "songlePlayer", { get: function() {
    return this._songlePlayer;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "isPlaying", { get: function() {
    return !!this._songlePlayer && this._songlePlayer.isPlaying;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "withSync", { get: function() {
    var t3, e2;
    return !(!(null === (t3 = this.options) || void 0 === t3 ? void 0 : t3.accessToken) && !(null === (e2 = this.options) || void 0 === e2 ? void 0 : e2.secretToken));
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "position", { get: function() {
    var t3;
    if (!this._songlePlayer)
      return 0;
    if (this.lastPosition > 0 && this.lastTime > 0)
      return Date.now() + this.lastPosition - this.lastTime;
    var e2 = this._songlePlayer.positionTime;
    if ("songle-api-html-media-element-media" === (null === (t3 = this._songlePlayer.media) || void 0 === t3 ? void 0 : t3.dispatcherName)) {
      var r2 = this.lastTime, n2 = this.lastPosition, i2 = void 0;
      if (r2 > 0) {
        var o2 = Date.now() - r2;
        i2 = Math.max(0, this.wait - o2);
      } else
        i2 = this.wait;
      0 === n2 && e2 >= 500 ? e2 = 0 : 0 === r2 && e2 - n2 >= 800 && (e2 = n2 + i2);
    }
    return e2;
  }, enumerable: false, configurable: true }), t2.prototype.initialize = function(t3) {
    var e2, r2, n2, i2 = t3.player, o2 = t3.updater, s2 = t3.emitter, a2 = t3.altSourceUrl;
    return pn(this, void 0, void 0, function() {
      var t4, l2, c2;
      return hn(this, function(p2) {
        switch (p2.label) {
          case 0:
            return this.player && this.player.removeListener(this.volumeListener), this.player = i2, this.player.addListener(this.volumeListener), this.updateMediaPosition = o2, this.emitter = s2, this._songlePlayer ? [3, 2] : [4, this.initializeSonglePlayer()];
          case 1:
            p2.sent(), p2.label = 2;
          case 2:
            return t4 = this.options.headless, l2 = a2 || this.options.altSourceUrls && (null === (e2 = this.player.data.song) || void 0 === e2 ? void 0 : e2.permalink) && this.options.altSourceUrls[null === (r2 = this.player.data.song) || void 0 === r2 ? void 0 : r2.permalink] || void 0, u.isUploaderUrl(l2) && (l2 = u.getAltSongUrlFromUploaderGuid(u.getUploaderGuid(u.getSongPathFromUrl(l2)))), (c2 = (null === (n2 = this.player.data.song) || void 0 === n2 ? void 0 : n2.permalink) || l2) === l2 && (l2 = void 0), [4, this._songlePlayer.useMedia(c2, { headless: t4, altSourceUrl: l2 })];
          case 3:
            return p2.sent(), this.ignoreSonglePlayerEvents = true, this._songlePlayer.volume = 0 * (1 - this.player.volume / 100) + 100 * this.player.volume / 100, this._songlePlayer.play(), this._songlePlayer.stop(), this.ignoreSonglePlayerEvents = false, this.resetProps(), [2];
        }
      });
    });
  }, t2.prototype.resetProps = function() {
    this.lastPosition = 0, this.lastTime = 0, this.elapsedTimes = [];
  }, t2.prototype.initializeSonglePlayer = function() {
    var t3;
    return pn(this, void 0, void 0, function() {
      var e2, r2, n2, i2, o2, s2, a2, u2 = this;
      return hn(this, function(l2) {
        switch (l2.label) {
          case 0:
            return e2 = this.options, r2 = e2.accessToken, n2 = e2.secretToken, (o2 = this.options.songle) ? [3, 2] : [4, gn()];
          case 1:
            o2 = l2.sent(), l2.label = 2;
          case 2:
            return (i2 = o2).System && (i2.System.showLicense = false), s2 = null === (t3 = this.options) || void 0 === t3 ? void 0 : t3.autoUseMedia, this._songlePlayer = this.withSync ? new i2.SyncPlayer({ mediaElement: this.player.mediaSourceElement, accessToken: r2, secretToken: n2, autoUseMedia: s2 }) : new i2.Player({ mediaElement: this.player.mediaSourceElement }), a2 = false, this._songlePlayer.on("play", function() {
              u2.ignoreSonglePlayerEvents || (a2 = false, u2.handler || (u2.startPolling(), u2.emitter.onPlay()));
            }), this._songlePlayer.on("pause", function() {
              return pn(u2, void 0, void 0, function() {
                return hn(this, function(t4) {
                  switch (t4.label) {
                    case 0:
                      return this.ignoreSonglePlayerEvents ? [2] : (a2 = false, this.stopPolling(), this.emitter.onPause(), this.stopping ? (this.stopping = false, [4, this.updateMediaPosition(0)]) : [3, 2]);
                    case 1:
                      t4.sent(), this.resetProps(), this.emitter.onStop(), t4.label = 2;
                    case 2:
                      return [2];
                  }
                });
              });
            }), this._songlePlayer.on("finish", function() {
              return pn(u2, void 0, void 0, function() {
                return hn(this, function(t4) {
                  switch (t4.label) {
                    case 0:
                      return a2 = false, this.handler ? (this.stopPolling(), [4, this.updateMediaPosition(0)]) : [3, 2];
                    case 1:
                      t4.sent(), this.emitter.onStop(), t4.label = 2;
                    case 2:
                      return [2];
                  }
                });
              });
            }), this._songlePlayer.on("seek", function(t4) {
              var e3 = t4.data;
              return pn(u2, void 0, void 0, function() {
                return hn(this, function(t5) {
                  switch (t5.label) {
                    case 0:
                      return this._songlePlayer.isPlaying ? [3, 2] : (a2 = false, [4, this.updateMediaPosition(e3.positionTime)]);
                    case 1:
                      return t5.sent(), this.emitter.onSeekComplete(e3.positionTime), [3, 4];
                    case 2:
                      return a2 = true, [4, this.updateMediaPosition(this._songlePlayer.positionTime)];
                    case 3:
                      t5.sent(), t5.label = 4;
                    case 4:
                      return [2];
                  }
                });
              });
            }), this._songlePlayer.on("mediaSeek", function() {
              a2 && (u2.emitter.onSeekComplete(u2.position), a2 = false);
            }), this.withSync && (this._songlePlayer.on("mediaPlay", function() {
              u2.handler || (u2.startPolling(), u2.emitter.onPlay());
            }), this._songlePlayer.on("mediaFinish", function() {
              u2.handler && (u2.stopPolling(), u2.emitter.onStop());
            })), [2];
        }
      });
    });
  }, t2.prototype.play = function() {
    if (this._songlePlayer)
      return this._songlePlayer.play();
    this.emitter.onPlay();
  }, t2.prototype.stop = function() {
    if (this._songlePlayer)
      return this.stopping = this._songlePlayer.isPlaying, this._songlePlayer.stop();
    this.emitter.onStop();
  }, t2.prototype.pause = function() {
    if (this._songlePlayer)
      return this.stopping = false, this._songlePlayer.pause();
    this.emitter.onPause();
  }, t2.prototype.seek = function(t3) {
    var e2 = this;
    this._songlePlayer ? (this._songlePlayer.seekTo(t3), this.emitter.onSeek(t3)) : this.updateMediaPosition(t3).then(function() {
      e2.emitter.onSeek(t3);
    });
  }, t2.prototype.startPolling = function() {
    var t3, e2 = this;
    if (this.lastTime > 0) {
      var r2 = Date.now() - this.lastTime;
      t3 = Math.max(0, this.wait - r2);
    } else
      t3 = this.wait;
    this.handler = setTimeout(function() {
      return pn(e2, void 0, void 0, function() {
        var e3, r3, n2, i2, o2, s2, a2, u2, l2;
        return hn(this, function(c2) {
          switch (c2.label) {
            case 0:
              return r3 = (e3 = this).lastTime, n2 = e3.lastPosition, i2 = this._songlePlayer.positionTime, o2 = false, "songle-api-html-media-element-media" === (null === (l2 = this._songlePlayer.media) || void 0 === l2 ? void 0 : l2.dispatcherName) && (0 === n2 && i2 >= 500 ? (i2 = 0, o2 = true) : 0 === r3 && i2 - n2 >= 800 && (i2 = n2 + t3, o2 = true)), s2 = r3 > 0 ? Date.now() - r3 : t3, this.updateElapsedTimes(s2), a2 = n2 > 0 ? n2 + s2 : i2, u2 = Math.abs(i2 - a2), (a2 = u2 > 2 * this.wait ? i2 : a2 <= i2 ? 0.5 * (a2 + i2) : Math.max(n2, i2)) < this.lastPosition && (this.lastPosition - a2 > 5 * this.wait || (a2 = this.lastPosition)), o2 || (this.lastTime = Date.now()), this.lastPosition = a2, [4, this.updateMediaPosition(a2)];
            case 1:
              return c2.sent(), this.handler && this.startPolling(), [2];
          }
        });
      });
    }, t3);
  }, t2.prototype.updateElapsedTimes = function(t3) {
    if (this.elapsedTimes.unshift(t3), this.elapsedTimes = this.elapsedTimes.slice(0, 10), this.elapsedTimes.length >= 10) {
      var e2 = this.elapsedTimes.reduce(function(t4, e3) {
        return t4 + e3;
      }) / 10;
      e2 > 5 * this.wait && (this.player.stageScale = Math.max(0.25, 0.9 * this.player.stageScale), this.elapsedTimes = []), e2 < 1.2 * this.wait && this.player.stageScale < 1 && (this.player.stageScale = Math.min(1, this.player.stageScale / 0.9), this.elapsedTimes = []);
    }
  }, t2.prototype.stopPolling = function() {
    var t3;
    if (this.handler) {
      if (clearTimeout(this.handler), this._songlePlayer)
        if ("songle-api-html-media-element-media" === (null === (t3 = this._songlePlayer.media) || void 0 === t3 ? void 0 : t3.dispatcherName)) {
          var e2 = this.lastTime, r2 = this.lastPosition, n2 = Date.now() - e2;
          this.lastPosition = r2 + n2;
        } else
          this.lastPosition = this._songlePlayer.positionTime;
      this.lastTime = 0;
    }
    this.handler = null;
  }, t2.prototype.dispose = function() {
    this.player && this.player.removeListener(this.volumeListener), this._songlePlayer && (this._songlePlayer.stop(), this._songlePlayer = null);
  }, t2.prototype.onVolumeUpdate = function(t3) {
    this._songlePlayer && (this._songlePlayer.volume = t3);
  }, t2;
}();
var bn = function() {
  function t2(t3) {
    this.listeners = [], this.throttleInterval = t3 && t3.throttleInterval ? Number(t3.throttleInterval) : 100;
  }
  return t2.prototype.onVideoLoad = function(t3, e2) {
    this.listeners.forEach(function(r2) {
      return r2.onVideoLoad && r2.onVideoLoad(t3, e2);
    });
  }, t2.prototype.onSongLoad = function(t3, e2) {
    this.listeners.forEach(function(r2) {
      return r2.onSongLoad && r2.onSongLoad(t3, e2);
    });
  }, t2.prototype.onSongMapLoad = function(t3, e2) {
    this.listeners.forEach(function(r2) {
      return r2.onSongMapLoad && r2.onSongMapLoad(t3, e2);
    });
  }, t2.prototype.onSongInfoLoad = function(t3, e2) {
    var r2 = false;
    this.listeners.forEach(function(n2) {
      n2.onSongInfoLoad && (n2.onSongInfoLoad(t3, e2), r2 = true);
    }), r2 && console.warn('[TextAlive API] "onSongInfoLoad" event is deprecated; use "onSongMapLoad" event instead');
  }, t2.prototype.onVocalAmplitudeLoad = function(t3, e2) {
    this.listeners.forEach(function(r2) {
      return r2.onVocalAmplitudeLoad && r2.onVocalAmplitudeLoad(t3, e2);
    });
  }, t2.prototype.onValenceArousalLoad = function(t3, e2) {
    this.listeners.forEach(function(r2) {
      return r2.onValenceArousalLoad && r2.onValenceArousalLoad(t3, e2);
    });
  }, t2.prototype.onLyricsLoad = function(t3, e2) {
    this.listeners.forEach(function(r2) {
      return r2.onLyricsLoad && r2.onLyricsLoad(t3, e2);
    });
  }, t2.prototype.onTextLoad = function(t3, e2) {
    this.listeners.forEach(function(r2) {
      return r2.onTextLoad && r2.onTextLoad(t3, e2);
    });
  }, t2.prototype.onAppLoad = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onAppLoad && e2.onAppLoad(t3);
    });
  }, t2.prototype.onAppReady = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onAppReady && e2.onAppReady(t3);
    });
  }, t2.prototype.onAppParameterUpdate = function(t3, e2) {
    this.listeners.forEach(function(r2) {
      return r2.onAppParameterUpdate && r2.onAppParameterUpdate(t3, e2);
    });
  }, t2.prototype.onAppMediaChange = function(t3, e2) {
    this.listeners.forEach(function(r2) {
      return r2.onAppMediaChange && r2.onAppMediaChange(t3, e2);
    });
  }, t2.prototype.onTemplateUpdate = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onTemplateUpdate && e2.onTemplateUpdate(t3);
    });
  }, t2.prototype.onTemplateCommit = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onTemplateCommit && e2.onTemplateCommit(t3);
    });
  }, t2.prototype.onTemplatesLoad = function(t3, e2) {
    this.listeners.forEach(function(r2) {
      return r2.onTemplatesLoad && r2.onTemplatesLoad(t3, e2);
    });
  }, t2.prototype.onFontsLoad = function(t3, e2) {
    this.listeners.forEach(function(r2) {
      return r2.onFontsLoad && r2.onFontsLoad(t3, e2);
    });
  }, t2.prototype.onVideoReady = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onVideoReady && e2.onVideoReady(t3);
    });
  }, t2.prototype.onTimerReady = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onTimerReady && e2.onTimerReady(t3);
    });
  }, t2.prototype.onStageElementSet = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onStageElementSet && e2.onStageElementSet(t3);
    });
  }, t2.prototype.onMediaElementSet = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onMediaElementSet && e2.onMediaElementSet(t3);
    });
  }, t2.prototype.onTimeUpdate = function(t3) {
    var e2 = this;
    this.listeners.forEach(function(e3) {
      return e3.onTimeUpdate && e3.onTimeUpdate(t3);
    }), this.position = t3, this.throttledTimeUpdate || (this.throttledTimeUpdate = new Promise(function(t4, r2) {
      setTimeout(function() {
        e2.onThrottledTimeUpdate(e2.position), e2.throttledTimeUpdate = null, t4();
      }, e2.throttleInterval);
    }));
  }, t2.prototype.onThrottledTimeUpdate = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onThrottledTimeUpdate && e2.onThrottledTimeUpdate(t3);
    });
  }, t2.prototype.onBackgroundGraphicsUpdate = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onBackgroundGraphicsUpdate && e2.onBackgroundGraphicsUpdate(t3);
    });
  }, t2.prototype.onMediaSeek = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onMediaSeek && e2.onMediaSeek(t3);
    });
  }, t2.prototype.onVideoSeekStart = function() {
    this.listeners.forEach(function(t3) {
      return t3.onVideoSeekStart && t3.onVideoSeekStart();
    });
  }, t2.prototype.onVideoSeekEnd = function() {
    this.listeners.forEach(function(t3) {
      return t3.onVideoSeekEnd && t3.onVideoSeekEnd();
    });
  }, t2.prototype.onVideoSeek = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onVideoSeek && e2.onVideoSeek(t3);
    });
  }, t2.prototype.onPlay = function() {
    this.listeners.forEach(function(t3) {
      return t3.onPlay && t3.onPlay();
    });
  }, t2.prototype.onPause = function() {
    this.listeners.forEach(function(t3) {
      return t3.onPause && t3.onPause();
    });
  }, t2.prototype.onSeek = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onSeek && e2.onSeek(t3);
    });
  }, t2.prototype.onSeekComplete = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onSeekComplete && e2.onSeekComplete(t3);
    });
  }, t2.prototype.onStop = function() {
    this.listeners.forEach(function(t3) {
      return t3.onStop && t3.onStop();
    });
  }, t2.prototype.onDispose = function() {
    this.listeners.forEach(function(t3) {
      return t3.onDispose && t3.onDispose();
    });
  }, t2.prototype.onResize = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onResize && e2.onResize(t3);
    });
  }, t2.prototype.onVolumeUpdate = function(t3) {
    this.listeners.forEach(function(e2) {
      return e2.onVolumeUpdate && e2.onVolumeUpdate(t3);
    });
  }, t2.prototype.addListener = function(t3) {
    !t3 || this.listeners.indexOf(t3) >= 0 || this.listeners.push(t3);
  }, t2.prototype.removeListener = function(t3) {
    var e2 = false;
    return this.listeners = this.listeners.filter(function(r2) {
      var n2 = r2 === t3;
      return e2 = e2 || n2, !n2;
    }), e2;
  }, t2;
}();
var _n = function() {
  function t2(t3, e2, r2) {
    var n2 = this;
    this.player = t3, this.manager = e2, this.emitter = r2, this._defaultBackgroundCss = null, this._background = null, t3.addListener({ onStageElementSet: function(t4) {
      return n2.doUpdateBackground(n2.background);
    } });
  }
  return Object.defineProperty(t2.prototype, "background", { get: function() {
    return this._background;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "defaultBackgroundCss", { get: function() {
    return this._defaultBackgroundCss ? this._defaultBackgroundCss : "";
  }, set: function(t3) {
    this._defaultBackgroundCss = t3, this.updateBackground(this._background);
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "ready", { get: function() {
    return null !== this._background;
  }, enumerable: false, configurable: true }), t2.prototype.settingBackground = function(t3) {
    return pn(this, void 0, void 0, function() {
      return hn(this, function(e2) {
        switch (e2.label) {
          case 0:
            return [4, this.doSetBackground(t3)];
          case 1:
            return [2, e2.sent() && this.doUpdateBackground(t3)];
        }
      });
    });
  }, t2.prototype.setBackground = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2;
      return hn(this, function(r2) {
        switch (r2.label) {
          case 0:
            return [4, this.doSetBackground(t3)];
          case 1:
            return [2, (e2 = r2.sent()) && this.updateBackground(e2)];
        }
      });
    });
  }, t2.prototype.doSetBackground = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2, r2, n2;
      return hn(this, function(i2) {
        switch (i2.label) {
          case 0:
            return e2 = t3 && t3.originalUrl ? t3.originalUrl : "", this.manager.isBackgroundColorAsset(t3) ? [2, { css: e2, originalUrl: e2 }] : this.manager.isBackgroundPiaproImageAsset(t3) ? [4, this.manager.read(e2)] : [3, 2];
          case 1:
            return (r2 = i2.sent()) && r2.url && this.manager.checkBackgroundImageLicense(r2.license) ? (r2.originalUrl = e2, t3 && (r2.x = t3.x, r2.y = t3.y), [2, r2]) : [2, { css: "", originalUrl: e2, x: t3 ? t3.x : void 0, y: t3 ? t3.y : void 0, license: r2 ? r2.license : void 0 }];
          case 2:
            return this.manager.isBackgroundSpecialImageAsset(t3) ? [2, { css: 'url("https://api.textalive.jp/images/backgrounds/snowmiku2016/' + (n2 = /^snowmiku2016-([0-9]{2})$/.exec(e2))[1] + '.jpg")', contentUrl: "https://api.textalive.jp/images/backgrounds/snowmiku2016/" + n2[1] + ".jpg", url: "https://snowmiku.com/2016/info_chara.html", name: "SNOW MIKU 2016", authorName: "", originalUrl: e2, x: t3 ? t3.x : void 0, y: t3 ? t3.y : void 0, defaultY: 0 }] : [2, { originalUrl: null, css: "", x: t3 ? t3.x : void 0, y: t3 ? t3.y : void 0 }];
        }
      });
    });
  }, t2.prototype.updateBackground = function(t3) {
    return !!this.doUpdateBackground(t3) && (this.emitter && this.emitter.onBackgroundGraphicsUpdate && this.emitter.onBackgroundGraphicsUpdate(t3), true);
  }, t2.prototype.doUpdateBackground = function(t3) {
    if (!t3)
      return false;
    if (!this.player.stageElement)
      return this._background = t3, true;
    var e2 = this.player.stageElement.style;
    return t3.css.length <= 0 ? e2.background = this.defaultBackgroundCss : e2.background = t3.css, "number" == typeof t3.x || this._background && "number" == typeof this._background.x ? ("number" != typeof t3.x && (t3.x = this._background.x), e2.backgroundPositionX = e2.backgroundPositionX + "%") : e2.backgroundPositionX = "number" == typeof t3.defaultX ? t3.defaultX + "%" : "center", "number" == typeof t3.y || this._background && "number" == typeof this._background.y ? ("number" != typeof t3.y && (t3.y = this._background.y), e2.backgroundPositionY = e2.backgroundPositionY + "%") : e2.backgroundPositionY = "number" == typeof t3.defaultY ? t3.defaultY + "%" : "center", e2.backgroundSize = "cover", this._background = t3, true;
  }, t2.prototype.export = function() {
    if (!this.background || !this.background.originalUrl)
      return null;
    var t3 = { originalUrl: this.background.originalUrl };
    return void 0 !== this.background.x && (t3.x = this.background.x), void 0 !== this.background.y && (t3.y = this.background.y), t3;
  }, t2.prototype.exportPartialVideoEntry = function(t3) {
    return { background: this.export() };
  }, t2;
}();
function wn(t2, e2, r2) {
  return pn(this, void 0, void 0, function() {
    var n2, i2, o2, s2, a2, u2, l2, c2, p2, h2, d2, f2, y2, v2;
    return hn(this, function(g2) {
      switch (g2.label) {
        case 0:
          if (n2 = { loaded: [], failed: [] }, "undefined" == typeof window || !window.document || !window.document.head)
            return n2.failed = t2.slice(), [2, n2];
          for (i2 = r2.split("").filter(function(t3, e3, r3) {
            return r3.indexOf(t3) === e3;
          }).sort(), o2 = true, s2 = 0, i2.forEach(function(t3) {
            var r3 = e2.indexOf(t3, s2);
            o2 = o2 && r3 >= 0, s2 = r3;
          }), a2 = window.document.head, u2 = [], l2 = 0; l2 < a2.children.length; l2++)
            "link" === (c2 = a2.children.item(l2)).tagName.toLowerCase() && "stylesheet" === c2.getAttribute("rel") && u2.push(c2.getAttribute("href"));
          p2 = [], h2 = [], d2 = [], t2.forEach(function(t3) {
            if (t3.google)
              d2.push(t3.key);
            else {
              var e3 = o2 && t3.compactUrl || t3.url;
              u2.includes(e3) || (h2.push(t3.en), p2.push(e3));
            }
          }), f2 = { classes: false, active: null, inactive: null, fontactive: function(e3) {
            n2.loaded.push(t2.find(function(t3) {
              return t3.en === e3;
            })), n2.failed = n2.failed.filter(function(t3) {
              return t3.en !== e3;
            });
          }, fontinactive: function(e3) {
            n2.failed.push(t2.find(function(t3) {
              return t3.en === e3;
            }));
          }, timeout: 5e3 }, d2.length > 0 && (f2.google = { families: d2 }), h2.length > 0 && (f2.custom = { families: h2, urls: p2 }), g2.label = 1;
        case 1:
          return g2.trys.push([1, 5, , 6]), (v2 = "undefined" != typeof window && (null === window || void 0 === window ? void 0 : window.WebFont)) ? [3, 3] : [4, import("./webfontloader-JIROIJKH.js")];
        case 2:
          v2 = g2.sent(), g2.label = 3;
        case 3:
          return y2 = v2, [4, new Promise(function(t3) {
            f2.active = f2.inactive = t3, y2.load(f2);
          })];
        case 4:
        case 5:
          return g2.sent(), [3, 6];
        case 6:
          return [2, n2];
      }
    });
  });
}
function Pn(t2, e2) {
  return pn(this, void 0, void 0, function() {
    var r2, n2, i2, o2, s2, a2, u2, l2;
    return hn(this, function(c2) {
      switch (c2.label) {
        case 0:
          if (r2 = { loaded: [], failed: [] }, !("undefined" != typeof window && window.document && window.document.head && window.Ts && window.Ts.loadFontAsync))
            return r2.failed = t2.slice(), [2, r2];
          for (n2 = window.document.head, i2 = {}, o2 = function(t3) {
            var e3 = n2.children.item(t3);
            if ("style" !== e3.tagName.toLowerCase() || "text/css" !== e3.getAttribute("type") || "stylesheet" !== e3.getAttribute("rel") || !e3.hasAttribute("data-cssName"))
              return "continue";
            var r3 = e3.getAttribute("data-cssName");
            if (void 0 === i2[r3])
              return i2[r3] = new Set(e3.getAttribute("data-text")), { value: void 0 };
            e3.getAttribute("data-text").split("").forEach(function(t4) {
              return i2[r3].add(t4);
            });
          }, s2 = 0; s2 < n2.children.length; s2++)
            if ("object" == typeof (a2 = o2(s2)))
              return [2, a2.value];
          return u2 = window.Ts, l2 = [], t2.forEach(function(t3) {
            var n3 = new Set(e2 + t3.en + t3.ja);
            i2[t3.en] && i2[t3.en].forEach(function(t4) {
              return n3.delete(t4);
            }), n3.size <= 0 ? r2.loaded.push(t3) : l2.push(new Promise(function(e3) {
              return function(t4, e4, r3, n4, i3) {
                var o3 = e4.en;
                t4.loadFontAsync({ cssName: o3, text: n4, outputType: "json", callback: function(t5) {
                  try {
                    !function(t6, e5, r4) {
                      var n5 = JSON.parse(r4), i4 = JSON.parse(n5.res), o4 = document.createElement("style");
                      o4.setAttribute("data-cssName", t6), o4.setAttribute("data-text", e5), o4.setAttribute("type", "text/css"), o4.setAttribute("rel", "stylesheet"), o4.innerHTML = "@font-face {font-family: '" + i4.fontFamily + "';font-weight: " + i4["font-weight"] + ";src: url(data:font/woff;base64," + i4.src + ");}", document.head.appendChild(o4);
                    }(o3, n4, t5.data), r3.loaded.push(e4);
                  } catch (t6) {
                    r3.failed.push(e4);
                  }
                  i3();
                } });
              }(u2, t3, r2, Array.from(n3.values()).join(""), e3);
            }));
          }), [4, Promise.all(l2)];
        case 1:
          return c2.sent(), [2, r2];
      }
    });
  });
}
var En = function(t2) {
  function e2(e3, r2) {
    var n2 = this.constructor, i2 = t2.call(this, e3) || this;
    return i2.fonts = r2, Object.setPrototypeOf(i2, n2.prototype), i2;
  }
  return ln(e2, t2), e2;
}(Error);
var On = function() {
  function t2(t3, e2, r2) {
    this.fontInfoManager = t3, this.textFetcher = e2, this.listener = r2, this._failed = [], this._loaded = [];
  }
  return Object.defineProperty(t2.prototype, "failed", { get: function() {
    return this._failed;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "loaded", { get: function() {
    return this._loaded;
  }, enumerable: false, configurable: true }), t2.prototype.loadAll = function() {
    return pn(this, void 0, void 0, function() {
      var t3;
      return hn(this, function(e2) {
        switch (e2.label) {
          case 0:
            return [4, this.listAvailableFonts()];
          case 1:
            return t3 = e2.sent(), [2, this.loadFonts(t3)];
        }
      });
    });
  }, t2.prototype.loadForVideo = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2, r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return (e2 = this.listFontFamiliesInVideo(t3)) ? [4, this.listAvailableFonts()] : (this.listener && this.listener.onFontsLoad && this.listener.onFontsLoad(this.loaded), [2, Promise.resolve(this.loaded)]);
          case 1:
            return r2 = n2.sent(), [2, this.loadFonts(r2.filter(function(t4) {
              return e2.indexOf(t4.en) >= 0;
            }))];
        }
      });
    });
  }, t2.prototype.listFontFamiliesInVideo = function(t3) {
    if (!t3 || !t3.phrases)
      return null;
    var e2 = [];
    return t3.phrases.forEach(function(t4) {
      return t4.words.forEach(function(t5) {
        return t5.characters.forEach(function(t6) {
          return e2.push(t6.fontFamily);
        });
      });
    }), e2.filter(function(t4, e3, r2) {
      return r2.indexOf(t4) === e3;
    });
  }, t2.prototype.listAvailableFonts = function() {
    return pn(this, void 0, void 0, function() {
      return hn(this, function(t3) {
        return [2, this.fontInfoManager.listAvailableFonts()];
      });
    });
  }, t2.prototype.isLoading = function() {
    return !!this.queue;
  }, t2.prototype.load = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2, r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return e2 = [], r2 = [], t3.forEach(function(t4) {
              "string" == typeof t4 ? e2.push(t4) : r2.push(t4);
            }), [4, this.fontInfoManager.listAvailableFonts()];
          case 1:
            return n2.sent().forEach(function(t4) {
              e2.indexOf(t4.key) >= 0 && r2.push(t4);
            }), [2, this.loadFonts(r2)];
        }
      });
    });
  }, t2.prototype.loadFonts = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2 = this;
      return hn(this, function(r2) {
        return this.queue ? (this.listener && this.listener.onFontsLoad && this.listener.onFontsLoad(null, new En("Failed to load some fonts because there is an ongoing font loding process", this.failed.slice())), [2, this.loaded]) : (this.queue = this.doLoad(t3).then(function(t4) {
          return e2.queue = null, t4;
        }), [2, this.queue]);
      });
    });
  }, t2.prototype.doLoad = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2, r2, n2, i2, o2 = this;
      return hn(this, function(s2) {
        switch (s2.label) {
          case 0:
            return e2 = [], r2 = [], [4, this.fontInfoManager.getFrequentChars()];
          case 1:
            return n2 = s2.sent(), t3.forEach(function(t4) {
              t4.typesquare || t4.typekit || e2.push(t4), t4.typesquare && r2.push(t4);
            }), i2 = (this.textFetcher && this.textFetcher() || "").split("").filter(function(t4, e3, r3) {
              return r3.indexOf(t4) === e3;
            }).sort().join(""), [2, Promise.all([wn(e2, n2, i2), Pn(r2, i2)]).then(function(t4) {
              var e3 = t4[0], r3 = t4[1], n3 = e3.loaded.concat(r3.loaded);
              if (o2.addLoadedFonts(n3), e3.failed.length > 0 || r3.failed.length > 0) {
                var i3 = e3.failed.concat(r3.failed);
                o2.addFailedFonts(i3), o2.listener && o2.listener.onFontsLoad && o2.listener.onFontsLoad(null, new En("Failed to load some fonts", o2.failed.slice()));
              } else
                o2.listener && o2.listener.onFontsLoad && o2.listener.onFontsLoad(n3);
              return o2.loaded;
            }).catch(function(t4) {
              return o2.listener && o2.listener.onFontsLoad && o2.listener.onFontsLoad(null, new En(t4, o2.failed.slice())), o2.loaded;
            })];
        }
      });
    });
  }, t2.prototype.addLoadedFonts = function(t3) {
    var e2 = this;
    this._loaded = this.loaded.concat(t3.filter(function(t4) {
      return e2.failed.findIndex(function(e3) {
        return e3.key === t4.key;
      }) < 0;
    }));
  }, t2.prototype.addFailedFonts = function(t3) {
    var e2 = this;
    this._failed = this.failed.concat(t3.filter(function(t4) {
      return e2.failed.findIndex(function(e3) {
        return e3.key === t4.key;
      }) < 0;
    }));
  }, t2;
}();
var Sn = function() {
  function t2() {
  }
  return Object.defineProperty(t2.prototype, "duration", { get: function() {
    return this.endTime - this.startTime;
  }, enumerable: false, configurable: true }), t2.prototype.contains = function(t3) {
    return t3 >= this.startTime && t3 <= this.endTime;
  }, t2.prototype.overlaps = function(t3, e2) {
    return this.contains(t3) || this.contains(e2) || this.startTime <= t3 && this.endTime >= e2;
  }, t2.prototype.progress = function(t3) {
    return this.contains(t3) ? this.startTime === this.endTime ? 0 : (t3 - this.startTime) / (this.endTime - this.startTime) : -1;
  }, t2;
}();
var Tn = function(t2) {
  function e2() {
    var e3 = t2.call(this) || this;
    return e3.previous = e3.next = null, e3;
  }
  return ln(e2, t2), Object.defineProperty(e2.prototype, "endTime", { get: function() {
    return this.next ? this.next.startTime : this.startTime;
  }, enumerable: false, configurable: true }), e2;
}(Sn);
var xn = function(t2) {
  function e2() {
    var e3 = t2.call(this) || this;
    return e3.previous = e3.next = null, e3;
  }
  return ln(e2, t2), e2;
}(Sn);
var An = function(t2) {
  function e2() {
    var e3 = t2.call(this) || this;
    return e3.previous = e3.next = null, e3;
  }
  return ln(e2, t2), e2;
}(Sn);
var Rn = function(t2) {
  function e2() {
    var e3 = t2.call(this) || this;
    return e3.previous = e3.next = null, e3;
  }
  return ln(e2, t2), e2;
}(Sn);
var Cn = function() {
  function t2(t3) {
    var e2 = t3.analysis, r2 = t3.info;
    this.beats = [], this.chords = [], this.segments = [], this.voice = [], this._revisions = { beatId: r2.beatRevisionId, chordId: r2.chordRevisionId, repetitiveSegmentId: r2.chorusRevisionId }, this.parseBeats(e2.beats), this.parseSegments(e2.repetitive_segment), this.parseChords(e2.chords), e2.voice && this.parseVoice(e2.voice);
  }
  return Object.defineProperty(t2.prototype, "revisions", { get: function() {
    return this._revisions;
  }, enumerable: false, configurable: true }), t2.prototype.parseBeats = function(t3) {
    var e2 = this;
    if (Array.isArray(t3) && Array.isArray(t3[0])) {
      var r2 = null, n2 = 0;
      t3[0].forEach(function(t4) {
        var i2 = new Tn();
        i2.startTime = 1e3 * t4[0], i2.length = t4[2], i2.position = t4[3], i2.previous = r2, null !== r2 && (r2.next = i2), i2.index = n2++, e2.beats.push(i2), r2 = i2;
      }), null !== r2 && (r2.next = null);
    }
  }, t2.prototype.parseChords = function(t3) {
    var e2 = this;
    if (Array.isArray(t3)) {
      var r2 = null, n2 = 0;
      t3.forEach(function(t4) {
        var i2 = new xn();
        i2.startTime = 1e3 * t4[0], i2.endTime = 1e3 * t4[1], i2.name = t4[2], i2.previous = r2, null !== r2 && (r2.next = i2), i2.index = n2++, e2.chords.push(i2), r2 = i2;
      }), null !== r2 && (r2.next = null);
    }
  }, t2.prototype.parseSegments = function(t3) {
    var e2 = this;
    Array.isArray(t3) && t3.forEach(function(t4) {
      var r2 = { chorus: !!t4.chorus, duration: 10 * t4.segment_length, segments: null }, n2 = null, i2 = 0;
      r2.segments = t4.start_frames.map(function(t5) {
        var e3 = new An();
        return e3.startTime = 10 * t5, e3.endTime = e3.startTime + r2.duration, e3.previous = n2, null !== n2 && (n2.next = e3), e3.index = i2++, n2 = e3, e3;
      }), null !== n2 && (n2.next = null), e2.segments.push(r2);
    });
  }, t2.prototype.parseVoice = function(t3) {
    var e2 = this;
    Array.isArray(t3) && t3.forEach(function(t4) {
      var r2 = [], n2 = null, i2 = 0, o2 = 0;
      t4.forEach(function(t5) {
        var e3 = new Rn();
        e3.startTime = o2, e3.endTime = e3.startTime + 10 * t5[1], e3.f0 = t5[0][0], e3.initialF0 = t5[0][1], e3.previous = n2, null !== n2 && (n2.next = e3), e3.index = i2++, r2.push(e3), n2 = e3, o2 = e3.endTime;
      }), null !== n2 && (n2.next = null), e2.voice.push(r2);
    });
  }, t2;
}();
function Nn(t2, e2, r2) {
  for (var n2 = r2 && "number" != typeof e2 ? r2(e2) : e2, i2 = 0, o2 = t2.length; i2 < o2; ) {
    var s2 = i2 + o2 >>> 1;
    (r2 ? r2(t2[s2]) : t2[s2]) < n2 ? i2 = s2 + 1 : o2 = s2;
  }
  return i2;
}
var kn = function() {
  function t2(t3) {
    var e2 = t3.song, r2 = t3.analysis, n2 = t3.vocalAmplitude, i2 = t3.maxVocalAmplitude, o2 = t3.valenceArousal;
    this._song = e2, this._analysis = r2, this._vocalAmplitude = n2, this._maxVocalAmplitude = i2, this._valenceArousal = o2;
  }
  return Object.defineProperty(t2.prototype, "song", { get: function() {
    return this._song;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "analysis", { get: function() {
    return this._analysis;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "vocalAmplitude", { get: function() {
    return this._vocalAmplitude;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "maxVocalAmplitude", { get: function() {
    return this._maxVocalAmplitude;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "valenceArousal", { get: function() {
    return this._valenceArousal;
  }, enumerable: false, configurable: true }), t2.prototype.getChoruses = function() {
    var t3;
    if (!this._analysis)
      return [];
    var e2 = this._analysis.segments.filter(function(t4) {
      return t4.chorus;
    });
    return e2.length <= 0 ? [] : (null === (t3 = e2[0].segments) || void 0 === t3 ? void 0 : t3.slice()) || [];
  }, t2.prototype.findChorus = function(t3, e2) {
    var r2 = [];
    if (this._analysis) {
      var n2 = this._analysis.segments.filter(function(t4) {
        return t4.chorus;
      });
      if (n2.length <= 0)
        return null;
      r2 = n2[0].segments;
    }
    return rt(r2, t3, e2);
  }, t2.prototype.findChorusBetween = function(t3, e2) {
    return this.findChorus(t3, { endTime: e2 });
  }, t2.prototype.getBeats = function() {
    var t3;
    return this._analysis && (null === (t3 = this._analysis.beats) || void 0 === t3 ? void 0 : t3.slice()) || [];
  }, t2.prototype.findBeat = function(t3, e2) {
    return this._analysis ? rt(this._analysis.beats, t3, e2) : null;
  }, t2.prototype.getChords = function() {
    var t3;
    return this._analysis && (null === (t3 = this._analysis.chords) || void 0 === t3 ? void 0 : t3.slice()) || [];
  }, t2.prototype.findChord = function(t3, e2) {
    return this._analysis ? rt(this._analysis.chords, t3, e2) : null;
  }, t2.prototype.getVocalFrequency = function(t3) {
    var e2;
    if (!Array.isArray(null === (e2 = this._analysis) || void 0 === e2 ? void 0 : e2.voice))
      return -1;
    var r2 = this._analysis.voice[0];
    if (r2.length <= 0)
      return -1;
    var n2 = Nn(r2, t3, function(t4) {
      return t4.endTime;
    });
    return r2[n2].contains(t3) ? r2[n2].f0 : -1;
  }, t2.prototype.getVocalAmplitude = function(t3) {
    var e2 = this._vocalAmplitude, r2 = Math.round(t3 / 10);
    return !Array.isArray(this._vocalAmplitude) || r2 < 0 || r2 >= e2.length ? -1 : this._vocalAmplitude[r2];
  }, t2.prototype.getMaxVocalAmplitude = function() {
    return "number" == typeof this._maxVocalAmplitude ? this._maxVocalAmplitude : -1;
  }, t2.prototype.getValenceArousal = function(t3) {
    var e2 = this._valenceArousal;
    if (!e2)
      return null;
    var r2 = Nn(e2.seq, t3, function(t4) {
      return 1e3 * t4.t[1];
    });
    if (r2 < 0)
      return { a: e2.seq[0].a, v: e2.seq[0].v };
    if (r2 + 1 >= e2.seq.length || t3 < 1e3 * e2.seq[r2 + 1].t[0])
      return { a: e2.seq[Math.min(r2, e2.seq.length - 1)].a, v: e2.seq[Math.min(r2, e2.seq.length - 1)].v };
    var n2 = e2.seq[r2], i2 = e2.seq[r2 + 1], o2 = t3 / 1e3, s2 = i2.t[0], a2 = n2.t[1], u2 = a2 - s2;
    return { a: (n2.a * (a2 - o2) + i2.a * (o2 - s2)) / u2, v: (n2.v * (a2 - o2) + i2.v * (o2 - s2)) / u2 };
  }, t2.prototype.getMedianValenceArousal = function() {
    var t3 = this._valenceArousal;
    return t3 ? t3.stats.median : null;
  }, t2;
}();
var jn = function() {
  function t2(t3, e2, r2) {
    this.songManager = t3, this.options = r2, this.listener = e2;
  }
  return Object.defineProperty(t2.prototype, "song", { get: function() {
    return this._song;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "analysis", { get: function() {
    return this._analysis;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "vocalAmplitude", { get: function() {
    return this._vocalAmplitude;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "maxVocalAmplitude", { get: function() {
    return this._maxVocalAmplitude;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "valenceArousal", { get: function() {
    return this._valenceArousal;
  }, enumerable: false, configurable: true }), t2.prototype.loadSong = function(t3, e2) {
    var r2, n2, i2;
    return pn(this, void 0, void 0, function() {
      var o2, s2;
      return hn(this, function(a2) {
        switch (a2.label) {
          case 0:
            return "number" == typeof t3 && t3 < 0 || !t3 ? (this.onSongLoad(null, new Error("Neither Songle ID or code provided")), [2, null]) : [4, this.songManager.load("number" == typeof t3 ? { id: t3 } : { code: t3 })];
          case 1:
            return o2 = a2.sent(), this.onSongLoad(o2, o2 ? void 0 : new Error("Song data not found")), o2 ? (s2 = { chord: null == e2 ? void 0 : e2.chordId, beat: null == e2 ? void 0 : e2.beatId, chorus: null == e2 ? void 0 : e2.repetitiveSegmentId }, [4, Promise.all([(null === (r2 = this.options) || void 0 === r2 ? void 0 : r2.vocalFrequencyEnabled) ? this.loadSongDetailInfo(o2.song.code, { revisions: s2 }) : this.loadSongInfo(o2.song.code, { revisions: s2 }), (null === (n2 = this.options) || void 0 === n2 ? void 0 : n2.vocalAmplitudeEnabled) ? this.loadVocalAmplitude(o2.song.code) : Promise.resolve(null), (null === (i2 = this.options) || void 0 === i2 ? void 0 : i2.valenceArousalEnabled) ? this.loadValenceArousal(o2.song.code) : Promise.resolve(null)])]) : [2, null];
          case 2:
            return a2.sent(), [2, new kn(this)];
        }
      });
    });
  }, t2.prototype.onSongLoad = function(t3, e2) {
    this._song = t3, this.listener && this.listener.onSongLoad && this.listener.onSongLoad(t3, e2);
  }, t2.prototype.loadSongInfo = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this.songManager.loadInfo(String(t3), e2)];
          case 1:
            return r2 = n2.sent(), this.onSongMapLoad(r2, r2 ? void 0 : new Error("Song analysis data not found")), [2, r2];
        }
      });
    });
  }, t2.prototype.loadSongDetailInfo = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this.songManager.loadDetailInfo(String(t3), e2)];
          case 1:
            return r2 = n2.sent(), this.onSongMapLoad(r2, r2 ? void 0 : new Error("Song analysis data not found")), [2, r2];
        }
      });
    });
  }, t2.prototype.mockSongInfo = function(t3) {
    var e2 = function(t4) {
      for (var e3 = t4.beat, r2 = t4.chorusSegment, n2 = t4.duration, i2 = [], o2 = 0; 60 * o2 / e3.bpm < n2 / 1e3; )
        i2.push([60 * o2 / e3.bpm, 1, e3.length, o2 % e3.length + 1, 1]), o2++;
      return { beats: [i2], chords: null, repetitive_segment: [{ chorus: true, index: 0, segment_length: r2.duration / 10, start_frames: r2.startTimes.map(function(t5) {
        return t5 / 10;
      }) }], voice: null };
    }(t3);
    return this._song = null, this.onSongMapLoad({ analysis: e2, info: null }), new kn(this);
  }, t2.prototype.onSongMapLoad = function(t3, e2) {
    var r2, n2;
    this._analysis = new Cn(t3), (null === (r2 = this.listener) || void 0 === r2 ? void 0 : r2.onSongMapLoad) && this.listener.onSongMapLoad(this._analysis, e2), (null === (n2 = this.listener) || void 0 === n2 ? void 0 : n2.onSongInfoLoad) && this.listener.onSongInfoLoad(t3, e2);
  }, t2.prototype.loadVocalAmplitude = function(t3) {
    var e2;
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return r2 = this, [4, this.songManager.loadVocalAmplitude(String(t3))];
          case 1:
            return r2._vocalAmplitude = n2.sent(), this._maxVocalAmplitude = Math.max.apply(Math, this._vocalAmplitude), (null === (e2 = this.listener) || void 0 === e2 ? void 0 : e2.onVocalAmplitudeLoad) && this.listener.onVocalAmplitudeLoad(this._vocalAmplitude, this._vocalAmplitude ? void 0 : new Error("Vocal amplitude data not found")), [2, this._vocalAmplitude];
        }
      });
    });
  }, t2.prototype.loadValenceArousal = function(t3) {
    var e2;
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return r2 = this, [4, this.songManager.loadValenceArousal(String(t3))];
          case 1:
            return r2._valenceArousal = n2.sent(), (null === (e2 = this.listener) || void 0 === e2 ? void 0 : e2.onValenceArousalLoad) && this.listener.onValenceArousalLoad(this._valenceArousal, this._valenceArousal ? void 0 : new Error("Valence arousal data not found")), [2, this._valenceArousal];
        }
      });
    });
  }, t2;
}();
var In = function() {
  function t2(t3, e2, r2) {
    this.managers = t3, this.listener = e2, this.options = r2;
  }
  return t2.prototype.loadRawText = function(t3) {
    var e2;
    return e2 = !t3.phrases || t3.phrases.length < 0 ? "" : t3.phrases.map(function(t4) {
      return t4.words.map(function(t5) {
        return t5.characters.map(function(t6) {
          return t6.char;
        }).join("");
      }).join("");
    }).join(""), this.onTextLoad({ text: e2 }), { lyricsId: -1, lyrics: null, lyricsBody: { text: e2, artist: null, name: null, url: null } };
  }, t2.prototype.loadLyrics = function(t3) {
    var e2 = t3.songCode, r2 = t3.lyricId, n2 = void 0 === r2 ? -1 : r2, i2 = t3.lyricDiffId, o2 = void 0 === i2 ? -1 : i2, s2 = t3.altLyricsUrl, a2 = t3.directAccess;
    return pn(this, void 0, void 0, function() {
      var t4, r3, i3, u2;
      return hn(this, function(l2) {
        switch (l2.label) {
          case 0:
            return n2 <= 0 ? (0 === n2 ? this.onLyricsLoad(null, new Error("Lyrics not loaded")) : this.onLyricsLoad(null, new Error("Lyrics not found")), [2, null]) : [4, this.managers.lyrics.loadDiff(e2, n2, o2)];
          case 1:
            return (null == (t4 = l2.sent()) ? void 0 : t4.data) ? (r3 = cn(cn({}, t4), { processing: false, failed: false, id: n2, diff: { id: o2 } }), this.onLyricsLoad(r3), s2 || a2 ? [3, 3] : [4, this.managers.lyrics.fetchLocalLyricBody(n2)]) : (this.onLyricsLoad(null, new Error("Lyrics timing information not found")), [2, null]);
          case 2:
            i3 = l2.sent(), l2.label = 3;
          case 3:
            if (null == i3 ? void 0 : i3.text)
              return [3, 7];
            l2.label = 4;
          case 4:
            return l2.trys.push([4, 6, , 7]), [4, this.loadLyricsText(t4, { altLyricsUrl: s2, directAccess: a2 })];
          case 5:
            return i3 = l2.sent(), [3, 7];
          case 6:
            return u2 = l2.sent(), this.onTextLoad(null, u2), [3, 7];
          case 7:
            return i3 && this.onTextLoad(i3), [2, { lyricsId: r3.id, lyrics: r3, lyricsBody: i3 }];
        }
      });
    });
  }, t2.prototype.loadLyricsText = function(t3, e2) {
    var r2 = void 0 === e2 ? {} : e2, n2 = r2.altLyricsUrl, i2 = r2.directAccess;
    return pn(this, void 0, void 0, function() {
      var e3, r3, o2 = this;
      return hn(this, function(s2) {
        switch (s2.label) {
          case 0:
            return e3 = this.options && "number" == typeof this.options.lyricsFetchTimeout && this.options.lyricsFetchTimeout >= 0, r3 = this.managers.lyrics.fetchLyricBody(n2 || t3.url, { parserPath: t3.parser_path, directAccess: i2 }), [4, e3 ? Promise.race([r3, new Promise(function(t4, e4) {
              return setTimeout(function() {
                return e4(new Error("Fetching lyrics text timeout"));
              }, o2.options.lyricsFetchTimeout);
            })]) : r3];
          case 1:
            return [2, s2.sent()];
        }
      });
    });
  }, t2.prototype.onLyricsLoad = function(t3, e2) {
    this.listener && this.listener.onLyricsLoad && this.listener.onLyricsLoad(t3, e2);
  }, t2.prototype.onTextLoad = function(t3, e2) {
    this.listener && this.listener.onTextLoad && this.listener.onTextLoad(t3, e2);
  }, t2;
}();
var Un = function() {
  function t2(t3) {
    var e2 = t3.video;
    this._video = e2;
  }
  return Object.defineProperty(t2.prototype, "video", { get: function() {
    return this._video;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "data", { get: function() {
    return this._video.json;
  }, enumerable: false, configurable: true }), t2;
}();
var Fn = function() {
  function t2(t3, e2) {
    this.managers = t3, this.listener = e2, this.listener = e2;
  }
  return Object.defineProperty(t2.prototype, "video", { get: function() {
    return this._video;
  }, enumerable: false, configurable: true }), t2.prototype.onVideoLoad = function(t3, e2) {
    var r2 = t3 ? Object.assign(t3, e2) : null;
    return r2 && ("string" == typeof r2.json ? r2.json = JSON.parse(r2.json) : "object" == typeof r2.json && null !== r2.json || (r2.json = {}), "string" == typeof r2.config ? r2.config = JSON.parse(r2.config) : "object" == typeof r2.config && null !== r2.config || (r2.config = {})), this._video = r2, this.listener && this.listener.onVideoLoad && this.listener.onVideoLoad(r2), new Un({ video: r2 });
  }, t2.prototype.createFromVideoId = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this.managers.video.load(t3)];
          case 1:
            return r2 = n2.sent(), [2, this.onVideoLoad(r2, e2)];
        }
      });
    });
  }, t2.prototype.createFromVideo = function(t3, e2) {
    return this.onVideoLoad(t3, e2);
  }, t2.prototype.createFromSongUrl = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      return hn(this, function(r2) {
        return [2, this.createFromSongPath(this.managers.song.getSongPathFromUrl(t3), e2)];
      });
    });
  }, t2.prototype.createFromSongPath = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this.managers.song.load({ songPath: t3 })];
          case 1:
            return (r2 = n2.sent()) ? [2, this.createFromSong(r2.song, e2)] : [2, null];
        }
      });
    });
  }, t2.prototype.createFromSongId = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this.managers.song.load({ id: t3 })];
          case 1:
            return (r2 = n2.sent()) ? [2, this.createFromSong(r2.song, e2)] : [2, null];
        }
      });
    });
  }, t2.prototype.createFromSongCode = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, this.managers.song.load({ code: t3 })];
          case 1:
            return (r2 = n2.sent()) ? [2, this.createFromSong(r2.song, e2)] : [2, null];
        }
      });
    });
  }, t2.prototype.createFromSong = function(t3, e2) {
    var r2;
    return pn(this, void 0, void 0, function() {
      var n2, i2, o2, s2, a2, u2;
      return hn(this, function(l2) {
        switch (l2.label) {
          case 0:
            return n2 = null == e2 ? void 0 : e2.lyricId, i2 = null == e2 ? void 0 : e2.lyricDiffId, "number" != typeof n2 || n2 < 0 ? [4, this.managers.lyrics.load(t3.code)] : [3, 4];
          case 1:
            return o2 = l2.sent(), (a2 = o2 && !o2.status.failed && !o2.status.processing && Array.isArray(o2.lyrics) && o2.lyrics.length > 0) ? [4, this.managers.lyrics.loadDetail(t3.code, o2.lyrics[0].id)] : [3, 3];
          case 2:
            a2 = l2.sent(), l2.label = 3;
          case 3:
            (s2 = a2) && (n2 = s2.id, i2 = null === (r2 = s2.diff) || void 0 === r2 ? void 0 : r2.id), l2.label = 4;
          case 4:
            return "number" != typeof n2 && (n2 = -1), "number" != typeof i2 && (i2 = -1), u2 = { id: -1, sourceId: -1, sourceOriginId: -1, songleId: t3.id, songleCode: t3.code, lyricId: n2, lyricDiffId: i2, title: null, log: null, background: null, config: null, json: null, synthJson: null, author: null, createdDate: null, accessCount: -1, altUrl: null }, [2, this.onVideoLoad(u2, e2)];
        }
      });
    });
  }, t2.prototype.createFromText = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2, n2, i2, o2, s2, a2;
      return hn(this, function(u2) {
        switch (u2.label) {
          case 0:
            return [4, this.managers.text.parse(t3)];
          case 1:
            return r2 = u2.sent(), n2 = r2 && "success" === r2.status ? this.createVideoDataFromParsedText(r2, t3) : this.createVideoDataFromText(t3), i2 = n2[n2.length - 1], o2 = i2 && i2.words[i2.words.length - 1], s2 = o2 && o2.characters[o2.characters.length - 1], a2 = s2 ? s2.endTime : 0, [2, this.createFromJSON({ phrases: n2, startTime: 0, endTime: a2, duration: a2 }, e2)];
        }
      });
    });
  }, t2.prototype.createFromJSON = function(t3, e2) {
    var r2 = { id: -1, sourceId: -1, sourceOriginId: -1, songleId: -1, lyricId: -1, lyricDiffId: -1, title: null, log: null, background: null, config: null, json: t3, synthJson: null, author: null, createdDate: null, accessCount: -1, altUrl: null };
    return this.onVideoLoad(r2, e2);
  }, t2.prototype.createVideoDataFromParsedText = function(t3, e2) {
    var r2 = 0, n2 = e2.split(/\r\n|[\n\v\f\r\x85\u2028\u2029]/);
    return t3.result.map(function(t4, e3) {
      return { words: t4.map(function(t5) {
        return { characters: n2[e3].substr(t5.startPosition, t5.wordLength).split("").map(function(t6) {
          return { char: t6, startTime: 300 * r2, endTime: 300 * ++r2 };
        }), pos: t5.PoS, rawPoS: t5.rawPoS, language: t5.language };
      }), templates: [{ type: "DefaultAlignment" }] };
    });
  }, t2.prototype.createVideoDataFromText = function(t3) {
    for (var e2, r2 = { characters: [] }, n2 = { words: [r2], templates: [{ type: "DefaultAlignment" }] }, i2 = 0, o2 = [n2], s2 = 0; s2 < t3.length; s2++) {
      var a2 = t3.charAt(s2);
      "\n" !== a2 ? " " !== a2 ? (e2 = { char: a2, startTime: 300 * i2, endTime: 300 * ++i2 }, r2.characters.push(e2)) : (r2 = { characters: [] }, n2.words.push(r2)) : (n2 = { words: [r2 = { characters: [] }], templates: [{ type: "DefaultAlignment" }] }, o2.push(n2));
    }
    return r2.characters.length <= 0 && n2.words.pop(), n2.words.length <= 0 && o2.pop(), o2;
  }, t2;
}();
var Ln = function() {
  function t2(t3, e2, r2) {
    var n2 = this;
    void 0 === e2 && (e2 = null), this.managers = t3, this.listener = e2, this.options = r2, this.fontLoader = new On(t3.font, function() {
      return n2.text;
    }, e2);
  }
  return Object.defineProperty(t2.prototype, "permalink", { get: function() {
    var t3;
    return "https://textalive.jp" + ((null === (t3 = this.song) || void 0 === t3 ? void 0 : t3.permalink) ? "/songs/" + encodeURIComponent(u.getSongPathFromUrl(this.song.permalink)) : "");
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "video", { get: function() {
    var t3;
    return null === (t3 = this.videoProvider) || void 0 === t3 ? void 0 : t3.video;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "song", { get: function() {
    var t3, e2;
    return null === (e2 = null === (t3 = this.songProvider) || void 0 === t3 ? void 0 : t3.song) || void 0 === e2 ? void 0 : e2.song;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "songStatus", { get: function() {
    var t3, e2;
    return null === (e2 = null === (t3 = this.songProvider) || void 0 === t3 ? void 0 : t3.song) || void 0 === e2 ? void 0 : e2.status;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "songMap", { get: function() {
    var t3;
    return null === (t3 = this.songProvider) || void 0 === t3 ? void 0 : t3.analysis;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "lyricsId", { get: function() {
    var t3, e2;
    return null === (e2 = null === (t3 = this.textProvider) || void 0 === t3 ? void 0 : t3.lyrics) || void 0 === e2 ? void 0 : e2.id;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "lyrics", { get: function() {
    var t3;
    return null === (t3 = this.textProvider) || void 0 === t3 ? void 0 : t3.lyrics;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "lyricsBody", { get: function() {
    var t3;
    return null === (t3 = this.textProvider) || void 0 === t3 ? void 0 : t3.lyricsBody;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "text", { get: function() {
    var t3, e2;
    return null === (e2 = null === (t3 = this.textProvider) || void 0 === t3 ? void 0 : t3.lyricsBody) || void 0 === e2 ? void 0 : e2.text;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "fonts", { get: function() {
    return this.fontLoader;
  }, enumerable: false, configurable: true }), t2.prototype.createFromVideoId = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return r2 = this, [4, new Fn(this.managers, this.listener).createFromVideoId(t3, e2)];
          case 1:
            return r2.videoProvider = n2.sent(), [2, this.videoProvider];
        }
      });
    });
  }, t2.prototype.createFromVideo = function(t3, e2) {
    return this.videoProvider = new Fn(this.managers, this.listener).createFromVideo(t3, e2), this.videoProvider;
  }, t2.prototype.createFromSongUrl = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return r2 = this, [4, new Fn(this.managers, this.listener).createFromSongUrl(t3, e2)];
          case 1:
            return r2.videoProvider = n2.sent(), [2, this.videoProvider];
        }
      });
    });
  }, t2.prototype.createFromSongPath = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return r2 = this, [4, new Fn(this.managers, this.listener).createFromSongPath(t3, e2)];
          case 1:
            return r2.videoProvider = n2.sent(), [2, this.videoProvider];
        }
      });
    });
  }, t2.prototype.createFromSongId = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return r2 = this, [4, new Fn(this.managers, this.listener).createFromSongId(t3, e2)];
          case 1:
            return r2.videoProvider = n2.sent(), [2, this.videoProvider];
        }
      });
    });
  }, t2.prototype.createFromSongCode = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return r2 = this, [4, new Fn(this.managers, this.listener).createFromSongCode(t3, e2)];
          case 1:
            return r2.videoProvider = n2.sent(), [2, this.videoProvider];
        }
      });
    });
  }, t2.prototype.createFromText = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return r2 = this, [4, new Fn(this.managers, this.listener).createFromText(t3, e2)];
          case 1:
            return r2.videoProvider = n2.sent(), [2, this.videoProvider];
        }
      });
    });
  }, t2.prototype.createFromJSON = function(t3, e2) {
    return this.videoProvider = new Fn(this.managers, this.listener).createFromJSON(t3, e2), this.videoProvider;
  }, t2.prototype.finalize = function(t3) {
    return pn(this, void 0, void 0, function() {
      return hn(this, function(e2) {
        switch (e2.label) {
          case 0:
            return this.video ? [4, this.loadSong()] : [2, null];
          case 1:
            return e2.sent(), [4, this.loadText(t3)];
          case 2:
            return e2.sent(), [4, this.loadFonts()];
          case 3:
            return e2.sent(), [2];
        }
      });
    });
  }, t2.prototype.mockSongInfo = function(t3) {
    this.songProvider = new jn(this.managers.song, this.listener, this.options).mockSongInfo(t3);
  }, t2.prototype.loadSong = function() {
    return pn(this, void 0, void 0, function() {
      var t3;
      return hn(this, function(e2) {
        switch (e2.label) {
          case 0:
            return t3 = this, [4, new jn(this.managers.song, this.listener, this.options).loadSong(this.video.songleCode || this.video.songleId, this.video)];
          case 1:
            return t3.songProvider = e2.sent(), [2];
        }
      });
    });
  }, t2.prototype.loadText = function(t3) {
    var e2, r2;
    return pn(this, void 0, void 0, function() {
      var n2, i2, o2, s2, a2, u2, l2, c2;
      return hn(this, function(p2) {
        switch (p2.label) {
          case 0:
            return n2 = this.video, i2 = n2.lyricId, o2 = n2.lyricDiffId, s2 = this.song ? this.song.code : null, a2 = new In(this.managers, this.listener, this.options), !s2 && i2 < 0 ? (u2 = a2.loadRawText(null === (e2 = this.videoProvider) || void 0 === e2 ? void 0 : e2.data), [3, 3]) : [3, 1];
          case 1:
            return l2 = (null == t3 ? void 0 : t3.altLyricsUrl) || void 0, c2 = (null == t3 ? void 0 : t3.lyricsDirectAccess) || void 0, [4, a2.loadLyrics({ songCode: s2, lyricId: i2, lyricDiffId: o2, altLyricsUrl: l2, directAccess: c2 })];
          case 2:
            u2 = p2.sent(), p2.label = 3;
          case 3:
            return this.textProvider = u2, (null == u2 ? void 0 : u2.lyrics) && (null === (r2 = null == u2 ? void 0 : u2.lyricsBody) || void 0 === r2 ? void 0 : r2.text) && this.importLyrics(), [2];
        }
      });
    });
  }, t2.prototype.loadFonts = function() {
    var t3, e2, r2;
    return pn(this, void 0, void 0, function() {
      return hn(this, function(n2) {
        return "number" == typeof this.video.id && this.video.id >= 0 ? (this.fontLoader.loadForVideo(null === (t3 = this.videoProvider) || void 0 === t3 ? void 0 : t3.data), [2]) : Array.isArray(null === (e2 = this.options) || void 0 === e2 ? void 0 : e2.fontFamilies) ? (this.fontLoader.load(this.options.fontFamilies), [2]) : null === (null === (r2 = this.options) || void 0 === r2 ? void 0 : r2.fontFamilies) ? (this.fontLoader.loadAll(), [2]) : [2];
      });
    });
  }, t2.prototype.importLyrics = function() {
    var t3 = this.text.replace(/[\s\r\n]/g, ""), e2 = 0, r2 = { phrases: this.lyrics.data.map(function(r3) {
      return { words: r3.map(function(r4) {
        return { characters: r4.map(function(r5) {
          return { char: t3.charAt(e2++), startTime: 1e3 * r5.start_time, endTime: 1e3 * r5.end_time };
        }) };
      }) };
    }) };
    this.video.json && Array.isArray(this.video.json.phrases) ? this.video.json.phrases.forEach(function(t4, e3) {
      t4.words.forEach(function(t5, n2) {
        t5.characters.forEach(function(t6, i2) {
          var o2 = r2.phrases[e3].words[n2].characters[i2];
          t6.char = o2.char, t6.startTime = o2.startTime, t6.endTime = o2.endTime;
        });
      });
    }) : this.video.json = r2;
  }, t2.prototype.getChoruses = function() {
    var t3;
    return null === (t3 = this.songProvider) || void 0 === t3 ? void 0 : t3.getChoruses();
  }, t2.prototype.findChorus = function(t3, e2) {
    var r2;
    return null === (r2 = this.songProvider) || void 0 === r2 ? void 0 : r2.findChorus(t3, e2);
  }, t2.prototype.findChorusBetween = function(t3, e2) {
    var r2;
    return null === (r2 = this.songProvider) || void 0 === r2 ? void 0 : r2.findChorusBetween(t3, e2);
  }, t2.prototype.getBeats = function() {
    var t3;
    return null === (t3 = this.songProvider) || void 0 === t3 ? void 0 : t3.getBeats();
  }, t2.prototype.findBeat = function(t3, e2) {
    var r2;
    return null === (r2 = this.songProvider) || void 0 === r2 ? void 0 : r2.findBeat(t3, e2);
  }, t2.prototype.getChords = function() {
    var t3;
    return null === (t3 = this.songProvider) || void 0 === t3 ? void 0 : t3.getChords();
  }, t2.prototype.findChord = function(t3, e2) {
    var r2;
    return null === (r2 = this.songProvider) || void 0 === r2 ? void 0 : r2.findChord(t3, e2);
  }, t2.prototype.getVocalFrequency = function(t3) {
    var e2;
    return null === (e2 = this.songProvider) || void 0 === e2 ? void 0 : e2.getVocalFrequency(t3);
  }, t2.prototype.getVocalAmplitude = function(t3) {
    var e2;
    return null === (e2 = this.songProvider) || void 0 === e2 ? void 0 : e2.getVocalAmplitude(t3);
  }, t2.prototype.getMaxVocalAmplitude = function() {
    var t3;
    return null === (t3 = this.songProvider) || void 0 === t3 ? void 0 : t3.getMaxVocalAmplitude();
  }, t2.prototype.getValenceArousal = function(t3) {
    var e2;
    return null === (e2 = this.songProvider) || void 0 === e2 ? void 0 : e2.getValenceArousal(t3);
  }, t2.prototype.getMedianValenceArousal = function() {
    var t3;
    return null === (t3 = this.songProvider) || void 0 === t3 ? void 0 : t3.getMedianValenceArousal();
  }, t2;
}();
var Dn = function() {
  function t2(t3, e2) {
    this.player = t3, this.listener = e2, this.initialize();
  }
  return Object.defineProperty(t2.prototype, "options", { get: function() {
    return this._options ? cn({}, this._options) : null;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "name", { get: function() {
    return this._name;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "author", { get: function() {
    return this._author;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "status", { get: function() {
    return this._status;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "server", { get: function() {
    return this._server;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "managed", { get: function() {
    return !!this._host;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "host", { get: function() {
    return this._host;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "songUrl", { get: function() {
    return this._songUrl;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "songOptions", { get: function() {
    return this._songOptions;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "parameters", { get: function() {
    return this._parameters;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "isConnecting", { get: function() {
    return !!this.connecting;
  }, enumerable: false, configurable: true }), t2.prototype.initialize = function() {
    var t3, e2, r2, n2;
    return pn(this, void 0, void 0, function() {
      return hn(this, function(i2) {
        switch (i2.label) {
          case 0:
            return this._options = null === (e2 = null === (t3 = this.player) || void 0 === t3 ? void 0 : t3.options) || void 0 === e2 ? void 0 : e2.app, this._options && (this._options = cn({}, this._options), this._name = null === (r2 = this._options) || void 0 === r2 ? void 0 : r2.appName, this._author = null === (n2 = this._options) || void 0 === n2 ? void 0 : n2.appAuthor, this._options.token && (g.textalive.appToken = this._options.token)), this._parameters = {}, this.parseQueryString(), this.initializeServerConnection(), "undefined" != typeof window && this._options ? [4, this.connect()] : [3, 2];
          case 1:
            i2.sent(), this.initializePlayerListener(), this.initializeMessageListener(), i2.label = 2;
          case 2:
            return this._songUrl && this.createFromSongUrl(), [2];
        }
      });
    });
  }, t2.prototype.initializeServerConnection = function() {
    var t3, e2, r2, n2, i2, o2;
    return pn(this, void 0, void 0, function() {
      var s2, a2, u2, l2, c2;
      return hn(this, function(p2) {
        switch (p2.label) {
          case 0:
            return [4, T.getServerStatus()];
          case 1:
            return s2 = p2.sent(), a2 = "ja" === (null == s2 ? void 0 : s2.lang), g.textalive.appToken && (null == s2 ? void 0 : s2.app) && (s2.app.data && (this._name = null === (t3 = s2.app.data) || void 0 === t3 ? void 0 : t3.name, this._author = null === (r2 = null === (e2 = s2.app) || void 0 === e2 ? void 0 : e2.data) || void 0 === r2 ? void 0 : r2.author, u2 = null === (i2 = null === (n2 = s2.app) || void 0 === n2 ? void 0 : n2.data) || void 0 === i2 ? void 0 : i2.status, this._status = "number" == typeof u2 ? u2 : -1), this._server = { version: s2.version, message: s2.app.message, error: s2.app.error }, !this._server.error) ? (l2 = this._server.message ? "\n" + this._server.message : "", a2 ? console.info("[TextAlive API]  v" + g.client.version + "  v" + (this._server.version || "0.0.0") + " " + l2) : console.info("[TextAlive API] App API client v" + g.client.version + " connected to server v" + (this._server.version || "0.0.0") + l2), this.listener.onAppLoad(this), [2]) : (c2 = (null === (o2 = this._server) || void 0 === o2 ? void 0 : o2.error) ? "\n" + this._server.error : "", a2 ? console.warn("[TextAlive API]  https://developer.textalive.jp " + c2) : console.warn("[TextAlive API] This app requires a valid app token to run properly. You could get a token from https://developer.textalive.jp." + c2), this.listener.onAppLoad(null, c2), [2]);
        }
      });
    });
  }, t2.prototype.initializePlayerListener = function() {
    var t3 = this;
    this.playerListener = { onVideoReady: function(e2) {
      t3._host && window.parent.postMessage({ kind: "ta_video", options: { lyrics: !!t3.player.data.lyrics, duration: t3.player.video.duration } }, "*");
    }, onThrottledTimeUpdate: function(e2) {
      t3._host && window.parent.postMessage({ kind: "ta_position", options: { position: e2 } }, "*");
    }, onPlay: function() {
      t3._host && window.parent.postMessage({ kind: "ta_status", options: { status: "play" } }, "*");
    }, onPause: function() {
      t3._host && window.parent.postMessage({ kind: "ta_status", options: { status: "pause" } }, "*");
    }, onStop: function() {
      t3._host && window.parent.postMessage({ kind: "ta_status", options: { status: "stop" } }, "*");
    }, onDispose: function() {
      t3.dispose();
    } }, this.player.addListener(this.playerListener);
  }, t2.prototype.initializeMessageListener = function() {
    var t3 = this;
    this.messageListener = function(e2) {
      if (e2.data.kind && /^ta_/.test(e2.data.kind)) {
        var r2 = t3.player;
        switch (e2.data.kind.substring("ta_".length)) {
          case "status":
            switch (e2.data.options.status) {
              case "play":
                r2.requestPlay();
                break;
              case "pause":
                r2.requestPause();
                break;
              case "stop":
                r2.requestStop();
            }
            break;
          case "seek":
            r2.requestMediaSeek(e2.data.options.position);
            break;
          case "parameter":
            var n2 = e2.data.options, i2 = n2.name, o2 = n2.value;
            t3.parameters[i2] = o2, t3.listener.onAppParameterUpdate(i2, o2);
            break;
          case "media":
            t3._songUrl = e2.data.options.url, t3._songOptions = e2.data.options.options || {}, r2.requestStop();
            var s2 = t3.createFromSongUrl();
            t3.listener.onAppMediaChange(t3._songUrl, s2);
        }
      }
    }, window.addEventListener("message", this.messageListener);
  }, t2.prototype.createFromSongUrl = function() {
    var t3, e2 = this._songOptions;
    return e2 && (t3 = { video: {} }, e2.altLyricsUrl && (t3.altLyricsUrl = e2.altLyricsUrl), e2.lyricsDirectAccess && (t3.lyricsDirectAccess = e2.lyricsDirectAccess), e2.lyricId && (t3.video.lyricId = e2.lyricId), e2.lyricDiffId && (t3.video.lyricDiffId = e2.lyricDiffId), e2.chordId && (t3.video.chordId = e2.chordId), e2.beatId && (t3.video.beatId = e2.beatId), e2.repetitiveSegmentId && (t3.video.repetitiveSegmentId = e2.repetitiveSegmentId)), this.player.createFromSongUrl(this._songUrl, t3);
  }, t2.prototype.parseQueryString = function() {
    var t3 = an("ta_app_token");
    t3 && (g.textalive.appToken = t3), this._songUrl = an("ta_song_url"), this._songOptions = {};
    var e2 = an("ta_lyric_id");
    e2 && (this._songOptions.lyricId = parseInt(e2), isNaN(this._songOptions.lyricId) && delete this._songOptions.lyricId);
    var r2 = an("ta_lyric_diff_id");
    r2 && (this._songOptions.lyricDiffId = parseInt(r2), isNaN(this._songOptions.lyricDiffId) && delete this._songOptions.lyricDiffId);
    var n2 = an("ta_alt_lyrics_url");
    n2 && (this._songOptions.altLyricsUrl = n2);
    var i2 = an("ta_lyrics_direct_access");
    i2 && (this._songOptions.lyricsDirectAccess = "true" === i2, this._songOptions.lyricsDirectAccess || delete this._songOptions.lyricsDirectAccess);
    var o2 = an("ta_chord_id");
    o2 && (this._songOptions.chordId = parseInt(o2), isNaN(this._songOptions.chordId) && delete this._songOptions.chordId);
    var s2 = an("ta_beat_id");
    s2 && (this._songOptions.beatId = parseInt(s2), isNaN(this._songOptions.beatId) && delete this._songOptions.beatId);
    var a2 = an("ta_repetitive_segment_id");
    a2 && (this._songOptions.repetitiveSegmentId = parseInt(a2), isNaN(this._songOptions.repetitiveSegmentId) && delete this._songOptions.repetitiveSegmentId);
  }, t2.prototype.connect = function() {
    return pn(this, void 0, void 0, function() {
      var t3, e2 = this;
      return hn(this, function(r2) {
        switch (r2.label) {
          case 0:
            return this.connecting ? [2, this.connecting] : "undefined" != typeof window && this.options && window.parent && window !== window.parent ? [3, 2] : [4, new Promise(function(t4) {
              return setTimeout(t4, 1);
            })];
          case 1:
            return r2.sent(), this.listener.onAppReady(this), [2, false];
          case 2:
            return this.connecting = Promise.race([new Promise(function(r3) {
              t3 = function(n2) {
                n2.data.kind && /^ta_/.test(n2.data.kind) && "ack" === n2.data.kind.substring("ta_".length) && (window.removeEventListener("message", t3), e2._host = n2.data.options, r3(true));
              }, window.addEventListener("message", t3);
            }), pn(e2, void 0, void 0, function() {
              var e3;
              return hn(this, function(r3) {
                switch (r3.label) {
                  case 0:
                    e3 = 0, r3.label = 1;
                  case 1:
                    return e3 < 5 ? (window.parent.postMessage({ kind: "ta_connect", options: this.options }, "*"), [4, new Promise(function(t4) {
                      return setTimeout(t4, 200);
                    })]) : [3, 4];
                  case 2:
                    if (r3.sent(), this._host)
                      return [3, 4];
                    r3.label = 3;
                  case 3:
                    return e3++, [3, 1];
                  case 4:
                    return !this._host && t3 && window.removeEventListener("message", t3), [2, !!this._host];
                }
              });
            })]), this.connecting.finally(function() {
              e2.connecting = null, e2.listener.onAppReady(e2);
            }), [2, this.connecting];
        }
      });
    });
  }, t2.prototype.dispose = function() {
    "undefined" != typeof window && this.options && (this.player.removeListener(this.playerListener), window.removeEventListener("message", this.messageListener)), this._host = null, this.player = null;
  }, t2;
}();
function Mn(t2) {
  return t2;
}
function Bn(t2) {
  return t2 < -1 ? t2 = -1 : t2 > 1 && (t2 = 1), function(e2) {
    return 0 == t2 ? e2 : t2 < 0 ? e2 * (e2 * -t2 + 1 + t2) : e2 * ((2 - e2) * t2 + (1 - t2));
  };
}
function Vn(t2) {
  return function(e2) {
    return Math.pow(e2, t2);
  };
}
function Gn(t2) {
  return function(e2) {
    return 1 - Math.pow(1 - e2, t2);
  };
}
function qn(t2) {
  return function(e2) {
    return (e2 *= 2) < 1 ? 0.5 * Math.pow(e2, t2) : 1 - 0.5 * Math.abs(Math.pow(2 - e2, t2));
  };
}
var Wn = Vn(2);
var Yn = Gn(2);
var zn = qn(2);
var Jn = Vn(3);
var Hn = Gn(3);
var Xn = qn(3);
var Zn = Vn(4);
var $n = Gn(4);
var Qn = qn(4);
var Kn = Vn(5);
var ti = Gn(5);
var ei = qn(5);
function ri(t2) {
  return 1 - Math.cos(t2 * Math.PI / 2);
}
function ni(t2) {
  return Math.sin(t2 * Math.PI / 2);
}
function ii(t2) {
  return -0.5 * (Math.cos(Math.PI * t2) - 1);
}
function oi(t2) {
  return function(e2) {
    return e2 * e2 * ((t2 + 1) * e2 - t2);
  };
}
var si = oi(1.7);
function ai(t2) {
  return function(e2) {
    return --e2 * e2 * ((t2 + 1) * e2 + t2) + 1;
  };
}
var ui = ai(1.7);
function li(t2) {
  return t2 *= 1.525, function(e2) {
    return (e2 *= 2) < 1 ? e2 * e2 * ((t2 + 1) * e2 - t2) * 0.5 : 0.5 * ((e2 -= 2) * e2 * ((t2 + 1) * e2 + t2) + 2);
  };
}
var ci = li(1.7);
function pi(t2) {
  return -(Math.sqrt(1 - t2 * t2) - 1);
}
function hi(t2) {
  return Math.sqrt(1 - --t2 * t2);
}
function di(t2) {
  return (t2 *= 2) < 1 ? -0.5 * (Math.sqrt(1 - t2 * t2) - 1) : 0.5 * (Math.sqrt(1 - (t2 -= 2) * t2) + 1);
}
function fi(t2) {
  return 1 - yi(1 - t2);
}
function yi(t2) {
  return t2 < 1 / 2.75 ? 7.5625 * t2 * t2 : t2 < 2 / 2.75 ? 7.5625 * (t2 -= 1.5 / 2.75) * t2 + 0.75 : t2 < 2.5 / 2.75 ? 7.5625 * (t2 -= 2.25 / 2.75) * t2 + 0.9375 : 7.5625 * (t2 -= 2.625 / 2.75) * t2 + 0.984375;
}
function vi(t2) {
  return t2 < 0.5 ? 0.5 * fi(2 * t2) : 0.5 * yi(2 * t2 - 1) + 0.5;
}
function gi(t2, e2) {
  var r2 = 2 * Math.PI;
  return function(n2) {
    if (0 == n2 || 1 == n2)
      return n2;
    var i2 = e2 / r2 * Math.asin(1 / t2);
    return -t2 * Math.pow(2, 10 * (n2 -= 1)) * Math.sin((n2 - i2) * r2 / e2);
  };
}
var mi = gi(1, 0.3);
function bi(t2, e2) {
  var r2 = 2 * Math.PI;
  return function(n2) {
    if (0 == n2 || 1 == n2)
      return n2;
    var i2 = e2 / r2 * Math.asin(1 / t2);
    return t2 * Math.pow(2, -10 * n2) * Math.sin((n2 - i2) * r2 / e2) + 1;
  };
}
var _i = bi(1, 0.3);
function wi(t2, e2) {
  var r2 = 2 * Math.PI;
  return function(n2) {
    var i2 = e2 / r2 * Math.asin(1 / t2);
    return (n2 *= 2) < 1 ? t2 * Math.pow(2, 10 * (n2 -= 1)) * Math.sin((n2 - i2) * r2 / e2) * -0.5 : t2 * Math.pow(2, -10 * (n2 -= 1)) * Math.sin((n2 - i2) * r2 / e2) * 0.5 + 1;
  };
}
var Pi = wi(1, 0.3 * 1.5);
var Ei = Object.freeze({ __proto__: null, linear: Mn, get: Bn, getPowIn: Vn, getPowOut: Gn, getPowInOut: qn, quadIn: Wn, quadOut: Yn, quadInOut: zn, cubicIn: Jn, cubicOut: Hn, cubicInOut: Xn, quartIn: Zn, quartOut: $n, quartInOut: Qn, quintIn: Kn, quintOut: ti, quintInOut: ei, sineIn: ri, sineOut: ni, sineInOut: ii, getBackIn: oi, backIn: si, getBackOut: ai, backOut: ui, getBackInOut: li, backInOut: ci, circIn: pi, circOut: hi, circInOut: di, bounceIn: fi, bounceOut: yi, bounceInOut: vi, getElasticIn: gi, elasticIn: mi, getElasticOut: bi, elasticOut: _i, getElasticInOut: wi, elasticInOut: Pi });
var Oi = function() {
  function t2() {
  }
  return t2.linear = Mn, t2.get = Bn, t2.getPowIn = Vn, t2.getPowOut = Gn, t2.getPowInOut = qn, t2.quadIn = Wn, t2.quadOut = Yn, t2.quadInOut = zn, t2.cubicIn = Jn, t2.cubicOut = Hn, t2.cubicInOut = Xn, t2.quartIn = Zn, t2.quartOut = $n, t2.quartInOut = Qn, t2.quintIn = Kn, t2.quintOut = ti, t2.quintInOut = ei, t2.sineIn = ri, t2.sineOut = ni, t2.sineInOut = ii, t2.getBackIn = oi, t2.backIn = si, t2.getBackOut = ai, t2.backOut = ui, t2.getBackInOut = li, t2.backInOut = ci, t2.circIn = pi, t2.circOut = hi, t2.circInOut = di, t2.bounceIn = fi, t2.bounceOut = yi, t2.bounceInOut = vi, t2.getElasticIn = gi, t2.elasticIn = mi, t2.getElasticOut = bi, t2.elasticOut = _i, t2.getElasticInOut = wi, t2.elasticInOut = Pi, t2;
}();
var Si = function() {
  function t2() {
    this.cursor = -1, this.widgets = [], this.instances = [], this.model = { id: -1, type: r.NONE, sourceId: -1, author: null, originalAuthor: null, className: null, createdDate: null };
  }
  return Object.defineProperty(t2.prototype, "id", { get: function() {
    return this.model ? this.model.id : -1;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "script", { get: function() {
    return this.model ? this.model.script : null;
  }, enumerable: false, configurable: true }), t2;
}();
var Ti = function() {
};
var xi = function() {
  function t2(t3, e2) {
    this.onTemplateLoad = e2, this._emitter = null, this._loaded = null, this._loading = null, this.verbose = false, this._emitter = t3, this.clear();
  }
  return Object.defineProperty(t2.prototype, "loaded", { get: function() {
    return this._loaded;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "loading", { get: function() {
    return this._loading;
  }, enumerable: false, configurable: true }), t2.prototype.clear = function() {
    this._loaded = {}, this._loading = {};
  }, t2.prototype.loadLatest = function(t3) {
    return void 0 === t3 && (t3 = 100), pn(this, void 0, void 0, function() {
      var e2;
      return hn(this, function(r2) {
        switch (r2.label) {
          case 0:
            return [4, V.list({ maxResults: t3, withoutAuthors: true, withoutOriginalAuthors: true, script: true })];
          case 1:
            return (e2 = r2.sent()) && e2.list ? (this.verbose && console.log("--- loading template classes ---"), [2, this.registerMany(e2.list)]) : [2];
        }
      });
    });
  }, t2.prototype.loadForVideo = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2, r2 = this;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, V.loadForVideo(t3)];
          case 1:
            return (e2 = n2.sent()) && e2.list ? (this.verbose && console.log("--- loading template classes for vid:" + t3 + " ---"), [4, this.registerMany(e2.list)]) : [2, null];
          case 2:
            return [2, n2.sent().map(function(t4) {
              return t4 ? r2.getByName(t4) : null;
            })];
        }
      });
    });
  }, t2.prototype.loadByNames = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2, r2 = this;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return !Array.isArray(t3) || t3.length <= 0 ? [2, []] : (this.verbose && console.log("--- loading template classes ---"), [4, Promise.all(t3.map(function(t4) {
              return r2.doLoadByName(t4);
            }))]);
          case 1:
            return (e2 = n2.sent()) && this._emitter.onTemplatesLoad(e2.filter(function(t4) {
              return !!t4;
            }).map(function(t4) {
              return t4.className;
            })), [2, e2];
        }
      });
    });
  }, t2.prototype.loadByName = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2, r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return n2.trys.push([0, 2, , 3]), [4, this.doLoadByName(t3)];
          case 1:
            return e2 = n2.sent(), this._emitter.onTemplatesLoad([e2.className]), [2, e2];
          case 2:
            return r2 = n2.sent(), this._emitter.onTemplatesLoad(null, r2), [2, null];
          case 3:
            return [2];
        }
      });
    });
  }, t2.prototype.doLoadByName = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2, r2, n2 = this;
      return hn(this, function(i2) {
        return null !== (e2 = this.getByName(t3)) ? [2, e2] : this._loading[t3] ? [2, this._loading[t3]] : (r2 = new Promise(function(e3) {
          return V.loadByName(t3).then(function(t4) {
            return n2.onTemplateLoad(t4);
          }).then(e3);
        }), this._loading[t3] = r2, r2.finally(function() {
          return delete n2._loading[t3];
        }), [2, r2]);
      });
    });
  }, t2.prototype.loadById = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2, r2, n2;
      return hn(this, function(i2) {
        switch (i2.label) {
          case 0:
            return i2.trys.push([0, 2, , 3]), [4, this.doLoadById(t3)];
          case 1:
            return e2 = i2.sent(), r2 = null, [3, 3];
          case 2:
            return n2 = i2.sent(), r2 = n2, [3, 3];
          case 3:
            return this._emitter.onTemplatesLoad(e2 ? [e2.className] : null, r2), [2, e2];
        }
      });
    });
  }, t2.prototype.doLoadById = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2, r2, n2 = this;
      return hn(this, function(i2) {
        return (e2 = this.getById(t3)) ? [2, e2] : this._loading[t3] ? [2, this._loading[t3]] : (r2 = new Promise(function(e3) {
          return V.load(t3).then(function(t4) {
            return n2.onTemplateLoad(t4);
          }).then(e3);
        }), this._loading[t3] = r2, r2.finally(function() {
          return delete n2._loading[t3];
        }), [2, r2]);
      });
    });
  }, t2.prototype.registerMany = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2, r2, n2 = this;
      return hn(this, function(i2) {
        switch (i2.label) {
          case 0:
            return e2 = t3.map(function(t4) {
              var e3 = n2.onTemplateLoad(t4);
              return n2._loading[t4.className] = e3, n2._loading[t4.className + "@" + t4.id] = e3, e3;
            }), [4, Promise.all(e2.map(function(t4) {
              return t4.then(function(t5) {
                return t5.className;
              }).catch(function(t5) {
                return null;
              });
            }))];
          case 1:
            return r2 = i2.sent().filter(function(t4) {
              return !!t4;
            }), this._emitter.onTemplatesLoad(r2), [2, r2];
        }
      });
    });
  }, t2.prototype.commit = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, V.create({ sourceId: t3.model.sourceId, script: t3.model.script, log: e2 })];
          case 1:
            return (r2 = n2.sent()).success && (t3.model.id = r2.id, this._emitter.onTemplateCommit(t3.className)), [2, r2];
        }
      });
    });
  }, t2.prototype.getByName = function(t3, e2) {
    var r2;
    if (void 0 === e2 && (e2 = false), t3 && (r2 = t3.match(/(.+)@([0-9]+)/))) {
      t3 = r2[1];
      var n2 = parseInt(r2[2]);
      if (!this._loaded[t3])
        return null;
      var i2 = this._loaded[t3].model;
      if (i2.id !== n2) {
        if (!e2)
          return null;
        this.verbose && console.log("[warning] template " + t3 + " version " + n2 + " is requested but " + i2.id + " is used");
      }
    }
    return this._loaded[t3] ? this._loaded[t3] : null;
  }, t2.prototype.getById = function(t3) {
    var e2 = null;
    for (var r2 in this._loaded)
      if (this._loaded[r2].model.id === t3) {
        e2 = this._loaded[r2];
        break;
      }
    return e2;
  }, t2;
}();
var Ai = { Matrix2D: st, Point: at, Color: Z, Font: $, RenderingUnit: z, TextUnit: X, Graphic: K, Phrase: et, Word: tt, Char: Q, Beat: Tn, RepetitiveSegment: An };
var Ri = ["headTime", "tailTime", "insomnia"];
var Ci = ["animate", "getAssignedUnit", "name", "type"];
var Ni = function() {
  function t2(t3, e2, r2) {
    this._emitter = null, this._player = null, this.interpreter = null, this.unsafeAcceleration = false, this._verbose = false, this.ignoreVersion = false, this.rawConsole = false, this._player = t3, this._emitter = e2, this.unsafeAcceleration = r2, this.loader = new xi(e2, this.register.bind(this)), t3.addListener({ onVideoReady: this.onVideoReady.bind(this) });
  }
  return Object.defineProperty(t2.prototype, "verbose", { get: function() {
    return this._verbose;
  }, set: function(t3) {
    this._verbose = this.loader.verbose = t3;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "ready", { get: function() {
    return !!this.interpreter;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "loaded", { get: function() {
    return this.loader.loaded;
  }, enumerable: false, configurable: true }), t2.prototype.initialize = function() {
    var t3 = this;
    if (!this.ready) {
      var e2 = function(t4) {
        var e3 = t4.player, n3 = t4.ignoredPropNames, i3 = t4.rawConsole, o2 = t4.templateGetter, s2 = e3.graphics.wrapperTable, a2 = new on(cn(cn({}, Ai), s2), n3, function(t5, r2) {
          return e3.graphics.isGraphics(t5) && r2 instanceof Z ? r2.toString() : r2;
        }), u2 = { require: { func: function(t5) {
          if (!(t5.length < 1 || "string" != typeof t5[0])) {
            var e4 = t5[0], r2 = o2(e4);
            return null === r2 ? void 0 : r2.functionDefinition;
          }
        }, raw: true, isConstructor: true }, print: { func: function(t5) {
          e3.isEditing && console.log.apply(console, t5);
        }, raw: i3 }, findChorus: { func: function(t5) {
          return t5.length < 1 || "number" != typeof t5[0] ? null : e3.findChorus(t5[0]);
        } }, findBeat: { func: function(t5) {
          return t5.length < 1 || "number" != typeof t5[0] ? null : e3.findBeat(t5[0]);
        } }, getVocalFrequency: { func: function(t5) {
          return t5.length < 1 || "number" != typeof t5[0] ? null : e3.getVocalFrequency(t5[0]);
        } }, getVocalAmplitude: { func: function(t5) {
          return t5.length < 1 || "number" != typeof t5[0] ? -1 : e3.getVocalAmplitude(t5[0]);
        } }, getMaxVocalAmplitude: { func: function(t5) {
          return e3.getMaxVocalAmplitude();
        } }, getValenceArousal: { func: function(t5) {
          return t5.length < 1 || "number" != typeof t5[0] ? null : e3.getValenceArousal(t5[0]);
        } }, getMedianValenceArousal: { func: function(t5) {
          return e3.getMedianValenceArousal();
        } } };
        Object.keys(r).forEach(function(t5) {
          a2.setProperty(a2.globalScope, t5, r[t5]), u2[t5] = { value: r[t5] };
        }), Object.keys(Ei).forEach(function(t5) {
          var e4 = Ei[t5];
          0 !== t5.indexOf("get") && (u2[t5] = { func: e4 });
        });
        var l2 = Object.keys(a2.wrapperTable);
        return l2 && l2.forEach(function(t5) {
          return u2[t5] = { cls: a2.wrapperTable[t5] };
        }), Object.keys(u2).forEach(function(t5) {
          var e4 = u2[t5];
          e4.func ? a2.createGlobalFunction(t5, e4) : e4.value && a2.setProperty(a2.globalScope, t5, e4.value);
        }), { interpreter: a2, unsafeGlobalScope: u2 };
      }({ player: this._player, ignoredPropNames: Ci, rawConsole: this.rawConsole, templateGetter: function(e3) {
        return t3.getByName(e3, true);
      } }), n2 = e2.interpreter, i2 = e2.unsafeGlobalScope;
      this.unsafeGlobalScope = i2, this.interpreter = n2, this.onVideoReady(this._player.video);
    }
  }, t2.prototype.getByName = function(t3, e2) {
    return void 0 === e2 && (e2 = false), this.loader.getByName(t3, e2);
  }, t2.prototype.getById = function(t3) {
    return this.loader.getById(t3);
  }, t2.prototype.clear = function() {
    this.loader.clear();
  }, t2.prototype.loadLatest = function(t3) {
    return void 0 === t3 && (t3 = 100), pn(this, void 0, void 0, function() {
      return hn(this, function(e2) {
        return this.ready || this.initialize(), [2, this.loader.loadLatest(t3)];
      });
    });
  }, t2.prototype.loadForVideo = function(t3) {
    return pn(this, void 0, void 0, function() {
      return hn(this, function(e2) {
        return this.ready || this.initialize(), [2, this.loader.loadForVideo(t3)];
      });
    });
  }, t2.prototype.loadByNames = function(t3) {
    return pn(this, void 0, void 0, function() {
      return hn(this, function(e2) {
        return this.ready || this.initialize(), [2, this.loader.loadByNames(t3)];
      });
    });
  }, t2.prototype.loadByName = function(t3) {
    return pn(this, void 0, void 0, function() {
      return hn(this, function(e2) {
        return this.ready || this.initialize(), [2, this.loader.loadByName(t3)];
      });
    });
  }, t2.prototype.loadById = function(t3) {
    return pn(this, void 0, void 0, function() {
      return hn(this, function(e2) {
        return this.ready || this.initialize(), [2, this.loader.loadById(t3)];
      });
    });
  }, t2.prototype.commit = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      return hn(this, function(r2) {
        return [2, this.loader.commit(t3, e2)];
      });
    });
  }, t2.prototype.register = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2, r2, n2, i2, o2, s2, a2, u2 = this;
      return hn(this, function(l2) {
        switch (l2.label) {
          case 0:
            if (!t3)
              return [2, null];
            if ("number" == typeof t3.sourceId) {
              if (e2 = t3, !(r2 = this.createClass(t3.script)))
                return [2, null];
            } else
              r2 = t3;
            n2 = Kr(r2.ast).dependencies, l2.label = 1;
          case 1:
            return l2.trys.push([1, 3, , 4]), [4, Promise.all(n2.map(function(t4) {
              var e3 = u2.getByName(t4, u2.ignoreVersion);
              return e3 ? Promise.resolve(e3) : u2.loadByName(t4);
            }))];
          case 2:
            return l2.sent(), this.verbose && console.log("load dependencies for", r2.className, n2), [3, 4];
          case 3:
            return i2 = l2.sent(), this.verbose && console.error("failed loading dependencies for", r2.className, i2), [3, 4];
          case 4:
            try {
              if (o2 = void 0, e2 ? (o2 = this.newRawInstance(r2), r2.model = e2) : o2 = this.createModel(r2), !o2)
                throw new Error("failed to create a template instance");
              return [2, this.registerClass(r2)];
            } catch (t4) {
              throw s2 = void 0, e2 && (delete (a2 = cn({}, e2)).script, s2 = a2), { error: t4.message, stack: t4.stack, cause: s2 };
            }
            return [2];
        }
      });
    });
  }, t2.prototype.updateClassScript = function(t3, e2) {
    var r2 = this.createClass(e2);
    return this.updateClass(t3, r2);
  }, t2.prototype.registerClass = function(t3) {
    if (!t3)
      return null;
    if (this.loader.loaded[t3.className]) {
      this.verbose && console.log("updating", t3.className, t3.model.id);
      var e2 = this.updateClass(this.loader.loaded[t3.className], t3);
      return this.verbose && console.log("updated", e2.className, e2.id), e2;
    }
    return this.loader.loaded[t3.className] = t3, this.verbose && console.log("loaded", t3.className, t3.model.id), t3;
  }, t2.prototype.updateClass = function(t3, e2) {
    var r2 = t3, n2 = e2;
    if (!n2)
      return null;
    if (r2.model.script === n2.model.script)
      return this.verbose && console.log("no diff for", r2.className), r2;
    if (!this.createModel(n2))
      return null;
    if (r2.className !== n2.className) {
      var i2 = this.getByName(n2.className);
      if (!i2)
        return n2.cursor = r2.cursor, this.loader.loaded[n2.className] = n2, this.verbose && console.log("create", n2.className), n2;
      r2 = i2;
    }
    return r2.newStatement = n2.newStatement, r2.widgets = n2.widgets, r2.scope = n2.scope, r2.functionDefinition = n2.functionDefinition, r2.newStatement = n2.newStatement, r2.unsafeConstructorGenerator = n2.unsafeConstructorGenerator, r2.ast = n2.ast, r2.cursor < 0 && (r2.cursor = n2.cursor), n2.id >= 0 ? (this.verbose && console.log("replace", n2.className, r2.id, n2.id), r2.model = n2.model) : (this.verbose && console.log("update", n2.className, r2.id, n2.id), r2.model.type = n2.model.type, r2.model.className = n2.model.className, r2.model.prettyName = n2.model.prettyName, r2.model.script = n2.model.script, r2.model.createdDate = null, r2.id >= 0 && (r2.model.sourceId = r2.model.id, r2.model.id = -1)), n2 = r2, this.updateInstances(r2.instances.slice(), n2), this._emitter.onTemplateUpdate(n2.className), n2;
  }, t2.prototype.createModel = function(t3) {
    var e2 = this.newRawInstance(t3);
    if (null === e2)
      return false;
    if (t3.id >= 0)
      return true;
    var r2 = e2.templateInstance, n2 = t3.model.script;
    return t3.model = { id: -1, sourceId: -1, className: t3.className, prettyName: r2 ? this.interpreter.getProperty(r2, "name") : e2.unsafeTemplateInstance.name, type: r2 ? this.interpreter.getProperty(r2, "type") : e2.unsafeTemplateInstance.type, script: n2, author: null, originalAuthor: null, createdDate: null }, e2;
  }, t2.prototype.updateInstances = function(t3, e2) {
    var r2 = this;
    t3.forEach(function(t4) {
      try {
        r2.updateInstance(t4, e2);
      } catch (r3) {
        console.log("failed updating template for", t4.assignedUnit, ":", e2);
      }
    }), this._player.isPlaying || this._player.requestStageUpdate();
  }, t2.prototype.createClass = function(t3) {
    var e2 = this;
    this.ready || this.initialize();
    var r2 = new Si();
    r2.model = { id: -1, sourceId: -1, className: null, prettyName: null, type: 0, script: t3, author: null, originalAuthor: null, createdDate: null };
    var n2 = Qr(t3, Ci), i2 = n2.ast, o2 = n2.widgets;
    if (r2.ast = i2, r2.widgets = o2, r2.className = r2.ast.body[0].id.name, r2.scope = this.interpreter.prepareRun(r2.ast), this.interpreter.run(1e3, "to define " + r2.className), r2.functionDefinition = this.interpreter.getRawProperty(r2.scope, r2.className), r2.newStatement = this.interpreter.newStatementFor(r2.className), this.unsafeAcceleration) {
      var s2 = Object.keys(this.unsafeGlobalScope), a2 = "return function(props){var " + Object.keys(this.getGlobalProperties()).map(function(t4) {
        return t4 + "=props." + t4;
      }).join(",") + ";" + t3 + "return " + r2.className + ";}", u2 = new (Function.bind.apply(Function, dn(dn([void 0], s2, false), [a2], false)))(), l2 = function(t4) {
        var r3 = e2.getByName(t4);
        return r3 ? r3.unsafeConstructorGenerator(e2.getGlobalProperties()) : null;
      }, c2 = s2.map(function(t4) {
        if ("require" === t4)
          return l2;
        var r3 = e2.unsafeGlobalScope[t4];
        return r3.func ? function() {
          for (var t5 = [], e3 = 0; e3 < arguments.length; e3++)
            t5[e3] = arguments[e3];
          return r3.func(t5);
        } : r3.cls || r3.value;
      });
      r2.unsafeConstructorGenerator = u2.apply({}, c2);
    }
    return r2;
  }, t2.prototype.getGlobalProperties = function() {
    var t3;
    return { width: this._player.videoWidth, height: this._player.videoHeight, margin: this._player.margin, duration: (null === (t3 = this._player.video) || void 0 === t3 ? void 0 : t3.duration) || 0 };
  }, t2.prototype.newRawInstance = function(t3) {
    var e2 = t3, r2 = new Ti();
    if (this.unsafeAcceleration) {
      var n2 = new (e2.unsafeConstructorGenerator(this.getGlobalProperties()))();
      r2.unsafeTemplateInstance = n2;
    } else {
      this.interpreter.prepareNewInstance(e2.newStatement, e2.scope);
      var i2 = this.interpreter.run(700, "to instantiate " + e2.className);
      r2.templateInstance = i2, r2.templateInstance._nativeInstance = r2;
    }
    return r2.templateClass = e2, r2.ignore = false, r2;
  }, t2.prototype.setProperty = function(t3, e2, r2) {
    this.unsafeAcceleration ? t3.unsafeTemplateInstance[e2] = r2 : this.interpreter.setProperty(t3.templateInstance, e2, r2);
  }, t2.prototype.getProperty = function(t3, e2) {
    return this.unsafeAcceleration ? t3.unsafeTemplateInstance[e2] : this.interpreter.getProperty(t3.templateInstance, e2);
  }, t2.prototype.exportInstance = function(t3) {
    for (var e2 = {}, r2 = 0, n2 = t3.templateClass.widgets.map(function(t4) {
      return t4.name;
    }).concat(Ri); r2 < n2.length; r2++) {
      var i2 = n2[r2], o2 = this.getProperty(t3, i2);
      try {
        var s2 = pt(o2);
        void 0 !== s2 && (e2[i2] = s2);
      } catch (e3) {
        console.error("cannot export " + t3.templateClass.className + "." + i2, o2, "assigned to", t3.assignedUnit);
      }
    }
    return { type: t3.templateClass.className, value: e2 };
  }, t2.prototype.importInstances = function(t3, e2) {
    try {
      this.importPhraseTemplates(t3.firstCredit, e2.credits), this.importPhraseTemplates(t3.firstPhrase, e2.phrases);
      for (var r2 = e2.graphics, n2 = t3.firstGraphic, i2 = 0; null !== n2; ) {
        var o2 = r2[i2++];
        this.importTemplates(n2, o2.templates), n2 = n2.next;
      }
    } catch (t4) {
      return console.error("restoring templates failed", t4), false;
    }
    return true;
  }, t2.prototype.importPhraseTemplates = function(t3, e2) {
    if (Array.isArray(e2))
      for (var r2 = 0; t3; ) {
        var n2 = e2[r2++];
        this.importTemplates(t3, n2.templates);
        for (var i2 = t3.firstWord, o2 = 0; o2 < t3.wordCount; o2++) {
          var s2 = n2.words[o2];
          this.importTemplates(i2, s2.templates);
          for (var a2 = i2.firstChar, u2 = 0; u2 < i2.charCount; u2++) {
            var l2 = s2.characters[u2];
            this.importTemplates(a2, l2.templates), a2 = a2.next;
          }
          i2 = i2.next;
        }
        if (e2.length < r2 + 1)
          break;
        t3 = t3.next;
      }
  }, t2.prototype.importTemplates = function(t3, e2) {
    if (Array.isArray(e2))
      for (var r2 = 0, n2 = e2; r2 < n2.length; r2++) {
        var i2 = n2[r2], o2 = this.importInstance(i2);
        o2 && t3.addTemplate(o2);
      }
  }, t2.prototype.importInstance = function(t3) {
    var e2 = this.getByName(t3.type), r2 = this.newInstance(e2);
    if (!r2 || !t3.value)
      return null;
    for (var n2 = 0, i2 = Object.keys(t3.value); n2 < i2.length; n2++) {
      var o2 = i2[n2], s2 = ht(t3.value[o2], this.interpreter.wrapperTable);
      void 0 !== s2 && this.setProperty(r2, o2, s2);
    }
    return r2;
  }, t2.prototype.updateInstance = function(t3, e2) {
    var r2 = t3, n2 = e2, i2 = this.newRawInstance(n2), o2 = r2.templateInstance, s2 = this.interpreter.cleanupProperties(o2);
    r2.templateClass !== n2 && (this.disposeInstance(r2), n2.instances.push(r2)), r2.templateClass = n2, r2.scope = i2.scope, r2.templateInstance = i2.templateInstance, r2.ignore = i2.ignore, this.interpreter.restoreProperties(r2.templateInstance, s2), this.attachGetAssignedUnitMethod(r2);
  }, t2.prototype.newInstance = function(t3) {
    var e2;
    try {
      if (null === (e2 = this.newRawInstance(t3)))
        return null;
    } catch (t4) {
      return null;
    }
    return this.attachGetAssignedUnitMethod(e2), t3.instances.push(e2), e2;
  }, t2.prototype.attachGetAssignedUnitMethod = function(t3) {
    var e2 = this;
    if (this.unsafeAcceleration)
      t3.unsafeTemplateInstance.getAssignedUnit = function() {
        return t3.assignedUnit;
      };
    else {
      var r2 = this.interpreter.createFunction(function() {
        return e2.interpreter.wrap(t3.assignedUnit);
      });
      this.interpreter.setRawProperty(t3.templateInstance, "getAssignedUnit", r2);
    }
  }, t2.prototype.disposeInstance = function(t3) {
    var e2 = t3.templateClass;
    e2.instances = e2.instances.filter(function(e3) {
      return e3 !== t3;
    });
  }, t2.prototype.disposeInstances = function(t3) {
    var e2 = this;
    if (Array.isArray(t3))
      t3.forEach(function(t4) {
        return e2.disposeInstance(t4);
      });
    else {
      var r2 = t3;
      [r2.firstCredit, r2.firstPhrase, r2.firstWord, r2.firstChar, r2.firstGraphic].forEach(function(t4) {
        for (; t4; )
          e2.disposeInstances(t4.removeTemplates()), t4 = t4.next;
      });
    }
  }, t2.prototype.setTemplate = function(t3, e2) {
    this.removeTemplates(t3), t3.addTemplate(e2);
  }, t2.prototype.clearTemplate = function(t3) {
    this.removeTemplates(t3);
  }, t2.prototype.removeTemplateAt = function(t3, e2) {
    var r2 = t3.removeTemplateAt(e2);
    r2 && this.disposeInstance(r2);
  }, t2.prototype.removeTemplates = function(t3) {
    var e2 = t3.removeTemplates();
    this.disposeInstances(e2);
  }, t2.prototype.getRequiredTemplates = function(t3) {
    return Kr(t3).dependencies;
  }, t2.prototype.getRequiredTemplateAt = function(t3, e2) {
    return Kr(t3, e2).dependencyAtCursor;
  }, t2.prototype.exec = function(t3, e2, r2) {
    if (t3.unsafeTemplateInstance) {
      var n2 = t3.unsafeTemplateInstance;
      return n2[e2].apply(n2, r2);
    }
    var i2 = this.interpreter.exec(t3.templateInstance, e2, r2, t3.assignedUnit ? " assigned to " + t3.assignedUnit.toString() : "");
    return this.interpreter.unwrap(i2);
  }, t2.prototype.declareVariable = function(t3, e2, r2, n2) {
    return this.updateClassScript(t3, function(t4, e3, r3, n3) {
      try {
        var i2 = Qr(t4), o2 = i2.ast, s2 = i2.fields, a2 = s2[s2.length - 1], u2 = t4.match(/(\r\n|[\n\v\f\r\x85\u2028\u2029])/), l2 = u2 ? u2.pop() : "\n", c2 = t4.split(l2), p2 = a2 ? Array(a2.loc.start.column + 1).join(" ") : "  ", h2 = a2 ? a2.loc.end.line : 0;
        if (h2 <= 0) {
          var d2 = o2.body[0].body, f2 = c2[d2.loc.start.line - 1], y2 = f2.substring(0, d2.loc.start.column + 1), v2 = f2.substring(d2.loc.start.column + 1);
          c2[d2.loc.start.line - 1] = y2, c2.splice(d2.loc.start.line, 0, v2), h2 = d2.loc.start.line;
        }
        for (var g2 = void 0; (g2 = "var" + Math.random().toString().substring(2)).length > 8 && (g2 = g2.substring(0, 8)), !(t4.indexOf(g2) < 0); )
          ;
        c2.length > h2 && c2[h2].length > 0 && c2.splice(h2, 0, ""), c2.splice(h2, 0, "", p2 + "// @proposed", p2 + "// @title " + e3, p2 + "// " + function(t5, e4) {
          if ("Slider" === t5)
            return "@ui Slider(" + e4.min + ", " + e4.max + ")";
          if ("Check" === t5)
            return "@ui Check()";
          if ("Color" === t5)
            return "@ui Color()";
          var r4 = e4.etc;
          return "@comment " + (r4 = r4.replace(/(\r\n|[\n\v\f\r\x85\u2028\u2029])/g, "")).replace(/\/[*/]/g, "");
        }(r3, n3), p2 + "this." + g2 + " = " + function(t5, e4) {
          return "Slider" === t5 ? ((e4.min + e4.max) / 2).toString() : "Check" === t5 ? "false" : "Color" === t5 ? 'new Color("#000000")' : "null";
        }(r3, n3) + ";"), t4 = c2.join(l2);
      } catch (t5) {
      }
      return t4;
    }(t3.model.script, e2, r2, n2));
  }, t2.prototype.onVideoReady = function(t3) {
    this.ready && (this.interpreter.setRawProperty(this.interpreter.globalScope, "width", this._player.resolutionWidth), this.interpreter.setRawProperty(this.interpreter.globalScope, "height", this._player.resolutionHeight), this.interpreter.setRawProperty(this.interpreter.globalScope, "margin", this.interpreter.wrap(this._player.margin)), this.interpreter.setRawProperty(this.interpreter.globalScope, "duration", (null == t3 ? void 0 : t3.duration) || 0));
  }, t2;
}();
var ki = function(t2) {
  function e2(e3, r2) {
    var n2 = this.constructor, i2 = t2.call(this, e3) || this;
    return i2.video = r2, Object.setPrototypeOf(i2, n2.prototype), i2;
  }
  return ln(e2, t2), e2;
}(Error);
var ji = function() {
  this.halted = [], this.errors = [];
};
var Ii = function() {
  function t2(t3, e2) {
    var r2 = this;
    this.listener = e2, this.player = null, this._scale = 1, this.playerListener = { onResize: function(t4) {
      r2.elementWidth = t4.width, r2.updateSize();
    }, onVideoReady: function() {
      r2.elementWidth = r2.calcWidth(), r2.updateSize();
    }, onStageElementSet: function(t4) {
      r2.elementWidth = r2.calcWidth(), r2.updateSize(), r2.player.graphics.setCanvas(t4);
    }, onDispose: function() {
      r2.dispose();
    } }, this.requestedTime = 0, this.request = null, this.player = t3, t3.addListener(this.playerListener);
  }
  return Object.defineProperty(t2.prototype, "scale", { get: function() {
    return this._scale;
  }, set: function(t3) {
    this._scale = t3, this.updateSize();
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "width", { get: function() {
    return this.player.graphics.width;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "height", { get: function() {
    return this.player.graphics.height;
  }, enumerable: false, configurable: true }), t2.prototype.requestUpdate = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2 = this;
      return hn(this, function(r2) {
        return this.requestedTime = void 0 === t3 ? this.player.videoPosition : t3, this.request || (this.request = new Promise(function(t4) {
          setTimeout(function() {
            try {
              e2.update(e2.requestedTime);
            } catch (t5) {
            }
            e2.request = null, t4(e2.requestedTime);
          }, 0);
        })), [2, this.request];
      });
    });
  }, t2.prototype.update = function(t3) {
    t3 || (t3 = this.player.mediaPosition), "number" == typeof t3 && (this.player.graphics.reset(), this.animate(t3), this.player.graphics.update(), this.listener.onStageUpdate(t3));
  }, t2.prototype.animate = function(t3) {
    for (var e2 = new ji(), r2 = e2.errors, n2 = e2.halted, i2 = 0, o2 = [this.player.video.firstCredit, this.player.video.firstPhrase, this.player.video.firstWord, this.player.video.firstChar, this.player.video.firstGraphic]; i2 < o2.length; i2++)
      for (var s2 = o2[i2]; s2; )
        this.animateRenderingUnit(t3, s2, e2), s2 = s2.next;
    if (n2.length > 0) {
      console.error("---");
      for (var a2 = 0; a2 < n2.length; a2++)
        console.error("halted", n2[a2], r2[a2]);
    }
  }, t2.prototype.animateRenderingUnit = function(t3, e2, n2) {
    if (e2.animate)
      e2.animate(t3, e2);
    else if (e2.templateCount <= 0)
      Ui(e2) && e2.getType() === r.CHAR && (e2.rendering.visible = false);
    else
      for (var i2 = 0; i2 < e2.templateCount; i2++)
        this.animateTemplate(t3, e2, e2.getTemplate(i2), n2);
  }, t2.prototype.animateTemplate = function(t3, e2, n2, i2) {
    var o2 = this;
    if (n2.ignore)
      e2.rendering.visible = false;
    else {
      if (e2.getType() !== r.GRAPHIC)
        for (var s2 = e2.parent; s2; ) {
          if (s2.templateCount > 0 && (!s2.rendering.visible || 0 === s2.rendering.alpha))
            return void (e2.rendering.visible = false);
          s2 = s2.parent;
        }
      var a2 = this.player.templates.getProperty(n2, "insomnia"), u2 = Ui(e2);
      if (!a2 && u2) {
        var l2 = function(t4, e3, n3, i3) {
          var o3 = i3 && t4(i3, "headTime") || 500, s3 = i3 && t4(i3, "tailTime") || 500;
          return !(n3.startTime - o3 <= e3 && n3.endTime + s3 >= e3) && (n3.getType() !== r.GRAPHIC && (n3.rendering.visible = false), true);
        }(function(t4, e3) {
          return o2.player.templates.getProperty(t4, e3);
        }, t3, e2, n2);
        if (l2)
          return;
      }
      this.doAnimateTemplate(t3, n2, i2);
    }
  }, t2.prototype.doAnimateTemplate = function(t3, e2, r2) {
    var n2 = r2.errors, i2 = r2.halted;
    try {
      this.player.templates.exec(e2, "animate", [t3]);
    } catch (t4) {
      n2.push(t4), i2.push(e2);
    }
  }, t2.prototype.calcWidth = function() {
    var t3 = this.player.stageElement;
    if (!t3)
      return 0;
    var e2 = window.getComputedStyle(t3);
    return t3.offsetWidth - sn(e2.borderLeftWidth) - sn(e2.borderRightWidth) - sn(e2.paddingLeft) - sn(e2.paddingRight);
  }, t2.prototype.updateSize = function() {
    var t3 = this.player.stageElement;
    if (t3) {
      var e2 = this.elementWidth * this.player.videoProportion;
      if (t3.style.height = e2 + "px", t3.width = this.elementWidth * this._scale, t3.height = e2 * this._scale, this.player.video) {
        var r2 = t3.width / this.player.videoWidth;
        this.player.graphics.updateStageTx(r2, this.player.margin), this.player.isPlaying || this.requestUpdate();
      }
    }
  }, t2.prototype.dispose = function() {
    this.player.removeListener(this.playerListener), this.player = null;
  }, t2;
}();
function Ui(t2) {
  if (t2.getType() === r.GRAPHIC)
    return true;
  for (var e2 = true, n2 = t2.parent; n2; ) {
    if (n2.templateCount > 0) {
      e2 = false;
      break;
    }
    n2 = n2.parent;
  }
  return e2;
}
var Fi = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><defs><style>.bg{fill:#1f4391;}.fg{fill:#fff;}</style></defs><g class="logo-sq"><rect class="bg" x="-20" y="-20" width="240" height="240"/><g class="textalive-logo-art"><path class="fg" d="M97.33,130.81V142a3,3,0,0,0,4.78,2.41l56.81-42.09a3,3,0,0,0,0-4.81l-8.33-6.14Z"/><path class="fg" d="M137.14,81.43l-35-25.84A3,3,0,0,0,97.33,58v52.92Z"/><path class="fg" d="M51,55H80.33a2,2,0,0,1,2,2V71.67a0,0,0,0,1,0,0H51a2,2,0,0,1-2-2V57A2,2,0,0,1,51,55Z"/><path class="fg" d="M44.83,107.5h56.33a2,2,0,0,1,2,2v12.67a2,2,0,0,1-2,2H44.83a0,0,0,0,1,0,0V107.5A0,0,0,0,1,44.83,107.5Z" transform="translate(189.83 41.84) rotate(90)"/></g></g></svg>';
var Li = "https://textalive.jp";
var Di = function() {
  function t2(t3) {
    var e2, r2 = this;
    if (this.player = t3, this._position = "embed", this._rounded = false, this._bordered = false, this._shadowed = false, this._background = "#fff", this._color = "#1f4391", void 0 !== (null === (e2 = t3.options) || void 0 === e2 ? void 0 : e2.mediaBannerPosition) && (this._position = t3.options.mediaBannerPosition), this.domEnabled) {
      this.logoAnchor = document.createElement("a"), this.logoAnchor.className = "textalive-logo", this.logoAnchor.innerHTML = Fi, this.logoAnchor.style.padding = this.bordered ? "1px 2px" : "1px 3px", this.logoAnchor.href = Li, this.logoAnchor.target = "_blank", this.logoAnchor.title = "Powered by TextAlive App API", this.logoSvg = this.logoAnchor.querySelector("svg"), this.logoSvg.style.width = "24px", this.songNameDiv = document.createElement("div"), this.songNameDiv.className = "name", this.songNameDiv.style.fontWeight = "bold", this.songNameDiv.style.overflow = "hidden", this.songNameDiv.style.textOverflow = "ellipsis", this.songNameDiv.style.marginBottom = "2px", this.songNameDiv.textContent = "-", this.songArtistDiv = document.createElement("div"), this.songArtistDiv.className = "artist", this.songArtistDiv.textContent = "-", this.songArtistDiv.style.overflow = "hidden", this.songArtistDiv.style.textOverflow = "ellipsis";
      var n2 = document.createElement("span");
      n2.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 150"><g class="song"><path d="M120.95,45.77l-59.12,13a2.57,2.57,0,0,0-2,2.51v47.8c0,13.61-12.4,23.74-24.2,23.74-8.92,0-14.82-4.23-14.82-13,0-13,12.86-21.93,23.9-21.93a16.33,16.33,0,0,1,10,3V35a2.57,2.57,0,0,1,2-2.51l69.41-15.29a2.57,2.57,0,0,1,3.13,2.51V92.84c0,13.61-12.1,23.9-24.2,23.9-8.92,0-14.82-4.24-14.82-13,0-13.16,12.86-21.93,23.9-21.93a16.31,16.31,0,0,1,10,2.87V48.29A2.57,2.57,0,0,0,120.95,45.77Z"/><path d="M35.61,134.36c-10.22,0-16.32-5.42-16.32-14.51,0-13.81,13.38-23.43,25.4-23.43a18.4,18.4,0,0,1,8.48,1.88V35a4,4,0,0,1,3.2-4l69.41-15.29a4.07,4.07,0,0,1,5,4V92.83c0,15-13.54,25.4-25.7,25.4-10.22,0-16.32-5.42-16.32-14.51,0-13.81,13.38-23.43,25.4-23.43A19,19,0,0,1,122.57,82V48.29a1.07,1.07,0,0,0-1.3-1h0l-59.12,13a1.08,1.08,0,0,0-.84,1v47.8C61.3,124,47.76,134.36,35.61,134.36Zm9.07-34.94c-10.57,0-22.4,8.74-22.4,20.43,0,10,8.35,11.51,13.32,11.51,13.38,0,22.7-11.72,22.7-22.24V61.31a4.1,4.1,0,0,1,3.2-4l59.12-13h0a4.07,4.07,0,0,1,5,4V87.56l-2.37-1.67a14.88,14.88,0,0,0-9.12-2.6c-10.59,0-22.4,8.39-22.4,20.43,0,10,8.35,11.51,13.32,11.51,10.74,0,22.7-9.2,22.7-22.4V19.72a1.07,1.07,0,0,0-1.3-1L57,34a1.07,1.07,0,0,0-.84,1v68.83l-2.37-1.67A14.87,14.87,0,0,0,44.68,99.42Z"/></g></svg>', n2.style.padding = "0 3px 0 0", this.songSvg = n2.querySelector("svg"), this.songSvg.style.width = "14px", this.songWrapper = document.createElement("div"), this.songWrapper.style.width = "203px", this.songWrapper.style.maxWidth = "203px", this.songWrapper.appendChild(this.songNameDiv), this.songWrapper.appendChild(this.songArtistDiv), this.songAnchor = document.createElement("a"), this.songAnchor.className = "song", this.songAnchor.target = "_blank", this.songAnchor.style.display = "flex", this.songAnchor.style.lineHeight = "1.2em", this.songAnchor.style.padding = "4px 3px 3px 3px", this.songAnchor.style.textDecoration = "none", this.songAnchor.appendChild(n2), this.songAnchor.appendChild(this.songWrapper), this.lyricsNameDiv = document.createElement("div"), this.lyricsNameDiv.className = "name", this.lyricsNameDiv.style.fontWeight = "bold", this.lyricsNameDiv.textContent = "-", this.lyricsNameDiv.style.overflow = "hidden", this.lyricsNameDiv.style.textOverflow = "ellipsis", this.lyricsNameDiv.style.marginBottom = "2px", this.lyricsArtistDiv = document.createElement("div"), this.lyricsArtistDiv.className = "artist", this.lyricsArtistDiv.textContent = "-", this.lyricsArtistDiv.style.overflow = "hidden", this.lyricsArtistDiv.style.textOverflow = "ellipsis";
      var i2 = document.createElement("span");
      i2.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 150 150"><g class="lyrics"><path d="M78,126.3H67.52l-6.26-23.82H24.4L18.14,126.3H7.7L35.7,22H50ZM27,92.39H58.65l-15.82-61Z"/><path d="M78,128.3H67.52a2,2,0,0,1-1.93-1.49l-5.87-22.33H25.94l-5.87,22.33a2,2,0,0,1-1.93,1.49H7.7a2,2,0,0,1-1.93-2.52l28-104.34A2,2,0,0,1,35.7,20H50a2,2,0,0,1,1.93,1.48l28,104.34A2,2,0,0,1,78,128.3Zm-8.89-4h6.29L48.43,24H37.23L10.31,124.3h6.28L22.46,102a2,2,0,0,1,1.93-1.49H61.26A2,2,0,0,1,63.2,102ZM58.65,94.39H27a2,2,0,0,1-1.94-2.5l15.82-61a2,2,0,0,1,3.87,0l15.82,61a2,2,0,0,1-1.94,2.5Zm-29.06-4H56.07L42.83,39.32Z"/><path d="M106.82,128c-17.74,0-26.43-13-26.43-36.52S89.09,55,106.82,55a21.78,21.78,0,0,1,15.83,6.43L134,56.22V112c0,5.22,1.56,8,4.7,8a7.31,7.31,0,0,0,3.65-1v6.61A17.77,17.77,0,0,1,133.6,128a9.61,9.61,0,0,1-9.74-7.65A22.4,22.4,0,0,1,106.82,128Zm0-10.09a18.15,18.15,0,0,0,16.69-10.61V75.7a18.15,18.15,0,0,0-16.69-10.61c-11.3,0-16,9.56-16,26.43S95.52,118,106.82,118Z"/><path d="M133.6,130A11.61,11.61,0,0,1,123.08,124,24.48,24.48,0,0,1,106.82,130c-13,0-28.43-6.68-28.43-38.52S93.85,53,106.82,53A23.88,23.88,0,0,1,123,59.05l10.08-4.65A2,2,0,0,1,136,56.22V112c0,4,.91,6,2.7,6a5.3,5.3,0,0,0,2.66-.78,2,2,0,0,1,3,1.74v6.61a2,2,0,0,1-1,1.74A19.64,19.64,0,0,1,133.6,130Zm-9.74-11.65a2,2,0,0,1,1.95,1.55,7.63,7.63,0,0,0,7.79,6.1,15.19,15.19,0,0,0,6.69-1.64v-2.52a8.51,8.51,0,0,1-1.65.16c-2.5,0-6.7-1.3-6.7-10V59.34l-8.46,3.91a2,2,0,0,1-2.25-.4A19.67,19.67,0,0,0,106.82,57C90.61,57,82.39,68.62,82.39,91.52S90.61,126,106.82,126a20.33,20.33,0,0,0,15.55-7A2,2,0,0,1,123.86,118.39Zm-17,1.57c-11.94,0-18-9.57-18-28.43s6.06-28.43,18-28.43a20.07,20.07,0,0,1,18.5,11.75,2,2,0,0,1,.19.86v31.65a2,2,0,0,1-.19.86A20.06,20.06,0,0,1,106.82,120Zm0-52.86c-12.55,0-14,13.94-14,24.43,0,21.9,8,24.43,14,24.43a16.13,16.13,0,0,0,14.69-9.07V76.16A16.13,16.13,0,0,0,106.82,67.09Z"/></g></svg>', i2.style.padding = "0 3px 0 0", this.lyricsSvg = i2.querySelector("svg"), this.lyricsSvg.style.width = "14px", this.lyricsWrapper = document.createElement("div"), this.lyricsWrapper.style.width = "90px", this.lyricsWrapper.style.maxWidth = "90px", this.lyricsWrapper.appendChild(this.lyricsNameDiv), this.lyricsWrapper.appendChild(this.lyricsArtistDiv), this.lyricsAnchor = document.createElement("a"), this.lyricsAnchor.className = "lyrics", this.lyricsAnchor.target = "_blank", this.lyricsAnchor.style.display = "flex", this.lyricsAnchor.style.lineHeight = "1.2em", this.lyricsAnchor.style.padding = "4px 3px 3px 3px", this.lyricsAnchor.style.textDecoration = "none", this.lyricsAnchor.appendChild(i2), this.lyricsAnchor.appendChild(this.lyricsWrapper), this.bannerDiv = document.createElement("div"), this.bannerDiv.className = "textalive-banner", this.bannerDiv.style.cursor = "pointer", this.bannerDiv.style.zIndex = "10000", this.bannerDiv.style.background = "#1f4391", this.bannerDiv.style.lineHeight = "0", this.bannerDiv.style.display = "flex", this.bannerDiv.style.maxWidth = "256px", this.bannerDiv.style.fontFamily = "'Hiragino Kaku Gothic Pro','','Yu Gothic',YuGothic,Meiryo,HelveticaNeue,'Helvetica Neue',Helvetica,Arial,sans-serif", this.bannerDiv.style.fontSize = "9px", this.bannerDiv.style.alignItems = "center", this.bannerDiv.style.whiteSpace = "nowrap", this.bannerDiv.appendChild(this.logoAnchor), this.bannerDiv.appendChild(this.songAnchor), this.bannerDiv.appendChild(this.lyricsAnchor), this.songAnchor.style.display = "none", this.lyricsAnchor.style.display = "none", this.updatePosition(), this.updateRounded(), this.updateBordered(), this.updateShadowed(), this.updateBackground(), this.updateColor();
    }
    this.listener = { onAppReady: function() {
      r2.updatePosition();
    }, onMediaElementSet: function(t4) {
      r2.domEnabled && (r2.bannerDiv && r2.bannerDiv.parentElement && r2.bannerDiv.parentElement.removeChild(r2.bannerDiv), r2.player.mediaBannerElement && r2.player.mediaBannerElement.appendChild(r2.bannerDiv));
    }, onVideoLoad: function() {
      r2.domEnabled && (r2.logoAnchor.href = Li, r2.songAnchor.style.display = "none", r2.lyricsAnchor.style.display = "none", r2.songAnchor.style.borderRadius = "0");
    }, onSongLoad: function(t4) {
      return pn(r2, void 0, void 0, function() {
        var e3, r3, n3, i3, o2, s2, a2, l2, c2;
        return hn(this, function(p2) {
          switch (p2.label) {
            case 0:
              return t4 ? (e3 = null === (a2 = null === (s2 = null == t4 ? void 0 : t4.song) || void 0 === s2 ? void 0 : s2.artist) || void 0 === a2 ? void 0 : a2.name, r3 = null === (l2 = null == t4 ? void 0 : t4.song) || void 0 === l2 ? void 0 : l2.name, n3 = null === (c2 = null == t4 ? void 0 : t4.song) || void 0 === c2 ? void 0 : c2.permalink, i3 = Li + (n3 ? "/songs/" + encodeURIComponent(u.getSongPathFromUrl(n3)) : ""), this.domEnabled && (this.logoAnchor.href = i3, this.songArtistDiv.textContent = Mi(e3), this.songNameDiv.textContent = Mi(r3), this.songAnchor.title = Mi(r3) + " by " + Mi(e3), this.songAnchor.href = n3, this.songAnchor.style.display = "flex", this.songAnchor.style.borderRadius = this.rounded ? "0 4px 4px 0" : "0", this.songWrapper.style.width = "auto"), [4, T.getServerStatus()]) : [2];
            case 1:
              return "ja" === (null == (o2 = p2.sent()) ? void 0 : o2.lang) ? console.warn("[TextAlive API]  :", Mi(e3), "/ :", Mi(r3), "/ :", Mi(n3)) : console.warn("[TextAlive API] Song artist:", Mi(e3), "/ song name:", Mi(r3), "/ distributed at:", Mi(n3)), [2];
          }
        });
      });
    }, onLyricsLoad: function(t4) {
      t4 && (r2.songWrapper.style.maxWidth = "90px", r2.lyricsAnchor.style.display = "flex", r2.songAnchor.style.borderRadius = "0");
    }, onTextLoad: function(t4) {
      return pn(r2, void 0, void 0, function() {
        var e3, r3, n3, i3, o2;
        return hn(this, function(s2) {
          switch (s2.label) {
            case 0:
              return t4 ? (e3 = null === (o2 = null == t4 ? void 0 : t4.artist) || void 0 === o2 ? void 0 : o2.name, r3 = null == t4 ? void 0 : t4.name, n3 = null == t4 ? void 0 : t4.url, this.domEnabled && (this.lyricsArtistDiv.textContent = Mi(e3), this.lyricsNameDiv.textContent = Mi(r3), this.lyricsAnchor.title = Mi(r3) + " by " + Mi(e3), this.lyricsAnchor.href = n3, this.lyricsWrapper.style.width = "auto"), [4, T.getServerStatus()]) : [2];
            case 1:
              return "ja" === (null == (i3 = s2.sent()) ? void 0 : i3.lang) ? console.warn("[TextAlive API]  :", Mi(e3), "/ :", Mi(r3), "/ :", Mi(n3)) : console.warn("[TextAlive API] Song lyrics artist:", Mi(e3), "/ lyrics name:", Mi(r3), "/ distributed at:", Mi(n3)), [2];
          }
        });
      });
    }, onDispose: function() {
      this.dispose();
    } }, t3.addListener(this.listener), t3.mediaBannerElement && this.player.mediaBannerElement.appendChild(this.bannerDiv);
  }
  return Object.defineProperty(t2.prototype, "domEnabled", { get: function() {
    return "undefined" != typeof window;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "position", { get: function() {
    return this._position;
  }, set: function(t3) {
    this._position = t3, this.updatePosition();
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "rounded", { get: function() {
    return this._rounded;
  }, set: function(t3) {
    this._rounded = t3, this.updateRounded();
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "bordered", { get: function() {
    return this._bordered;
  }, set: function(t3) {
    this._bordered = t3, this.updateBordered();
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "shadowed", { get: function() {
    return this._shadowed;
  }, set: function(t3) {
    this._shadowed = t3, this.updateShadowed();
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "background", { get: function() {
    return this._background;
  }, set: function(t3) {
    this._background = t3, this.updateBackground();
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "color", { get: function() {
    return this._color;
  }, set: function(t3) {
    this._color = t3, this.updateColor();
  }, enumerable: false, configurable: true }), t2.prototype.dispose = function() {
    this.player.removeListener(this.listener);
  }, t2.prototype.updatePosition = function() {
    var t3, e2;
    if (this.domEnabled) {
      var r2 = this.position, n2 = this.player;
      if (null === r2 || !(null === (t3 = n2.options) || void 0 === t3 ? void 0 : t3.app) || (null === (e2 = n2.app) || void 0 === e2 ? void 0 : e2.managed))
        this.bannerDiv.style.display = "none";
      else if (this.bannerDiv.style.display = "flex", "embed" === r2)
        this.bannerDiv.style.position = "initial", this.bannerDiv.style.marginTop = "4px", this.songAnchor.style.flexGrow = "1", this.lyricsAnchor.style.flexGrow = "1";
      else {
        this.bannerDiv.style.position = "fixed", this.bannerDiv.style.marginTop = "0";
        var i2 = r2.indexOf("top") >= 0, o2 = r2.indexOf("right") >= 0, s2 = r2.indexOf("bottom") >= 0, a2 = r2.indexOf("left") >= 0;
        this.bannerDiv.style.top = i2 ? "4px" : "initial", this.bannerDiv.style.right = o2 ? "4px" : "initial", this.bannerDiv.style.bottom = s2 ? "4px" : "initial", this.bannerDiv.style.left = a2 ? "4px" : "initial", this.songAnchor.style.flexGrow = "0", this.lyricsAnchor.style.flexGrow = "0";
      }
    }
  }, t2.prototype.updateRounded = function() {
    if (this.domEnabled) {
      var t3 = this.rounded;
      this.logoSvg.style.borderRadius = t3 ? "4px 0 0 4px" : "0", this.lyricsAnchor.style.borderRadius = t3 ? "0 4px 4px 0" : "0", this.bannerDiv.style.borderRadius = t3 ? "4px" : "0";
    }
  }, t2.prototype.updateBordered = function() {
    if (this.domEnabled) {
      var t3 = this.bordered;
      this.logoAnchor.style.padding = t3 ? "1px 2px" : "1px 3px", this.bannerDiv.style.border = t3 ? "1px solid rgba(31, 67, 145, 0.3)" : "none";
    }
  }, t2.prototype.updateShadowed = function() {
    if (this.domEnabled) {
      var t3 = this.shadowed;
      this.bannerDiv.style.boxShadow = t3 ? "1px 1px 3px 0 rgba(9, 19, 42, 0.9)" : "none";
    }
  }, t2.prototype.updateBackground = function() {
    this.domEnabled && (this.songAnchor.style.background = this.background, this.lyricsAnchor.style.background = this.background);
  }, t2.prototype.updateColor = function() {
    this.domEnabled && (this.songSvg.style.fill = this.color, this.songAnchor.style.color = this.color, this.lyricsSvg.style.fill = this.color, this.lyricsAnchor.style.color = this.color);
  }, t2;
}();
function Mi(t2) {
  return t2 && "" !== t2 ? t2 : "-";
}
function Bi(t2, e2) {
  var r2 = e2.parser;
  return pn(this, void 0, void 0, function() {
    var e3, n2, i2;
    return hn(this, function(o2) {
      switch (o2.label) {
        case 0:
          return t2 && t2.length > 0 && t2[0].words && t2[0].words.length > 0 && t2[0].words[0] && !t2[0].words[0].pos ? (e3 = t2.map(function(t3) {
            return t3.words.map(function(t4) {
              return t4.characters.map(function(t5) {
                return t5.char;
              }).join("");
            }).join(" ");
          }), n2 = e3.join("\n"), [4, r2(n2)]) : [2];
        case 1:
          return (i2 = o2.sent()) && "success" === i2.status ? (t2.forEach(function(t3, r3) {
            var n3 = i2.result[r3], o3 = 0;
            t3.words.forEach(function(t4) {
              var i3 = t4.characters.map(function(t5) {
                return t5.char;
              }).join(""), s2 = e3[r3].indexOf(i3, o3);
              if (!(s2 < 0)) {
                o3 = s2;
                var a2 = n3.find(function(t5) {
                  return t5.startPosition <= s2 && t5.endPosition >= s2;
                });
                a2 && (t4.pos = a2.PoS, t4.rawPoS = a2.rawPoS, t4.language = a2.language);
              }
            });
          }), [2]) : [2];
      }
    });
  });
}
function Vi(t2) {
  for (; t2.firstElementChild; )
    t2.removeChild(t2.firstElementChild);
}
function Gi(t2, e2) {
  var r2 = e2.id, n2 = e2.data, i2 = e2.loader, o2 = e2.deserializer;
  return pn(this, void 0, void 0, function() {
    return hn(this, function(e3) {
      switch (e3.label) {
        case 0:
          return r2 && r2 >= 0 ? [4, i2(r2)] : [3, 2];
        case 1:
          e3.sent(), e3.label = 2;
        case 2:
          return o2(t2, n2), [2];
      }
    });
  });
}
function qi(t2) {
  return "string" != typeof t2 ? t2 : "undefined" == typeof window ? null : document.querySelector(t2);
}
var Wi = function() {
  function t2(t3) {
    this._mediaPosition = 0, this._videoPosition = 0, this.isEditing = false, this._isVideoSeeking = false, this._volume = 100, this._options = t3, this.emitter = new bn(t3), this._templates = new Ni(this, this.emitter, t3 && t3.unsafeAcceleration);
    var e2 = Object.assign({}, q);
    t3 && t3.managers && (e2 = Object.assign(e2, t3.managers)), this.managers = e2, this._timer = t3 && t3.timer || this.createDefaultTimer(), this._data = new Ln(e2, this.emitter, t3), this._backgroundGraphics = new _n(this, e2.asset, this.emitter), this._graphics = t3 && t3.graphics || this.createDefaultGraphicsDriver(), this.stage = new Ii(this, { onStageUpdate: this.onStageUpdate.bind(this) }), this._banner = new Di(this), this.stageElement = qi(null == t3 ? void 0 : t3.stageElement) || null, this.mediaElement = qi(null == t3 ? void 0 : t3.mediaElement) || null, this._app = new Dn(this, this.emitter);
  }
  return Object.defineProperty(t2.prototype, "options", { get: function() {
    return this._options ? cn({}, this._options) : null;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "app", { get: function() {
    return this._app;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "data", { get: function() {
    return this._data;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "backgroundGraphics", { get: function() {
    return this._backgroundGraphics;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "video", { get: function() {
    return this._video;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "templates", { get: function() {
    return this._templates;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "graphics", { get: function() {
    return this._graphics;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "stageElement", { get: function() {
    return this._stageElement;
  }, set: function(t3) {
    this._stageElement = t3, this.emitter.onStageElementSet(t3);
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "stageScale", { get: function() {
    return this.stage.scale;
  }, set: function(t3) {
    this.stage.scale = t3;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "mediaElement", { get: function() {
    return this._mediaElement;
  }, set: function(t3) {
    this.updateMediaElement(t3);
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "mediaSourceElement", { get: function() {
    return this._mediaSourceElement;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "mediaBannerElement", { get: function() {
    return this._mediaBannerElement;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "mediaPosition", { get: function() {
    return this._mediaPosition;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "videoPosition", { get: function() {
    return this._videoPosition;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "wait", { get: function() {
    return this._timer ? this._timer.wait : 0;
  }, set: function(t3) {
    this._timer && (this._timer.wait = t3);
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "fps", { get: function() {
    return 1e3 / this.wait;
  }, set: function(t3) {
    this.wait = 1e3 / t3;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "resolutionWidth", { get: function() {
    var t3, e2, r2, n2;
    return "object" == typeof (null === (e2 = null === (t3 = this._data) || void 0 === t3 ? void 0 : t3.video) || void 0 === e2 ? void 0 : e2.config) && "number" == typeof this._data.video.config.width ? this._data.video.config.width : "number" == typeof (null === (n2 = null === (r2 = this._options) || void 0 === r2 ? void 0 : r2.defaultVideoSize) || void 0 === n2 ? void 0 : n2.width) ? this._options.defaultVideoSize.width : 1280;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "resolutionHeight", { get: function() {
    var t3, e2, r2, n2;
    return "object" == typeof (null === (e2 = null === (t3 = this._data) || void 0 === t3 ? void 0 : t3.video) || void 0 === e2 ? void 0 : e2.config) && "number" == typeof this._data.video.config.height ? this._data.video.config.height : "number" == typeof (null === (n2 = null === (r2 = this._options) || void 0 === r2 ? void 0 : r2.defaultVideoSize) || void 0 === n2 ? void 0 : n2.height) ? this._options.defaultVideoSize.height : 720;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "resolutionProportion", { get: function() {
    return this.resolutionHeight / this.resolutionWidth;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "margin", { get: function() {
    var t3, e2, r2, n2;
    return "object" == typeof (null === (e2 = null === (t3 = this._data) || void 0 === t3 ? void 0 : t3.video) || void 0 === e2 ? void 0 : e2.config) && this._data.video.config.margin ? this._data.video.config.margin : (null === (n2 = null === (r2 = this._options) || void 0 === r2 ? void 0 : r2.defaultVideoSize) || void 0 === n2 ? void 0 : n2.margin) || yn;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "videoWidth", { get: function() {
    var t3 = this.resolutionWidth, e2 = this.margin;
    return t3 + e2[1] + e2[3];
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "videoHeight", { get: function() {
    var t3 = this.resolutionHeight, e2 = this.margin;
    return t3 + e2[0] + e2[2];
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "videoProportion", { get: function() {
    return this.videoHeight / this.videoWidth;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "stageWidth", { get: function() {
    return this.stage.width;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "stageHeight", { get: function() {
    return this.stage.height;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "isLoading", { get: function() {
    return !!this._videoPromise;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "isPlaying", { get: function() {
    return !!this._timer && this._timer.isPlaying;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "isVideoSeeking", { get: function() {
    return this._isVideoSeeking;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "banner", { get: function() {
    return this._banner;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "timer", { get: function() {
    return this._timer;
  }, enumerable: false, configurable: true }), Object.defineProperty(t2.prototype, "volume", { get: function() {
    return this._volume;
  }, set: function(t3) {
    isNaN(t3) || (this._volume = Math.min(100, Math.max(0, t3)), this.emitter.onVolumeUpdate(this._volume));
  }, enumerable: false, configurable: true }), t2.prototype.createDefaultTimer = function() {
    try {
      if ("undefined" != typeof window && "basic" !== an("ta_timer"))
        return new mn();
    } catch (t3) {
    }
    return new vn();
  }, t2.prototype.createDefaultGraphicsDriver = function() {
    return new ct();
  }, t2.prototype.addListener = function(t3) {
    return this.emitter.addListener(t3);
  }, t2.prototype.removeListener = function(t3) {
    return this.emitter.removeListener(t3);
  }, t2.prototype.createFromVideoId = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2 = this;
      return hn(this, function(n2) {
        return [2, this.create(function() {
          return r2.doCreateFromVideoId(t3, e2);
        }, null == e2 ? void 0 : e2.dryRun)];
      });
    });
  }, t2.prototype.doCreateFromVideoId = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, (r2 = new Ln(this.managers, this.emitter, this._options)).createFromVideoId(t3, null == e2 ? void 0 : e2.video)];
          case 1:
            return n2.sent(), [2, this.finalize(r2, e2)];
        }
      });
    });
  }, t2.prototype.createFromVideo = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2 = this;
      return hn(this, function(n2) {
        return [2, this.create(function() {
          return r2.doCreateFromVideo(t3, e2);
        }, null == e2 ? void 0 : e2.dryRun)];
      });
    });
  }, t2.prototype.doCreateFromVideo = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        return (r2 = new Ln(this.managers, this.emitter, this._options)).createFromVideo(t3, null == e2 ? void 0 : e2.video), [2, this.finalize(r2, e2)];
      });
    });
  }, t2.prototype.createFromSongUrl = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2 = this;
      return hn(this, function(n2) {
        return [2, this.create(function() {
          return r2.doCreateFromSongUrl(t3, e2);
        }, null == e2 ? void 0 : e2.dryRun)];
      });
    });
  }, t2.prototype.doCreateFromSongUrl = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, (r2 = new Ln(this.managers, this.emitter, this._options)).createFromSongUrl(t3, null == e2 ? void 0 : e2.video)];
          case 1:
            return n2.sent(), [2, this.finalize(r2, e2)];
        }
      });
    });
  }, t2.prototype.createFromSongPath = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2 = this;
      return hn(this, function(n2) {
        return [2, this.create(function() {
          return r2.doCreateFromSongPath(t3, e2);
        }, null == e2 ? void 0 : e2.dryRun)];
      });
    });
  }, t2.prototype.doCreateFromSongPath = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, (r2 = new Ln(this.managers, this.emitter, this._options)).createFromSongPath(t3, null == e2 ? void 0 : e2.video)];
          case 1:
            return n2.sent(), [2, this.finalize(r2, e2)];
        }
      });
    });
  }, t2.prototype.createFromSongId = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2 = this;
      return hn(this, function(n2) {
        return [2, this.create(function() {
          return r2.doCreateFromSongId(t3, e2);
        }, null == e2 ? void 0 : e2.dryRun)];
      });
    });
  }, t2.prototype.doCreateFromSongId = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, (r2 = new Ln(this.managers, this.emitter, this._options)).createFromSongId(t3, null == e2 ? void 0 : e2.video)];
          case 1:
            return n2.sent(), [2, this.finalize(r2, e2)];
        }
      });
    });
  }, t2.prototype.createFromSongCode = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2 = this;
      return hn(this, function(n2) {
        return [2, this.create(function() {
          return r2.doCreateFromSongCode(t3, e2);
        }, null == e2 ? void 0 : e2.dryRun)];
      });
    });
  }, t2.prototype.doCreateFromSongCode = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, (r2 = new Ln(this.managers, this.emitter, this._options)).createFromSongCode(t3, null == e2 ? void 0 : e2.video)];
          case 1:
            return n2.sent(), [2, this.finalize(r2, e2)];
        }
      });
    });
  }, t2.prototype.createFromText = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2 = this;
      return hn(this, function(n2) {
        return [2, this.create(function() {
          return r2.doCreateFromText(t3, e2);
        }, null == e2 ? void 0 : e2.dryRun)];
      });
    });
  }, t2.prototype.doCreateFromText = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        switch (n2.label) {
          case 0:
            return [4, (r2 = new Ln(this.managers, this.emitter, this._options)).createFromText(t3, null == e2 ? void 0 : e2.video)];
          case 1:
            return n2.sent(), [2, this.finalize(r2, e2)];
        }
      });
    });
  }, t2.prototype.createFromJSON = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2 = this;
      return hn(this, function(n2) {
        return [2, this.create(function() {
          return r2.doCreateFromJSON(t3, e2);
        }, null == e2 ? void 0 : e2.dryRun)];
      });
    });
  }, t2.prototype.doCreateFromJSON = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2;
      return hn(this, function(n2) {
        return (r2 = new Ln(this.managers, this.emitter, this._options)).createFromJSON(t3, null == e2 ? void 0 : e2.video), [2, this.finalize(r2, e2)];
      });
    });
  }, t2.prototype.create = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2, n2 = this;
      return hn(this, function(i2) {
        if (this._videoPromise && !e2)
          throw new ki("Player.createFrom* method calls cannot run in parallel", this._videoPromise);
        return r2 = t3(), e2 || (this._videoPromise = r2, r2.finally(function() {
          return n2._videoPromise = null;
        })), [2, r2];
      });
    });
  }, t2.prototype.finalize = function(t3, e2) {
    return pn(this, void 0, void 0, function() {
      var r2, n2, i2, o2 = this;
      return hn(this, function(s2) {
        switch (s2.label) {
          case 0:
            return t3.video ? [4, Promise.all([t3.finalize(e2), this.backgroundGraphics.setBackground(t3.video.background)])] : [2, null];
          case 1:
            return s2.sent(), (null == e2 ? void 0 : e2.dryRun) ? [2, null] : (r2 = t3.video.json, function(t4, e3) {
              var r3 = e3.config, n3 = e3.song;
              r3 && "object" == typeof r3 && "number" == typeof r3.duration ? t4.duration = r3.duration : n3 ? t4.duration = 1e3 * n3.length : t4.duration || (t4.duration = t4.endTime);
            }(n2 = new nt(r2), { config: t3.video.config, song: t3.song }), [4, Promise.all([this.graphics.createRuntime(n2), Gi(n2, { id: t3.video.id, data: r2, loader: function(t4) {
              return pn(o2, void 0, void 0, function() {
                return hn(this, function(e3) {
                  switch (e3.label) {
                    case 0:
                      return [4, this.templates.loadForVideo(t4)];
                    case 1:
                      return e3.sent(), [2];
                  }
                });
              });
            }, deserializer: function(t4, e3) {
              return o2.templates.importInstances(t4, e3);
            } }), Bi(null == r2 ? void 0 : r2.phrases, { parser: x.parse.bind(x) })])]);
          case 2:
            return s2.sent(), this._data, this._video && this.templates.disposeInstances(this._video), this._data = t3, this._video = n2, this.emitter.onVideoReady(n2), i2 = (null == e2 ? void 0 : e2.altSourceUrl) || void 0, [4, this._timer.initialize({ player: this, updater: this.updateMediaPosition.bind(this), emitter: this.emitter, altSourceUrl: i2 })];
          case 3:
            return s2.sent(), this.emitter.onTimerReady(this._timer), [2, n2];
        }
      });
    });
  }, t2.prototype.updateMediaPosition = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2 = this;
      return hn(this, function(r2) {
        return this._isVideoSeeking ? (this._mediaPosition = t3, this.emitter.onMediaSeek(t3), [2, t3]) : [2, this.stage.requestUpdate(t3).then(function(t4) {
          return e2._mediaPosition = t4, e2._videoPosition = t4, e2.emitter.onMediaSeek(t4), t4;
        })];
      });
    });
  }, t2.prototype.exportVideo = function(t3) {
    return void 0 === t3 && (t3 = { legacyStringMode: true }), pn(this, void 0, void 0, function() {
      var e2, r2, n2, i2;
      return hn(this, function(o2) {
        return e2 = { sourceId: this._data.video.id, sourceOriginId: this._data.video.sourceOriginId, songleId: this._data.song.id, lyricId: this._data.lyricsId, lyricDiffId: this._data.lyrics ? this._data.lyrics.id : -1, config: ((null == t3 ? void 0 : t3.legacyStringMode) ? this._data.video.config && JSON.stringify(this._data.video.config) : this._data.video.config) || null }, r2 = this.backgroundGraphics.exportPartialVideoEntry(t3), n2 = this._video.exportData(this._templates), i2 = (null == t3 ? void 0 : t3.legacyStringMode) ? JSON.stringify(n2) : n2, [2, cn(cn(cn({}, e2), r2), { json: i2 })];
      });
    });
  }, t2.prototype.getChoruses = function() {
    return this._data.getChoruses();
  }, t2.prototype.findChorus = function(t3, e2) {
    return this._data.findChorus(t3, e2);
  }, t2.prototype.findChorusBetween = function(t3, e2) {
    return this._data.findChorusBetween(t3, e2);
  }, t2.prototype.getBeats = function() {
    return this._data.getBeats();
  }, t2.prototype.findBeat = function(t3, e2) {
    return this._data.findBeat(t3, e2);
  }, t2.prototype.getChords = function() {
    return this._data.getChords();
  }, t2.prototype.findChord = function(t3, e2) {
    return this._data.findChord(t3, e2);
  }, t2.prototype.getVocalFrequency = function(t3) {
    return this._data.getVocalFrequency(t3);
  }, t2.prototype.getVocalAmplitude = function(t3) {
    return this._data.getVocalAmplitude(t3);
  }, t2.prototype.getMaxVocalAmplitude = function() {
    return this._data.getMaxVocalAmplitude();
  }, t2.prototype.getValenceArousal = function(t3) {
    return this._data.getValenceArousal(t3);
  }, t2.prototype.getMedianValenceArousal = function() {
    return this._data.getMedianValenceArousal();
  }, t2.prototype.resize = function(t3) {
    return this.emitter.onResize(t3);
  }, t2.prototype.onResize = function(t3) {
    return this.resize(t3);
  }, t2.prototype.setStageElement = function(t3) {
    return this._stageElement = t3, this.emitter.onStageElementSet(t3);
  }, t2.prototype.setMediaElement = function(t3) {
    this.mediaElement = t3;
  }, t2.prototype.updateMediaElement = function(t3) {
    "undefined" != typeof document && (this._mediaElement && Vi(this._mediaElement), t3 ? (Vi(t3), this._mediaSourceElement || (this._mediaSourceElement = document.createElement("div"), this._mediaSourceElement.classList.add("textalive-media-wrapper")), t3.appendChild(this._mediaSourceElement), this._mediaBannerElement || (this._mediaBannerElement = document.createElement("div"), this._mediaSourceElement.classList.add("textalive-banner-wrapper")), t3.appendChild(this._mediaBannerElement)) : (this._mediaSourceElement = null, this._mediaBannerElement = null)), this._mediaElement = t3, this.emitter.onMediaElementSet(t3);
  }, t2.prototype.setVideoPosition = function(t3) {
    return pn(this, void 0, void 0, function() {
      var e2 = this;
      return hn(this, function(r2) {
        return [2, this.stage.requestUpdate(t3).then(function(t4) {
          return e2._videoPosition = t4, e2.emitter.onVideoSeek(t4), t4;
        })];
      });
    });
  }, t2.prototype.setMediaPosition = function(t3) {
    return pn(this, void 0, void 0, function() {
      return hn(this, function(e2) {
        return this.requestMediaSeek(t3), [2];
      });
    });
  }, t2.prototype.requestPlay = function() {
    return this._timer.play(), true;
  }, t2.prototype.requestStop = function() {
    return this._timer.stop(), true;
  }, t2.prototype.requestPause = function() {
    return this._timer.pause(), true;
  }, t2.prototype.requestMediaSeek = function(t3) {
    return this._timer.seek(t3), true;
  }, t2.prototype.startVideoSeek = function() {
    return this._isVideoSeeking = true, this.emitter.onVideoSeekStart();
  }, t2.prototype.endVideoSeek = function() {
    return this._isVideoSeeking = false, this.emitter.onVideoSeekEnd();
  }, t2.prototype.requestSettingBackground = function(t3) {
    return pn(this, void 0, void 0, function() {
      return hn(this, function(e2) {
        return [2, this.backgroundGraphics.settingBackground(t3)];
      });
    });
  }, t2.prototype.requestSetBackground = function(t3) {
    return pn(this, void 0, void 0, function() {
      return hn(this, function(e2) {
        return [2, this.backgroundGraphics.setBackground(t3)];
      });
    });
  }, t2.prototype.requestStageUpdate = function() {
    return pn(this, void 0, void 0, function() {
      return hn(this, function(t3) {
        return [2, this.stage.requestUpdate()];
      });
    });
  }, t2.prototype.onStageUpdate = function(t3) {
    this._isVideoSeeking || this.emitter.onTimeUpdate(t3);
  }, t2.prototype.dispose = function() {
    this._timer && (this._timer.dispose(), this._timer = null), this.mediaElement && (Vi(this._mediaElement), this._mediaElement = null), this.stageElement && (this._stageElement = null), this.emitter.onDispose();
  }, t2;
}();
console.log("# \n\n\n\n\n\nTextAlive App API\nTextAlive App API TextAlive https://textalive.jp/  https://developer.textalive.jp/ \n\n# \n\ntextalive-ml@aist.go.jp");
var Yi = e.exports.sortedIndex;
export {
  vn as BasicTimer,
  Z as Color,
  Oi as Ease,
  st as Matrix2D,
  ct as NullGraphicsDriver,
  Wi as Player,
  Fi as PlayerLogoImage,
  at as Point,
  mn as SongleTimer,
  r as UnitTypes,
  E as dataUrlToString,
  rt as findTimedObject,
  P as isStringEncodedDataUrl,
  Yi as sortedIndex,
  O as stringToDataUrl
};
//# sourceMappingURL=textalive-app-api.js.map
